window.$P=function(){};if("undefined"!==typeof(coherent)){throw new Error("Library module (coherent) already defined")}var coherent={version:"@VERSION@",revision:"@REVISION@",generateUid:(function(){var a=0;return function(){return ++a}})()};var transitionEndName="",animationEndName="",docStyle=document&&document.documentElement.style;coherent.Browser={IE:!!(!window.opera)&&(function(){var d=/Trident.+rv:(\d+)/;var b=d.exec(navigator.userAgent);if(b){return b&&parseInt(b[1],10)}else{var c=/MSIE (\d+)/;var a=c.exec(navigator.userAgent);return a&&parseInt(a[1],10)}})(),Safari:navigator.userAgent.indexOf("AppleWebKit/")>-1,Safari2:(function(){var a=/AppleWebKit\/(\d+(?:\.\d+)?)/;var b=a.exec(navigator.userAgent);return(b&&parseInt(b[1],10)<420)})(),Mozilla:navigator.userAgent.indexOf("Gecko")>-1&&navigator.userAgent.indexOf("KHTML")==-1,MobileSafari:!!navigator.userAgent.match(/Apple.*Mobile.*Safari/)&&!navigator.userAgent.match(/Android/),Chrome:navigator.userAgent.indexOf("Chrome")>-1,AppleStoreApp:!!navigator.userAgent.match(/Apple.*Store.*App/)||!!navigator.userAgent.match(/ASA\//)};coherent.OS={Mac:navigator.userAgent.indexOf("Mac OS X")>-1&&navigator.userAgent.indexOf("Mobile")==-1,Windows:navigator.userAgent.indexOf("Windows")>-1,Linux:navigator.userAgent.indexOf("Linux")>-1,iPhone:navigator.userAgent.indexOf("iPhone")>-1};if(("transition" in docStyle||"MozTransition" in docStyle)&&window.ontransitionend!==undefined){transitionEndName="transitionend";animationEndName="animationend"}else{if("msTransition" in docStyle){transitionEndName="MSTransitionEnd";animationEndName="MSAnimationEnd"}else{if("WebkitTransition" in docStyle){transitionEndName="webkitTransitionEnd";animationEndName="webkitAnimationEnd"}}}coherent.Support={Properties:("__defineGetter__" in Object.prototype),QuerySelector:("querySelector" in document),Touches:!!document.createTouch,CSS3ColorModel:false,CSSTransitions:false,transitionEnd:transitionEndName,animationEnd:animationEndName,threeDTransforms:false};if(coherent.Support.Properties){coherent.Support.__defineGetter__("CSS3ColorModel",function(){delete this.CSS3ColorModel;var b=document.createElement("span");try{b.style.backgroundColor="rgba(100,100,100,0.5)";return this.CSS3ColorModel=(b.style.length===1)}catch(a){}return(this.CSS3ColorModel=false)});coherent.Support.__defineGetter__("CSSTransitions",function(){delete this.CSSTransitions;var b=document.createElement("span");try{b.style.setProperty("-webkit-transition-duration","1ms","");b.style.setProperty("-o-transition-duration","1ms","");b.style.setProperty("-moz-transition-duration","1ms","");return this.CSSTransitions=(b.style.length>0)}catch(a){}return(this.CSSTransitions=false)});coherent.Support.__defineGetter__("threeDTransforms",function(){delete this.threeDTransforms;var a=Object.prototype.hasOwnProperty;var f,b,d;try{d=false;if(a.call(window,"styleMedia")){d=window.styleMedia.matchMedium("(-webkit-transform-3d)")}else{if(a.call(window,"media")){d=window.media.matchMedium("(-webkit-transform-3d)")}}if(!d){if(!(b=document.getElementById("supportsThreeDStyle"))){b=document.createElement("style");b.id="supportsThreeDStyle";b.textContent="@media (transform-3d),(-o-transform-3d),(-moz-transform-3d),(-ms-transform-3d),(-webkit-transform-3d) { #supportsThreeD { height:3px } }";document.querySelector("head").appendChild(b)}if(!(f=document.querySelector("#supportsThreeD"))){f=document.createElement("div");f.id="supportsThreeD";document.body.appendChild(f)}d=(f.offsetHeight===3)||b.style.MozTransform!==undefined||b.style.WebkitTransform!==undefined}return(this.threeDTransforms=d)}catch(c){return(this.threeDTransforms=false)}})}coherent.typeOf=function(b){if(null===b){return"null"}var a=typeof(b);if("object"!==a&&"function"!==a){return a}return Object.prototype.toString.call(b).slice(8,-1).toLowerCase()};coherent.compareValues=function(f,d){var c=coherent.typeOf(f);if(c!==coherent.typeOf(d)){var a=String(f);var e=String(d);return a.localeCompare(e)}switch(c){case"null":return 0;case"boolean":case"number":var b=(f-d);if(0===b){return b}return(b<0?-1:1);case"regexp":case"function":break;case"string":case"array":case"object":if(f.localeCompare){return f.localeCompare(d)}if(f.compare){return f.compare(d)}break;case"undefined":return true;default:throw new TypeError("Unknown type for comparison: "+c)}return String(f).localeCompare(String(d))};coherent.defineError=function(b){function a(c){this.message=c;this.name=b}a.prototype=new Error;a.prototype.constructor=a;a.prototype.name=b;return a};var InvalidArgumentError=coherent.defineError("InvalidArgumentError");if("undefined"==typeof(window.console)){window.console={}}if("undefined"==typeof(window.console.log)){window.console.log=function(){}}String.prototype.titleCase=function(){return this.charAt(0).toUpperCase()+this.substr(1)};String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")};String.prototype.decodeUrl=function(){return decodeURIComponent(this.trim().replace(/\+/g," "))};String.prototype.beginsWith=function(a){return a===this.substring(0,a.length)};if(!String.prototype.localeCompare){String.prototype.localeCompare=function(a){if(this<a){return -1}else{if(this>a){return 1}else{return 0}}}}String.prototype.expand=function(c,a){function b(f,d){var e=c[d];if(null===e||"undefined"===typeof(e)){return a}return e}return this.replace(/\$\{(\w+)\}/g,b)};String.prototype.times=function(b){if(isNaN(b)||b<=0){return""}var a=this;while(--b){a+=this}return a};String.prototype.truncate=function truncate(){var c=arguments[0],b=coherent.typeOf(c)==="number",i=b?{}:(c||{}),e=this.toString(),d=Math,a=b?c:(i.length||30),h,g=i.omission||"\u2026",f=i.from||"start";if(this.length>a){switch(f){case"start":case"beginning":e=this.slice(0,a).stripPunctuationAtEnd().trim()+g;break;case"middle":h=d.floor(a/2);e=[this.slice(0,h).stripPunctuationAtEnd().trim(),g,this.slice(-h).stripPunctuationAtStart().trim()].join(" ");break;case"end":case"ending":e=g+this.slice(-a).stripPunctuationAtStart().trim();break;default:break}}return e};String.prototype.escapeForInnerHTML=function(){var a=document.createElement("div");a.innerHTML="&";if(a.innerHTML===""){String.prototype.escapeForInnerHTML=function(){return this.replace(/&((\w){0,10})$/g,"&amp;$1")}}else{String.prototype.escapeForInnerHTML=function(){return this.valueOf()}}return this.escapeForInnerHTML()};String.stringify=function(a){return typeof a==="string"?a:String(a)};(function(){var c=String.prototype,h="\\s!¡\\?¿‽\\.\\,…:;_\\-–—~·•‘’“”‚„‛‟′`″'\"#\\$&\\*@§¶\\^\\|\\/",d="",f="[",g="]",a="+",l=new RegExp([f,h,g,a,"$"].join(d)),j=new RegExp(["^",f,h,g,a].join(d)),b=/<[^>]*>/g,i=function i(){return this.replace(l,d)},k=function k(){return this.replace(j,d)},e=function e(){return this.replace(b,d)};c.stripPunctuationAtEnd=i;c.stripPunctuationAtStart=k;c.stripTags=e})();if("undefined"!==typeof(window.Prototype)){(function(){var a=["indexOf","lastIndexOf","forEach","filter","map","some","every","reduce","reduceRight"];for(var b=0;b<a.length;++b){delete Array.prototype[a[b]]}})()}Array.prototype.distinct=function(){var b=this.length;var a=new Array(b);var c;var f;var d=0;for(c=0;c<b;++c){f=this[c];if(-1==a.indexOf(f)){a[d++]=f}}a.length=d;return a};Array.prototype.compare=function(c){var e=this.length-c.length;if(0!==e){return e}var f;var b;var d;for(f=0,b=this.length;f<b;++f){d=coherent.compareValues(this[f],c[f]);if(0!==d){return d}}return 0};Array.from=function(a,b){return Array.prototype.slice.call(a,b||0)};if(!Array.prototype.reduce){Array.prototype.reduce=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=0;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c++];break}if(++c>=a){throw new TypeError()}}while(true)}for(;c<a;c++){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.prototype.reduceRight){Array.prototype.reduceRight=function(b){var a=this.length;if(typeof b!="function"){throw new TypeError()}if(0===a&&1===arguments.length){throw new TypeError()}var c=a-1;if(arguments.length>=2){var d=arguments[1]}else{do{if(c in this){d=this[c--];break}if(--c<0){throw new TypeError()}}while(true)}for(;c>=0;c--){if(c in this){d=b.call(null,d,this[c],c,this)}}return d}}if(!Array.indexOf){Array.indexOf=function(c,b,a){return Array.prototype.indexOf.call(c,b,a)}}if(!Array.lastIndexOf){Array.lastIndexOf=function(c,b,a){return Array.prototype.lastIndexOf.call(c,b,a)}}if(!Array.forEach){Array.forEach=function(c,a,b){return Array.prototype.forEach.call(c,a,b)}}if(!Array.filter){Array.filter=function(c,a,b){return Array.prototype.filter.call(c,a,b)}}if(!Array.map){Array.map=function(c,a,b){return Array.prototype.map.call(c,a,b)}}if(!Array.some){Array.some=function(c,a,b){return Array.prototype.some.call(c,a,b)}}if(!Array.every){Array.every=function(c,a,b){return Array.prototype.every.call(c,a,b)}}if(!Array.reduce){Array.reduce=function(b,a){if(arguments.length>2){return Array.prototype.reduce.call(b,a,arguments[2])}else{return Array.prototype.reduce.call(b,a)}}}if(!Array.reduceRight){Array.reduceRight=function(b,a){if(arguments.length>2){return Array.prototype.reduceRight.call(b,a,arguments[2])}else{return Array.prototype.reduceRight.call(b,a)}}}Array.from=function(d,e){var b=d.length;var a=[];for(var c=(e||0);c<b;++c){a.push(d[c])}return a};if(!Array.prototype.indexOf){Array.prototype.indexOf=function(c,b){if("undefined"===typeof(b)){b=0}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a<this.length;a++){if(this[a]===c){return a}}return -1}}if(!Array.prototype.lastIndexOf){Array.prototype.lastIndexOf=function(c,b){if("undefined"===typeof(b)){b=this.length-1}else{if(b<0){b=Math.max(0,this.length+b)}}for(var a=b;a>=0;a--){if(this[a]===c){return a}}return -1}}if(!Array.prototype.forEach){Array.prototype.forEach=function(c,d){var a=this.length;for(var b=0;b<a;b++){c.call(d,this[b],b,this)}}}if(!Array.prototype.filter){Array.prototype.filter=function(d,e){var a=this.length;var c=[];for(var b=0;b<a;b++){if(d.call(e,this[b],b,this)){c.push(this[b])}}return c}}if(!Array.prototype.map){Array.prototype.map=function(d,e){var a=this.length;var c=[];for(var b=0;b<a;b++){c.push(d.call(e,this[b],b,this))}return c}}if(!Array.prototype.some){Array.prototype.some=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(c.call(d,this[b],b,this)){return true}}return false}}if(!Array.prototype.every){Array.prototype.every=function(c,d){var a=this.length;for(var b=0;b<a;b++){if(!c.call(d,this[b],b,this)){return false}}return true}}if(!Function.prototype.bind){Function.prototype.bind=function(c){var a=this;if(!arguments.length){return a}if(1==arguments.length){return function(){return a.apply(c,arguments)}}var b=Array.from(arguments,1);return function(){return a.apply(c,b.concat(Array.from(arguments)))}}}if(!Function.prototype.bindAsEventListener){Function.prototype.bindAsEventListener=function(c){var a=this;if(1==arguments.length){return function(d){return a.call(c,d||window.event)}}var b=Array.from(arguments);b.shift();return function(d){return a.apply(c,[d||window.event].concat(b))}}}if(!Function.prototype.delay){Function.prototype.delay=function(d){var b=this;d=d||10;if(arguments.length<2){function a(){b()}return window.setTimeout(a,d)}var c=Array.from(arguments,1);function e(){b.apply(b,c)}return window.setTimeout(e,d)}}if(!Function.prototype.bindAndDelay){Function.prototype.bindAndDelay=function(f,d){var b=this;f=f||b;d=d||10;if(arguments.length<3){function a(){b.call(f)}return window.setTimeout(a,d)}var c=Array.from(arguments,2);function e(){b.apply(f,c)}return window.setTimeout(e,d)}}if(!Function.prototype.bindAndRepeat){Function.prototype.bindAndRepeat=function(f,c){var b=this;f=f||b;c=c||10;if(arguments.length<3){function a(){b.call(f)}return window.setInterval(a,c)}var d=Array.from(arguments,2);function e(){b.apply(f,d)}return window.setInterval(e,c)}}Function.prototype.sync=function(){var b=arguments.length?this.bind.apply(this,arguments):this;var a={};var c=false;b.stop=function(){c=true};b.waitFor=function(d){a[d]=true;return function(){a[d]=false;for(var e in a){if(a[e]){return}}if(c){return}b()}};return b};function Set(){var d=this;if(d.constructor!==Set){d=new Set()}var b=arguments;if(1==b.length&&b[0] instanceof Array){b=b[0]}var c;var a=b.length;for(c=0;c<a;++c){d[b[c]]=true}return d}Set.union=function(c,b){var a=Object.clone(c);if(!b){return a}var d;for(d in b){a[d]=true}return a};Set.intersect=function(c,b){var a=new Set();var d;for(d in c){if(d in b){a[d]=true}}return a};Set.add=function(b,a){b[a]=true;return b};Set.remove=function(b,a){delete b[a];return b};Set.toArray=function(d){var c;var b=[];for(c in d){b.push(c)}return b};Set.forEach=function(f,c,b){var d;var a=0;for(d in f){c.call(b,d,a++)}};Set.join=function(f,c){var d;var b=[];for(d in f){b.push(d)}return b.join(c||"")};var $S=Set;Object.clone=function(b){var a=(function(){});a.prototype=b;return new a()};Object.applyDefaults=function(c,b){c=c||{};if(!b){return c}for(var a in b){if(a in c){continue}c[a]=b[a]}return c};Object.extend=function(c,a){c=c||{};for(var b in a){c[b]=a[b]}return c};Object.merge=function(c,a){var b={};var d;for(d in c){b[d]=c[d]}for(d in a){if(d in b){continue}b[d]=a[d]}return b};(function(){var b=Set("file","submit","image","reset","button");var d={};function e(i,h,j){var g=i[h];var f=coherent.typeOf(g);if("string"===f){i[h]=[g,j]}else{if("array"===f){g.push(j)}else{i[h]=j}}}function c(h){var f=h.name;var g=(h.type||"").toLowerCase();if(h.disabled||g in b){return}if("radio"===g||"checkbox"===g){if(h.checked){e(this,f,h.value)}}else{if(h.multiple){function i(j){if(j.selected){e(this,f,j.value)}}this[f]=[];Array.forEach(h.options,i,this)}else{e(this,f,h.value);if("image"===g){e(this,f+".x",0);e(this,f+".y",0)}}}}Object.fromForm=function(g){var f={};Array.forEach(g.elements,c,f);return f};function a(h){h=h.split("=");if(1===h.length){return}var f=h[0].decodeUrl();var g=h[1].decodeUrl()||null;e(this,f,g)}Object.fromQueryString=function(g){if("?"==g.charAt(0)){g=g.slice(1)}g=g.split(/\s*&\s*/);var f={};g.forEach(a,f);return f};Object.toQueryString=function(k){if(!k){return""}var h;var j;var f;var g=[];function i(l){if(null!==l&&"undefined"!==typeof(l)){l=encodeURIComponent(l)}g.push(h+"="+l)}for(h in k){j=k[h];f=coherent.typeOf(j);if("null"===f){j=""}if("function"===f||j===d[h]){continue}h=encodeURIComponent(h);if("array"===f){j.forEach(i)}else{i(j)}}return g.join("&")}})();RegExp.escape=function(a){return a.replace(RegExp._escapeRegex,"\\$1")};RegExp.specialCharacters=["/",".","*","+","?","|","(",")","[","]","{","}","\\"];RegExp._escapeRegex=new RegExp("(\\"+RegExp.specialCharacters.join("|\\")+")","g");var Class=(function(){function d(i,l){var j;if(!i&&!l){return i}if(!i){j=function(){return l.apply(this,arguments)}}else{var k=/this\.base/.test(i);if(!k&&!l){return i}if(!k){j=function(){l.call(this);return i.apply(this,arguments)}}else{j=function(){var n=this.base;this.base=l||function(){};var m=i.apply(this,arguments);this.base=n;return m}}}j.valueOf=function(){return i};j.toString=function(){return String(i)};return j}function g(i,j){var k=i.prototype.__factory__.apply(i,j);if("function"!==typeof(k)){throw new Error("Factory function doesn't return a function")}k.__factoryFn__=true;return k}function f(k){if(k.__createFactoryObjects){k.__createFactoryObjects();return}var j;var i;for(j in k.__factories__){i=k[j];if(!i.__factoryFn__){continue}k[j]=i.call(k)}}function c(i,k){if(i&&!(i instanceof Function)){throw new Error("Invalid constructor")}if(k&&!(k instanceof Function)){throw new Error("Invalid superclass")}k=k?k.valueOf():null;i=d(i,k);var j;if(i){j=function(){if(!(this instanceof j)){return g(j,arguments)}this.__uid=this.__uid||coherent.generateUid();var l=i.apply(this,arguments);f(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return l||this}}else{j=function(){if(!(this instanceof j)){return g(j,arguments)}this.__uid=this.__uid||coherent.generateUid();f(this);if(this.__postConstruct instanceof Function){this.__postConstruct()}return this}}j.valueOf=function(){return i};j.toString=function(){return String(i||j)};return j}function b(j){function i(){}i.prototype=j.prototype;return new i()}function e(k,i){if(!k||!/this\.base/.test(k)){return k}function j(){var m=this.base;this.base=i||function(){};var l=k.apply(this,arguments);this.base=m;return l}j.valueOf=function(){return k};j.toString=function(){return String(k)};return j}function h(k,i,l){if(l instanceof Function){var j=k[i];var m=l.valueOf();if(j instanceof Function&&j.valueOf()!==m){l=e(l,j)}if(m.__factoryFn__){k.__factories__[i]=l}}k[i]=l;return l}function a(j){var i;for(i=j.superclass;i;i=i.superclass){if("__subclassCreated__" in i){i.__subclassCreated__(j)}}}return{create:function(l,j){var i;var k={};switch(arguments.length){case 0:throw new TypeError("Missing superclass and declaration arguments");case 1:j=l;l=undefined;break;default:k=b(l);break}if("function"==typeof(j)){j=j();if(!j){throw new Error("Class declaration function did not return a prototype")}}if(j.hasOwnProperty("constructor")){i=j.constructor;delete j.constructor}i=c(i,l);i.prototype=k;i.prototype.constructor=i;i.superclass=l;if(l){k.__factories__=Object.clone(l.prototype.__factories__)}else{k.__factories__={}}this.extend(i,j);a(i);return i},findPropertyName:function(l,i){var j;for(var k in l){j=l[k];if(j===i||("function"===typeof(j)&&j.valueOf()===i)){return k}}return null},extend:(function(){if(coherent.Support.Properties){return function(i,j){var n=i.prototype;var k;for(var o in j){var m=j.__lookupGetter__(o);var l=j.__lookupSetter__(o);if(m||l){m&&n.__defineGetter__(o,m);l&&n.__defineSetter__(o,l)}else{h(n,o,j[o])}}return i}}else{return function(i,j){var k=i.prototype;for(var l in j){h(k,l,j[l])}}}})()}})();coherent.strings={"marker.input.multipleValues":"Multiple Values","marker.input.placeholder":"","marker.input.noSelection":"No Selection","marker.image.multipleValues":"","marker.image.placeholder":"","marker.image.noSelection":"","marker.text.multipleValues":"Multiple Values","marker.text.placeholder":"","marker.text.noSelection":"No Selection","error.no_description":"An unspecified error occurred.","error.invalid_value":"This value is not valid.","error.invalid_number":"This value is not a valid number."};coherent.localisedString=function(a){return{valueOf:function(){if(a in coherent.strings){return coherent.strings[a]}return null},toString:function(){if(a in coherent.strings){return coherent.strings[a]}console.log("Localisation missing string for key: "+a);return a}}};var _=coherent.localisedString;coherent.Error=Class.create({constructor:function(a){Object.extend(this,a)},toString:function(){return this.description},description:_("error.no_description"),recoverySuggestion:null});coherent.KeyInfo=Class.create({constructor:function(d,b){var a=coherent.KVO.getPropertyMethodsForKeyOnObject(b,d);this.__uid=[b,coherent.generateUid()].join("_");this.reader=a.getter;this.mutator=a.mutator;this.validator=a.validator;this.key=b;this.mutable=((this.mutator||!this.reader)?true:false);if(!this.reader&&!this.mutator){this.mutable=true}this.changeCount=0;var c=a.value;if(!c){return}var e=coherent.typeOf(c);if(e in coherent.KVO.typesOfKeyValuesToIgnore||!c._addParentLink){return}c._addParentLink(d,this)},get:function(b){if(this.reader){return this.reader.call(b)}var a;if(this.key in b){a=b[this.key]}else{a=null}if(a&&a._addParentLink){a._addParentLink(b,this)}return a},set:function(b,a){if(this.mutator){this.mutator.call(b,a)}else{b.willChangeValueForKey(this.key,this);if("undefined"===typeof(a)){a=null}b[this.key]=a;b.didChangeValueForKey(this.key,this)}},validate:function(b,a){if(!this.validator){return a}return this.validator.call(b,a)},unlinkParentLink:function(){if(!this.parentLink){return}this.parentLink.observer=null;this.parentLink.callback=null;this.parentLink=null}});coherent.ChangeType={setting:0,insertion:1,deletion:2,replacement:3};coherent.ChangeNotification=Class.create({constructor:function(d,a,e,c,b){this.object=d;this.changeType=a;this.newValue=e;this.oldValue=c;this.indexes=b;this.objectKeyPath=[]},toString:function(){var a="[ChangeNotification changeType: ";switch(this.changeType){case coherent.ChangeType.setting:a+="setting";break;case coherent.ChangeType.insertion:a+="insertion";break;case coherent.ChangeType.deletion:a+="deletion";break;case coherent.ChangeType.replacement:a+="replacement";break;default:a+="<<unknown>>";break}a+=" newValue="+this.newValue+" oldValue="+this.oldValue+(this.indexes?" indexes="+this.indexes.join(", "):"")+"]";return a}});coherent.ObserverEntry=Class.create({constructor:function(a,c,b){this.observer=a;this.callback=c;this.context=b},observeChangeForKeyPath:function(a,b){if(!this.callback||!this.observer||-1!==a.objectKeyPath.indexOf(this.observer)){return}this.callback.call(this.observer,a,b,this.context)}});coherent.KVO=Class.create({constructor:function(){},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}},setValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){this.setValueForVariableKeyPath(c,d);return}d=d.split(".")}var b=d[0];if(1==d.length){this.setValueForKey(c,b);return}if("@"==b.charAt(0)){return}var a=this.valueForKey(b);if(!a){return}a.setValueForKeyPath(c,d.slice(1))},setValueForVariableKeyPath:function(a,c){var b=coherent.VariableKeyPath.resolve(c,this);if("undefined"===typeof(b)){return}this.setValueForKeyPath(a,b)},setValueForKey:function(b,a){if(!a||0===a.length){throw new InvalidArgumentError("key may not be empty")}var c=this.infoForKey(a);if(!c||!c.mutable){return}c.set(this,b)},valueForKeyPath:function(e){if(!e||0===e.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(e)){if("$"==e.charAt(0)){return this.valueForVariableKeypath(e)}e=e.split(".")}var d=e[0];if(1==e.length){return this.valueForKey(d)}if("@"==d.charAt(0)){var b=d.substr(1);var a=this.valueForKeyPath(e.slice(1));return coherent.ArrayOperator[b](a)}var c=this.valueForKey(d);if("undefined"===typeof(c)||null===c){return undefined}return c.valueForKeyPath(e.slice(1))},valueForVariableKeypath:function(b){var a=coherent.VariableKeyPath.resolve(b,this);if("undefined"===typeof(a)){return undefined}return this.valueForKeyPath(a)},valueForKey:function(a){if(!a||0===a.length){throw new InvalidArgumentError("the key is empty")}var b=this.infoForKey(a);if(!b){return null}return b.get(this)},validateValueForKeyPath:function(c,d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath may not be empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){return this.validateValueForVariableKeypath(c,d)}d=d.split(".")}var b=d[0];if(1==d.length){return this.validateValueForKey(c,b)}var a=this.valueForKey(b);if("undefined"===typeof(a)||null===a){return c}return a.validateValueForKeyPath(c,d.slice(1))},validateValueForVariableKeypath:function(a,c){var b=coherent.VariableKeyPath.resolve(c,this);if("undefined"===typeof(b)){return a}return this.validateValueForKeyPath(a,b)},validateValueForKey:function(b,a){if(!a||!a.length){throw new InvalidArgumentError("missing key")}var c=this.infoForKey(a);return c.validate(this,b)},observeChildObjectChangeForKeyPath:function(d,c,a){if(coherent.KVO.kAllPropertiesKey!=c){c=a+"."+c}else{c=a}var b=Object.clone(d);b.object=this;this.notifyObserversOfChangeForKeyPath(b,c)},infoForKeyPath:function(d){if(!d||0===d.length){throw new InvalidArgumentError("keyPath is empty")}if("string"==typeof(d)){if("$"==d.charAt(0)){return this.infoForVariableKeyPath(d)}d=d.split(".")}var b=d[0];if(1==d.length){return this.infoForKey(b)}else{if("@"==b.charAt(0)){var c=new coherent.KeyInfo(null,null);c.mutable=false;return c}else{var a=this.valueForKey(b);if(!a){return undefined}if(!a.infoForKeyPath){return undefined}return a.infoForKeyPath(d.slice(1))}}},infoForVariableKeyPath:function(b){var a=coherent.VariableKeyPath.resolve(b,this);return("undefined"===typeof(a))?undefined:this.infoForKeyPath(a)},infoForKey:function(a){var b;if(!this.__keys){this.__keys={}}if(coherent.KVO.kAllPropertiesKey==a){return null}b=this.__keys[a];if(b){return b}b=new coherent.KeyInfo(this,a);this.__keys[a]=b;return b},setKeysTriggerChangeNotificationsForDependentKey:function(d,c){if(!d||!d.length){throw new InvalidArgumentError("keys array is not valid")}if(!c){throw new InvalidArgumentError("dependentKey can not be null")}if(-1!==c.indexOf(".")){throw new InvalidArgumentError("dependentKey may not be a key path")}var b;var f;var a;var e;if("string"===typeof(d)){d=[d]}if(!this.__dependentKeys){this.__dependentKeys={}}for(a=0;a<d.length;++a){b=d[a];if(!b){throw new InvalidArgumentError("key at index "+a+" was null")}if(!(b in this.__dependentKeys)){this.__dependentKeys[b]=[]}coherent.KVO.getPropertyMethodsForKeyOnObject(b,this);e=this.__dependentKeys[b];if(-1==e.indexOf(c)){e.push(c)}}},mutableKeys:function(){var d=[];var b;var a;var c;if("__mutableKeys" in this&&this.__mutableKeys.concat){return this.__mutableKeys}var e=Set.union(coherent.KVO.keysToIgnore,this.__keysToIgnore);for(b in this){if(b in e||"__"===b.substr(0,2)){continue}a=this[b];if("function"!==typeof(a)){d.push(b);continue}if(1!==a.length||"set"!==b.substr(0,3)){continue}c=b.charAt(3);if(c!==c.toUpperCase()){continue}b=c.toLowerCase()+b.substr(4);if(b in e){continue}if(-1===d.indexOf(b)){d.push(b)}}return d},initialiseKeyValueObserving:function(){this.__uid=this.__uid||coherent.generateUid();this.__observers={};this.__variableBindings={}},_addParentLink:function(d,e,c){if(!this.hasOwnProperty("__observers")){this.initialiseKeyValueObserving()}var b=this.__observers[coherent.KVO.kAllPropertiesKey];if(!b){b=this.__observers[coherent.KVO.kAllPropertiesKey]={}}c=c||e.__uid;if(c in b){return}var a=new coherent.ObserverEntry(d,d.observeChildObjectChangeForKeyPath,e?e.key:"");b[c]=a;if(!e){return}e.unlinkParentLink();e.parentLink=a},_removeParentLink:function(c,d,b){if(!this.__observers){return}var a=this.__observers[coherent.KVO.kAllPropertiesKey];if(!a){a=this.__observers[coherent.KVO.kAllPropertiesKey]={}}b=b||d.__uid;if(d&&d.parentLink===a[b]){d.unlinkParentLink()}delete a[b]},addObserverForKeyPath:function(a,f,e,b){if(!e||0===e.length){throw new InvalidArgumentError("keyPath is empty")}if(!a){throw new InvalidArgumentError("Observer may not be null")}if(!f){f=a.observeChangeForKeyPath}if("string"===typeof(f)){f=a[f]}if(!f){throw new InvalidArgumentError("Missing callback method")}if(!this.hasOwnProperty("__observers")){this.initialiseKeyValueObserving()}if("$"===e.charAt(0)){var c=this.__variableBindings[e];if(!c){c=coherent.Binding.bindingFromString(e,this);this.__variableBindings[e]=c;c.bind();c.observerFn=function(l,k,h){var j=this.getObservers();for(var g in j){var i=j[g];i.observeChangeForKeyPath(l,k)}}}c.addObserver(a,f,b)}else{this.infoForKeyPath(e);if(!this.__observers[e]){this.__observers[e]=[]}var d=new coherent.ObserverEntry(a,f,b);this.__observers[e].push(d)}},removeObserverForKeyPath:function(c,g){if(!g||0===g.length){throw new InvalidArgumentError("keyPath may not be empty")}if(!c){throw new InvalidArgumentError("Observer may not be null")}if(!this.__observers){return}if("$"===g.charAt(0)){var d=this.__variableBindings[g];if(d){d.removeObserver(c)}return}if(!this.__observers[g]){return}var f=this.__observers[g];var b=-1;var e;var a=f.length;for(b=0;b<a;++b){e=f[b];if(e.observer==c){f.splice(b,1);return}}},willChangeValueForKey:function(a,c){if(!a){throw new InvalidArgumentError("key may not be null")}c=(c instanceof coherent.KeyInfo)?c:this.infoForKey(a);if(!c){return}if(1!==++c.changeCount){return}var b=(this.__dependentKeys&&this.__dependentKeys[a]);if(b){b.forEach(this.willChangeValueForKey,this)}c.previousValue=c.get(this)},forceChangeNotificationForKey:function(a,b){if(!a){throw new InvalidArgumentError("key may not be null")}b=(b instanceof coherent.KeyInfo)?b:this.infoForKey(a);if(!b){return}if(0!==b.changeCount){return}b.changeCount=1;this.didChangeValueForKey(a,b)},didChangeValueForKey:function(b,f){if(!b){throw new InvalidArgumentError("key may not be null")}f=(f instanceof coherent.KeyInfo)?f:this.infoForKey(b);if(!f){return}if(0!==--f.changeCount){return}var c=f.get(this);var a=f.previousValue;f.previousValue=null;if(c!==a){var e=new coherent.ChangeNotification(this,coherent.ChangeType.setting,c,a);this.notifyObserversOfChangeForKeyPath(e,b);if(a&&a._removeParentLink){a._removeParentLink(this,f)}if(c&&c._addParentLink){c._addParentLink(this,f)}}var d=(this.__dependentKeys&&this.__dependentKeys[b]);if(d){d.forEach(this.didChangeValueForKey,this)}},notifyObserversOfChangeForKeyPath:function(j,l){if(!l){throw new InvalidArgumentError("keyPath may not be null")}if(l.charAt(0)==="$"){throw new InvalidArgumentError("keyPath cannot be a variable keypath")}if(!this.__observers){return}var g;var f;var h;f=this.__observers[coherent.KVO.kAllPropertiesKey];if(f){var e=Object.clone(j);var a=j.objectKeyPath.length;j.objectKeyPath.push(this);for(g in f){var b=f[g];b.observeChangeForKeyPath(e,l)}j.objectKeyPath.length=a}if(coherent.KVO.kAllPropertiesKey==l){return}f=this.__observers[l];if(f&&f.length){h=f.length;for(g=0;g<h;++g){f[g].observeChangeForKeyPath(j,l)}}var d=l+".";var i=d.length;var k;var m;var q;var p;var c;var n=!(null===j.oldValue||"undefined"===typeof(j.oldValue));for(m in this.__observers){if(m.substr(0,i)!=d){continue}f=this.__observers[m];if(!f||!f.length){continue}k=m.substr(i);p=j.oldValue;if(p&&p.valueForKeyPath){p=p.valueForKeyPath(k)}else{p=null}c=j.newValue;if(c&&c.valueForKeyPath){c=c.valueForKeyPath(k)}else{c=null}if(n&&p===c){continue}q=new coherent.ChangeNotification(j.object,j.changeType,c,p,j.indexes);h=f.length;for(g=0;g<h;++g){f[g].observeChangeForKeyPath(q,m)}}},toJSON:function(a){var b={};this.mutableKeys().forEach(function(c){b[c]=this[c]},this);return b}});coherent.KVO.kAllPropertiesKey="*";coherent.KVO.keysToIgnore=$S("__keys","__observers","__keysToIgnore","__dependentKeys","__mutableKeys","__factories__");coherent.KVO.typesOfKeyValuesToIgnore=$S("string","number","boolean","date","regexp","function");coherent.KVO.getPropertyMethodsForKeyOnObject=(function(){function b(h,f){f=f||"__kvo_prop_"+h;var g={getter:function(){var i=null;if(f in this){i=this[f]}var j=this.__keys?this.__keys[h]:null;if(!j){return i}if(i&&i._addParentLink){i._addParentLink(this,j)}else{j.unlinkParentLink()}return i},mutator:function(i){this.willChangeValueForKey(h);if("undefined"===typeof(i)){i=null}this[f]=i;this.didChangeValueForKey(h);return i}};g.mutator.__key=h;g.getter.__key=h;return g}function c(h,g){function f(j){this.willChangeValueForKey(g);var i=h.call(this,j);this.didChangeValueForKey(g);return i}f.__key=g;f.valueOf=function(){return h};f.toString=function(){return String(h)};return f}function d(f,h){function g(){var i=f.call(this);var j=this.__keys?this.__keys[h]:null;if(!j){return i}if(i&&i._addParentLink){i._addParentLink(this,j)}else{j.unlinkParentLink()}return i}g.__key=h;g.valueOf=function(){return f};g.toString=function(){return String(f)};return g}function e(t,k){var m=k.constructor.prototype;var j=(m==k);var l=(m!=Object.prototype&&m!=Array.prototype&&m!=coherent.KVO.prototype)?m:k;var u=t.titleCase();var p="get"+u;var q="set"+u;var i="validate"+u;var o;var h;var s;var f=k[i];var n=("undefined"!==typeof(o=k.__lookupGetter__(t))&&"undefined"!==typeof(h=k.__lookupSetter__(t)));if(!n){p=(p in k)?p:t;o=k[p];h=k[q]}if("function"!==typeof(o)){var r="__kvo_prop_"+t;var g=b(t,r);if(t in k){s=k[r]=("undefined"==typeof(o)?null:o);delete k[t]}o=g.getter;h=g.mutator;n=true}else{if(0!==o.length){o=null}if(h&&1!==h.length){h=null}if(o&&!j){s=o.valueOf().call(k)}if(o&&t!==o.__key){o=d(o,t)}if(h&&t!==h.__key){h=c(h,t)}}if(n){l.__defineGetter__(t,o);l.__defineSetter__(t,h)}else{if(o){if(k.hasOwnProperty(p)){k[p]=o}else{l[p]=o}}if(h){if(k.hasOwnProperty(q)){k[q]=h}else{l[q]=h}}}return{getter:o,mutator:h,validator:f,value:s}}function a(q,j){var l=j.constructor.prototype;var i=(l==j);var k=(l!=Object.prototype&&l!=Array.prototype&&l!=coherent.KVO.prototype)?l:j;var r=q.titleCase();var o="set"+r;var n="get"+r;var h="validate"+r;n=(n in j)?n:q;var m=j[n];var g=j[o];var f=j[h];var p;if("function"!==typeof(m)){if(q in j){p=m}m=null;g=null}else{if(0!==m.length){m=null}if(g&&1!==g.length){g=null}if(m&&!i){p=m.valueOf().call(j)}if(m&&q!==m.__key){m=d(m,q)}if(g&&q!==g.__key){g=c(g,q)}}if(m){if(j.hasOwnProperty(n)){j[n]=m}else{k[n]=m}}if(g){if(j.hasOwnProperty(o)){j[o]=g}else{k[o]=g}}return{getter:m,mutator:g,validator:f,value:p}}if(coherent.Support.Properties){return e}else{return a}})();coherent.KVO.adapt=function(c){if(!c){throw new InvalidArgumentError("Can't adapt a null object")}var b;var a=coherent.KVO.prototype;for(b in a){if(b in c){continue}c[b]=a[b]}if("keyDependencies" in c&&!("__dependentKeys" in c)){var d=c.keyDependencies;for(b in d){c.setKeysTriggerChangeNotificationsForDependentKey(d[b],b)}}return c};coherent.KVO.adaptTree=function(d){coherent.KVO.adapt(d);var c;var a;var e=coherent.KVO.keysToIgnore;var b=coherent.KVO.typesOfKeyValuesToIgnore;for(c in d){if(e[c]){continue}a=d[c];if(!a){continue}if(b[coherent.typeOf(a)]){continue}coherent.KVO.adaptTree(a)}return d};coherent.KVO.unadaptTree=function(c){var a,b=coherent.typeOf(c);switch(b){case"object":a={};break;case"array":a=[];break;default:return c}if(!c.mutableKeys){return c}c.mutableKeys().forEach(function(d){a[d]=coherent.KVO.unadaptTree(c[d])});return a};coherent.KVO.__subclassCreated__=function(a){var d=a.superclass.prototype;var b=a.prototype;if(d.keyDependencies===b.keyDependencies){return}var e=b.keyDependencies||{};for(var c in e){b.setKeysTriggerChangeNotificationsForDependentKey(e[c],c)}};coherent.Bindable=Class.create(coherent.KVO,{constructor:function(a){this.bindings={};this.__parameters=a;this.__context=coherent.dataModel},__createFactoryObjects:function(){var a=coherent.dataModel;var c=this.__context;coherent.dataModel=this.__context=this;var d;var b;for(d in this.__factories__){b=this[d];if(!b.__factoryFn__){continue}this[d]=b.call(this)}coherent.dataModel=a;this.__context=c},exposedBindings:[],automaticallySetupBindings:true,__relativeSource:null,__relativeSourceKeyPathPattern:/(\$|^)(\*.)(.+)/,__relativeSourceKeyPathFormat:"$1$3",bindNameToKeyPath:function(b,f,a){var c;var e;var d=this;if(!this.bindings){this.bindings={}}c=this["observe"+b.titleCase()+"Change"];if(!c){c=function(h){if(coherent.ChangeType.setting!==h.changeType){throw new InvalidArgumentError('Received invalid change type for synthesized binding observer (name="'+b+'" keyPath="'+f+'")')}var g=h.newValue;d.setValueForKey(h.newValue,b)}}if(this.bindings[b]){this.bindings[b].unbind()}if(this.__relativeSourceKeyPathPattern.test(f)){e=coherent.Binding.bindingFromString(f.replace(this.__relativeSourceKeyPathPattern,this.__relativeSourceKeyPathFormat),a)}else{e=coherent.Binding.bindingFromString(f,this.__context)}e.observerFn=c.bind(this);this.bindings[b]=e},__postConstruct:function(){if(!this.automaticallySetupBindings){return}this.__initialising=true;this.__copyParameters(this.__parameters||{});this.setupBindings();this.updateBindings();this.createObservers();delete this.__initialising},__copyParameters:function(c){var d;var a;var b=coherent.KVO.adaptTree;for(d in c){if(-1!==d.search(/Binding$/)){continue}a=c[d];if("object"===coherent.typeOf(a)&&!("addObserverForKeyPath" in a)){b(a)}this[d]=a}this.__parameters=c},bindingInfoForName:function(a){if(!this.__parameters){return null}return this.__parameters[a+"Binding"]||this.__parameters[a]},__createAutoObserver:function(c,b){var a=coherent.ChangeType.setting;return function(d){if(this.bindings[b]||a==d.changeType){return}c.apply(this,arguments)}},createObservers:function(){var e=this.exposedBindings;var a=e.length;var b;var d;var c;for(b=0;b<a;++b){c=e[b];d=this["observe"+c.titleCase()+"Change"];if(!d){continue}d=this.__createAutoObserver(d,c);this.addObserverForKeyPath(this,d,c,"__auto_observer__")}},setupBindings:function(){var e=this.exposedBindings;var c=e.length;var f;var a;var d;for(d=0;d<c;++d){a=e[d];f=this.bindingInfoForName(a);if(!f){continue}this.bindNameToKeyPath(a,f,this.__relativeSource)}},updateBindings:function(){var f=this.bindings;var e=this.exposedBindings;var c=e.length;var a;var d;for(d=0;d<c;++d){a=f[e[d]];if(!a){continue}a.update()}},unbind:function(){for(var a in this.bindings){this.bindings[a].unbind()}}});coherent.Bindable.__subclassCreated__=function(a){var c=a.superclass.prototype;var b=a.prototype;if(c.exposedBindings===b.exposedBindings){return}b.exposedBindings=c.exposedBindings.concat(b.exposedBindings)};coherent.SortDescriptor=Class.create({constructor:function(d,a,b){this.keyPath=d;this.ascending=a;this.comparisonFn=b||this.defaultCompare;var c=typeof(this.comparisonFn);if("string"!=c&&"function"!=c){throw new InvalidArgumentError("comparisonFn must be either the name of a method or a function reference")}},resolveComparisonFn:function(b){var a=this.comparisonFn;if("string"===typeof(a)){a=b[a]}if("function"!==typeof(a)){throw new TypeError("comparisonFn does not resolve to a function")}return a},compareObjects:function(c,b){if(!c.valueForKeyPath||!b.valueForKeyPath){throw new InvalidArgumentError("Objects are not Key Value compliant")}var e=c.valueForKeyPath(this.keyPath);var d=b.valueForKeyPath(this.keyPath);var a=this.resolveComparisonFn(e);return a.call(e,d)},defaultCompare:function(a){return coherent.compareValues(this,a)},reversedSortDescriptor:function(){return new coherent.SortDescriptor(this.keyPath,!this.ascending,this.comparisonFn)}});coherent.Controller=Class.create(coherent.Bindable,{constructor:function(a){this.base(a)},registerWithName:function(a){if(!a){return}this.name=a;coherent.registerModelWithName(this,a)}});coherent.Markers={MultipleValues:"ThisIsAnUniqueStringThatRepresentsMultipleValues",NoSelection:"ThisIsAnUniqueStringThatRepresentsNoSelection"};coherent.SelectionProxy=Class.create(coherent.KVO,{constructor:function(a){this.controller=a;this.mutable=true},infoForKey:function(b){var a=this.controller.selectedObjects();var c=a.infoForKey(b);c.mutable&=this.mutable;return c},infoForKeyPath:function(c){var a=this.controller.selectedObjects();var b=a.infoForKeyPath(c);b.mutable&=this.mutable;return b},translateValue:function(d){if("array"!==coherent.typeOf(d)){return d}if(1===d.length){return d[0]}var c;var a;var b=d[0];for(c=1,a=d.length;c<a;++c){if(0!==coherent.compareValues(b,d[c])){return coherent.Markers.MultipleValues}}return b},valueForKey:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKey(c);return this.translateValue(a)},validateValueForKeyPath:function(e,f){var b=this.controller.selectedObjects();var a=b.length;var d;if(0===a){return e}var c;for(d=0;d<a;++d){c=b[d].validateValueForKeyPath(e,f);if(c instanceof coherent.Error){return c}}return c},valueForKeyPath:function(c){var b=this.controller.selectedObjects();if(0===b.length){return coherent.Markers.NoSelection}var a=b.valueForKeyPath(c);return this.translateValue(a)},setValueForKey:function(d,c){if(!this.mutable){return}var b=this.controller.selectedObjects();var a=this.valueForKey(c);b.setValueForKey(d,c);var e=this.valueForKey(c);if(a===e){return}var f=new coherent.ChangeNotification(this,coherent.ChangeType.setting,e,a);this.notifyObserversOfChangeForKeyPath(f,c)},setValueForKeyPath:function(c,f){if(!this.mutable){return}var b=this.controller.selectedObjects();var a=this.valueForKeyPath(f);b.setValueForKeyPath(c,f);var d=this.valueForKeyPath(f);if(a===d){return}var e=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,a);this.notifyObserversOfChangeForKeyPath(e,f)}});coherent.ObjectController=Class.create(coherent.Controller,{constructor:function(a){this.base(a);this.objectClass=coherent.KVO;this.__content=null;this.__editable=true;this.__selectedObjects=[];this.__selection=new coherent.SelectionProxy(this)},observeChildObjectChangeForKeyPath:function(f,e,b){this.base(f,e,b);if("selectedObjects"!==b){return}var c="selection."+e;var d=this.valueForKeyPath(c);var a=new coherent.ChangeNotification(this,coherent.ChangeType.setting,d,null);this.notifyObserversOfChangeForKeyPath(a,c)},keyDependencies:{},exposedBindings:["editable","content"],editable:function(){var a=this.__editable;if(this.bindings.content){a&=this.bindings.content.mutable()}return a},setEditable:function(a){if(this.bindings.content){a&=this.bindings.content.mutable()}if(this.bindings.editable){this.bingings.editable.setValue(a)}this.__editable=a},content:function(){return this.__content},setContent:function(a){if(this.bindings.content){this.bindings.content.setValue(a)}this.__content=a;this.willChangeValueForKey("selectedObjects");if(!a){this.__selectedObjects=[]}else{this.__selectedObjects=[a]}this.didChangeValueForKey("selectedObjects");this.forceChangeNotificationForKey("selection")},selectedObjects:function(){return this.__selectedObjects},selection:function(){return this.__selection}});window.XHR=(function(){var getTransport=function(){throw new Error("XMLHttpRequest not available.")};if(!coherent.Browser.IE||!!(window.XMLHttpRequest)){getTransport=function(){return new XMLHttpRequest()}}else{var progIdCandidates=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"];var len=progIdCandidates.length;var progId;var xhr;for(var i=0;i<len;++i){try{progId=progIdCandidates[i];xhr=new ActiveXObject(progId);getTransport=function(){return new ActiveXObject(progId)};break}catch(e){}}}function send(url,method,options){if(options.timeout){timeout=window.setTimeout(function(){cancel()},options.timeout)}function noop(){}function cancel(){xhr.onreadystatechange=noop;xhr.abort()}function readyStateChanged(){if(timeout){window.clearTimeout(timeout)}if(4!==xhr.readyState){return}if(xhrSent===false){arguments.callee.delay(0);return}var status=xhr.status;var succeeded=(status>=200&&status<300)||304==status;if(0===status||"undefined"===typeof(status)){var protocol=window.location.protocol;succeeded="file:"===protocol||"chrome:"===protocol}var result=xhr.responseText;var err;if(succeeded){if("HEAD"==method){result={};try{var headers=xhr.getAllResponseHeaders();if(headers){headers=headers.split("\n");headers.forEach(function(header){var match=header.match(/^([^:]+):(.+)$/m);var name=match[1].trim();result[name]=match[2].trim()})}}catch(e){}}else{var contentType=options.responseContentType||xhr.getResponseHeader("Content-Type");if(contentType.match(/(?:application\/(?:x-)?json)|(?:text\/json)/)){try{result=eval("("+result+")")}catch(e){err=e;succeeded=false}}if(contentType.match(/(?:application|text)\/xml/)){result=xhr.responseXML}}}else{err=new Error("XHR request failed");err.url=url;err.method=method;err.xhr=xhr;try{err.status=xhr.status;err.statusText=xhr.statusText}catch(e){err.status=0;err.statusText=null}}if(succeeded){deferred.callback(result)}else{deferred.failure(err)}xhr.onreadystatechange=noop;xhr=null}var urlArgs=(url||"").split("?");if(2==urlArgs.length){url=urlArgs[0];urlArgs=Object.fromQueryString(urlArgs[1])}else{urlArgs={}}var xhr=getTransport();var args=Object.applyDefaults(options.parameters||{},urlArgs);var queryString=Object.toQueryString(args);var body=options.body||"";var async=!options.sync;var deferred=new coherent.Deferred(cancel);var xhrSent=false;var timeout;method=(method||"GET").toUpperCase();if("GET"==method){url=url+"?"+queryString}if(options.user){xhr.open(method,url,async,options.user,options.password||"")}else{xhr.open(method,url,async)}var headers=options.headers||{};for(var h in headers){xhr.setRequestHeader(h,headers[h])}xhr.setRequestHeader("X-Requested-With","XMLHttpRequest");if("POST"==method){xhr.setRequestHeader("Content-Type",options.contentType||"application/x-www-form-urlencoded");body=body||queryString}if(async){xhr.onreadystatechange=readyStateChanged}xhr.send(body);xhrSent=true;if(!async){readyStateChanged()}return deferred}return{get:function(url,parameters,options){return XHR.request("GET",url,parameters,options)},post:function(url,parameters,options){return XHR.request("POST",url,parameters,options)},request:function(method,url,parameters,options){method=method.toUpperCase();options=options||{};options.parameters=parameters;return send(url,method,options)}}})();coherent.AjaxController=Class.create(coherent.ObjectController,{exposedBindings:["url"],flushContentBeforeQuery:false,constructor:function(a){this.base(a);this.addObserverForKeyPath(this,this.queryUpdated,"url");this.addObserverForKeyPath(this,this.queryUpdated,"method");this.queryDelay=500;this.url="";this.method="GET";this.setValueForKey(new coherent.KVO(),"parameters")},validateParameters:function(){return true},observeChildObjectChangeForKeyPath:function(c,b,a){this.base(c,b,a);if("parameters"===a){this.queryUpdated(c,b,a)}},queryUpdated:function(c,b,a){if(!this.parameters||!this.validateParameters()){return}this.setValueForKey(true,"queryInProgress");if(this.__queryTimer){window.clearTimeout(this.__queryTimer)}this.__queryTimer=this.performQuery.bindAndDelay(this,this.queryDelay)},performQuery:function(){var e={};var d=this.parameters.mutableKeys();var a=d.length;var f;var b;for(var c=0;c<a;++c){f=d[c];if(!this.parameters.hasOwnProperty(f)){continue}b=this.parameters[f];if(""===b||null===b||"undefined"===typeof(b)){continue}e[f]=b}this.finalParameters(e);this.__request=XHR.get(this.url,e,{responseContentType:"application/json"});this.__request.addMethods(this.querySucceeded.bind(this),this.queryFailed.bind(this));if(this.flushContentBeforeQuery){this.setContent(null)}},finalParameters:function(a){return a},extractContent:function(a){return a},querySucceeded:function(a){coherent.KVO.adaptTree(a);this.setContent(this.extractContent(a));this.setValueForKey("","statusCode");this.setValueForKey("","errorMessage");this.setValueForKey(false,"queryInProgress")},queryFailed:function(a){console.log("failure: "+this.url);this.setValueForKey(a.status,"statusCode");this.setValueForKey(a.statusText,"errorMessage");this.setContent(null);this.setValueForKey(false,"queryInProgress")}});function IndexRange(c,a){var b;var d=[];if(1==arguments.length&&c.length){a=c.length-1;c=0}for(b=c;b<=a;++b){d.push(b)}return d}coherent.ArrayController=Class.create(coherent.ObjectController,{constructor:function(a){this.base(a);this.arrangedObjects=[];this.__sortDescriptors=[];this.__filterPredicate=null;this.__selectionIndexes=[]},keyDependencies:{selectedObjects:["selectionIndexes"],selectionIndex:["selectionIndexes"],canRemove:["editable","selectionIndexes"],canAdd:["editable"]},selectsInsertedObjects:true,exposedBindings:["selectionIndexes","sortDescriptors","filterPredicate","contentForMultipleSelection"],observeContentChange:function(d){var a;var c;switch(d.changeType){case coherent.ChangeType.setting:this.setContent(d.newValue);break;case coherent.ChangeType.insertion:this._insertObjectsIntoArrangedObjects(d.newValue);if(this.selectsInsertedObjects){var b=this.selectedObjects();b=b.concat(d.newValue);this.setSelectedObjects(b)}break;case coherent.ChangeType.deletion:this.rearrangeObjects();break;case coherent.ChangeType.replacement:this.rearrangeObjects();break;default:break}},canAdd:function(){return this.editable()},add:function(){var a=new (this.objectClass)();var b=this.content();b.addObject(a)},canRemove:function(){return this.editable()&&this.selectionIndexes().length},remove:function(){var a=this.selectedObjects();var b=this.content();b.removeObjects(a)},setContent:function(a){a=a||[];if(this.bindings.content){this.bindings.content.setValue(a)}this.__content=a;this.rearrangeObjects(a)},sortDescriptors:function(){return this.__sortDescriptors},setSortDescriptors:function(a){if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue(a)}this.__sortDescriptors=a;this.rearrangeObjects()},filterPredicate:function(){return this.__filterPredicate},setFilterPredicate:function(a){if(this.bindings.filterPredicate){this.bindings.filterPredicate.setValue(a)}this.__filterPredicate=a;this.rearrangeObjects()},filterObjects:function(e){var f=this.filterPredicate();if(!f){return IndexRange(e)}var c=[];var d;var a;var b;for(d=0,a=e.length;d<a;++d){b=e[d];if(f(b)){c.push(d)}}return c},_compareObjects:function(f,e){var d;var b;var c=this.sortDescriptors();var a=c.length;for(d=0;d<a;++d){b=c[d].compareObjects(f,e);if(!c[d].ascending){b*=-1}if(0!==b){return b>0?1:-1}}return 0},sortObjects:function(d,b){b=b||IndexRange(d);var c=this.sortDescriptors();var e=c.length;function a(m,l){var i;var g;var k=d[m];var j=d[l];var f=e;var h=c;for(i=0;i<f;++i){g=h[i].compareObjects(k,j);if(!h[i].ascending){g*=-1}if(0!==g){return g}}return 0}if(0!==c.length){b.sort(a)}return b},arrangeObjects:function(e){var c=this.filterObjects(e);c=this.sortObjects(e,c);if(e===this.content()){var d=[];var a=c.length;for(var b=0;b<a;++b){d[c[b]]=b}this.__contentToArrangedMap=d;this.__arrangedToContentMap=c}return e.objectsAtIndexes(c)},rearrangeObjects:function(d){var g=d||this.content()||[];var c=this.arrangeObjects(g);var b=this.selectedObjects();var e=[];var a=b.length;var h;var f;for(f=0;f<a;++f){h=c.indexOf(b[f]);if(-1!==h){e.push(h)}}this.setValueForKey(c,"arrangedObjects");this.setValueForKey(e,"selectionIndexes")},_insertObjectsIntoArrangedObjects:function(a){var h=this.arrangeObjects(a);var k=h.length;var b=this.arrangedObjects;var f=b.length;var g=[];var j=0;var d;var c;var e;g.length=k;for(e=0;e<k;++e){d=h[e];while(j<f){c=b[j];if(-1===this._compareObjects(d,c)){break}++j}g[e]=j+e}b.insertObjectsAtIndexes(h,g)},selectedObjects:function(){return this.__selectedObjects},setSelectedObjects:function(b){var c=[];var e;var d;var a=this.arrangedObjects;for(e=0;e<b.length;++e){d=a.indexOf(b[e]);if(-1===d){continue}c.push(d)}return this.setSelectionIndexes(c)},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(b){b=b||[];b.sort();if(0===(this.selectionIndexes()||[]).compare(b)){return false}if(this.bindings.selectionIndexes){this.bindings.selectionIndexes.setValue(b)}this.__selectionIndexes=b;var a=this.arrangedObjects;this.__selectedObjects=a.objectsAtIndexes(b);this.forceChangeNotificationForKey("selection");return true},setSelectionIndex:function(b){var a=this.setSelectionIndexes([b]);return a},selectionIndex:function(){var a=this.selectionIndexes();if(0===a.length){return -1}return a[0]}});coherent.ModelController=Class.create(coherent.Controller,{constructor:function(b,a){if(!("addObserverForKeyPath" in b)){coherent.KVO.adaptTree(b)}function c(d){this.setValueForKey(b[d],d)}b.mutableKeys().forEach(c,this);this.base(a)}});Object.extend(coherent,{dataModel:new coherent.KVO(),registerModelWithName:function(b,a){coherent.dataModel.setValueForKey(b,a)},unregisterModelWithName:function(a){delete coherent.dataModel[a]}});coherent.ValueTransformer=Class.create({transformedValue:function(a){return a},reverseTransformedValue:function(a){return a},__factory__:function(){var b=Array.from(arguments);var a=this;function c(){}return function(){c.prototype=a.prototype;var d=new c();a.prototype.constructor.apply(d,b);return d}}});coherent.ValueTransformer.__subclassCreated__=function(a){var c=coherent.ValueTransformer.prototype;var b=a.prototype;if(c.reverseTransformedValue==b.reverseTransformedValue){a.prototype.reverseTransformedValue=null}};coherent.transformer={};coherent.transformerInstances={};coherent.findTransformerWithName=function(transformerName){var valueTransformer=coherent.transformerInstances[transformerName.toLowerCase()];if(valueTransformer){return valueTransformer}if(-1===transformerName.indexOf(".")){valueTransformer=coherent.transformer[transformerName]}else{try{valueTransformer=eval(transformerName)}catch(e){}}valueTransformer=valueTransformer&&new valueTransformer();if(valueTransformer){return valueTransformer}throw new InvalidArgumentError("The transformerName argument does not specify a valid ValueTransformer: "+transformerName)};coherent.registerTransformerWithName=function(b,a){if(!b.transformedValue){throw new InvalidArgumentError("The valueTransformer argument does not support the ValueTransformer method transformedValue")}a=a.toLowerCase();coherent.transformerInstances[a]=b};coherent.transformer.Not=Class.create(coherent.ValueTransformer,{transformedValue:function(a){return(a?false:true)},reverseTransformedValue:function(a){return !!a}});coherent.registerTransformerWithName(new coherent.transformer.Not(),"not");coherent.transformer.Boolean=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.trueValue=a;this.falseValue=b},transformedValue:function(a){return(a==this.trueValue)},reverseTransformedValue:function(a){return(a?this.trueValue:this.falseValue)}});coherent.transformer.Matches=Class.create(coherent.ValueTransformer,{constructor:function(a){this.trueRegex=a},transformedValue:function(a){return this.trueRegex.test(a)}});coherent.transformer.Generic=Class.create(coherent.ValueTransformer,{constructor:function(a,b){this.modelValues=a;this.displayValues=b},transformedValue:function(b){var a=this.modelValues.indexOf(b);var c;if(-1==a){return c}else{return this.displayValues[a]}},reverseTransformedValue:function(b){var a=this.displayValues.indexOf(b);var c;if(-1==a){return c}else{return this.modelValues[a]}}});coherent.transformer.Truncated=Class.create(coherent.ValueTransformer,{constructor:function(a){this.max=a||50},ellipsis:String.fromCharCode(8230),transformedValue:function(a){if(a){return a.toString().truncate({from:"middle",length:this.max,omission:this.ellipsis})}else{return a}}});coherent.registerTransformerWithName(new coherent.transformer.Truncated(50),"truncated");coherent.transformer.StringsToObjects=Class.create(coherent.ValueTransformer,{constructor:function(a){this.key=a||"string"},transformedValue:function(b){if(!b||!b.map){return b}function a(c){var d=new coherent.KVO();d[this.key]=c;return d}return b.map(a,this)},reverseTransformedValue:function(b){if(!b||!b.map){return b}function a(c){return c[this.key]}return b.map(a,this)}});coherent.registerTransformerWithName(new coherent.transformer.StringsToObjects("string"),"StringsToObjects");coherent.transformer.ObjectToArray=Class.create(coherent.ValueTransformer,{transformedValue:function(d){var a=coherent.KVO.adapt([]);if(d){for(var c in d){var b=d[c].index;a[b]=d[c]}}return a}});coherent.registerTransformerWithName(new coherent.transformer.ObjectToArray(),"ObjectToArray");
/*!
 * Sizzle CSS Selector Engine - v1.0
 *  Copyright 2009, The Dojo Foundation
 *  Released under the MIT, BSD, and GPL Licenses.
 *  More information: http://sizzlejs.com/
 */
;
/*!
 * ATTENTION: This file has been modified to remove all handling of XML
 */
(function(){var q=/((?:\((?:\([^()]+\)|[^()]+)+\)|\[(?:\[[^[\]]*\]|['"][^'"]*['"]|[^[\]'"]+)+\]|\\.|[^ >+~,(\[\\]+)+|[>+~])(\s*,\s*)?/g,j=0,d=Object.prototype.toString,l=Array.prototype.splice,n=Array.prototype.push,i=Array.prototype.sort;var b=function(w,s,z,A){z=z||[];var C=s=s||document;if(s.nodeType!==1&&s.nodeType!==9){return[]}if(!w||typeof w!=="string"){return z}var x=[],u,E,H,e,B,t,v=true;q.lastIndex=0;while((u=q.exec(w))!==null){x.push(u[1]);if(u[2]){t=RegExp.rightContext;break}}if(x.length>1&&k.exec(w)){if(x.length===2&&f.relative[x[0]]){E=g(x[0]+x[1],s)}else{E=f.relative[x[0]]?[s]:b(x.shift(),s);while(x.length){w=x.shift();if(f.relative[w]){w+=x.shift()}E=g(w,E)}}}else{if(!A&&x.length>1&&s.nodeType===9&&f.match.ID.test(x[0])&&!f.match.ID.test(x[x.length-1])){var D=b.find(x.shift(),s);s=D.expr?b.filter(D.expr,D.set)[0]:D.set[0]}if(s){var D=A?{expr:x.pop(),set:a(A)}:b.find(x.pop(),x.length===1&&(x[0]==="~"||x[0]==="+")&&s.parentNode?s.parentNode:s);E=D.expr?b.filter(D.expr,D.set):D.set;if(x.length>0){H=a(E)}else{v=false}while(x.length){var G=x.pop(),F=G;if(!f.relative[G]){G=""}else{F=x.pop()}if(F==null){F=s}f.relative[G](H,F)}}else{H=x=[]}}if(!H){H=E}if(!H){throw"Syntax error, unrecognized expression: "+(G||w)}if(d.call(H)==="[object Array]"){if(!v){n.apply(z,H)}else{if(s&&s.nodeType===1){for(var y=0;H[y]!=null;y++){if(H[y]&&(H[y]===true||H[y].nodeType===1&&h(s,H[y]))){n.call(z,E[y])}}}else{for(var y=0;H[y]!=null;y++){if(H[y]&&H[y].nodeType===1){n.call(z,E[y])}}}}}else{a(H,z)}if(t){b(t,C,z,A);b.uniqueSort(z)}return z};b.uniqueSort=function(s){if(c){hasDuplicate=false;i.call(s,c);if(hasDuplicate){for(var e=1;e<s.length;e++){if(s[e]===s[e-1]){l.call(s,e--,1)}}}}};b.matches=function(e,s){return b(e,null,null,s)};b.find=function(x,u){var y,s;if(!x){return[]}for(var t=0,e=f.order.length;t<e;t++){var v=f.order[t],s;if((s=f.match[v].exec(x))){var w=RegExp.leftContext;if(w.substr(w.length-1)!=="\\"){s[1]=(s[1]||"").replace(/\\/g,"");y=f.find[v](s,u);if(y!=null){x=x.replace(f.match[v],"");break}}}}if(!y){y=u.getElementsByTagName("*")}return{set:y,expr:x}};b.filter=function(A,z,D,u){var t=A,F=[],x=z,w,e;while(A&&z.length){for(var y in f.filter){if((w=f.match[y].exec(A))!=null){var s=f.filter[y],E,C;e=false;if(x==F){F=[]}if(f.preFilter[y]){w=f.preFilter[y](w,x,D,F,u);if(!w){e=E=true}else{if(w===true){continue}}}if(w){for(var v=0;(C=x[v])!=null;v++){if(C){E=s(C,w,v,x);var B=u^!!E;if(D&&E!=null){if(B){e=true}else{x[v]=false}}else{if(B){F.push(C);e=true}}}}}if(E!==undefined){if(!D){x=F}A=A.replace(f.match[y],"");if(!e){return[]}break}}}if(A==t){if(e==null){throw"Syntax error, unrecognized expression: "+A}else{break}}t=A}return x};var f=b.selectors={order:["ID","NAME","TAG"],match:{ID:/#((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,CLASS:/\.((?:[\w\u00c0-\uFFFF_-]|\\.)+)/,NAME:/\[name=['"]*((?:[\w\u00c0-\uFFFF_-]|\\.)+)['"]*\]/,ATTR:/\[\s*((?:[\w\u00c0-\uFFFF_-]|\\.)+)\s*(?:(\S?=)\s*(['"]*)(.*?)\3|)\s*\]/,TAG:/^((?:[\w\u00c0-\uFFFF\*_-]|\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\((even|odd|[\dn+-]*)\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\((\d*)\))?(?=[^-]|$)/,PSEUDO:/:((?:[\w\u00c0-\uFFFF_-]|\\.)+)(?:\((['"]*)((?:\([^\)]+\)|[^\2\(\)]*)+)\2\))?/},attrMap:{"class":"className","for":"htmlFor"},attrHandle:{href:function(e){return e.getAttribute("href")}},relative:{"+":function(x,s){var u=typeof s==="string",w=u&&!/\W/.test(s),y=u&&!w;if(w){s=s.toUpperCase()}for(var t=0,e=x.length,v;t<e;t++){if((v=x[t])){while((v=v.previousSibling)&&v.nodeType!==1){}x[t]=y||v&&v.nodeName===s?v||false:v===s}}if(y){b.filter(s,x,true)}},">":function(x,s){var v=typeof s==="string";if(v&&!/\W/.test(s)){s=s.toUpperCase();for(var t=0,e=x.length;t<e;t++){var w=x[t];if(w){var u=w.parentNode;x[t]=u.nodeName===s?u:false}}}else{for(var t=0,e=x.length;t<e;t++){var w=x[t];if(w){x[t]=v?w.parentNode:w.parentNode===s}}if(v){b.filter(s,x,true)}}},"":function(u,s){var t=j++,e=r;if(!s.match(/\W/)){var v=s=s.toUpperCase();e=p}e("parentNode",s,t,u,v)},"~":function(u,s){var t=j++,e=r;if(typeof s==="string"&&!s.match(/\W/)){var v=s=s.toUpperCase();e=p}e("previousSibling",s,t,u,v)}},find:{ID:function(s,t){if(typeof t.getElementById!=="undefined"){var e=t.getElementById(s[1]);return e?[e]:[]}},NAME:function(t,w){if(typeof w.getElementsByName!=="undefined"){var s=[],v=w.getElementsByName(t[1]);for(var u=0,e=v.length;u<e;u++){if(v[u].getAttribute("name")===t[1]){s.push(v[u])}}return s.length===0?null:s}},TAG:function(e,s){return s.getElementsByTagName(e[1])}},preFilter:{CLASS:function(u,s,t,e,x){u=" "+u[1].replace(/\\/g,"")+" ";for(var v=0,w;(w=s[v])!=null;v++){if(w){if(x^(w.className&&(" "+w.className+" ").indexOf(u)>=0)){if(!t){e.push(w)}}else{if(t){s[v]=false}}}}return false},ID:function(e){return e[1].replace(/\\/g,"")},TAG:function(s,e){return s[1].toUpperCase()},CHILD:function(e){if(e[1]=="nth"){var s=/(-?)(\d*)n((?:\+|-)?\d*)/.exec(e[2]=="even"&&"2n"||e[2]=="odd"&&"2n+1"||!/\D/.test(e[2])&&"0n+"+e[2]||e[2]);e[2]=(s[1]+(s[2]||1))-0;e[3]=s[3]-0}e[0]=j++;return e},ATTR:function(v,s,t,e,w){var u=v[1].replace(/\\/g,"");if(f.attrMap[u]){v[1]=f.attrMap[u]}if(v[2]==="~="){v[4]=" "+v[4]+" "}return v},PSEUDO:function(v,s,t,e,w){if(v[1]==="not"){if(v[3].match(q).length>1||/^\w/.test(v[3])){v[3]=b(v[3],null,null,s)}else{var u=b.filter(v[3],s,t,true^w);if(!t){e.push.apply(e,u)}return false}}else{if(f.match.POS.test(v[0])||f.match.CHILD.test(v[0])){return true}}return v},POS:function(e){e.unshift(true);return e}},filters:{enabled:function(e){return e.disabled===false&&e.type!=="hidden"},disabled:function(e){return e.disabled===true},checked:function(e){return e.checked===true},selected:function(e){e.parentNode.selectedIndex;return e.selected===true},parent:function(e){return !!e.firstChild},empty:function(e){return !e.firstChild},has:function(t,s,e){return !!b(e[3],t).length},header:function(e){return/h\d/i.test(e.nodeName)},text:function(e){return"text"===e.type},radio:function(e){return"radio"===e.type},checkbox:function(e){return"checkbox"===e.type},file:function(e){return"file"===e.type},password:function(e){return"password"===e.type},submit:function(e){return"submit"===e.type},image:function(e){return"image"===e.type},reset:function(e){return"reset"===e.type},button:function(e){return"button"===e.type||e.nodeName.toUpperCase()==="BUTTON"},input:function(e){return/input|select|textarea|button/i.test(e.nodeName)}},setFilters:{first:function(s,e){return e===0},last:function(t,s,e,u){return s===u.length-1},even:function(s,e){return e%2===0},odd:function(s,e){return e%2===1},lt:function(t,s,e){return s<e[3]-0},gt:function(t,s,e){return s>e[3]-0},nth:function(t,s,e){return e[3]-0==s},eq:function(t,s,e){return e[3]-0==s}},filter:{PSEUDO:function(x,t,u,y){var s=t[1],v=f.filters[s];if(v){return v(x,u,t,y)}else{if(s==="contains"){return(x.textContent||x.innerText||"").indexOf(t[3])>=0}else{if(s==="not"){var w=t[3];for(var u=0,e=w.length;u<e;u++){if(w[u]===x){return false}}return true}}}},CHILD:function(e,u){var x=u[1],s=e;switch(x){case"only":case"first":while(s=s.previousSibling){if(s.nodeType===1){return false}}if(x=="first"){return true}s=e;case"last":while(s=s.nextSibling){if(s.nodeType===1){return false}}return true;case"nth":var t=u[2],A=u[3];if(t==1&&A==0){return true}var w=u[0],z=e.parentNode;if(z&&(z.sizcache!==w||!e.nodeIndex)){var v=0;for(s=z.firstChild;s;s=s.nextSibling){if(s.nodeType===1){s.nodeIndex=++v}}z.sizcache=w}var y=e.nodeIndex-A;if(t==0){return y==0}else{return(y%t==0&&y/t>=0)}}},ID:function(s,e){return s.nodeType===1&&s.getAttribute("id")===e},TAG:function(s,e){return(e==="*"&&s.nodeType===1)||s.nodeName===e},CLASS:function(s,e){return(" "+(s.className||s.getAttribute("class"))+" ").indexOf(e)>-1},ATTR:function(w,u){var t=u[1],e=f.attrHandle[t]?f.attrHandle[t](w):w[t]!=null?w[t]:w.getAttribute(t),x=e+"",v=u[2],s=u[4];return e==null?v==="!=":v==="="?x===s:v==="*="?x.indexOf(s)>=0:v==="~="?(" "+x+" ").indexOf(s)>=0:!s?x&&e!==false:v==="!="?x!=s:v==="^="?x.indexOf(s)===0:v==="$="?x.substr(x.length-s.length)===s:v==="|="?x===s||x.substr(0,s.length+1)===s+"-":false},POS:function(v,s,t,w){var e=s[2],u=f.setFilters[e];if(u){return u(v,t,s,w)}}}};var k=f.match.POS;for(var o in f.match){f.match[o]=new RegExp(f.match[o].source+/(?![^\[]*\])(?![^\(]*\))/.source)}var a=function(s,e){s=Array.prototype.slice.call(s);if(e){n.apply(e,s);return e}return s};try{Array.prototype.slice.call(document.documentElement.childNodes)}catch(m){a=function(v,u){var s=u||[];if(d.call(v)==="[object Array]"){Array.prototype.push.apply(s,v)}else{if(typeof v.length==="number"){for(var t=0,e=v.length;t<e;t++){s.push(v[t])}}else{for(var t=0;v[t];t++){s.push(v[t])}}}return s}}var c;if(document.documentElement.compareDocumentPosition){c=function(s,e){var t=s.compareDocumentPosition(e)&4?-1:s===e?0:1;if(t===0){hasDuplicate=true}return t}}else{if("sourceIndex" in document.documentElement){c=function(s,e){var t=s.sourceIndex-e.sourceIndex;if(t===0){hasDuplicate=true}return t}}else{if(document.createRange){c=function(u,s){var t=u.ownerDocument.createRange(),e=s.ownerDocument.createRange();t.selectNode(u);t.collapse(true);e.selectNode(s);e.collapse(true);var v=t.compareBoundaryPoints(Range.START_TO_END,e);if(v===0){hasDuplicate=true}return v}}}}(function(){var s=document.createElement("form"),t="script"+(new Date).getTime();s.innerHTML="<input name='"+t+"'/>";var e=document.documentElement;e.insertBefore(s,e.firstChild);if(!!document.getElementById(t)){f.find.ID=function(v,w){if(typeof w.getElementById!=="undefined"){var u=w.getElementById(v[1]);return u?u.id===v[1]||typeof u.getAttributeNode!=="undefined"&&u.getAttributeNode("id").nodeValue===v[1]?[u]:undefined:[]}};f.filter.ID=function(w,u){var v=typeof w.getAttributeNode!=="undefined"&&w.getAttributeNode("id");return w.nodeType===1&&v&&v.nodeValue===u}}e.removeChild(s)})();(function(){var e=document.createElement("div");e.appendChild(document.createComment(""));if(e.getElementsByTagName("*").length>0){f.find.TAG=function(s,w){var v=w.getElementsByTagName(s[1]);if(s[1]==="*"){var u=[];for(var t=0;v[t];t++){if(v[t].nodeType===1){u.push(v[t])}}v=u}return v}}e.innerHTML="<a href='#'></a>";if(e.firstChild&&typeof e.firstChild.getAttribute!=="undefined"&&e.firstChild.getAttribute("href")!=="#"){f.attrHandle.href=function(s){return s.getAttribute("href",2)}}})();if(document.querySelectorAll){(function(){var e=b,t=document.createElement("div");t.innerHTML="<p class='TEST'></p>";if(t.querySelectorAll&&t.querySelectorAll(".TEST").length===0){return}b=function(x,w,u,v){w=w||document;if(!v&&w.nodeType===9){try{return a(w.querySelectorAll(x),u)}catch(y){}}return e(x,w,u,v)};for(var s in e){b[s]=e[s]}})()}if(document.getElementsByClassName&&document.documentElement.getElementsByClassName){(function(){var e=document.createElement("div");e.innerHTML="<div class='test e'></div><div class='test'></div>";if(e.getElementsByClassName("e").length===0){return}e.lastChild.className="e";if(e.getElementsByClassName("e").length===1){return}f.order.splice(1,0,"CLASS");f.find.CLASS=function(s,t){if(typeof t.getElementsByClassName!=="undefined"){return t.getElementsByClassName(s[1])}}})()}function p(s,x,w,A,y){var z=s=="previousSibling";for(var u=0,t=A.length;u<t;u++){var e=A[u];if(e){if(z&&e.nodeType===1){e.sizcache=w;e.sizset=u}e=e[s];var v=false;while(e){if(e.sizcache===w){v=A[e.sizset];break}if(e.nodeType===1){e.sizcache=w;e.sizset=u}if(e.nodeName===x){v=e;break}e=e[s]}A[u]=v}}}function r(s,x,w,A,y){var z=s=="previousSibling";for(var u=0,t=A.length;u<t;u++){var e=A[u];if(e){if(z&&e.nodeType===1){e.sizcache=w;e.sizset=u}e=e[s];var v=false;while(e){if(e.sizcache===w){v=A[e.sizset];break}if(e.nodeType===1){e.sizcache=w;e.sizset=u;if(typeof x!=="string"){if(e===x){v=true;break}}else{if(b.filter(x,[e]).length>0){v=e;break}}}e=e[s]}A[u]=v}}}var h=document.compareDocumentPosition?function(s,e){return s.compareDocumentPosition(e)&16}:function(s,e){return s!==e&&(s.contains?s.contains(e):true)};var g=function(e,y){var u=[],v="",w,t=y.nodeType?[y]:y;while((w=f.match.PSEUDO.exec(e))){v+=w[0];e=e.replace(f.match.PSEUDO,"")}e=f.relative[e]?e+"*":e;for(var x=0,s=t.length;x<s;x++){b(e,t[x],u)}return b.filter(v,u)};window.Sizzle=b})();Object.extend(Element,{NodeType:{ELEMENT:1,ATTRIBUTE:2,TEXT:3,CDATA_SECTION:4,ENTITY_REFERENCE:5,ENTITY:6,PROCESSING_INSTRUCTION:7,COMMENT:8,DOCUMENT:9,DOCUMENT_TYPE:10,DOCUMENT_FRAGMENT:11,NOTATION:12},TABINDEX:"tabindex",DATATABINDEX:"data-tabindex",TRANSITION_DELAY_INTERVAL:1,uniqueId:function(){return"coherent_id_"+Element.assignId.uniqueId++},assignId:function(a){return a.id||(a.id=("coherent_id_"+Element.assignId.uniqueId++))},hasAttribute:function(b,a){return"hasAttribute" in b?b.hasAttribute(a):a in b.attributes&&typeof b.attributes[a]!=="undefined"},regexForClassName:function(b){var a=arguments.callee;if(!a._lookup){a._lookup={}}if(b in a._lookup){return a._lookup[b]}return(a._lookup[b]=new RegExp("(^|\\s)"+b+"(\\s|$)"))},hasClassName:function(a,b){var c=a.className;if(!c){return false}if(c==b){return true}return Element.regexForClassName(b).test(c)},addClassName:function(a,b){if(!b){return}if(Element.hasClassName(a,b)){return}a.className+=" "+b},setClassName:function(a,b){if(!b){b=""}a.className=b},removeClassName:function(a,b){if(!a||!b){return}var c=Element.regexForClassName(b);a.className=a.className.replace(c," ").trim()},replaceClassName:function(b,c,a){if(!c){return}if(!a){Element.removeClassName(b,c);return}var d=Element.regexForClassName(c);b.className=b.className.replace(d,"$1"+a+"$2").trim()},toggleClassName:function(a,b){if(!b){return}var c=Element.regexForClassName(b);var d=a.className;if(c.test(d)){a.className=d.replace(c," ").trim()}else{a.className+=" "+b}},updateClass:function(f,g,c){var e=$S(f.className.split(" "));var h=Set.add;var b=Set.remove;var d;var a;if("string"===typeof(g)){h(e,g)}else{for(d=0,a=g.length;d<a;++d){h(e,g[d])}}if("string"===typeof(c)){b(e,c)}else{for(d=0,a=c.length;d<a;++d){b(e,c[d])}}f.className=Set.join(e," ")},addTransitionCallback:function(a,c){if(!c||!a){return}var b=function(d){if(d.srcElement===a){a.removeEventListener(coherent.Support.transitionEnd,b,false);c(d)}};a.addEventListener(coherent.Support.transitionEnd,b,false)},addClassNameForTransition:function(a,b,c){Element.addTransitionCallback(a,c);Element.addClassName.delay(Element.TRANSITION_DELAY_INTERVAL,a,b)},removeClassNameForTransition:function(a,b,c){Element.addTransitionCallback(a,c);Element.removeClassName.delay(Element.TRANSITION_DELAY_INTERVAL,a,b)},setClassNameForTransition:function(a,b,c){Element.addTransitionCallback(a,c);Element.setClassName.delay(Element.TRANSITION_DELAY_INTERVAL,a,b)},replaceGetParams:function(d,g){var c=d.indexOf("?");if(c>=0){var e=d.substring(0,c);var f=d.substring(c+1,d.length);var b=Object.fromQueryString(f);var a=Object.fromQueryString(g);b=Object.merge(a,b);return e+"?"+Object.toQueryString(b)}else{return d+"?"+g}},pickSrcFromSrcSet:function(b,a){a=(a!==null)?a:(window.devicePixelRatio)?window.devicePixelRatio:1;var c=Infinity;var d="";var e=/url\(['"]?(.*?)['"]?\)\s*?([\d\.]*?)x/g;b.replace(e,function(g,f,h){var i=Math.abs(a-parseFloat(h));if(i<c){d=f;c=i}return g});return d},parseSourceSetData:function(e,l){var b=e.src;var h=true;var g=(l!==null)?l:(window.devicePixelRatio)?window.devicePixelRatio:1;var k="-webkit-image-set(";if(coherent.typeOf(l)==="string"){l=null}var i={};for(var j in e){var f=j.match(/[\d\.]+$/);var m=null,d=0,a=0;if(!f&&j==="src"){m=b;d=g;a=3}else{if(j.indexOf("scaleParam")===0){m=Element.replaceGetParams(b,e[j]);d=parseFloat(f[0]);a=2}else{if(j.indexOf("scaleUrl")===0){m=e[j];d=parseFloat(f[0]);a=1}}}if(m!==null&&(!i[""+d]||a<=i[""+d].pri)){i[""+d]={pri:a,url:m}}}for(var c in i){if(i[c]!==""){k+=(h?"":", ")+"url("+i[c].url+") "+c+"x";h=false}}k+=")";return k},PROPERTIES:["backgroundColor","backgroundPosition","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","color","display","fontSize","letterSpacing","lineHeight","opacity","width","height","top","bottom","left","right","marginTop","marginRight","marginBottom","marginLeft","paddingTop","paddingRight","paddingBottom","paddingLeft"],getStyles:function(e,d){var f={};var b=window.getComputedStyle(e,null);if("string"===typeof(d)){return e.style[d]||b[d]||null}d=d||Element.PROPERTIES;var g;var a=d.length;for(var c=0;c<a;++c){g=d[c];f[g]=e.style[g]||b[g]||null}return f},setStyle:function(a,b,c){a.style[b]=c},setStyles:function(a,b){var c=a.style;for(var d in b){c[d]=b[d]}},isElement:function(a){return a.nodeType===Element.NodeType.ELEMENT},isVoidElement:function(a){var b=false;switch(a.tagName.toLowerCase()){case"area":case"base":case"br":case"col":case"command":case"embed":case"hr":case"img":case"input":case"keygen":case"link":case"meta":case"param":case"source":case"track":case"wbr":b=true;break;default:break}return b},setInnerHTML:function(a,b){Element.innerHTML(a,b,false)},appendInnerHTML:function(a,b){Element.innerHTML(a,b,true)},innerHTML:function(d,e,b){var a=d.parentNode,c=a&&d.cloneNode(false);a&&a.replaceChild(c,d);e=String.stringify(e);if(b){d.innerHTML+=e.escapeForInnerHTML()}else{d.innerHTML=e.escapeForInnerHTML()}a&&a.replaceChild(d,c)},findDeepestFirstParentNode:function(e,d){var c=null;var b;var a;for(b=0,a=e.childNodes.length;b<a;b++){if((c=d(e.childNodes[b]))){break}}return c!==null?Element.findDeepestFirstParentNode(c,d):e},nonVoidElement:function(a){return Element.isElement(a)&&!Element.isVoidElement((a))&&(a)||null},setDeepestFirstElementInnerHTML:function(a,c){var b=Element.findDeepestFirstParentNode(a,Element.nonVoidElement);Element.innerHTML((b),c)},getDimensions:function(e){var g=Element.getStyle(e,"display");if(g&&g!="none"){return{left:e.offsetLeft,top:e.offsetTop,width:e.offsetWidth,height:e.offsetHeight}}var b=e.style;var f=b.visibility;var c=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var d={width:e.offsetWidth,height:e.offsetHeight,left:e.offsetLeft,top:e.offsetTop};b.display=a;b.position=c;b.visibility=f;return d},clone:function(a){return a.cloneNode(true)},depthFirstTraversal:function(d,e,c){if(!d||!e){return}var a=d.nextSibling||d.parentNode;var b;c=c||e;while(d!==a){if(1===d.nodeType){b=e.call(c,d);if(false!==b&&d.firstChild){d=d.firstChild;continue}}while(!d.nextSibling){d=d.parentNode;if(d===a){return}}d=d.nextSibling}},query:function(c,b){if(1==arguments.length){b=c;c=document}else{if(c!=document){b="#"+Element.assignId(c)+" "+b}}var a;try{a=c.querySelector(b)}catch(d){a=Sizzle(b,c)[0]||null}return a},queryAll:function(c,b){if(1==arguments.length){b=c;c=document}else{if(c!=document){b="#"+Element.assignId(c)+" "+b}}var a;try{a=Array.from(c.querySelectorAll(b))}catch(d){a=Sizzle(b,c)}return a},match:function(b,a){return Sizzle.matches(a,[b]).length==1},getViewport:function(){var c=["left","top","width","height"],d=c.length,b={},f=window,a,e;if(f.innerWidth){a=["pageXOffset","pageYOffset","innerWidth","innerHeight"]}else{a=["scrollLeft","scrollTop","clientWidth","clientHeight"];f=document.documentElement||document.body}for(e=0;e<d;e++){b[c[e]]=f[a[e]]}return b},scrollParent:function(d){var c;var b=Element.getStyles;var a=document.body;while(d&&d!=a){c=b(d,["overflow","overflowX","overflowY"]);if(("visible"!==c.overflowX||"visible"!==c.overflowY)||"visible"!==c.overflow){return d}d=d.parentNode}return d},getRect:function(p,n){if(!p){return null}var r=document.documentElement;var m=document.body;var d=0;var o=0;if(p!=document.body&&p.getBoundingClientRect){var l=p.getBoundingClientRect();l={left:l.left,right:l.right,top:l.top,bottom:l.bottom};if(!!n===false){l.left+=Math.max(r.scrollLeft,m.scrollLeft);l.right+=Math.max(r.scrollLeft,m.scrollLeft);l.top+=Math.max(r.scrollTop,m.scrollTop);l.bottom+=Math.max(r.scrollTop,m.scrollTop)}else{if(coherent.Browser.MobileSafari){l.top-=window.pageYOffset;l.bottom-=window.pageYOffset;l.left-=window.pageXOffset;l.right-=window.pageXOffset}}l.left-=r.clientLeft;l.right-=r.clientLeft;l.top-=r.clientTop;l.bottom-=r.clientTop;l.width=l.right-l.left;l.height=l.bottom-l.top;return l}var j=p.parentNode;var f=p;var a=p.offsetParent;var k=coherent.Browser.Mozilla;var q=coherent.Browser.Safari&&!coherent.Browser.Safari2;var b=coherent.Browser.Safari2;var h=Element.getStyles;var g=Element.getDimensions(p);var c=("fixed"===Element.getStyles(p,"position"));var i;d+=p.offsetLeft;o+=p.offsetTop;while(!c&&a){d+=a.offsetLeft;o+=a.offsetTop;if(k&&!((/^t(able|d|h)$/i).test(a.tagName))||q){i=h(a,["borderLeftWidth","borderTopWidth"]);d+=parseInt(i.borderLeftWidth||0,10);o+=parseInt(i.borderTopWidth||0,10)}if(!c){c=("fixed"===h(a,"position"))}if("BODY"!==a.tagName){f=a}a=a.offsetParent}var e=k?["display","overflow","borderLeftWidth","borderTopWidth"]:["display"];while(j&&j.tagName&&"BODY"!==j.tagName&&"HTML"!==j.tagName){i=h(j,e);if(!((/^inline|table.*$/i).test(i.display))){d-=j.scrollLeft;o-=j.scrollTop}if(k&&"visible"!=i.overflow){d+=parseInt(i.borderLeftWidth||0,10);o+=parseInt(i.borderTopWidth||0,10)}j=j.parentNode}var s=h(f,"position");if((b&&(c||s=="absolute"))||(k&&s!="absolute")){d-=m.offsetLeft;o-=m.offsetTop}if(n===true&&!c){d-=Math.max(window.pageXOffset,r.scrollLeft,m.scrollLeft);o-=Math.max(window.pageYOffset,r.scrollTop,m.scrollTop)}return{left:d,top:o,right:d+g.width-1,bottom:o+g.height-1,width:g.width,height:g.height}},offsetFromAncestor:function(b,a){var c=b&&b.offsetWidth&&{top:b.offsetTop,left:b.offsetLeft,width:b.offsetWidth,height:b.offsetHeight};a=c&&(a||document.body);while(a&&b&&a!==b){b=b.parentNode;c.top+=b.offsetTop;c.left+=b.offsetLeft}return c},locateAncestor:function(c,b,a){if(typeof b!="function"){throw new TypeError("Qualifier must be a function")}a=a||document.documentElement;while(c&&c!=a){if(b(c)){return c}c=c.parentNode}return null},scrollDocumentTopBy:function(a){document.documentElement.scrollTop=document.body.scrollTop=a},scrollDocumentLeftBy:function(a){document.documentElement.scrollLeft=document.body.scrollLeft=a},getDocumentScrollTop:function(){return document.documentElement.scrollTop||document.body.scrollTop},getDocumentScrollLeft:function(){return document.documentElement.scrollLeft||document.body.scrollLeft},isFixedPositionSupported:function(){var a=document.body;var f=4;var c=a.appendChild(document.createElement("DIV"));var h=c.appendChild(document.createElement("DIV"));var g=Element.getDocumentScrollTop();var e;var b;var d=true;if(a.getBoundingClientRect){c.style.cssText="position:relative;height:9999px;width:1px;";h.style.cssText="position:fixed;top:1px;width:1px;height:1px;";Element.scrollDocumentTopBy(0);e=h.getBoundingClientRect().top;Element.scrollDocumentTopBy(f);b=h.getBoundingClientRect().top;d=(e===b||b<0)&&Element.getDocumentScrollTop()===f;Element.scrollDocumentTopBy(g)}a.removeChild(c);return d},preventFocus:function(b,a){(a?Element.findFocusables(b):[b]).forEach(function(d,c){d.setAttribute(Element.DATATABINDEX,Element.tabIndex(d));d.removeAttribute(Element.TABINDEX);d.tabIndex=-1})},restoreFocus:function(b,a){(a?Element.queryAll(b,"["+Element.DATATABINDEX+"]"):[b]).forEach(function(e,c){var d=e.getAttribute(Element.DATATABINDEX);if(parseInt(d,10)>=-1){e.setAttribute(Element.TABINDEX,d)}else{e.removeAttribute(Element.TABINDEX)}e.removeAttribute(Element.DATATABINDEX)})},hidden:function(a){return !Element.visible(a)},visible:function(b){var a=(b.offsetWidth>0||b.offsetHeight>0),c=(b.style&&b.style.display)!=="none";return a&&c},tabIndex:function(a){if(a.nodeType===Element.NodeType.ELEMENT||a.nodeType===Element.NodeType.DOCUMENT){var c=a.getAttributeNode(Element.TABINDEX),b=c?c.specified:false;return parseInt(b&&a.getAttribute(Element.TABINDEX),10)}},findFocusables:function(e,d,b){var a=[],f=0,g=(function(){if(typeof b==="boolean"){return b}else{if(typeof d==="boolean"){return d}else{return true}}})(),c=(function(){var h=d;if(typeof d==="string"){if(d.toLowerCase()==="first"){h=1}else{if(d.toLowerCase()==="last"){h=-1}}}return parseInt(h,10)})();Element.depthFirstTraversal(e,function(h){if(Element.tabIndex(h)||Element._findFocusables.isValidEl(h)){a.push({node:h,dfs:f++})}});if(g){a=a.filter(function(h){return Element.visible(h.node)&&(h.node.getAttribute(Element.TABINDEX)||0)>=0})}a=a.sort(function(i,h){var j=parseInt(i.node.getAttribute(Element.TABINDEX),10)||0,k=parseInt(h.node.getAttribute(Element.TABINDEX),10)||0;if(j===k){return i.dfs>h.dfs?1:-1}if(j>0&&k>0){return k<j?1:-1}return k>j?1:-1}).map(function(h){return h.node});if(c===-1){return a[a.length-1]}if(c===1){return a[0]}return a.slice(0,c||a.length)},_findFocusables:{validNodeNames:["A","INPUT","SELECT","BUTTON","TEXTAREA"],isValidEl:function(a){return Element._findFocusables.validNodeNames.some(function(b){return a.nodeName.toUpperCase()===b})}}});Element.getStyle=Element.getStyles;Element.assignId.uniqueId=1;if(!coherent.Support.QuerySelector){Object.extend(Element,{query:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)[0]||null)},queryAll:function(b,a){if(1==arguments.length){a=b;b=document}return(Sizzle(a,b)||null)}})}(function(){var a=this.Event;this.Event={};Object.extend(this.Event,a||{})}).call(window);Object.extend(Event,{KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_RETURN:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45,KEY_CAPSLOCK:20,KEY_LEFTCOMMAND:91,KEY_RIGHTCOMMAND:93,KEY_MOZILLACOMMAND:224,KEY_RIGHTWINDOWSSTART:92,MOUSE_LEFT:1,MOUSE_RIGHT:3,shiftKey:false,_domHasFinishedLoading:function(){if(arguments.callee.done){return}arguments.callee.done=true;if(Event._domLoadedTimer){window.clearInterval(Event._domLoadedTimer)}var c=Event._readyCallbacks;var a=c.length;var b;for(b=0;b<a;++b){c[b]()}Event._readyCallbacks=null},observe:function(c,a,b){if("on"==a.slice(0,2)){a=a.slice(2)}c.addEventListener(a,b,false)},stopObserving:function(c,a,b){if("on"==a.slice(0,2)){a=a.slice(2)}c.removeEventListener(a,b,false)},stop:function(a){a.preventDefault();a.stopPropagation()},preventDefault:function(a){a.preventDefault()},onDomReady:function(a){if(Event._domHasFinishedLoading.done){window.setTimeout(a,0);return}if(!Event._readyCallbacks){document.addEventListener("DOMContentLoaded",Event._domHasFinishedLoading,false);function b(){if((/loaded|complete/).test(document.readyState)){Event._domHasFinishedLoading()}}if(coherent.Browser.Safari){Event._domLoadedTimer=window.setInterval(b,10)}Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(a)},isModifiedKey:function(a){return !!(a.altKey||a.ctrlKey||a.metaKey)},isMetaKey:function(b){var a=(b.keyCode?b.keyCode:b.which);switch(a){case this.KEY_TAB:case this.KEY_CLEAR:case this.KEY_RETURN:case this.KEY_SHIFT:case this.KEY_CTRL:case this.KEY_ALT:case this.KEY_ESC:case this.KEY_LEFT:case this.KEY_UP:case this.KEY_RIGHT:case this.KEY_DOWN:case this.KEY_HOME:case this.KEY_END:case this.KEY_PAGEUP:case this.KEY_PAGEDOWN:case this.KEY_INSERT:case this.KEY_CAPSLOCK:case this.KEY_LEFTCOMMAND:case this.KEY_RIGHTCOMMAND:case this.KEY_MOZILLACOMMAND:case this.KEY_RIGHTWINDOWSSTART:if(b.charCode===0){return true;break}else{return false;break}default:break}return false}});coherent.PartFinder=(function(){function c(g,e){var h=g.length;var d=Array.from(e);function i(){g=[];d=null;h=0}function m(p){g.splice(p,1);if(d){d.splice(p,1)}h=g.length}function f(p){var r=Element.assignId(p);var q=g.indexOf(r);if(-1==q){return}g.splice(q,1);if(d){d.splice(q,1)}h=g.length}function o(r,q){var p=Element.assignId(r);g.splice(q,0,p);if(d){d.splice(q,0,r)}h=g.length}function n(p){g.push(Element.assignId(p));h=g.length;if(d){d.push(p)}}function k(){d=null}function j(){var r=[];var p;for(var q=0;q<h;++q){p=document.getElementById(g[q]);if(!p){continue}r.push(g[q])}g=r;h=r.length;d=null}function l(r){if(d){if(1==arguments.length){return d[r]}return d}if(1==arguments.length){return document.getElementById(g[r])}var p=[];for(var q=0;q<h;++q){p[q]=document.getElementById(g[q])}d=p;window.setTimeout(k,250);return p}if(e){window.setTimeout(k,250)}l.removePartAtIndex=m;l.removePart=f;l.insertPartAtIndex=o;l.add=n;l.removeAll=i;l.refresh=j;return l}function a(g,e){var d=e;function f(){d=null}function h(){if(d){return d}d=document.getElementById(g);window.setTimeout(f,250);return d}return h}function b(e,d){var f=Element.queryAll(e,d);var g=Array.map(f,Element.assignId);return{nodes:f,ids:g}}return{singlePart:function(e,d){function f(){var k=d;var g=typeof(k);if("function"===g){k=k()}else{if("string"===g){k=document.getElementById(k)}else{if(!k){k=this.viewElement()}}}var h=b(k,e);var j=a(h.ids[0],h.nodes[0]);var i=Class.findPropertyName(this,arguments.callee);if(i){this[i]=j}return h.nodes[0]}return f},multipleParts:function(e,d){function f(i){var l=d;var g=typeof(l);if("function"===g){l=l()}else{if("string"===g){l=document.getElementById(l)}else{if(!l){l=this.viewElement()}}}var h=b(l,e);var k=c(h.ids,h.nodes);var j=Class.findPropertyName(this,arguments.callee);if(j){this[j]=k}if(arguments.length){return h.nodes[i]}else{return Array.from(h.nodes)}}return f}}})();var Part=coherent.PartFinder.singlePart;var PartList=coherent.PartFinder.multipleParts;coherent.Style={kSelectedClass:"selected",kDisabledClass:"disabled",kReadOnlyClass:"read-only",kMarkerClass:"nullValue",kFocusClass:"focused",kHoverClass:"hover",kAscendingClass:"asc",kDescendingClass:"desc",kActiveClass:"active",kEditingClass:"editing",kUpdatingClass:"updating",kFadingClass:"invisible",kInvalidValueClass:"invalid",kInsertedClass:"inserted",kDeletedClass:"deleted",kReplacingClass:"replacing",kLoadingClass:"loading",kFirstClass:"first",kLastClass:"last"};coherent.Style.__styles=(function(){var a=[];var b=coherent.Style;for(var c in b){a.push(b[c])}return a})();coherent.setupSelectors=function(b,h,e){b=b||document.body;var a;var d;var g;var c=Element.queryAll;function f(j){for(var i in g){j.setAttribute(i,g[i])}}for(a in h){d=c(b,a);g=h[a];Array.forEach(d,f)}coherent.View.createViewsForNodeTree(b,e)};window.FIRST_RESPONDER="__first_responder__";coherent.Responder=Class.create(coherent.Bindable,{sendActionToView:function(b,a){if(FIRST_RESPONDER===a){a=coherent.page.firstResponder}var c=a||coherent.page.firstResponder||this;while(c){if(b in c){c[b](this);return true}c=c.nextResponder()}return false},acceptsFirstResponder:function(){return false},becomeFirstResponder:function(){return true},resignFirstResponder:function(){return true},nextResponder:function(){return this.__nextResponder||null},setNextResponder:function(a){this.__nextResponder=a},presentError:function(b){this.willPresentError(b);if(!("field" in b)){b.field=this}var a=this.nextResponder();if(a){return a.presentError(b)}return false},clearAllErrors:function(b){var a=this.nextResponder();if(a){a.clearAllErrors(b||this)}},willPresentError:function(a){},onmousedown:function(a){var b=this.nextResponder();if(b){b.onmousedown(a)}},onmouseup:function(a){var b=this.nextResponder();if(b){b.onmouseup(a)}},onmousedrag:function(a){var b=this.nextResponder();if(b){b.onmousedrag(a)}},onmouseenter:function(a){var b=this.nextResponder();if(b){b.onmouseenter(a)}},onmouseleave:function(a){var b=this.nextResponder();if(b){b.onmouseleave(a)}},onclick:function(a){var b=this.nextResponder();if(b){b.onclick(a)}},ondblclick:function(a){var b=this.nextResponder();if(b){b.ondblclick(a)}},onkeydown:function(a){var b=this.nextResponder();if(b){b.onkeydown(a)}},onkeyup:function(a){var b=this.nextResponder();if(b){b.onkeyup(a)}},onkeypress:function(a){var b=this.nextResponder();if(b){b.onkeypress(a)}},ontouchstart:function(a){var b=this.nextResponder();if(b){b.ontouchstart(a)}},ontouchmove:function(a){var b=this.nextResponder();if(b){b.ontouchmove(a)}},ontouchend:function(a){var b=this.nextResponder();if(b){b.ontouchend(a)}}});coherent.View=Class.create(coherent.Responder,{__viewClassName__:"View",__tagSpec__:["div","b","strong","em","i","q","p","span","li","h1","h2","h3","h4","td","label"],multipleValuesPlaceholder:_("marker.text.multipleValues"),nullPlaceholder:_("marker.text.placeholder"),noSelectionPlaceholder:_("marker.text.noSelection"),exposedBindings:["visible","class","enabled","editable","html","text","tabindex","title"],automaticallySetupBindings:false,requireBindingsForInferredViewType:true,formatter:null,target:null,action:null,sendActionOn:["click"],animated:false,updateAnimationDuration:0,updateAnimationDelay:0,postUpdateAnimationDuration:0,postUpdateAnimationDelay:0,preUpdateAnimationDuration:0,preUpdateAnimationDelay:0,constructor:function(a,b,c){this.base(c);if("string"===typeof(a)){this.id=a;this.__view=document.getElementById(a)}else{this.id=Element.assignId(a);this.__view=a}if(b&&!("addObserverForKeyPath" in b)){coherent.KVO.adaptTree(b)}this.__relativeSource=b;if(this.id in coherent.View.viewLookup){throw new Error("Two views share the same ID: "+this.id)}this.__updating=null;coherent.View.viewLookup[this.id]=this},__postConstruct:function(){var b=this;function c(){delete b.__view;delete b.__container}c.delay(250);var a=this.viewElement();if(a){this.__init()}else{Event.onDomReady(this.__init.bind(this))}},__init:function(){this.__initialising=true;var f=this.viewElement();if(!f){throw new Error("Unable to locate node with ID: "+this.id)}this.viewElement=function(){return f};var g;var a;if("true"===f.getAttribute("animated")){this.animated=true}var b=f.getAttribute("__parametersId");var h=this.__parameters||coherent.View.nodeParameters[b]||{};this.__copyParameters(h);if(this.innerHTML&&""===String(f.innerHTML).trim()){f.innerHTML=this.innerHTML}var i=coherent.dataModel;var c=this.__context;coherent.dataModel=this.__context=this;var d=this.structure()||{};var e={};for(a in d){g=d[a];if(g&&"function"==typeof(g)&&(g=g.valueOf()).__factoryFn__){e[a]=g;g.call(this,a,true)}}for(a in e){e[a].call(this,a,false)}this.__context=c;coherent.dataModel=i;this.setupBindings();this.init();this.updateBindings();this.createObservers();delete this.__initialising;delete this.viewElement},bindingInfoForName:function(c){var b=this.viewElement();var a=c+"Binding";return b.getAttribute(a)||this.__parameters[a]||this.__parameters[c]},teardown:function(){for(var a in this.bindings){this.bindings[a].unbind()}delete coherent.View.viewLookup[this.id]},__factory__:function(b,g,d){var a=this;var e=Element.queryAll;if("string"!==typeof(b)){d=g;g=b;b=null}g=g||{};var f="parameters_"+coherent.generateUid();coherent.View.nodeParameters[f]=g;g.viewClass=a;function h(i){i.setAttribute("__parametersId",f);if("sortKey" in g){i.setAttribute("sortKey",g.sortKey)}}function c(j){if(!j.getAttribute("__parametersId")){h(j)}var k=this.__relativeSource||this;var i=coherent.View.fromNode(j)||new a(j,k);coherent.View.createViewsForNodeTree(j,k,this.__context)}return function(m,j){if(m&&1===m.nodeType){return new a(m,j,g)}var n=d||(this?this.viewElement():document);var k=b||m;var i;if(/^#\S+$/.test(k)){var l=document.getElementById(k.substring(1));i=l?[l]:[]}else{i=e(n,k)||[]}if(!i.length){return null}if("action" in g){if(!g.target||g.target!==FIRST_RESPONDER){g.target=this}if(FIRST_RESPONDER!==g.target&&"string"===typeof(g.action)){g.action=(g.target)[g.action]}}Array.forEach(i,j?h:c,this);return coherent.View.fromNode(i[0])}},init:function(){var a=this.viewElement();var g=this.bindings;if(g["class"]&&!g["class"].hasValue()){var b=$S(a.className.split(" "));function e(h){delete b[h]}coherent.Style.__styles.forEach(e);var f=Set.join(b," ");g["class"].setValue(f)}if(g.enabled&&!g.enabled.hasValue()){g.enabled.setValue(!a.disabled)}if(g.text&&!g.text.hasValue()){var c=(a.textContent||a.innerText||"").trim();if(c){g.text.setValue(c)}}if(g.html&&!g.html.hasValue()){var d=(a.innerHTML||"").trim();if(d){g.html.setValue(d)}}if(g.title&&!g.title.hasValue()&&a.title){g.title.setValue(a.title)}},structure:function(){return this.__structure__},viewElement:function(){return this.__view||document.getElementById(this.id)},container:function(){return this.__container||this.__view||document.getElementById(this.__containerId||this.id)},setContainer:function(a){if(this.__view){this.__container=a}this.__containerId=Element.assignId(a);return a},superview:function(){var b=this.viewElement();if(!b){return null}var a=null;while(b&&!a){b=b.parentNode;if(!b){return null}if(document==b){return coherent.page}a=coherent.View.fromNode(b)}return a},isDescendantOf:function(b){if(!b){return false}var a=b.viewElement();var c=this.viewElement();while(c&&c!==document.body){if(c.id==a.id){return true}c=c.parentNode}return false},nextResponder:function(){return this.__nextResponder||this.superview()},focus:function(){var a=this.viewElement();function c(){a.focus()}if(coherent.Browser.IE){var b=/^(?:a|button|iframe|input|label|select|textarea)$/i;if(b.test(a.nodeName)){this.focus=c;c()}else{this.focus=function(){}}return}else{this.focus=c;c()}},blur:function(){var a=this.viewElement();function c(){a.blur()}if(coherent.Browser.IE){var b=/^(?:a|button|iframe|input|label|select|textarea)$/i;if(b.test(a.nodeName)){this.blur=c;c()}else{this.blur=function(){}}return}else{this.blur=c;c()}},setDelegate:function(a){this.delegate=a},sendToDelegate:function(a){if(this.delegate&&"function"==typeof(this.delegate[a])){this.delegate[a](this)}},sendAction:function(){var b=coherent.EventLoop.currentEvent;if(!this.action){return}if(FIRST_RESPONDER!==this.target||"string"!==typeof(this.action)){this.action.call(this.target||this.action,this,b);return}var a=coherent.page.firstResponder||this;var c=this.action;while(a){if(c in a){a[c](this,b);return}a=a.nextResponder()}},onclick:function(a){if(this.disabled){Event.stop(a);return}if(this.action&&this.sendActionOn.containsObject("click")){this.sendAction();Event.stop(a)}else{this.base(a)}},addTrackingInfo:function(a){coherent.page.addTrackingInfo(this.id,a)},observeVisibleChange:function(f,e,b){var a=this.viewElement();var d=coherent.Style.kFadingClass;function c(){a.style.display="none";Element.removeClassName(a,d)}if(!this.animated||this.__initialising){a.style.display=(f.newValue?"":"none")}else{if(f.newValue){if(a.style.display!==""){Element.addClassName(a,d);a.style.display=""}coherent.Animator.removeClassName(a,d,{duration:this.updateAnimationDuration||300})}else{coherent.Animator.addClassName(a,d,{duration:this.updateAnimationDuration||300,callback:c})}}},observeEnabledChange:function(b){var a=this.viewElement();this.disabled=a.disabled=!b.newValue;if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}},observeEditableChange:function(b){var a=this.viewElement();a.readOnly=!b.newValue;if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}},observeClassChange:function(h,g,d){var a=this.viewElement();var c=$S(a.className.split(" "));var f=$S((h.newValue||"").split(" "));function e(i){if(i in c){Set.add(f,i)}}coherent.Style.__styles.forEach(e);var b=Set.join(f," ");if(this.animated&&!this.__initialising){coherent.Animator.setClassName(a,b,{duration:500})}else{a.className=b}},translateValue:function(c){var a=this.viewElement();var b=true;if(this.formatter){c=this.formatter.stringForValue(c)}switch(c){case"":case null:case undefined:c=this.attributeOrProperty("nullPlaceholder");break;case coherent.Markers.NoSelection:c=this.attributeOrProperty("noSelectionPlaceholder");break;case coherent.Markers.MultipleValues:c=this.attributeOrProperty("multipleValuesPlaceholder");break;default:c=String(c);b=false;break}if(b){Element.addClassName(a,coherent.Style.kMarkerClass)}else{Element.removeClassName(a,coherent.Style.kMarkerClass)}return c},_beginUpdate:function(h,f){var c=(this.preUpdateAnimationDuration||this.updateAnimationDuration||this.postUpdateAnimationDuration)===0;if(c&&h){h.call(this);return}f=f||coherent.Style.kUpdatingClass;var a=this.viewElement();var e=this;if(this.__updating){this.__updating=h||null;return}this.__updating=h||null;function b(){if(e.__updating){e.__updating.call(e)}e.__updating=null;var j=e.postUpdateAnimationDuration||e.updateAnimationDuration;var i=e.postUpdateAnimationDelay||e.updateAnimationDelay;coherent.Animator.removeClassName(a,f,{duration:j,delay:i})}var g=this.preUpdateAnimationDuration||this.updateAnimationDuration;var d=this.preUpdateAnimationDelay||this.updateAnimationDelay||0;coherent.Animator.addClassName(a,f,{duration:g,callback:b})},observeTitleChange:function(d,c,b){var a=this.viewElement();a.title=d.newValue},observeTextChange:function(f,e,b){var a=this.viewElement();var d=(this.translateValue(f.newValue)||"").trim();if(this.lastText===d){return}this.lastText=d;function c(){var g=document.createTextNode(d);a.innerHTML="";a.appendChild(g)}this._beginUpdate(c)},observeHtmlChange:function(h,g,b){var a=this.viewElement();var f=h.newValue;if("string"===typeof(f)){f=f.trim()}var d=(this.translateValue(f)||"").trim();function c(){var i=document.createTextNode(d);a.innerHTML="";a.appendChild(i)}function e(){Element.setInnerHTML(a,d)}if(d!==f){if((a.textContent||a.innerText||"").trim()===d){return}this._beginUpdate(c)}else{if((a.innerHTML||"").trim()===d){return}this._beginUpdate(e)}},observeTabindexChange:function(f,e,b){var a=this.viewElement(),d=f.newValue,c="tabindex";if(d!==0&&!d){a.removeAttribute(c)}else{a.setAttribute(c,d)}},removeChild:function(a){if(!a){return null}coherent.View.teardownViewsForNodeTree(a);if(this.beforeRemoveElement){this.beforeRemoveElement(a)}return a.parentNode.removeChild(a)},attributeOrProperty:(function(){if(coherent.Browser.IE){return function(b){var a=this.viewElement();var c=a[b];if(c||""===c){return c}return String(this[b])}}else{return function(b){var a=this.viewElement();var c=a.getAttribute(b);if(c||""===c){return c}c=a[b];if(c||""===c){return c}return String(this[b])}}})()});coherent.View.nodeParameters={};coherent.View.viewLookup={};coherent.View.registry={};coherent.View.tagToViewLookup={};coherent.View.tagSpecRegex=/^(\w+)\s*(?:\[(\w*)\s*=\s*(\w*)\s*\])?$/;coherent.View.__updateTagSpecTable=function(c){var b=c.prototype;function d(e){var g=e.match(coherent.View.tagSpecRegex);if(!g){throw new Error("Invalid view spec: "+e)}var h=g[1].toUpperCase();var f=g[2];var i=g[3];var j=coherent.View.tagToViewLookup[h]||{};if(!(h in coherent.View.tagToViewLookup)){coherent.View.tagToViewLookup[h]=j}if(!f){if(j.viewClass){console.log((b.__viewClassName__+": "||"")+"Redefining view spec: "+e+": previously registered to "+(j.viewClass.prototype.__viewClassName__||"unknown"));throw new Error("Redefining view spec: "+e)}j.viewClass=c;return}if(!j.attr){j.attr={}}if(!(f in j.attr)){j.attr[f]={}}if(i in j.attr[f]){console.log((b.__viewClassName__+": "||"")+"Redefining view spec: "+e+": previously registered to "+(j.viewClass.prototype.__viewClassName__||"unknown"));throw new Error("Redefining view spec: "+e)}j.attr[f][i]=c}if(b.hasOwnProperty("__tagSpec__")){var a=b.__tagSpec__;if("string"==typeof(a)){d(a)}else{if("forEach" in a){a.forEach(d)}else{console.log("Invalid type for __tagSpec__")}}}if(b.hasOwnProperty("__viewClassName__")){coherent.View.registry[b.__viewClassName__]=c}};coherent.View.__subclassCreated__=function(a){if(!coherent.View.registry){coherent.View.registry={}}var b=a.prototype;var c=a.superclass.prototype;coherent.View.__updateTagSpecTable(a);if(b.__structure__!==c.__structure__){Object.applyDefaults(b.__structure__,c.__structure__)}};coherent.View.viewClassForNode=function(f,d){function a(s){var o=[];var r=s.split(" ");var q;var p=coherent.View.registry;for(q=0;q<r.length;++q){if(r[q] in p){o[o.length]=p[r[q]]}}return o}var h=f.getAttribute("view");var c=f.getAttribute("__parametersId");var j;if(c){return coherent.View.nodeParameters[c].viewClass}if(h){j=coherent.View.registry[h];if(!j){throw new InvalidArgumentError("Invalid view type: "+h)}return j}var e=a(f.className.baseVal?f.className.baseVal:f.className)||0;if(1==e.length){return e[0]}if(e.length>1){throw new InvalidArgumentError("CSS class matches multiple view types: "+f.className)}var g=coherent.View.tagToViewLookup[f.tagName];if(!g){return null}var i;var l;var m=g.attr||{};var n;for(var b in m){n=m[b];l=f.getAttribute(b);if(l in n){j=n[l];break}l=f[b];if(l in n){i=n[l]}}j=j||i||g.viewClass;if(!j){return null}function k(r){var s=j.prototype.exposedBindings||[];var o=s.length;var q;var p;for(p=0;p<o;++p){q=s[p]+"Binding";if(r.getAttribute(q)){return true}}return false}if(!d&&j.prototype.requireBindingsForInferredViewType&&!k(f)){return null}return j};coherent.View.createViewForNode=function(c,e,b){var a=coherent.View.fromNode(c);if(a){return a}var d=coherent.View.viewClassForNode(c,b);return new (d||coherent.View)(c,e,b)};coherent.View.fromNode=function(a){var b=coherent.View.viewLookup;if(!b||!b[a.id]){return null}return b[a.id]};coherent.View.rebindNodeTreeWithRelativeSource=function(c,e,d){var a=coherent.ListView;function b(g){var f=coherent.View.fromNode(g);if(!f||(e&&f.__relativeSource!==e)){return true}f.__relativeSource=d;f.setupBindings();f.updateBindings();if(f instanceof a){return false}}Element.depthFirstTraversal(c,b)};coherent.View.unbindNodeTree=function(b){function a(d){var c=coherent.View.fromNode(d);if(!c){return}c.unbind()}Element.depthFirstTraversal(b,a)};coherent.View.createViewsForNodeTree=function(e,c,d){function b(f){if(coherent.View.fromNode(f)){return}var g=coherent.View.viewClassForNode(f);if(!g){return}new (g)(f,c)}var a=coherent.dataModel;if(d){coherent.dataModel=d}Element.depthFirstTraversal(e||document.body,b);if(d){coherent.dataModel=a}};coherent.View.teardownViewsForNodeTree=function(a){function b(d){var c=coherent.View.fromNode(d);if(!c){return}c.teardown()}Element.depthFirstTraversal(a||document.body,b)};coherent.View.__updateTagSpecTable(coherent.View);coherent.Anchor=Class.create(coherent.View,{__viewClassName__:"Anchor",__tagSpec__:"a",exposedBindings:["href"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.href&&!b.href.hasValue()&&a.href){b.href.setValue(a.href)}},observeHrefChange:function(b){var a=this.viewElement();a.href=b.newValue}});coherent.ListView=Class.create(coherent.View,{__viewClassName__:"List",__tagSpec__:["table","ul"],exposedBindings:["content","selectionIndexes","selectedIndex","selectedObject"],_items:null,_activeItem:-1,init:function(){this.base();this.objectCache={};var b=this.viewElement();var a;switch(b.tagName){case"SELECT":this._isSelectElement=true;this._items=PartList("option");this.templateElement=document.createElement("option");Event.observe(b,"change",this.selectedIndexChanged.bindAsEventListener(this));break;case"TABLE":a=this.setContainer(b.tBodies[0]);this._items=PartList("> tbody tr");this.templateElement=Element.clone(this._items(0));break;default:a=this.container();var c=b.firstChild;while(c){if(1===c.nodeType){break}c=c.nextSibling}if(!c){return}this._items=PartList("> "+c.nodeName);this.templateElement=Element.clone(c);break}this._items();if("true"===(this.attributeOrProperty("multiple")||"").toLowerCase()){this.multiple=true}this.templateElement.id="";if(this.template&&"function"!==typeof(this.template)){delete this.template}if(this.template&&!(this.template.valueOf()).__factoryFn__){this.template=this.template()}if(!this.template&&this.initFromDOM!==false){this._initFromDOM()}else{if(a){while(a.firstChild){a.removeChild(a.firstChild)}}}},computeSelectionIndexes:function(){var b=[];var a=this._items();function c(f,d){if(f.selected){b.push(d)}}a.forEach(c);return b},_initFromDOM:function(){var b=this.container();var n=this.viewElement();var c=this.bindings;var h=[];var p=[];var l=[];var m=this._items();var j=m.length;var k;if(!j||(c.content&&c.content.hasValue())){return}var d=this.objectClass||coherent.KVO;var a=coherent.Style.kSelectedClass;var o=Element.hasClassName;for(var g=0;g<j;++g){k=m[g];var f=l[g]=new d();if(k.selected||o(k,a)){h.push(g);p.push(f)}this.setupElement(k,f)}this.__selectionIndexes=h;this.selectedIndex=h.length?h[0]:-1;this.__content=l;if(c.content){c.content.setValue(l)}if(c.selectionIndexes){c.selectionIndexes.setValue(h)}if(c.selectedObject){c.selectedObject.setValue(p[0])}if(c.selectedIndex){c.selectedIndex.setValue(this.selectedIndex)}},acceptsFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}return true},highlightSelectionIndexes:function(d){var m=this.viewElement();var l=this._items();var h=l.length;var f;var g=0;var b=!!this._isSelectElement;var c;var a=coherent.Style.kSelectedClass;var k;var n;if(this.animated){var o={curve:coherent.easing.inOutSine,duration:300};k=function(i,e){coherent.Animator.addClassName(i,e,o)};n=function(i,e){coherent.Animator.removeClassName(i,e,o)}}else{k=Element.addClassName;n=Element.removeClassName}for(f=0;f<h;++f){if(f===0){Element.addClassName(l[f],coherent.Style.kFirstClass)}else{Element.removeClassName(l[f],coherent.Style.kFirstClass)}if(h>1&&f===h-1){Element.addClassName(l[f],coherent.Style.kLastClass)}else{Element.removeClassName(l[f],coherent.Style.kLastClass)}c=(f==d[g]);try{l[f].selected=c}catch(j){l[f].setAttribute("selected",c)}if(c){g++}if(b){continue}if(c){k(l[f],a)}else{n(l[f],a)}}if(1===d.length){this.selectedIndex=m.selectedIndex=d[0]}this.__selectionIndexes=d},selectionIndexes:function(){return this.__selectionIndexes},setSelectionIndexes:function(e){var a;var b=this.viewElement();var f=this.bindings;e=(e||[]).concat().sort();if(String(e)===String(this.__selectionIndexes)){e=this.__selectionIndexes}if(1===e.length){a=this.selectedIndex=b.selectedIndex=e[0]}else{if(e.length){a=b.selectedIndex=e[0]}else{a=b.selectedIndex=-1}}if(f.selectionIndexes){f.selectionIndexes.setValue(e)}if(f.selectedIndex){f.selectedIndex.setValue(a)}if(f.selectedObject&&f.content){var c=null;if(-1!==a){c=(this.__content||[])[a]}f.selectedObject.setValue(c)}if(f.selectedValue){var d=null;if(-1!==a){d=b.options[a].value}f.selectedValue.setValue(d)}this.__selectionIndexes=e;this.highlightSelectionIndexes(e)},selectedObjects:function(){var a=this.__content||[];return a.objectsAtIndexes(this.selectionIndexes()||[])},onkeydown:function(b){var j=this.viewElement();if(j.disabled){return}if(Event.KEY_UP!=b.keyCode&&Event.KEY_DOWN!=b.keyCode){return}Event.stop(b);var i=this.selectionIndexes();var e=(this.__content||[]).length-1;var l;if(this.multiple&&b.shiftKey&&i.length){var h=(this.selectedIndex==i[0]);var g=i[0];var k=i[i.length-1];if(1==i.length){if(Event.KEY_UP==b.keyCode){l=g-1}else{l=g+1}if(l<0||l>e){return}i.push(l)}else{if(h){if(Event.KEY_UP==b.keyCode){i.length--}else{if(k<e){i.push(l=k+1)}}}else{if(this.KEY_DOWN==b.keyCode){i.splice(0,1)}else{if(g>0){i.push(l=g-1)}}}}}else{if(!i.length){if(Event.KEY_UP==b.keyCode){this.selectedIndex=e}else{if(Event.KEY_DOWN==b.keyCode){this.selectedIndex=0}}i=[l=this.selectedIndex]}else{if(Event.KEY_UP==b.keyCode&&this.selectedIndex>0){this.selectedIndex--}else{if(Event.KEY_DOWN==b.keyCode&&this.selectedIndex<e){this.selectedIndex++}}i=[l=this.selectedIndex]}}if(!isNaN(l)){var n=this._items(l);var m=Element.scrollParent(j);var f=m.offsetHeight;var c=n.offsetTop-m.scrollTop;var d=n.offsetHeight;var a=this.container();if(n.offsetParent!==a){c-=a.offsetTop}if(c<0){n.scrollIntoView(true)}else{if(c+d>f){n.scrollIntoView(false)}}}this.setSelectionIndexes(i);return},selectedIndexChanged:function(c){if(!this.bindings.selectionIndexes&&!this.bindings.selectedIndex&&!this.bindings.selectedObject&&!this.bindings.selectedValue){return}var a=this.viewElement();var b;if(this.multiple){b=this.computeSelectionIndexes()}else{b=[this.selectedIndex=a.selectedIndex]}this.setSelectionIndexes(b)},_clearSelection:function(){var a=this.viewElement();var e=("SELECT"!==a.tagName);var f=Element.removeClassName;var c=coherent.Style.kSelectedClass;function d(g){g.selected=false;if(e){f(g,c)}}var b=this._items();b.forEach(d);a.selectedIndex=-1},observeSelectedIndexChange:function(d){var c=d.newValue;var b=(-1!==c&&null!==c&&"undefined"!==typeof(c));var a=b?[c]:[];this.setSelectionIndexes(a)},observeSelectedObjectChange:function(e){var d=e.newValue;var c=this.__content||[];var a=c.indexOf(d);var b=(-1===a?[]:[a]);this.setSelectionIndexes(b)},observeSelectionIndexesChange:function(b){var a=b.newValue||[];this.setSelectionIndexes(a)},_updateDomWithContent:function(l){this._items.refresh();var n=coherent.View.rebindNodeTreeWithRelativeSource;var r=coherent.View.unbindNodeTree;var s=this.selectedObjects();var j=[];var c=l.length;var m=this._items();var o=m.length;var f=Math.min(o,c);var h=0;var g;var k;var a;var p;var d;while(h<f){g=l[h];if(-1!==s.indexOf(g)){j.push(h)}k=m[h];d=Element.assignId(k);a=this.objectCache[d];this.objectCache[d]=g;if("undefined"===typeof(a)){this.setupElement(k,g)}else{n(k,a,g)}p=coherent.View.fromNode(k);if(!p||!p.bindings.visible){k.style.display=""}++h}if(h<c){var b=this.container();var q=document.createDocumentFragment();while(h<c){g=l[h];if(-1!==s.indexOf(g)){j.push(h)}k=this.createElement(g,null,q);this._items.add(k);++h}b.appendChild(q)}else{while(h<o){k=m[h];d=Element.assignId(k);r(k);this.objectCache[d]=null;if("SELECT"==this.viewElement().tagName){k.parentNode.removeChild(k);this._items.removePart(k);--o}else{k.style.display="none";++h}}}this.highlightSelectionIndexes(j)},observeContentChange:function(l){var b=this.container();var n=this.viewElement();var h;var m;var j;var k;var i;var g=[];var o=coherent.View.rebindNodeTreeWithRelativeSource;var p=coherent.View.unbindNodeTree;var a=this.objectCache;function d(s,r){var t=Element.assignId(t);var q=a[t];a[t]=r;o(s,q,r);s.style.display=""}switch(l.changeType){case coherent.ChangeType.setting:this.__content=l.newValue||[];this._updateDomWithContent(this.__content);break;case coherent.ChangeType.insertion:for(h=0;h<l.indexes.length;++h){m=this._items(l.indexes[h]);if(m&&"none"===m.style.display){j=m;d(m,l.newValue[h])}else{j=this.createElement(l.newValue[h],m);this._items.insertPartAtIndex(j,l.indexes[h])}if(this.animated){Element.addClassName(j,coherent.Style.kInsertedClass);coherent.Animator.removeClassName(j,coherent.Style.kInsertedClass,{discreteTransitionPoint:1,duration:this.updateAnimationDuration})}}break;case coherent.ChangeType.replacement:function f(r,q){d(r,q);coherent.Animator.removeClassName(r,coherent.Style.kReplacingClass,{duration:250,discreteTransitionPoint:1})}for(h=0;h<l.indexes.length;++h){j=this._items(l.indexes[h]);if(!this.animated){d(j,l.newValue[h])}else{coherent.Animator.addClassName(j,coherent.Style.kReplacingClass,{duration:this.updateAnimationDuration,discreteTransitionPoint:0,callback:f.bind(this,l.newValue[h])})}}break;case coherent.ChangeType.deletion:g=this.selectionIndexes();for(h=l.indexes.length-1;h>=0;--h){var c=l.indexes[h];g.removeObject(c);j=this._items(c);this._items.removePartAtIndex(c);if(!this.animated){this.removeChild(j)}else{coherent.Animator.addClassName(j,coherent.Style.kDeletedClass,{duration:this.updateAnimationDuration,discreteTransitionPoint:0,callback:this.removeChild.bind(this)})}}this.setSelectionIndexes(g);break;default:console.log("Unknown change type: "+l.changeType);break}if(this.bindings.displayValues){this.bindings.displayValues.update()}if(this.bindings.contentValues){this.bindings.contentValues.update()}},setupElement:function(d,c){if(coherent.Browser.MobileSafari&&!d.__setup){d.__setup=true;d.addEventListener("click",function(){},false)}if(this.template){var a=coherent.dataModel;var b;coherent.dataModel=this.__context;this.template.call(this,d,c);coherent.dataModel=a}else{coherent.View.createViewsForNodeTree(d,c,this.__context)}var f=Element.assignId(d);this.objectCache[f]=c;return d},createElement:function(c,d,b){var a=this.viewElement();b=b||this.container();var f=Element.clone(this.templateElement);var g=b.insertBefore(f,d||null);return this.setupElement(g,c)},onmousedown:function(d){var b=this.viewElement();if(b.disabled){return}if("SELECT"===b.tagName){this.base(d);return}var f=d.target||d.srcElement;var a=this.container();var c=this._items();if(f==a||f==b){return}while(f&&f.parentNode!=a){f=f.parentNode}if(f==a||f==b){return}this._activeItem=c.indexOf(f);Element.addClassName(f,coherent.Style.kActiveClass)},onmouseup:function(b){var a=this.viewElement();if(a.disabled){return}if(-1!==this._activeItem){Element.removeClassName(this._items(this._activeItem),coherent.Style.kActiveClass)}this._activeItem=-1},ontouchmove:function(b){var a=this.viewElement();if(a.disabled){return}if(-1!==this._activeItem){Element.removeClassName(this._items(this._activeItem),coherent.Style.kActiveClass)}this._activeItem=-1;this.base(b)},onclick:function(a){var k=this.viewElement();if(k.disabled){this.base(a);Event.stop(a);return}if("SELECT"===k.tagName){this.base(a);return}var i=a.target||a.srcElement;var f=-1;var d=null;var b=this.container();var j=this._items();if(i==b){return}while(i&&i.parentNode!=b){i=i.parentNode}if(i){f=j.indexOf(i);var c=Element.assignId(i);d=this.objectCache[c]}var h;if(!this.multiple){this.selectedIndex=f;this.setSelectionIndexes(h=[f])}else{h=this.selectionIndexes();if(a.shiftKey){this.setSelectionIndexes(IndexRange(this.selectedIndex,f))}else{if(a.ctrlKey||a.metaKey){var g=h.indexOf(f);if(-1===g){this.selectedIndex=f;h.push(f)}else{h.splice(g,1)}this.setSelectionIndexes(h)}else{this.selectedIndex=f;this.setSelectionIndexes([f])}}}if(i&&"A"==i.tagName){i.blur()}this.sendAction()}});coherent.Overlay=Class.create(coherent.View,{content:Part(".content"),container:Part(".container"),__structure__:{".close":coherent.Anchor({action:"close",visibleBinding:"canClose"}),".spinner":coherent.View({visibleBinding:"loading"}),".buttons":coherent.ListView({visibleBinding:"recoveryOptions",contentBinding:"recoveryOptions",action:"recoveryButtonClicked",acceptsFirstResponder:function(){return false},template:coherent.View({__structure__:{button:coherent.View({textBinding:"*.text"})}})})},minWidth:200,minHeight:200,contentScreen:null,spinnerDelay:500,spinnerClassName:"overlay-waiting",timeout:5000,focusableSelectors:"input, select, textarea, button, a[href]",closeBtn:Part(".close"),innerHTML:'<span class="chrome tl"></span><span class="chrome tr"></span><span class="chrome top"></span><span class="chrome left"></span><span class="chrome right"></span><span class="chrome bottom"></span><span class="chrome bl"></span><span class="chrome br"></span><span class="chrome center"></span><div class="spinner"></div><div class="container"><div class="content"></div><ul class="buttons"><li><button></button></li></ul></div><a href="#" class="close">close</a>',errorInnerHTML:'<div class="blue-header-popup">        <div class="header">            <h2>Server did not respond</h2>        </div>        <div class="content clearfix">            <p><strong>Your request to the server got no response. Either the request took too long, or the server may be down temporarily. Please try again.</strong></p>            <div class="error-actions">                <a href="#" class="cancel continue"><span class="replaced">Continue</span></a>            </div>        </div>        <div class="footer empty-footer">            <p>&nbsp;</p>        </div>    </div>',keyDependencies:{canClose:["loading","displayCloseWidget"]},init:function(){this.__cache={};this.__urlCache={};var a=this.viewElement();Element.setStyle(a,"display","none");this.setValueForKey(false,"visible");this.__curFocusIndex=0;this.__curFocusElement=null;this.__focusableElements=null},enableTabHandler:function(){Element.preventFocus(this.pageTarget,true);if(this.autoFocus||this.isModalDialog){var a=this.viewElement();try{a.setAttribute("tabindex","-1");a.focus()}catch(b){}if(Element.getViewport().height<Element.getDimensions(a).height){(this.closeBtn()||a).scrollIntoView()}}Element.query("#page,.page").setAttribute("aria-hidden","true");this.__keyboardObserver=this.__keyboardObserver.bindAsEventListener(this);Event.observe(document,"keydown",this.__keyboardObserver);this.hasPreventedFocus=true},disableTabHandler:function(){Element.query("#page,.page").removeAttribute("aria-hidden");Element.restoreFocus(this.pageTarget,true);Event.stopObserving(document,"keydown",this.__keyboardObserver);this.hasPreventedFocus=false},__keyboardObserver:function(a){if((a.keyCode||a.which)===Event.KEY_ESC){if(this.valueForKey("canClose")){this.hide();Event.stop(a)}}},__inOverlay:function(c){var a=this.viewElement(),b=Element.locateAncestor(c,function(d){return d==a},a.parentNode);return !!b},canClose:function(){return !this.loading&&this.displayCloseWidget},onclick:function(c){var a=this.viewElement(),d=Element.locateAncestor(c.target||c.srcElement,function b(e){return Element.hasClassName(e,"cancel")},a);if(d&&!d.disabled){this.hide();Event.stop(c)}d=this.nextResponder();if(d){d.onclick(c)}},display:function(c){c=Object.applyDefaults(c||{},{timeout:this.timeout,spinnerDelay:this.spinnerDelay,obscurePage:true,displayCloseWidget:true,nextResponder:null,dialog:false,pageTarget:Element.query("#page,.page"),grow:false,autoFocus:true,onCloseFocus:document.activeElement,dimensions:{width:this.minWidth,height:this.minHeight}});if(!c.url&&!c.sourceId&&!c.html&&!c.text&&!c.error){throw new Error("No source specified for the overlay.")}this.setValueForKey(c.displayCloseWidget,"displayCloseWidget");this.setValueForKey(c.autoFocus,"autoFocus");this.setValueForKey(c.onCloseFocus,"onCloseFocus");this.pageTarget=c.pageTarget;if(c.nextResponder){this.setNextResponder(c.nextResponder)}if(!this.contentScreen){function b(d){if(this.displayCloseWidget){this.close()}Event.stop(d)}if(coherent.Browser.IE===6){this.contentScreen=document.createElement("IFRAME");this.contentScreen.scrolling="no";this.contentScreen.frameBorder="0";this.contentScreen.src="about:blank"}else{this.contentScreen=document.createElement("DIV");if(this.displayCloseWidget){Event.observe(this.contentScreen,"click",b.bindAsEventListener(this))}}this.contentScreen.className="overlayScreen";Element.assignId(this.contentScreen);document.body.appendChild(this.contentScreen)}var a=this.viewElement();if(a.parentNode!==document.body){document.body.appendChild(a)}if(this.__request){this.__request.abort()}this.__clearTimers();if(c.grow){this.__show(c)}if(c.url){this.__loadContent(c);return}this.__showContent(c)},__clearTimers:function(){var b=[this.__loadingTimer,this.__waitingTimer],a;for(a=0;a<b.length;a++){if(b[a]){window.clearTimeout(b[a]);b[a]=0}}},__prepareToShow:function(b){var a=document.getElementById(this.__spinnerDelayNodeId);if(a){Element.setStyle(a,"display","none")}b.obscurePage=false;this.setValueForKey(false,"loading");this.__showContent(b)},__loadContent:function(c){function f(){console.log("Failed to display overlay: timeout exceeded");this.__clearTimers();c.html=this.errorInnerHTML;this.__prepareToShow(c)}function h(d){console.log("Failed to display overlay: "+d.message);this.__clearTimers();c.html=this.errorInnerHTML;this.__prepareToShow(c)}function b(){var d=document.getElementById(this.__spinnerDelayNodeId),i=Element.setStyle;if(!this.__spinnerDelayNodeId){d=document.body.appendChild(document.createElement("DIV"));i(d,"display","none");d.className=this.spinnerClassName;this.__spinnerDelayNodeId=Element.assignId(d)}i(d,"display","")}function a(j){var i=document.createElement("div"),d=coherent.Scripts.extract(j);c.scripts=d.scripts;c.html=d.toString();c.sourceId=Element.assignId(i);Element.setInnerHTML(i,c.html);this.__urlCache[c.url]=c.sourceId;this.__cache[i.id]=i;this.__clearTimers();this.__prepareToShow(c);this.requestCompleteCallback.call(this)}var e=this.__urlCache[c.url],g;if(e){c.sourceId=e;this.__clearTimers();this.__showContent(c);return}if(c.obscurePage){this.__obscurePage()}g=XHR.get(c.url);g.addMethods(a.bind(this),h.bind(this));this.setValueForKey(true,"loading");this.__loadingTimer=f.bindAndDelay(this,c.timeout);this.__waitingTimer=b.bindAndDelay(this,c.spinnerDelay)},requestCompleteCallback:function(){},__obscurePage:function(){var b=this.contentScreen,a="px";if(!this.__didObscurePage){this.__didObscurePage=true;Element.setStyle(b,"display","block");if(coherent.Browser.MobileSafari){Element.setStyles(b,{position:"absolute",top:0+a,left:0+a,width:document.documentElement.clientWidth+a,height:document.documentElement.offsetHeight+a})}coherent.Animator.setStyles(b,{opacity:0.85},{duration:175})}},__unobscurePage:function(){var a=this.contentScreen;if(this.__didObscurePage){this.__didObscurePage=false;coherent.Animator.setStyles(a,{opacity:0},{duration:250,callback:function(){Element.setStyle(a,"display","none")}})}},__getNodeById:function(a){return this.__cache[a]=(document.getElementById(a)||this.__cache[a])},__removeChildren:function(a){while(a.firstChild){a.removeChild(a.firstChild)}},__suspendScrolling:function(){if(coherent.Browser.IE===6){Element.query("html").style.overflow="hidden"}},__resumeScrolling:function(){if(coherent.Browser.IE===6){Element.query("html").style.overflow=""}},__enableDialog:function(c){var a=this.viewElement(),b=Element.assignId(this.content());a.setAttribute("role","alertdialog");if(c&&"ariaDialog" in c&&c.ariaDialog===true){a.setAttribute("role","dialog")}a.setAttribute("aria-describedby",b);if(c&&"headerId" in c){a.setAttribute("aria-labelledby",c.headerId)}a.setAttribute("tabindex","-1");this.isModalDialog=true},__disableDialog:function(){var a=this.viewElement();a.removeAttribute("role");a.removeAttribute("aria-describedby");a.removeAttribute("aria-labelledby");a.removeAttribute("tabindex");this.isModalDialog=false},__showContent:function(d){var f=document.body,h=f.insertBefore(this.viewElement(),f.firstChild),g=this.content(),a=this.container(),j,i,e,b,k;if("classname" in d){h.className=d.classname}Element.setStyles(h,{opacity:0,display:"",width:"",height:""});if("sourceId" in d){this.__removeChildren(g);b=this.__getNodeById(d.sourceId);if(b.parentNode){b.parentNode.removeChild(b)}g.appendChild(b)}else{if("html" in d){e=coherent.Scripts.extract(d.html);d.scripts=e.scripts;g.innerHTML=e}else{if("text" in d){j=document.createTextNode(d.text);this.__removeChildren(g);g.appendChild(j)}else{if("error" in d){j=document.createElement("span");Element.setInnerHTML(j,d.error.description);this.__removeChildren(g);g.appendChild(j);this.setValueForKey(d.error,"error");if(this.error.recoveryOptions&&this.error.recoveryAttempter){function c(m){var l=new coherent.KVO();l.text=m;return l}k=this.error.recoveryOptions.map(c);this.setValueForKey(k,"recoveryOptions")}else{this.setValueForKey(null,"recoveryOptions")}}}}}if(!d.error){this.setValueForKey(null,"error");this.setValueForKey(null,"recoveryOptions")}this.beforeShow(g,d);this.setDisplayDimensions(this.getDisplayDimensions(g),d);this.__show(d)},beforeShow:function(b,a){},getDisplayDimensions:function(a){return Element.getDimensions(a)},setDisplayDimensions:function(b,a){a.dimensions=b;a.dimensions.height=Math.max(this.minHeight,a.dimensions.height);a.dimensions.width=Math.max(this.minWidth,a.dimensions.width)},load:function(a){this.display({url:a})},__show:function(d){var b=d.dimensions.width,p=d.dimensions.height,a=this.container(),m=this.viewElement(),n="px",h=Element.getViewport(),g=Element.setStyle,l=Element.setStyles,f=coherent.Animator.setStyles,k=Math.max(p/2+15,Math.round(h.height/2+h.top))+n,i={display:"",position:"absolute",left:"50%",top:k},e={opacity:1},j=this;this.__grow=d.grow;if(this.__grow){i.width=this.minWidth+n;i.height=this.minHeight+n;i.marginLeft=(-this.minWidth/2)+n;i.marginTop=(-this.minHeight/2)+n;e.width=b+n;e.height=p+n;e.marginLeft=(-b/2)+n;e.marginTop=(-p/2)+n}else{i.width=b+n;i.height=p+n;i.marginLeft=(-b/2)+n;i.marginTop=(-p/2)+n}if(d.dialog){this.__enableDialog(d)}if(d.obscurePage){this.__obscurePage()}function o(){if(d.scripts){coherent.Scripts.install(d.scripts)}d.scripts=null}l(m,i);function c(){j.sendToDelegate("willShowOverlay");f(m,e,{duration:d.animDuration||250,callback:function(){o();j.setValueForKey(true,"visible");j.sendToDelegate("didShowOverlay");j.enableTabHandler()}})}coherent.Overlay.__currentOverlay=this;c.delay(100)},close:function(){return this.hide()},hide:function(b){var k=this.contentScreen,i=this.viewElement(),a=this.container(),g=this.content(),j="px",f=this,h=this.__removeChildren,e=Element.setStyle,d=coherent.Animator.setStyles,c={opacity:0};this.sendToDelegate("willHideOverlay");if(this.__grow){c.width=this.minWidth+j;c.height=this.minHeight+j;c.marginLeft=(-this.minWidth/2)+j;c.marginTop=(-this.minHeight/2)+j}this.__unobscurePage();d(i,c,{duration:250,callback:function(){i=document.body.appendChild(i);e(i,"display","none");f.sendToDelegate("didHideOverlay");if(b){h(g)}}});coherent.Overlay.__currentOverlay=null;this.setValueForKey(false,"visible");this.disableTabHandler();if(this.isModalDialog){this.__disableDialog()}window.setTimeout(function(){if(this.onCloseFocus){this.onCloseFocus.focus()}}.bind(this),0)},recoveryButtonClicked:function(d){var c=d.selectedIndex,b=this.error,a=b.recoveryAttempter;if(-1==c||!a){return}a(b,c)}});coherent.Overlay.getCurrentOverlay=function(){return coherent.Overlay.__currentOverlay||null};coherent.Bubble=Class.create(coherent.Overlay,{arrow:Part(".arrow"),innerHTML:'<span class="chrome tl"></span><span class="chrome tr"></span><span class="chrome top"></span><span class="chrome left"></span><span class="chrome right"></span><span class="chrome bottom"></span><span class="chrome bl"></span><span class="chrome br"></span><span class="chrome center"></span><div class="spinner"></div><div class="container"><div class="content"></div><ul class="buttons"><li><button class="text-action"></button></li></ul></div><span class="chrome arrow"></span>',minWidth:50,minHeight:20,maxWidth:800,maxHeight:500,init:function(){this.base();this.currentTarget=null;this.hasPreventedFocus=false},display:function(a){a=Object.applyDefaults(a,{grow:false});var b=Element.assignId(a.target);if(this.currentTarget==b){return}if(this.currentTarget){this.base(a);return}if(this.__timer){window.clearTimeout(this.__timer)}this.currentTarget=b;this.__timer=this.base.bindAndDelay(this,150,a)},hide:function(a){if(a&&this.currentTarget!==a.target.id){return}if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=this.__hide.bindAndDelay(this)},onmousedown:function(){if(this.__timer){window.clearTimeout(this.__timer)}},onmouseup:function(){this.hide()},__show:function(c){if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=null;this.currentTarget=Element.assignId(c.target);var k=this.viewElement();var m=this.arrow();var g=this.content();var b=this.container();if(c.dialog){this.__enableDialog();this.enableTabHandler()}Element.setStyle(b,"opacity",1);b.style.position="";Element.setStyle(k,"opacity",0);k.style.display="";var a=Element.getRect(c.target),o=a.left+a.width/2;var h=Element.getViewport();var i,q,p,f;if(c.within){i=Element.getRect(c.within)}else{if(c.dimensions){var l=parseInt(a.left,10)+Math.floor(a.width/2);var n=Math.floor(c.dimensions.width/2);i={left:l-n,right:l+n,width:c.dimensions.width}}else{i=Element.getRect(document.body)}}k.style.width="";q=Element.getRect(g);if(q.width<=i.width){if((o+q.width/2)<i.right){p={width:q.width+"px",left:Math.max(i.left,o-q.width/2)+"px",right:""};f=(o-parseInt(p.left,10))+"px"}else{p={width:q.width+"px",left:(i.right-q.width)+"px",right:""};f=(o-parseInt(p.left,10))+"px"}}else{p={width:i.width+"px",left:i.left+"px",right:""};f=(o-i.left)+"px"}Element.setStyles(k,p);Element.setStyle(m,"left",f);Element.removeClassName(k,"below");var d=m.offsetHeight;var e=d+parseInt(Element.getStyle(m,"marginBottom")||0,10)-2;var j=parseInt(a.top,10)-k.offsetHeight-e;if(j<h.top||"below"==c.position){Element.addClassName(k,"below");e=d+parseInt(Element.getStyle(m,"marginTop")||0,10)-4;j=parseInt(a.bottom,10)+e}k.style.top=j+"px";coherent.Animator.setStyles(k,{opacity:1},{duration:100})},__hide:function(){if(this.__timer){window.clearTimeout(this.__timer)}this.__timer=null;var a=this.viewElement();if(this.hasPreventedFocus){this.disableTabHandler()}this.__disableDialog();this.currentTarget=null;coherent.Animator.setStyles(a,{opacity:0},{duration:100,callback:function(){a.style.display="none"}})}});coherent.Bubble.display=function(d){var b="coherent_bubble_node";var c=document.getElementById(b);var a;if(c){a=coherent.View.fromNode(c)}else{c=document.createElement("div");c.id=b;document.body.appendChild(c);a=new coherent.Bubble(c)}a.display(d)};coherent.Bubble.hide=function(d){var b="coherent_bubble_node";var c=document.getElementById(b);if(!c){return}var a=coherent.View.fromNode(c);a.hide(d)};coherent.FieldGroup=Class.create(coherent.View,{validateFields:function(){var c=this.viewElement();var b=Element.queryAll(c,"input, textarea");var a=b.length;var j;var g;var d;var h=true;for(var e=0;e<a;++e){j=coherent.View.fromNode(b[e]);if(!j){continue}if("validate" in j){d=j.validate();if(d instanceof coherent.Error){h=false;g=g||b[e]}}}if(g){g.focus()}return h}});coherent.Fieldset=Class.create(coherent.FieldGroup,{bubbleClass:"bubble",init:function(){this.__currentViewId=false;this.__fieldErrors={};coherent.page.addObserverForKeyPath(this,"observeFirstResponderChange","firstResponder")},presentError:function(a){var b=a.field;if(!b){return}this.__fieldErrors[b.id]=a},clearAllErrors:function(a){delete this.__fieldErrors[a.id];if(this.__currentViewId==a.id){this.__currentViewId=false;coherent.Bubble.hide({target:document.getElementById(a.id)})}},observeFirstResponderChange:function(b){var a=b.newValue;this.showErrorMessageForField(a)},showErrorMessageForField:function(b){var a=!!b&&this.__fieldErrors[b.id];if(!a||!b.isDescendantOf(this)){if(this.__currentViewId){coherent.Bubble.hide({target:document.getElementById(this.__currentViewId)})}this.__currentViewId=false;return}this.__currentViewId=b.id;coherent.Bubble.display({classname:this.bubbleClass,error:a,position:a.position,target:b.viewElement(),within:this.viewElement(),nextResponder:b})}});coherent.Binding=Class.create({constructor:function(b,c,a){if(0===arguments.length){return}this.object=b;this.keyPath=c;this.transformer=a;this.refresh()},bind:function(){this.object.addObserverForKeyPath(this,this.observeChangeForKeyPath,this.keyPath)},unbind:function(){this.object.removeObserverForKeyPath(this,this.keyPath)},refresh:function(){this.cachedOriginalValue=this.object.valueForKeyPath(this.keyPath);this.cachedValue=this.transformedValue(this.cachedOriginalValue)},transformedValue:function(a){if(!this.transformer){return a}return this.transformer.transformedValue(a)},validateProposedValue:function(b){if(this.transformer){if(!this.transformer.reverseTransformedValue){throw new Error("Can't validate a value when the transformer doesn't have a reverseTransformedValue method")}b=this.transformer.reverseTransformedValue(b)}var a=this.object.validateValueForKeyPath(b,this.keyPath);if(a instanceof coherent.Error){return a}return this.transformedValue(a)},setValue:function(a){if(this.cachedValue===a){return}this.cachedValue=a;if(this.transformer){if(!this.transformer.reverseTransformedValue){return}a=this.transformer.reverseTransformedValue(a)}this.cachedOriginalValue=a;var b=this.updating;this.updating=true;this.object.setValueForKeyPath(a,this.keyPath);this.updating=b},mutable:function(){if(this.transformer&&!this.transformer.reverseTransformedValue){return false}var a=this.object.infoForKeyPath(this.keyPath);return a&&a.mutable},value:function(){return this.cachedValue},hasValue:function(){var a=this.value();return !(null===a||"undefined"===typeof(a))},update:function(){var a=this.value();var b=new coherent.ChangeNotification(this.object,coherent.ChangeType.setting,a);this.updating=true;this.observerFn(b,this.keyPath);this.updating=false},observerFn:function(c,b,a){},observeChangeForKeyPath:function(f,e,a){if(this.updating&&f.newValue===this.cachedOriginalValue){return}this.cachedOriginalValue=f.newValue;this.cachedOldValue=f.oldValue;var d=this.transformedValue(f.newValue);var b=Object.clone(f);b.newValue=d;b.oldValue=null;if(coherent.ChangeType.setting===f.changeType){this.cachedValue=d}var c=this.updating;this.updating=true;this.observerFn(b,e,a);this.updating=c}});coherent.Binding.bindingRegex=/^(.*?)(?:\((.*)\))?$/;coherent.Binding.compoundRegex=/^\s*([^&|].*?)\s*(\&\&|\|\|)\s*(\S.+)\s*$/;coherent.Binding.bindingFromString=function(d,c){var b;var e;b=d.match(coherent.Binding.compoundRegex);if(b&&4==b.length){e=new coherent.CompoundBinding(b[2],coherent.Binding.bindingFromString(b[1],c),coherent.Binding.bindingFromString(b[3],c));e.bind();return e}b=d.match(coherent.Binding.bindingRegex);if(!b||b.length<3){throw new InvalidArgumentError("bindingString isn't in correct format")}var f=b[1];var a;if(b[2]){a=coherent.findTransformerWithName(b[2])}if("$"==f.charAt(0)){e=new coherent.VariableBinding(c||coherent.dataModel,f,a)}else{e=new coherent.Binding(c||coherent.dataModel,f,a)}e.bind();return e};coherent.VariableKeyPath=Class.create({constructor:function(b,a){this.keyPath=b;this.kvo=a},origKeyPath:function(){return this.keyPath},resolve:function(){return coherent.VariableKeyPath.resolve(this.keyPath,this.kvo)},variablePaths:function(){return coherent.VariableKeyPath.variableKeys(this.keyPath)}});coherent.VariableKeyPath.resolve=function(h,d){if("$"!==h.charAt(0)){throw new InvalidArgumentError("variable keypath isn't in correct format")}var a=h.substr(1).split("$"),g="",f={},c=d;for(var b=0;b<a.length;b++){var e=a[b];if(f[e]){g+=f[e]}else{if(e.length>0){if((e.charAt(0)!==".")&&(e.charAt(e.length-1)!==".")){e=c.valueForKeyPath(e);if("undefined"===typeof(e)||null===e){return undefined}}g+=e}}}return g};coherent.VariableKeyPath.variableKeys=function(c){var a=[],b={};c.substr(1).split("$").forEach(function(d){if(d.length>0&&d.charAt(0)!=="."&&d.charAt(d.length-1)!=="."){if(!b[d]){b[d]=true;a.push(d)}}});return a};coherent.VariableBinding=Class.create(coherent.Binding,{constructor:function(b,c,a){this.variableKeyPath=new coherent.VariableKeyPath(c,b);this.cachedVariablesMap={};this.base(b,c,a);this.observers={}},addObserver:function(a,d,b){var c=new coherent.ObserverEntry(a,d,b);c.vbuid=coherent.VariableBinding.observerId++;a.vbuid=c.vbuid;this.observers[c.vbuid]=c},removeObserver:function(a){delete this.observers[a.vbuid]},getObservers:function(){return this.observers},valueForResolvedKeyPath:function(a){if(null===a||"undefined"===typeof(a)||a.indexOf("undefined")!=-1){return undefined}return this.object.valueForKeyPath(a)},bind:function(){this.bindVariablePaths();this.bindResolvedPath()},bindVariablePaths:function(){for(var a in this.cachedVariablesMap){this.object.addObserverForKeyPath(this,this.observeChangeForVariablePath,a)}},bindResolvedPath:function(){this.object.addObserverForKeyPath(this,this.observeChangeForResolvedPath,this.cachedResolvedKey)},unbind:function(){this.unbindVariablePaths();this.unbindResolvedPath()},unbindVariablePaths:function(){for(var a in this.cachedVariablesMap){this.object.removeObserverForKeyPath(this,a)}},unbindResolvedPath:function(){this.object.removeObserverForKeyPath(this,this.cachedResolvedKey)},refresh:function(){this.refreshCacheForVariablePaths();this.refreshCacheForResolvedPath()},refreshCacheForVariablePaths:function(){this.variableKeyPath.variablePaths().forEach(function(a){this.cachedVariablesMap[a]=this.object.valueForKeyPath(a)},this)},refreshCacheForResolvedPath:function(){var b=this.resolvedKeyPathFromCache(),a=this.valueForResolvedKeyPath(b);this.cachedOriginalValue=a;this.cachedValue=a;this.cachedResolvedKey=b},resolvedKeyPathFromCache:function(){var a=this.cachedVariablesMap,b="";this.variableKeyPath.origKeyPath().substr(1).split("$").forEach(function(c){if(c.length>0){if(c.charAt(0)!=="."&&c.charAt(c.length-1)!=="."){b+=a[c]}else{b+=c}}});return b},observeChangeForVariablePath:function(f,e,a){this.unbindResolvedPath();this.cachedVariablesMap[e]=f.newValue;var c=this.resolvedKeyPathFromCache(),d=this.valueForResolvedKeyPath(c);this.cachedResolvedKey=c;var b=Object.clone(f);b.newValue=d;b.oldValue=this.cachedOriginalValue;this.observeChangeForResolvedPath(b,"",a);this.bindResolvedPath()},observeChangeForResolvedPath:function(c,b,a){this.observeChangeForKeyPath(c,this.variableKeyPath.origKeyPath(),a)}});coherent.VariableBinding.observerId=1;coherent.CompoundBinding=Class.create(coherent.Binding,{constructor:function(a,c,b){this.base();if(!a||!c||!b){throw new InvalidArgumentError("No parameters to CompoundBinding initialiser are optional")}this.operation=a;this.left=c;this.right=b;this.left.observerFn=this.right.observerFn=this.observeChange.bind(this);switch(this.operation){case coherent.CompoundBinding.AND:this.cachedValue=this.left.value()&&this.right.value();break;case coherent.CompoundBinding.OR:this.cachedValue=this.left.value()||this.right.value();break;default:throw new InvalidArgumentError("Unknown operation value for CompoundBinding");break}},bind:function(){this.left.bind();this.right.bind()},unbind:function(){this.left.unbind();this.right.unbind()},mutable:function(){return false},setValue:function(a){throw new Error("Attempting to set value of CompoundBinding")},observeChange:function(c,b){var a=this.cachedValue;switch(this.operation){case coherent.CompoundBinding.AND:this.cachedValue=this.left.value()&&this.right.value();break;case coherent.CompoundBinding.OR:this.cachedValue=this.left.value()||this.right.value();break;default:throw new Error("Unknown operation value for CompoundBinding");break}if(a===this.cachedValue){return}this.update()}});coherent.CompoundBinding.AND="&&";coherent.CompoundBinding.OR="||";Class.extend(Array,{containsObject:function(a){return -1!==this.indexOf(a)},valueForKey:function(c){if(!c||0===c.length){throw new InvalidArgumentError("the key is empty")}if("@count"==c){return this.length}var d=new Array(this.length);var b;var a=this.length;for(b=0;b<a;++b){d[b]=this[b].valueForKey(c)}return d},setValueForKey:function(d,c){if(!c||0===c.length){throw new InvalidArgumentError("key is empty")}var b;var a=this.length;for(b=0;b<a;++b){this[b].setValueForKey(d,c)}},indexesOfObjects:function(e){var d;var b=e.length;var a=[];var c;for(d=0;d<b;++d){c=this.indexOf(e[d]);if(-1===c){continue}a.push(c)}return a},addObject:function(b){var a=this.length;var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.push(b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},addObjects:function(c){var b;var a=c.length;for(b=0;b<a;++b){this.addObject(c[b])}},insertObjectAtIndex:function(b,a){if(a<0||a>=this.length){throw new RangeError("index must be within the bounds of the array")}var c=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,[b],null,[a]);this.splice(a,0,b);this.observeElementAtIndex(a);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},insertObjectsAtIndexes:function(e,c){if(e.length!==c.length){throw new InvalidArgumentError("length of objects and indexes parameters must be equal")}var a=e.length;var d;var b;for(d=0;d<a;++d){b=c[d];this.splice(b,0,e[d]);this.observeElementAtIndex(b)}var f=new coherent.ChangeNotification(this,coherent.ChangeType.insertion,e,null,c);this.notifyObserversOfChangeForKeyPath(f,coherent.KVO.kAllPropertiesKey)},replaceObjectAtIndex:function(c,b){var a=this[b];this[b]=c;var d=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,[c],[a],[b]);this.notifyObserversOfChangeForKeyPath(d,coherent.KVO.kAllPropertiesKey)},replaceObjectsAtIndexes:function(f,d){var b=[];var a=f.length;var e;var c;for(e=0;e<a;++e){c=d[e];b[e]=this[c];this.stopObservingElementAtIndex(c);this[c]=f[e];this.observeElementAtIndex(c)}var g=new coherent.ChangeNotification(this,coherent.ChangeType.replacement,f,null,d);this.notifyObserversOfChangeForKeyPath(g,coherent.KVO.kAllPropertiesKey)},removeObject:function(b){var a=this.indexOf(b);if(-1===a){return}this.removeObjectAtIndex(a)},removeObjects:function(d){var a=d.length;var b;for(var c=0;c<a;++c){b=this.indexOf(d[c]);if(-1===b){continue}this.removeObjectAtIndex(b)}},removeObjectsAtIndexes:function(b){var a=b.length;for(var c=0;c<a;++c){this.removeObjectAtIndex(b[c])}},removeObjectAtIndex:function(b){if(b<0||b>=this.length){throw new RangeError("index must be within the bounds of the array")}this.stopObservingElementAtIndex(b);var a=this.splice(b,1);var c=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,a,[b]);this.notifyObserversOfChangeForKeyPath(c,coherent.KVO.kAllPropertiesKey)},removeAllObjects:function(){var d;var c=[];var a=this.length;c.length=a;for(d=0;d<a;++d){this.stopObservingElementAtIndex(d);c[d]=d}var b=this.splice(0,a);var e=new coherent.ChangeNotification(this,coherent.ChangeType.deletion,null,b,c);this.notifyObserversOfChangeForKeyPath(e,coherent.KVO.kAllPropertiesKey)},objectsAtIndexes:function(c){var d;var b=[];var a=c.length;b.length=c.length;for(d=0;d<a;++d){b[d]=this[c[d]]}return b},observeChildObjectChangeForKeyPath:function(f,e,b){var d=f.object;var c=this.indexOf(d);if(!this.__uid){this.initialiseKeyValueObserving()}if(-1===c){d._removeParentLink(this,null,this.__uid);return}var a=new coherent.ChangeNotification(d,coherent.ChangeType.replacement,[f.newValue],[f.oldValue],[c]);this.notifyObserversOfChangeForKeyPath(a,e)},observeElementAtIndex:function(a){var b=this[a];if(!b||!b._addParentLink){return}if(!this.__uid){this.initialiseKeyValueObserving()}b._addParentLink(this,null,this.__uid)},stopObservingElementAtIndex:function(a){var b=this[a];if(!b||!b._removeParentLink){return}if(!this.__uid){this.initialiseKeyValueObserving()}b._removeParentLink(this,null,this.__uid)},initialiseKeyValueObserving:function(){var b;var a=this.length;this.__observers={};this.__uid=this.__uid||coherent.generateUid();for(b=0;b<a;++b){this.observeElementAtIndex(b)}},toJSON:function(){return this}});coherent.KVO.adapt(Array.prototype);coherent.ArrayOperator={avg:function(a){return this.sum(a)/a.length},count:function(a){throw new InvalidArgumentError("@count operator must end the keyPath")},distinctUnionOfArrays:function(a){return this.unionOfArrays(a).distinct()},distinctUnionOfObjects:function(a){return a.distinct()},max:function(d){var b=null;var e;var a;var c;for(e=0,a=d.length;e<a;++e){c=d[e];if(null===b||c>b){b=c}}return b},min:function(c){var e=null;var d;var a;var b;for(d=0,a=c.length;d<a;++d){b=c[d];if(null===e||b<e){e=b}}return e},sum:function(b){var d=0;var a=b.length;var c;for(c=0;c<a;++c){d+=b[c]}return d},unionOfArrays:function(b){var d=[];var a;var c;for(c=0,a=b.length;c<a;++c){d=d.concat(b[c])}return d},unionOfObjects:function(a){return a}};coherent.KVOTable=Class.create(coherent.KVO,{valueForKeyPath:function(a){if("array"===coherent.typeOf(a)){a=a.join(".")}return this.valueForKey(a)},setValueForKeyPath:function(a,b){if("array"===coherent.typeOf(b)){b=b.join(".")}return this.setValueForKey(a,b)},infoForKeyPath:function(a){if("array"===coherent.typeOf(a)){a=a.join(".")}return this.infoForKey(a)}});coherent.Scripts={extract:function(b){var c=RegExp("(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)","img");var a=[];var d=new String(b.replace(c,function(){a.push(arguments[1]);return""}));d.scripts=a;return d},install:function(a){if(!a){return}function b(f){if(!f||!f.length){return}if(window.execScript){window.execScript(f)}else{var c=document.createElement("script");var e=document.createTextNode(f);c.appendChild(e);c.type="text/javascript";c.defer=false;var d=document.getElementsByTagName("head").item(0);d.appendChild(c)}}if("string"===typeof(a)){b(a);return}a.forEach(b)}};Element.colours={black:"#000000",white:"#ffffff"};if(coherent.Browser.IE){if(coherent.Browser.IE<=8){(function(){var a=this.Element;var b=this.Element.prototype;this.Element={};Object.extend(this.Element,a||{});if(!this.Element.prototype){this.Element.prototype=b}}).call(window)}Element._isBlacklisted=function(a){a=a.trim().toLowerCase();return a==="content"||/^webkit.*$/.test(a)};Element.setStyle=function(a,e,d){if(Element._isBlacklisted(e)){return}if("opacity"!=e){a.style[e]=d;return}var c=a.style.filter;var b=a.style;if(d==1||d===""){b.filter=c.replace(/alpha\([^\)]*\)/gi,"");return}if(d<0.00001){d=0}b.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(d*100)+")"};Element.setStyles=function(a,b){var c=a.style;for(var d in b){if("opacity"==d){Element.setStyle(a,d,b[d])}else{if(!Element._isBlacklisted(d)){c[d]=b[d]}}}};Element.getStyles=function(e,c){var b=e.currentStyle;function j(k){var i=0;if("width"===k){i+=parseInt(b.borderLeftWidth,10)||0+parseInt(b.borderRightWidth,10)||0+parseInt(b.paddingLeft,10)||0+parseInt(b.paddingRight,10)||0;return Math.max(0,e.offsetWidth-i)+"px"}else{i+=parseInt(b.borderTopWidth,10)||0+parseInt(b.borderBottomWidth,10)||0+parseInt(b.paddingTop,10)||0+parseInt(b.paddingBottom,10)||0;return Math.max(0,e.offsetHeight-i)+"px"}}var h={};var f;if("string"===typeof(c)){if("opacity"===c){f=b.filter.match(/opacity=(\d+)/i);return(null===f?1:parseInt(f[1],10)/100)}if(c=="height"||c=="width"){return j(c)}else{if(a=="backgroundPosition"){return b.backgroundPositionX+" "+b.backgroundPositionY}else{return b[c]}}}c=c||Element.PROPERTIES;var a;var g=c.length;for(var d=0;d<g;++d){a=c[d];if("opacity"===a){f=b.filter.match(/opacity=(\d+)/i);h[a]=(null===f?1:parseInt(f[1],10)/100)}else{if(a==="height"||a==="width"){h[a]=j(a)}else{if(a==="backgroundPosition"){h[a]=b.backgroundPositionX+" "+b.backgroundPositionY}else{h[a]=b[a]}}}}return h};Element.getStyle=Element.getStyles;Element.noScopeElements=["<style","<script","<link","&lt;style","&lt;script","&lt;link"];Element.setInnerHTML=function(a,b){Element.innerHTML(a,b,false)};Element.appendInnerHTML=function(a,b){Element.innerHTML(a,b,true)};Element.innerHTML=function(c,d,b){d=String.stringify(d);d=d.escapeForInnerHTML();var a=this.noScopeElements.some(function(e){return(d.indexOf(e)!==-1)});if(a){if(b){c.innerHTML='<input type="hidden"/>'+c.innerHTML+d}else{c.innerHTML='<input type="hidden"/>'+d}c.removeChild(c.firstChild)}else{if(b){c.innerHTML+=d}else{c.innerHTML=d}}};Element.clone=function(c){var d=c.cloneNode(false);if("TR"!=c.tagName){d.innerHTML=c.innerHTML;return d}var b;var a;var e;for(b=0;b<c.children.length;++b){a=c.children[b];e=a.cloneNode(false);e.id="";e.innerHTML=a.innerHTML;d.appendChild(e)}return d}}if(coherent.Browser.IE){Object.extend(Event,{preventDefault:function(a){a.returnValue=false},onDomReady:function(b){var c;function a(){try{document.documentElement.doScroll("left");document.body.firstChild;document.namespaces}catch(d){c=a.delay(1);return}Event._domHasFinishedLoading()}if(Event._domHasFinishedLoading.done){window.setTimeout(b,0);return}if(!Event._readyCallbacks){c=a.delay(1);Event.observe(window,"load",Event._domHasFinishedLoading);Event._readyCallbacks=[]}Event._readyCallbacks.push(b)}});if(!window.addEventListener){Object.extend(Event,{observe:function(c,a,b){if("on"!=a.slice(0,2)){a="on"+a}c.attachEvent(a,b)},stopObserving:function(c,a,b){if("on"!=a.slice(0,2)){a="on"+a}if(typeof b==="function"){c.detachEvent(a,b)}},stop:function(a){a=a||window.event;a.returnValue=false;a.cancelBubble=true}})}}coherent.Formatter=Class.create({invalidValueMessage:_("error.invalid_value"),constructor:function(a){Object.extend(this,a)},stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}return String(a)},valueForString:function(a){return a},isStringValid:function(a){return true},isValidInputCharacter:function(a){return true}});coherent.NumberFormatter=Class.create(coherent.Formatter,{invalidValueMessage:_("error.invalid_number"),validFloatCharacters:"0123456789.-",validIntCharacters:"0123456789-",allowsFloats:true,stringForValue:function(a){if(null===a||"undefined"===typeof(a)){return""}return String(a)},valueForString:function(a){if(this.allowsFloats){return parseFloat(a)}else{return parseInt(a,10)}},isStringValid:function(a){var c=this.valueForString(a);var b=!isNaN(c);if(b&&!isNaN(this.minimum)){b=(c>=this.minimum)}if(b&&!isNaN(this.maximum)){b=(c<=this.maximum)}if(b){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(this.allowsFloats){return(-1!==this.validFloatCharacters.indexOf(a))}else{return(-1!==this.validIntCharacters.indexOf(a))}}});coherent.RegexFormatter=Class.create(coherent.Formatter,{constructor:function(a){this.base(a);this.typeofValidCharacters=typeof(this.validCharacters);if(this.invalidRegex&&"exec" in this.invalidRegex){this.invalidRegex=[this.invalidRegex]}if(this.validRegex&&"exec" in this.validRegex){this.validRegex=[this.validRegex]}},isStringValid:function(b){var c;var a;var e;var d=true;if(this.invalidRegex&&this.invalidRegex.length){e=this.invalidRegex;for(c=0,a=e.length;c<a;++c){if(e[c].test(b)){d=false;break}}}if(d&&this.validRegex&&this.validRegex.length){d=false;e=this.validRegex;for(c=0,a=e.length;c<a;++c){if(e[c].test(b)){d=true;break}}}if(d){return true}return new coherent.Error({description:this.invalidValueMessage})},isValidInputCharacter:function(a){if(!this.validCharacters){return true}if("string"===this.typeofValidCharacters){return(-1!==this.validCharacters.indexOf(a))}else{return this.validCharacters.test(a)}}});coherent.easing=(function(){var b=Math.PI/2;var a=Math.PI;return{linear:function(c){return c},cubicBezier:function(f,d,q,o,k){var l=3*f,n=3*(q-f)-l,c=1-l-n,j=3*d,m=3*(o-d)-j,r=1-j-m,p;function i(s){return((c*s+n)*s+l)*s}function h(s){return((r*s+m)*s+j)*s}function e(s){return(3*c*s+2*n)*s+l}function g(s,A){var z=0,y=1,v=s,t,w,u=8;while(u--){t=i(v)-s;if(Math.abs(t)<A){return v}w=e(v);if(Math.abs(w)<0.000001){break}v=v-t/w}v=s;if(v<z){return z}if(v>y){return y}while(z<y){t=i(v);if(Math.abs(t-s)<A){return v}if(s>t){z=v}else{y=v}v=(y-z)*0.5+z}return v}k=k/1000||5;p=function(s){return h(g(s,1/(200*k)))};p.timingFunction="cubic-bezier";p.p1x=f;p.p1y=d;p.p2x=q;p.p2y=o;return p},ease:function(d){var c=coherent.easing.cubicBezier(0.25,0.1,0.25,1,d);c.timingFunction="ease";return c},easeIn:function(d){var c=coherent.easing.cubicBezier(0.42,0,1,1,d);c.timingFunction="ease-in";return c},easeOut:function(d){var c=coherent.easing.cubicBezier(0,0,0.58,1,d);c.timingFunction="ease-out";return c},easeInOut:function(d){var c=coherent.easing.cubicBezier(0.42,0,0.58,1,d);c.timingFunction="ease-in-out";return c},linearCompleteAndReverse:function(c){return(c>0.5)?2-2*c:2*c},inSine:function(c){return 1-Math.cos(c*b)},outSine:function(c){return Math.sin(c*b)},inOutSine:function(c){return(1-Math.cos(c*a))/2},inBack:function(c,d){if(d==undefined){d=1.70158}return c*c*((d+1)*c-d)},outBack:function(c,d){if(d==undefined){d=1.70158}c=c-1;return(c*c*((d+1)*c+d)+1)},outBackStrong:function(c,d){if(d==undefined){d=1.70158*1.5}c=c-1;return(c*c*((d+1)*c+d)+1)},inOutQuad:function(c){if((c/=1/2)<1){return 1/2*c*c}return -1/2*((--c)*(c-2)-1)}}})();coherent.Animator=function(){var a={duration:500,actions:{}};var j=null;var x={};var b=0;var f=Element.getStyles;function d(B,A,E){var D={};E=E||{};function C(F){if(!F||F.tagName.toUpperCase()=="PARAM"){return false}var G=Element.assignId(F);D[G]=f(F,A);if(E[G]){return false}}Element.depthFirstTraversal(B,C);return D}function q(){return[this.r,this.g,this.b,this.a].join(",")}function n(A){if(typeof(A)!="string"){return A}var B;if((B=Element.colours[A.toLowerCase()])){A=B}if((B=A.match(/^rgb(?:a)?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d(?:\.\d+)?)\s*)?\)$/i))){return{r:parseInt(B[1],10),g:parseInt(B[2],10),b:parseInt(B[3],10),a:parseInt(B[4]||1,10),toString:q}}if("#"!==A.charAt(0)){if(A=="transparent"){return{r:255,g:255,b:255,a:0}}throw new Error("Invalid colour: "+A)}if(4==A.length){return{r:parseInt(A.charAt(1)+A.charAt(1),16),g:parseInt(A.charAt(2)+A.charAt(2),16),b:parseInt(A.charAt(3)+A.charAt(3),16),a:1,toString:q}}else{return{r:parseInt(A.substr(1,2),16),g:parseInt(A.substr(3,2),16),b:parseInt(A.substr(5,2),16),a:1,toString:q}}}function m(A){if("margin" in A){A.marginLeft=A.marginRight=A.marginTop=A.marginBottom=A.margin;delete A.margin}if("padding" in A){A.paddingLeft=A.paddingRight=A.paddingTop=A.paddingBottom=A.padding;delete A.padding}if("borderColor" in A){A.borderLeftColor=A.borderRightColor=A.borderTopColor=A.borderBottomColor=A.borderColor;delete A.borderColor}if("borderWidth" in A){A.borderLeftWidth=A.borderRightWidth=A.borderTopWidth=A.borderBottomWidth=A.borderWidth;delete A.borderWidth}return A}function p(D,B,E,A,C){this.property=D;this.element=B;this.start=n(E);this.end=n(A);if(coherent.Support.CSS3ColorModel){if(this.start.a===0){this.start.r=this.end.r;this.start.g=this.end.g;this.start.b=this.end.b}else{if(this.end.a===0){this.end.r=this.start.r;this.end.g=this.start.g;this.end.b=this.start.b}}this.step=this.stepRGBA}else{this.step=this.stepRGB}this.delta={r:this.end.r-this.start.r,g:this.end.g-this.start.g,b:this.end.b-this.start.b,a:this.end.a-this.start.a};this.shouldCleanup=!!C}p.prototype.stepRGB=function(B){if(this.curve){B=this.curve(B)}var A=["rgb(",Math.round(B*this.delta.r+this.start.r),",",Math.round(B*this.delta.g+this.start.g),",",Math.round(B*this.delta.b+this.start.b),")"].join("");this.element.style[this.property]=A};p.prototype.stepRGBA=function(B){if(this.curve){B=this.curve(B)}var A=["rgba(",Math.round(B*this.delta.r+this.start.r),",",Math.round(B*this.delta.g+this.start.g),",",Math.round(B*this.delta.b+this.start.b),",",B*this.delta.a+this.start.a,")"].join("");this.element.style[this.property]=A};p.prototype.cleanup=function(){this.element.style[this.property]=""};function i(D,B,E,A,C){this.property=D;this.element=B;this.start=parseInt(E||0,10);this.end=parseInt(A||0,10);this.delta=this.end-this.start;this.shouldCleanup=!!C}i.prototype.step=function(A){if(this.curve){A=this.curve(A)}this.element.style[this.property]=Math.round(A*this.delta+this.start)+"px"};i.prototype.cleanup=function(){this.element.style[this.property]=""};function u(B,D,A,C){this.element=B;this.start=parseFloat(D||0);this.end=parseFloat(A||0);this.delta=A-D;this.shouldCleanup=!!C}var g=(typeof document.createElement("div").style.opacity!="undefined");if(g){u.prototype.step=function(B){if(this.curve){B=this.curve(B)}var A=B*this.delta+this.start;this.element.style.opacity=(A>=1)?1:A.toFixed(3)};u.prototype.cleanup=function(){this.element.style.opacity=""}}else{if(coherent.Browser.IE){u.prototype.step=function(B){if(this.curve){B=this.curve(B)}var A=B*this.delta+this.start;this.element.style.filter=(A>=1)?"":"Alpha(Opacity="+Math.round(A*100)+")"};u.prototype.cleanup=function(){this.element.style.cssText=this.element.style.cssText.replace(/filter:.*?(?:;|$)/i,"")}}}function v(D,B,E,A,C){this.property=D;this.element=B;this.start=E;this.end=A;this.shouldCleanup=!!C}v.prototype.step=function(A){if(A>=this.discreteTransitionPoint){this.element.style[this.property]=this.end;this.step=function(B){}}};v.prototype.cleanup=function(){this.element.style[this.property]=""};function k(B,C,A){this.element=B;this.start=C;this.end=A}k.prototype.step=function(A){if(A>=this.discreteTransitionPoint){this.element.className=this.end;this.step=function(B){}}};function s(E,H,B,G){function F(I){switch(I){case"top":return"0% 50%";case"right":return"100% 50%";case"bottom":return"50% 100%";case"left":return"0% 50%";case"center":return"50% 50%";default:I=I.replace(/top|left/g,"0%");I=I.replace(/bottom|right/g,"100%");return I}}function C(I){return parseInt(I,10)}H=F(H);B=F(B);var D=H.match(/%|px/)[0];var A=B.match(/%|px/)[0];if(D!=A){return new v("backgroundPosition",E,H,B,G)}this.element=E;this.unit=D;this.start=Array.map(H.split(" "),C);this.end=Array.map(B.split(" "),C);this.delta=[this.end[0]-this.start[0],this.end[1]-this.start[1]];this.shouldCleanup=!!G;return this}s.prototype.step=function(A){if(this.curve){A=this.curve(A)}this.element.style.backgroundPosition=Math.round(A*this.delta[0]+this.start[0])+this.unit+" "+Math.round(A*this.delta[1]+this.start[1])+this.unit};s.prototype.cleanup=function(){if(coherent.Browser.IE){this.element.style.backgroundPositionX="";this.element.style.backgroundPositionY=""}else{this.element.style.backgroundPosition=""}};function c(B,D,A,C){this.element=B;this.startX=parseInt(D[0]||0,10);this.endX=parseInt(A[0]||0,10);this.startY=parseInt(D[1]||0,10);this.endY=parseInt(A[1]||0,10);this.deltaX=this.endX-this.startX;this.deltaY=this.endY-this.startY;this.shouldCleanup=!!C}c.prototype.step=function(A){if(this.curve){A=this.curve(A)}this.element.scrollTo(Math.round(A*this.deltaX+this.startX),Math.round(A*this.deltaY+this.startY))};c.prototype.cleanup=function(){this.element.scrollTo(this.startX,this.startY)};function w(D,B,E,A,C){switch(D){case"_className":return new k(B,E,A);case"display":return new v(D,B,E,A,C);case"backgroundPosition":return new s(B,E,A,C);case"backgroundColor":case"color":case"borderColor":case"borderTopColor":case"borderRightColor":case"borderBottomColor":case"borderLeftColor":return new p(D,B,E,A,C);case"opacity":return new u(B,E,A,C);case"scroll":return new c(B,E,A,C);default:return new i(D,B,E,A,C)}}function y(C,F){var E=[];var D=x[C];if(!D||!D.properties[F]){return}var A=D.properties[F].shift();if(A.shouldCleanup&&"function"===typeof(A.cleanup)){A.cleanup()}if("function"==typeof(A.callback)){E.push(A.callback)}if(!D.properties[F].length){delete D.properties[F];D.propCount--}if(!D.propCount){if("function"==typeof(x[C]._callback)){E.push(D._callback)}delete (x[C]);b--}if(!b){o()}var B=E.length;for(var G=0;G<B;G++){E[G](document.getElementById(C),F)}}function h(){if(j){return}j=window.setInterval(e,10)}function o(){if(!j){return}window.clearInterval(j);j=null}function e(){var B,D,E,A,C=(new Date()).getTime();coherent.EventLoop._start=C;for(B in x){D=x[B].properties;for(E in D){A=D[E][0];if(C>=A.endTime){A.step(1);y(B,E)}else{if(A.startTime<=C){A.step((C-A.startTime)/A.totalTime)}}}}}function l(D,C,F){F=Object.applyDefaults(F,a);if(F.delay){arguments.callee.delay(F.delay,D,C,F);delete F.delay;return}var L=Element.assignId(D);var E=x[L];if(!E){b++;E=x[L]={_node:D,propCount:0,properties:{},timers:{}}}if("function"==typeof(F.callback)){E._callback=F.callback}var B=F.startTime||coherent.EventLoop.getStart();var A=B+F.duration;var S=F.startStyles||f(D,Set.toArray(C));m(C);for(var N in C){var J=C[N],T=J.delay||0,I=B+T,G=J.duration?J.duration+I:A,O=J,M=J.curve||F.curve,R=J.discreteTransitionPoint||F.discreteTransitionPoint||0.5,K=typeof(J.cleanup)!=="undefined"?J.cleanup:F.cleanup,H;if("object"===typeof(O)&&"value" in O){O=O.value}if(N in E.properties){H=E.properties[N]}else{E.propCount++;H=[]}function Q(X,Y,U){var W=Y.startTime<G&&Y.endTime>G;var V=Y.startTime<I&&Y.endTime>I;var Z=Y.startTime<=I&&Y.endTime>=G;if(!(V||W||Z)){X.push(Y)}return X}if(H.length){H=H.reduce(Q,[])}var P=w(N,D,S[N],O,K);P.curve=M;P.discreteTransitionPoint=R;P.startTime=I;P.endTime=G;P.totalTime=G-I;if("object"===typeof(J)&&"callback" in J){P.callback=J.callback}if(F.stepBackToZero){P.step(0)}H.push(P);E.properties[N]=H}h()}function r(A){var B=Element.assignId(A);return !!document.getElementById(B)}function z(J,N,O){var L=x[J.id];if(J.className===N&&(!L||!L._className||L._className.value===N)){if(O.callback){O.callback()}return}O=Object.applyDefaults(O,a);if(O.delay){arguments.callee.delay(O.delay,J,N,O);delete O.delay;return}if(!r(J)){J.className=N;if(O.callback){O.callback()}return}var I=O.only;var E=d(J,I,O.ignore);var C=J.className;J.className=N;for(var B in E){var H=x[B];if(!H){continue}for(var A in H.properties){H._node.style[A]=""}}var G=d(J,I,O.ignore);J.className=C;var M={};M[J.id]={_className:{value:N,duration:O.duration,callback:O.callback}};delete O.callback;function K(S){var R=S.id;var U=O.actions[R];var X=E[R]||{};var Y=G[R]||{};var aa={};if(!U){var Z=X.display;var W=Y.display;if(Z=="none"&&W=="none"){U=coherent.Animator.IGNORE_NODE}if(Z=="none"&&W!=="none"){U=coherent.Animator.FADE_IN_NODE}if(Z!=="none"&&W=="none"){U=coherent.Animator.FADE_OUT_NODE}}if("function"===typeof(U)){U=U(S,E,G)}if("object"==typeof(U)){aa=U;U=coherent.Animator.MORPH_NODE}switch(U){case coherent.Animator.IGNORE_NODE:return false;case coherent.Animator.FADE_NODE:M[R]=M[R]||{};M[R].opacity={value:"0",duration:O.duration,curve:coherent.easing.linearCompleteAndReverse};return false;case coherent.Animator.FADE_OUT_NODE:document.getElementById(R).style.display="block";M[R]=M[R]||{};M[R].opacity={value:"0",duration:O.duration/2,cleanup:false,callback:function(){document.getElementById(R).style.display=""}};return false;case coherent.Animator.FADE_IN_NODE:X.opacity=0;document.getElementById(R).style.display="block";M[R]=M[R]||{};M[R].opacity={value:"1",duration:O.duration/2,delay:O.duration/2,callback:function(){document.getElementById(R).style.display=""}};return false;case coherent.Animator.MORPH_NODE:default:for(var Q in X){var T=x[R];var V=aa[Q];var P=V?(V.value||V):Y[Q];if((T&&Q in T.properties)||(String(X[Q])!=String(P))){M[R]=M[R]||{};if(Q in aa){if(V.value){M[R][Q]=V}else{M[R][Q]={value:V}}M[R][Q].cleanup=false}else{M[R][Q]=P}}}return true}}Element.depthFirstTraversal(J,K);O.stepBackToZero=true;O.cleanup=true;O.startTime=(new Date()).getTime();for(var D in M){var F=document.getElementById(D);if(!F){continue}O.startStyles=E[D];l(F,M[D],O)}}function t(C,A){var B=Element.regexForClassName(A);return C.replace(B," ")}return{actors:function(){return x},addClassName:function(B,C,A){if(!C){return}var D=Element.regexForClassName(C);var E=B.className;if(!D.test(E)){if(E){E+=" "+C}else{E=C}}z(B,E,A)},removeClassName:function(B,C,A){var E=B.className;var D;if(E===C){z(B,"",A);return}if("string"===typeof(C)){E=t(E,C)}else{E=C.reduce(t,E)}z(B,E,A)},setClassName:function(B,C,A){var D=B.className;z(B,C,A)},replaceClassName:function(D,C,A,B){if(C){var E=Element.regexForClassName(C);A=D.className.replace(E,"$1"+A+"$2")}else{A=D.className+" "+A}z(D,A,B)},setStyles:l,abort:function(){x={};o()},abortAnimation:function(A){delete x[A.id]}}}();coherent.Animator.FADE_NODE="fade";coherent.Animator.FADE_IN_NODE="fade_in";coherent.Animator.FADE_OUT_NODE="fade_out";coherent.Animator.IGNORE_NODE="ignore";coherent.Animator.MORPH_NODE="morph";coherent.Animator.innerHTML=function(b,a,d){d=d||500;function e(){var h=b.innerHTML;var i=Element.getStyles(b,"height");Element.setInnerHTML(b,a);var g=Element.getStyles(b,"height");Element.setInnerHTML(b,h);b.style.height=i;b.style.overflow="hidden";coherent.Animator.setStyles(b,{opacity:{value:0,callback:c}},{duration:d/2});coherent.Animator.setStyles(b,{height:{value:g,curve:coherent.easing.inOutSine}},{duration:d,cleanup:true})}function c(){Element.setInnerHTML(b,a);coherent.Animator.setStyles(b,{opacity:1},{duration:d/2,callback:f,cleanup:true})}function f(){b.style.overflow=""}if(b.style.display!="none"){e()}else{b.innerHTML=a}};coherent.Animator.innerText=function(b,e,d){d=d||500;function a(g){var f=document.createTextNode(g);b.innerHTML="";b.appendChild(f)}function c(){a(e);coherent.Animator.setStyles(b,{opacity:1},{duration:d/2,cleanup:true})}if(b.style.display!="none"){coherent.Animator.setStyles(b,{opacity:0},{duration:d/2,callback:c})}else{a(e)}};coherent.Animator.scrollTo=function(b,d){var a=Element.getViewport(),f=(window.height||document.body.scrollHeight)-a.height,c=b,e,g;if(typeof b=="string"){e=document.getElementById(b.replace("#",""))}else{if("nodeName" in b){e=b}}if(e){g=Element.getRect(e);c=[a.left,Math.min(f,g.top)]}d=Object.applyDefaults(d,{duration:375,curve:coherent.easing.cubicBezier(0.175,0.9,0.2,1,375),startStyles:{scroll:[a.left,a.top]},callback:function(){if(e&&e.id){window.location.hash="#"+e.id}}});coherent.Animator.setStyles(window,{scroll:c},d)};var CancelledError=coherent.defineError("CancelledError");var InvalidStateError=coherent.defineError("InvalidStateError");(function(){var c=-1;var a=0;var b=1;coherent.Deferred=Class.create({constructor:function(d){this.canceller=d;this._result=null;this._status=c;this._callbacks=[]},_fire:function(d){while(this._callbacks.length){this._status=(d instanceof Error)?b:a;this._result=d;var e=this._callbacks.shift()[this._status];if(!e){continue}d=e(d);if(d instanceof coherent.Deferred){var f=this;function g(h){f._fire(h);return h}d.addMethods(g,g);return}}this._status=(d instanceof Error)?b:a;this._result=d},result:function(){return this._result},cancel:function(){if(c!==this._status){throw new InvalidStateError("Can not cancel Deferred because it is already complete")}var d=(this.canceller&&this.canceller());if(!(d instanceof Error)){d=new CancelledError("Deferred operation cancelled")}this.failure(d)},addMethods:function(d,e){this._callbacks.push([d,e]);if(c===this._status){return this}this._fire(this._result);return this},addCallback:function(d){return this.addMethods(d,null)},addErrorHandler:function(d){return this.addMethods(null,d)},callback:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal callback because Deferred is already complete: result="+d)}this._fire(d)},failure:function(d){if(c!==this._status){throw new InvalidStateError("Can not signal failure because Deferred is already complete: error="+d)}this._fire(d)}})})();coherent.URL=Class.create({constructor:function(b){this.url=b.trim();var c=(/^(([^\:\/\?#]+)\:)?(\/\/([^\/\?#]*))?([^\?#]*)(\?([^#]*))?(#(.*))?$/),a=this.url.match(c)||[];this.protocol=a[2]||"";this.authority=a[4]||"";this.path=a[5].trim()||"";this.query=a[7]||"";this.fragment=a[9]||"";c=(/^(([^@]+)@)?([^\:]+)(:(.+))?$/);a=this.authority.match(c)||[];this.userInfo=a[2]||"";this.host=a[3]||"";this.port=a[5]||""},toHash:function(a){var b=this.query.split("&").map(function(d){return escape(d)}),c=typeof a!=="undefined"?a:",";b.sort();return[this.protocol,this.authority,this.path,b,this.fragment].join(c)}});coherent.FormControl=Class.create(coherent.View,{exposedBindings:["value","name"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.value&&!b.value.hasValue()&&a.value){b.value.setValue(a.value)}if(b.name&&!b.name.hasValue()&&a.name){b.name.setValue(a.name)}},observeValueChange:function(c){var a=this.viewElement();var b=c.newValue;if("undefined"===typeof(b)){a.disabled=true}else{if(!this.bindings.enabled){a.disabled=false}}if(!this.bindings.editable){a.readOnly=!this.bindings.value.mutable()||coherent.Markers.MultipleValues===b||coherent.Markers.NoSelection===b}if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}a.value=b},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue},validate:function(){return this.viewElement().value}});coherent.Button=Class.create(coherent.FormControl,{__viewClassName__:"Button",__tagSpec__:["input[type=button]","input[type=submit]","input[type=reset]","button"],requireBindingsForInferredViewType:false,onmousedown:function(b){var a=this.viewElement();Element.addClassName(a,coherent.Style.kActiveClass)},onmouseup:function(b){var a=this.viewElement();Element.removeClassName(a,coherent.Style.kActiveClass)},onclick:function(a){if(this.disabled){Event.stop(a);return}this.sendAction()}});coherent.EventLoop={currentEvent:null,getStart:function(){if(!this._start){this._start=new Date().getTime()}return this._start},begin:function(a){this._start=new Date().getTime();this.currentEvent=a},end:function(){this.currentEvent=null;this._start=null}};coherent.Form=Class.create(coherent.FieldGroup,{exposedBindings:["actionUrl","method"],sendActionOn:["submit"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.actionUrl&&!b.actionUrl.hasValue()&&a.action){b.actionUrl.setValue(a.action)}if(b.method&&!b.method.hasValue()&&a.method){b.method.setValue(a.method)}Event.observe(a,"submit",this.onsubmit.bind(this))},onsubmit:function(a){if(!this.action||!this.sendActionOn.containsObject("submit")){return}Event.stop(a);this.sendAction()},observeActionUrlChange:function(d,c,b){var a=this.viewElement();a.action=d.newValue},observeMethodChange:function(d,c,b){var a=this.viewElement();a.method=d.newValue}});coherent.ImageView=Class.create(coherent.View,{__viewClassName__:"Image",__tagSpec__:["img","input[type=image]"],exposedBindings:["src","alt","width","height","maskBoxImage"],multipleValuesPlaceholder:_("marker.image.multipleValues"),nullPlaceholder:_("marker.image.placeholder"),noSelectionPlaceholder:_("marker.image.noSelection"),init:function(){this.base();var a=this.viewElement();Event.observe(a,"error",this.onerror.bind(this));Event.observe(a,"load",this.onload.bind(this));var b=this.bindings;if(b.src&&!b.src.hasValue()&&a.src){b.src.setValue(a.src)}if(b.alt&&!b.alt.hasValue()&&a.alt){b.alt.setValue(a.alt)}if(b.width&&!b.width.hasValue()&&a.width){b.width.setValue(a.width)}if(b.height&&!b.height.hasValue()&&a.height){b.height.setValue(a.height)}},onload:function(){var a=this.viewElement();this.setValueForKey(false,"loading");Element.removeClassName(a,coherent.Style.kLoadingClass)},onerror:function(){var a=this.viewElement();this.setValueForKey(false,"loading");Element.updateClass(a,coherent.Style.kInvalidValueClass,coherent.Style.kLoadingClass)},falseyToEmptyString:function(a){return a?a:""},src:function(){var a=this.viewElement().src;return("about:blank"===a)?null:a},setSrc:function(c){if(this.bindings.src){this.bindings.src.setValue(c)}this.setValueForKey(true,"loading");var b=this.viewElement();Element.updateClass(b,coherent.Style.kLoadingClass,coherent.Style.kInvalidValueClass);if(!c){c="about:blank"}var a=b.src;b.src=c;if(coherent.Browser.Safari&&b.src===a){this.onload()}},observeSrcChange:function(e){var c=this;var a=this.viewElement();var d=e.newValue;var b=true;switch(d){case"":case null:case undefined:d=this.attributeOrProperty("nullPlaceholder");break;case coherent.Markers.NoSelection:d=this.attributeOrProperty("noSelectionPlaceholder");break;case coherent.Markers.MultipleValues:d=this.attributeOrProperty("multipleValuesPlaceholder");break;default:b=false;break}if(b){Element.addClassName(a,coherent.Style.kMarkerClass)}else{Element.removeClassName(a,coherent.Style.kMarkerClass)}this.setSrc(d)},observeWidthChange:function(c){var a=this.viewElement();var b=parseInt(c.newValue,10);if(isNaN(b)){a.removeAttribute("width")}else{a.width=b}},observeAltChange:function(c){var a=this.viewElement();var b=c.newValue;if(b===null||"undefined"===typeof(b)){a.alt=""}else{a.alt=b}},observeHeightChange:function(c){var b=this.viewElement();var a=parseInt(c.newValue,10);if(isNaN(a)){b.removeAttribute("height")}else{b.height=a}},observeMaskBoxImageChange:function(d){var a=this.viewElement();var b=coherent.typeOf(d.newValue);if(b==="null"){Element.setStyle(a,"-webkit-mask-box-image","none")}else{if(b==="string"){Element.setStyle(a,"-webkit-mask-box-image",d.newValue)}else{var c=d.newValue.uri+" "+this.falseyToEmptyString(d.newValue.top)+" "+this.falseyToEmptyString(d.newValue.right)+" "+this.falseyToEmptyString(d.newValue.bottom)+" "+this.falseyToEmptyString(d.newValue.left)+" "+this.falseyToEmptyString(d.newValue.repeatX)+" "+this.falseyToEmptyString(d.newValue.repeatY);Element.setStyle(a,"-webkit-mask-box-image",c)}}}});coherent.ImageSetView=Class.create(coherent.ImageView,{__viewClassName__:"ImageSet",__tagSpec__:[],exposedBindings:["pxRatio","srcSet"],pxRatio:null,rawSourceSet:null,parseSrcSet:function(){if(!this.rawSourceSet){return}var a=Element.parseSourceSetData(this.rawSourceSet,this.pxRatio);var b=Element.pickSrcFromSrcSet(a,this.pxRatio);Element.setStyle(this.viewElement(),"content",a);this.setSrc(b)},observeSrcSetChange:function(a){if(!a.newValue){return}this.rawSourceSet=a.newValue;this.parseSrcSet()},observePxRatioChange:function(a){if(!a.newValue){return}this.pxRatio=a.newValue;this.parseSrcSet()}});coherent.Media=Class.create(coherent.View,{exposedBindings:["src","currentTime","volume","muted"],init:function(){var a=this.viewElement();var b=this.bindings;if(b.src&&!b.src.hasValue()&&a.src){b.src.setValue(a.src)}if(b.currentTime&&!b.currentTime.hasValue()){b.currentTime.setValue(a.currentTime)}if(b.duration&&!b.duration.hasValue()){b.duration.setValue(a.duration)}if(b.volume&&!b.volume.hasValue()){b.volume.setValue(a.volume)}if(b.muted&&!b.muted.hasValue()){b.muted.setValue(a.muted)}Event.observe(a,"ended",this.mediaDidEnd.bindAsEventListener(this))},pause:function(){var a=this.viewElement();if(!a.paused){a.pause()}},play:function(){var a=this.viewElement();a.play();this.forceChangeNotificationForKey("ended")},stop:function(){var a=this.viewElement();a.currentTime=a.duration},muted:function(){var a=this.viewElement();return a.muted},mediaDidEnd:function(a){this.forceChangeNotificationForKey("ended")},ended:function(){var a=this.viewElement();return a.ended},src:function(){var a=this.viewElement();return a.src},setSrc:function(c){if(this.bindings.src){this.bindings.src.setValue(c)}var b=this.viewElement();var d=this;function a(){b.src=c;b.load();d.forceChangeNotificationForKey("ended")}a.delay(0)}});coherent.Page=Class.create(coherent.Responder,{constructor:function(){this.firstResponder=null;this.__hoverTrackingIds={};this._onmousedragHandler=this._onmousedrag.bindAsEventListener(this);this._delegates={click:[]};this.onclick=this._fireDelegates},targetViewForEvent:function(c){var b=c.target||c.srcElement;var a;var d=coherent.View.fromNode;while(b&&b!=document&&!(a=d(b))){b=b.parentNode}if(!b||b==document){return null}return a},makeFirstResponder:function(a){if(this.firstResponder==a){return true}if(this.firstResponder&&!this.firstResponder.resignFirstResponder()){return false}if(this.firstResponder){Element.removeClassName(this.firstResponder.viewElement(),coherent.Style.kFocusClass)}if(a&&!a.becomeFirstResponder()){return false}this.willChangeValueForKey("firstResponder");this.firstResponder=a;this.didChangeValueForKey("firstResponder");if(a){a.focus();Element.addClassName(a.viewElement(),coherent.Style.kFocusClass)}return true},addTrackingInfo:function(c,b){if("string"!==typeof(c)){c=Element.assignId(c)}var a=this.__hoverTrackingIds[c];if(!a){a=this.__hoverTrackingIds[c]=[]}a.push(b)},superview:function(){return null},presentError:function(a){function b(){var c=a.description;if(a.recoverySuggestion){c+="\n"+a.recoverySuggestion}window.alert(c);coherent.page.makeFirstResponder(a.field)}b.delay(0)},delegate:function(a,c,b){if("string"===typeof(c)){this._delegates[c].push({sel:a,fn:b})}else{var d;for(d in c){if(!(d in this._delegates)){throw new Error("Invalid delegation event type: "+d)}this._delegates[d].push({sel:a,fn:c[d]})}}},superview:function(){return null},_fireDelegates:function(e){var c=e.target||e.srcElement;var b=Element.match;var a=this._delegates[e.type]||[];function d(f){if(b(c,f.sel)){f.fn(e)}}a.forEach(d)},_findFirstResponder:function(a){while(a&&!a.acceptsFirstResponder()){a=a.superview()}if(!a){this.makeFirstResponder(null);return}this.makeFirstResponder(a)},_onmousedown:function(b){var a=this.targetViewForEvent(b);if(a){this._findFirstResponder(a);a.onmousedown(b);Event.observe(document,"mousemove",this._onmousedragHandler)}this._mousedownView=a},_onmouseup:function(a){if(this._mousedownView){this._mousedownView.onmouseup(a)}Event.stopObserving(document,"mousemove",this._onmousedragHandler)},_onmousedrag:function(a){if(this._mousedownView){this._mousedownView.onmousedrag(a)}},_onmouseover:function(a){var g=this.__hoverTrackingIds||{};var o=this.__mouseOverIds||{};var d={};var k=a.target||a.srcElement;var h=document.body;var l;var n;var b;var f;var j;var m;for(;k&&k!=h;k=k.parentNode){b=k.id;if(!b||!(b in g)){continue}d[b]=true;if(b in o){continue}l=g[b];j=l.length;for(f=0;f<j;++f){m=l[f];if(m.onmouseenter){m.onmouseenter.call(m.owner,k,m.ownerInfo)}}}for(b in o){if(b in d){continue}k=document.getElementById(b);if(!k){continue}l=g[b];j=l.length;for(f=0;f<j;++f){m=l[f];if(m.onmouseleave){m.onmouseleave.call(m.owner,k,m.ownerInfo)}}}this.__mouseOverIds=d},_onmouseout:function(a){},_onclick:function(b){if(coherent.Browser.Mozilla&&b.button===2){return}var a=this.targetViewForEvent(b);if(a){a.onclick(b)}else{this._fireDelegates(b)}},_ondblclick:function(a){if(this._mousedownView){this._mousedownView.ondblclick(a)}},_onkeydown:function(a){var b=this.firstResponder;if(b){b.onkeydown(a)}},_onkeyup:function(a){var b=this.firstResponder;if(b){b.onkeyup(a)}},_onkeypress:function(a){var b=this.firstResponder;if(b){b.onkeypress(a)}},_onfocus:function(b){var c=b.target||b.srcElement;if(c==window){return}if(c==document){this.makeFirstResponder(this._previousFirstResponder||null);this._previousFirstResponder=null}else{var a=this.targetViewForEvent(b);if(a&&a.acceptsFirstResponder()){this.makeFirstResponder(a)}else{this.makeFirstResponder(null)}}},_onblur:function(b){var c=b.target||b.srcElement;if(c==window){return}if(c==document){this._previousFirstResponder=this.firstResponder;this.makeFirstResponder(null)}else{var a=this.targetViewForEvent(b);if(a&&this.firstResponder==a){this.makeFirstResponder(null)}}},_ontouchstart:function(b){var a=this.targetViewForEvent(b);if(a){a.ontouchstart(b);a.onmousedown(b)}this._touchstartView=a},_ontouchmove:function(a){if(this._touchstartView){this._touchstartView.ontouchmove(a)}},_ontouchend:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);this._touchstartView.onmouseup(a)}},_ontouchcancel:function(a){if(this._touchstartView){this._touchstartView.ontouchend(a);this._touchstartView.onmouseup(a)}},_onunload:function(){var b;var a=coherent.View.viewLookup;for(b in a){a[b].teardown();delete a[b]}}});(function(){coherent.page=new coherent.Page();window._setTimeout=window.setTimeout;window.setTimeout=function(f,e){if(!f){return null}if("string"===typeof(f)){f="coherent.EventLoop.begin();do {"+f+"} while (false); coherent.EventLoop.end();";return window._setTimeout(f,e)}var d=Array.from(arguments,2);function c(){coherent.EventLoop.begin();var g=f.apply(this,d);coherent.EventLoop.end();return g}return window._setTimeout(c,e)};window._setInterval=window.setInterval;window.setInterval=function(f,e){if(!f){return null}if("string"===typeof(f)){f="coherent.EventLoop.begin();do {"+f+"} while (false); coherent.EventLoop.end();";return window._setInterval(f,e)}var d=Array.from(arguments,2);function c(){coherent.EventLoop.begin();var g=f.apply(this,d);coherent.EventLoop.end();return g}return window._setInterval(c,e)};var b=coherent.page;var a;a=function(c){return function(d){d=d||window.event;Event.shiftKey=d.shiftKey;coherent.EventLoop.begin(d);b[c](d);coherent.EventLoop.end()}};if(window.addEventListener){document.addEventListener("mouseover",a("_onmouseover"),false);document.addEventListener("mouseout",a("_onmouseout"),false);document.addEventListener("mousedown",a("_onmousedown"),false);document.addEventListener("mouseup",a("_onmouseup"),false);document.addEventListener("click",a("_onclick"),false);document.addEventListener("dblclick",a("_ondblclick"),false);document.addEventListener("keydown",a("_onkeydown"),false);document.addEventListener("keyup",a("_onkeyup"),false);document.addEventListener("keypress",a("_onkeypress"),false);document.addEventListener("focus",a("_onfocus"),true);document.addEventListener("blur",a("_onblur"),true);window.addEventListener("focus",a("_onfocus"),false);window.addEventListener("blur",a("_onblur"),false);if(coherent.Support.Touches){document.addEventListener("touchstart",a("_ontouchstart"),true);document.addEventListener("touchmove",a("_ontouchmove"),true);document.addEventListener("touchend",a("_ontouchend"),true);document.addEventListener("touchcancel",a("_ontouchcancel"),true)}}else{if(window.attachEvent){document.attachEvent("onmouseover",a("_onmouseover"));document.attachEvent("onmouseout",a("_onmouseout"));document.attachEvent("onmousedown",a("_onmousedown"));document.attachEvent("onmouseup",a("_onmouseup"));document.attachEvent("onclick",a("_onclick"));document.attachEvent("ondblclick",a("_ondblclick"));document.attachEvent("onkeydown",a("_onkeydown"));document.attachEvent("onkeyup",a("_onkeyup"));document.attachEvent("onkeypress",a("_onkeypress"));document.attachEvent("onfocusin",a("_onfocus"));document.attachEvent("onfocusout",a("_onblur"));window.attachEvent("focus",a("_onfocus"));window.attachEvent("blur",a("_onblur"));window.attachEvent("onunload",a("_onunload"))}}})();coherent.TextField=Class.create(coherent.FormControl,{__viewClassName__:"TextField",__tagSpec__:["input[type=text]","input[type=email]","input[type=tel]","input[type=password]","input[type=hidden]","textarea"],init:function(){this.base();var a=this.viewElement();Event.observe(a,"change",this.valueChanged.bindAsEventListener(this));Event.observe(a,"drop",this.fieldReceivedDropEvent.bindAsEventListener(this));this.editing=false;this.validationError=null;var b=this.bindings;if(b.maxLength&&!b.maxLength.hasValue()&&a.maxLength){b.maxLength.setValue(a.maxLength)}},exposedBindings:["errorMessage","maxLength"],multipleValuesPlaceholder:_("marker.input.multipleValues"),nullPlaceholder:_("marker.input.placeholder"),noSelectionPlaceholder:_("marker.input.noSelection"),keypressUpdateTimeout:500,continuallyUpdatesValue:true,sendsActionOnEndEditing:true,sendActionOn:["blur","keydown"],beginEditing:function(){this.editing=true},endEditing:function(){Element.removeClassName(this.viewElement(),coherent.Style.kEditingClass);this.editing=false;if(this.sendsActionOnEndEditing&&this.action){this.sendAction()}},validate:function(){var a=this.viewElement(),c=a.value,b;if(this.formatter){b=this.formatter.isStringValid(c);if(b!==true){this.presentError(b);return b}c=this.formatter.valueForString(c)}if(!(this.bindings.errorMessage&&this.bindings.errorMessage.value())){this.clearAllErrors()}if(this.bindings.value){c=this.bindings.value.validateProposedValue(c);if(c instanceof coherent.Error){this.presentError(c);return c}if(c!=this.bindings.value.value()){this.bindings.value.setValue(c)}}return c},presentError:function(a){this.validationError=a;Element.addClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},clearAllErrors:function(){this.validationError=null;Element.removeClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},acceptsFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}return true},becomeFirstResponder:function(){var a=this.viewElement();if(a.disabled||a.readOnly){return false}if(this.markerValue){this.clearMarkerValue()}this.hasFocus=true;this.beginEditing();return true},resignFirstResponder:function(b){var a=this.viewElement();this.hasFocus=false;if(""===a.value){this.setMarkerValue("nullPlaceholder")}this.endEditing();return true},setMarkerValue:function(b){var a=this.viewElement();var c=this.attributeOrProperty(b);this.markerValue=b;a.value=c;Element.addClassName(a,coherent.Style.kMarkerClass)},clearMarkerValue:function(){var a=this.viewElement();this.markerValue=false;a.value="";Element.removeClassName(a,coherent.Style.kMarkerClass)},valueChanged:function(a){if(this.updateTimer){window.clearTimeout(this.updateTmer);this.updateTimer=null}if(this.markerValue){return}this.validate()},fieldReceivedDropEvent:function(b){var a=this.viewElement();a.value="";this.clearMarkerValue()},onkeyup:function(b){if(Event.isMetaKey(b)){return}var a=this.viewElement();Element.addClassName(a,coherent.Style.kEditingClass);if(!this.continuallyUpdatesValue){return}if(this.updateTimer){window.clearTimeout(this.updateTimer)}if(a.readOnly||a.disabled){return}this.updateTimer=this.valueChanged.bindAndDelay(this,this.keypressUpdateTimeout)},onkeydown:function(a){if(this.action&&a.keyCode===Event.KEY_RETURN){this.valueChanged(null);if(this.validationError){return}this.sendAction();Event.stop(a)}},onkeypress:function(b){var d=Event;var a=this.viewElement();if(!this.formatter){return}if((b.charCode===0||d.isMetaKey(b)||b.charCode===d.KEY_BACKSPACE||d.isModifiedKey(b))){return}if(a&&a.value&&a.value.length>=a.maxLength&&typeof a.selectionStart==="number"&&a.selectionStart===a.selectionEnd){Event.stop(b)}var e=String.fromCharCode(b.charCode||b.keyCode);if(!this.formatter.isValidInputCharacter(e)){Event.stop(b)}},observeValueChange:function(c){var a=this.viewElement();var b=c.newValue;if(this.formatter){b=this.formatter.stringForValue(b)}if("undefined"===typeof(b)){a.disabled=true}else{if(!this.bindings.enabled){a.disabled=false}}if(!this.bindings.editable){a.readOnly=!this.bindings.value.mutable()||coherent.Markers.MultipleValues===b||coherent.Markers.NoSelection===b}if(a.readOnly){Element.addClassName(a,coherent.Style.kReadOnlyClass)}else{Element.removeClassName(a,coherent.Style.kReadOnlyClass)}if(a.disabled){Element.addClassName(a,coherent.Style.kDisabledClass)}else{Element.removeClassName(a,coherent.Style.kDisabledClass)}if(!this.bindings.errorMessage||!this.bindings.errorMessage.value()){this.clearAllErrors()}if(this.hasFocus){return}switch(a.type){case"text":case"password":case"email":case"tel":case"textarea":if(null===b||"undefined"===typeof(b)||""===b){this.setMarkerValue("nullPlaceholder")}else{if(coherent.Markers.NoSelection===b){this.setMarkerValue("noSelectionPlaceholder")}else{if(coherent.Markers.MultipleValues===b){this.setMarkerValue("multipleValuesPlaceholder")}else{this.clearMarkerValue();a.value=b}}}break;default:a.value=b;break}},observeErrorMessageChange:function(c){var b=c.newValue;if(!b){this.clearAllErrors();return}var a=new coherent.Error({description:c.newValue});this.presentError(a)},observeMaxLengthChange:function(c){var b=c.newValue;var a=this.viewElement();if("INPUT"==a.nodeName){a.maxLength=b}}});coherent.SearchField=Class.create(coherent.TextField,{__viewClassName__:"Search",__tagSpec__:"input[type=search]",exposedBindings:["predicate"],init:function(){this.base();var a=this.viewElement();if("search"===a.type){Event.observe(a,"search",this.valueChanged.bindAsEventListener(this))}},keypressUpdateTimeout:25,valueChanged:function(a){this.base(a);if(this.bindings.predicate){this.bindings.predicate.setValue(this.createFilterPredicate())}},createFilterPredicate:function(){var a=this.viewElement();var d=this.attributeOrProperty("predicate");var c=a.value.toLowerCase();function b(f){var e=f.valueForKeyPath(d);if(!e){return !!c}if(e.toLocaleString){e=e.toLocaleString()}else{e=e.toString()}e=e.toLowerCase();return(-1!==e.indexOf(c))}return b},observePredicateChange:function(a){}});coherent.SelectField=Class.create(coherent.ListView,{__viewClassName__:"Select",__tagSpec__:"select",exposedBindings:["errorMessage","displayValues","contentValues","selectedValue","name"],init:function(){this.base();this._items=function(b){var a=this.viewElement().options;return b?a[b]:a}},_initFromDOM:function(){var o=this.viewElement(),c=this.bindings,e=this.objectClass||coherent.KVO,k=[],m=[],n=o.options,l=n.length,g,h,b,f;if(o.name&&c.name&&!c.name.hasValue()){c.name.setValue(o.name)}if(!l||(c.content&&c.content.hasValue())){return}var j=c.displayValues&&c.displayValues.keyPath;var a=c.contentValues&&c.contentValues.keyPath;var d=c.content&&c.content.keyPath;if(j&&j.beginsWith(d)){j=j.substring(d.length+1)}else{j=null}if(a&&a.beginsWith(d)){a=a.substring(d.length+1)}else{a=null}for(g=0;g<l;++g){h=n[g];b=Element.assignId(h);f=m[g]=new e();if(j){f.setValueForKeyPath(h.text,j)}if(a){f.setValueForKeyPath(h.value,a)}if(h.selected){k.push(g)}}this.__content=m;this.__selectionIndexes=k;this.selectedIndex=k.length?k[0]:-1;if(c.content){c.content.setValue(m)}if(k.length){if(c.selectionIndexes){c.selectionIndexes.setValue(k)}if(c.selectedObject){c.selectedObject.setValue(this.selectedIndex)}if(c.selectedIndex){c.selectedIndex.setValue(this.selectedIndex)}if(c.selectedValue){c.selectedValue.setValue(n[this.selectedIndex].value)}}},observeContentChange:function(g){var h=this.viewElement(),d,i,e=[],j,b;switch(g.changeType){case coherent.ChangeType.setting:var f=this.__content=g.newValue||[],c=f.length;j=this.selectedObjects();while(h.options.length>c){h.remove(h.options.length-1)}for(d=0;d<c;++d){if(-1!==j.indexOf(f[d])){e.push(d)}if(d==h.options.length){if(coherent.Browser.IE){h.add(new Option())}else{h.add(new Option(),null)}}}break;case coherent.ChangeType.insertion:for(d=0;d<g.indexes.length;++d){i=g.indexes[d];if(!coherent.Browser.IE){i=h.options[i]}h.add(new Option(),i)}break;case coherent.ChangeType.replacement:for(d=0;d<g.indexes.length;++d){h.options[g.indexes[d]]=new Option()}break;case coherent.ChangeType.deletion:e=this.selectionIndexes();for(d=g.indexes.length-1;d>=0;--d){var a=g.indexes[d];h.remove(a);e.removeObject(a)}this.setSelectionIndexes(e);break;default:console.log("Unknown change type: "+g.changeType);break}if(this.bindings.displayValues){this.bindings.displayValues.update()}if(this.bindings.contentValues){this.bindings.contentValues.update()}this.setSelectionIndexes(e)},observeContentValuesChange:function(g){var b=this.viewElement();var e;var d;var f=b.options;var a=f.length;switch(g.changeType){case coherent.ChangeType.setting:if(!g.newValue){break}for(e=0;e<a;++e){f[e].value=g.newValue[e]}break;case coherent.ChangeType.insertion:case coherent.ChangeType.replacement:var c;for(c=0;c<g.indexes.length;++c){e=g.indexes[c];d=f[e];d.value=g.newValue[c]}break;default:console.log("Unknown change type: "+g.changeType);break}},observeDisplayValuesChange:function(g){var b=this.viewElement();var e;var d;var f=b.options;var a=f.length;switch(g.changeType){case coherent.ChangeType.setting:if(!g.newValue){break}for(e=0;e<a;++e){f[e].innerHTML=g.newValue[e]}break;case coherent.ChangeType.insertion:case coherent.ChangeType.replacement:var c;for(c=0;c<g.indexes.length;++c){e=g.indexes[c];d=f[e];d.innerHTML=g.newValue[c]}break;default:console.log("Unknown change type: "+g.changeType);break}},observeSelectedValueChange:function(f,h,b){if(this.bindings.content&&!this.bindings.content.value()){return}var g=this.viewElement();var i=g.options;var e=i.length;var a=f.newValue;g.disabled="undefined"===typeof(a)||coherent.Markers.MultipleValues===a||coherent.Markers.NoSelection===a;var d=[];a=a||"";for(var c=0;c<e;++c){if(i[c].value==a){d=[c];break}}this.setSelectionIndexes(d)},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue},observeErrorMessageChange:function(c){var b=c.newValue;if(!b){this.clearAllErrors();return}var a=new coherent.Error({description:c.newValue});this.presentError(a)},onkeydown:function(a){},presentError:function(a){this.validationError=a;Element.addClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)},clearAllErrors:function(){this.validationError=null;Element.removeClassName(this.viewElement(),coherent.Style.kInvalidValueClass);return this.base.apply(this,arguments)}});coherent.TableHeaderView=Class.create(coherent.View,{__viewClassName__:"TableHeader",exposedBindings:["sortDescriptors"],init:function(){this.base();var a=this.viewElement();if(!a.rows.length){return}var e=a.rows[0];var d=e.cells;var f=d.length;var c;this.__selectedColumn=-1;this.__sortKeyIndex={};for(var b=0;b<f;++b){c=d[b].getAttribute("sortKey");if(!c){continue}this.__sortKeyIndex[c]=b}},selectedColumn:function(){return this.__selectedColumn},setSelectedColumn:function(c){var b=this.viewElement();if(!b.rows.length){return}if(this.__selectedColumn===c){return}var e;var d=b.rows[0];if(-1!==this.__selectedColumn){e=d.cells[this.__selectedColumn];var a=e.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;Element.updateClass(e,[],[coherent.Style.kSelectedClass,a])}this.__selectedColumn=c;if(-1!==this.__selectedColumn){e=d.cells[this.__selectedColumn];var f=e.__ascending?coherent.Style.kAscendingClass:coherent.Style.kDescendingClass;var g=e.__ascending?coherent.Style.kDescendingClass:coherent.Style.kAscendingClass;Element.updateClass(e,[coherent.Style.kSelectedClass,f],g)}},onclick:function(e){var a=this.viewElement();var b;var h=e.target||e.srcElement;while(h&&!(b=h.getAttribute("sortKey"))){if(h.parentNode==a){return}h=h.parentNode}if(!h){return}var d=this.__sortKeyIndex[b];if(this.__selectedColumn==d){h.__ascending=h.__ascending?false:true;var c=coherent.Style.kAscendingClass;var g=coherent.Style.kDescendingClass;if(h.__ascending){Element.updateClass(h,c,g)}else{Element.updateClass(h,g,c)}}else{this.setSelectedColumn(d)}var f=new coherent.SortDescriptor(b,h.__ascending?true:false);if(this.bindings.sortDescriptors){this.bindings.sortDescriptors.setValue([f])}},observeSortDescriptorsChange:function(c){var b=c.newValue;if(!b||!b.length||b.length>1){this.setSelectedColumn(-1);return}var a=this.__sortKeyIndex[b[0].keyPath];if("undefined"===typeof(a)||null===a){a=-1}this.setSelectedColumn(a)}});coherent.ToggleButton=Class.create(coherent.FormControl,{exposedBindings:["checked","selection"],__viewClassName__:"ToggleButton",__tagSpec__:["input[type=checkbox]","input[type=radio]"],init:function(){this.base();var a=this.viewElement();var b=this.bindings;if(b.checked&&!b.checked.hasValue()){b.checked.setValue(a.checked)}if(b.selection&&!b.selection.hasValue()&&a.checked&&a.value){b.selection.setValue(a.value)}},onclick:function(c){var a=this.viewElement();var b=a.checked;if(this.bindings.selection){this.bindings.selection.setValue(a.value)}if(this.bindings.checked){this.bindings.checked.setValue(b)}this.sendAction()},observeValueChange:function(c){this.base(c);var a=this.viewElement();var b=c.newValue;a.value=b;if(!this.bindings.selection){return}a.checked=(this.bindings.selection.value()==b);if(this.bindings.checked){this.bindings.checked.setValue(a.checked)}},observeCheckedChange:function(e,d,b){var a=this.viewElement();var c=!!e.newValue;a.checked=c;if(this.bindings.selection){this.bindings.selection.setValue(a.value)}},observeSelectionChange:function(e,d,b){var a=this.viewElement();var c=(e.newValue===a.value);a.checked=c;if(this.bindings.checked){this.bindings.checked.setValue(c)}}});coherent.ViewController=Class.create(coherent.Responder,{view:null,title:null,automaticallySetupBindings:false,constructor:function(b,c){this.base(c);if("string"===typeof(b)){this.__viewId=b}else{if(b&&1===b.nodeType){this.__viewId=Element.assignId(b)}else{this.__viewId=b.id}}var a=document.getElementById(this.__viewId);this.viewElement=function(){return a}},registerWithName:function(a){if(!a){return}this.name=a;coherent.registerModelWithName(this,a)},nextResponder:function(){return this.view.superview()},structure:function(){return this.__structure__},viewElement:function(){return this.view.viewElement()},addTrackingInfo:function(a,b){coherent.page.addTrackingInfo(a,b)},__postConstruct:function(){var a=document.getElementById(this.__viewId);if(a){this.__init()}else{Event.onDomReady(this.__init.bind(this))}},__init:function(){this.__initialising=true;var d=document.getElementById(this.__viewId);if(!d){throw new Error("Unable to locate node with ID: "+this.__viewId)}var f=this.__context;var a=coherent.dataModel;this.__context=coherent.dataModel=this;var c=this.structure()||{};var g={};var e;var h;this.__copyParameters(this.__parameters||{});var b=coherent.View.fromNode(d);for(h in c){e=c[h];if(e&&"function"==typeof(e)&&(e=e.valueOf()).__factoryFn__){g[h]=e;e.call(this,h,true)}}for(h in g){g[h].call(this,h,false)}if(!b){coherent.View.createViewsForNodeTree(d,null,this);b=coherent.View.createViewForNode(d)}this.view=b;this.view.setNextResponder(this);coherent.dataModel=a;this.__context=f;this.setupBindings();this.init();this.updateBindings();this.createObservers();delete this.__initialising;delete this.viewElement},init:function(){}});coherent.ViewController.__subclassCreated__=function(a){var b=a.prototype;var c=a.superclass.prototype;if(b.__structure__!==c.__structure__){Object.applyDefaults(b.__structure__,c.__structure__)}};