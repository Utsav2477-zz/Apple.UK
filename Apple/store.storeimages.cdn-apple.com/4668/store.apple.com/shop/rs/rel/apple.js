window.$P=function(){};var $=function(a){if("string"===typeof a||a instanceof String){return document.getElementById(a)}return a};Package=(function(){var a={};return function(c){if(c in a){return}a[c]=true;var e=window;var g=c.split(".");var b=g.length;var d;var f;for(d=0;d<b;++d){f=g[d];if(!e[f]){e[f]={}}e=e[f]}}})();coherent.strings["marker.image.placeholder"]="../img/block1px.gif";coherent.strings["error.required_value"]="This field is required.";Package("apple");(function(){Event.onLoad(function(){var f=Element.query("#ac-globalnav");if(f){b()}});function e(g){var h="Bag",f;if(g){f="Bag";h="blue dot"}apple.metrics.fireMicroEvent({eVar:"eVar1",feature:"Globalnav",part:f,action:h})}function b(){var j=Element.queryAll("#ac-globalnav .ac-gn-link:not([aria-label])"),h=Element.query("#ac-globalnav .ac-gn-link-search"),g=Element.query("#ac-globalnav .ac-gn-searchresults"),m=Element.query("#ac-globalnav .ac-gn-link-bag"),l="Globalnav",k="eVar1",f=window.s.pageName,i=[f,null,l,null].join(" | ");j.forEach(function(n){n.setAttribute("data-evar1",[i,n.getAttribute("data-analytics-title")].join(" | "))});h.setAttribute("data-asext-evar",k);h.setAttribute("data-asext-feature",l);h.setAttribute("data-asext-action","search");if(m){Event.observe(m,"click",function(n){if(window.acStore){window.acStore.getItemCount().then(function(o){e(o)},function(o){e()})}else{e()}})}Event.observe(g,"click",function(x){var o=x.target,r={};if(o.classList.contains("ac-gn-searchresults-link")){var p=o.getAttribute("data-analytics-click").split(",");var n=p[0].split(":");var y=p[1].split(":")[1];var w=n[0].trim();var u=d(o.getAttribute("data-section"));var v=n[1].replace(/\{data\-(\w*)\}/g,function(z,A){return A==="section"?u:o.getAttribute("data-"+A)}).trim();var q=c(o.getAttribute("href"))?"www":"aos";var t=o.getAttribute("data-label").toLowerCase();r.eVar2=t;r.eVar23=v.replace("no keyword ","");r.prop7=q+":"+t;r.prop25=u;if(this.isSearchLink(o)){y=y?[y,"event8"].join(","):"event8"}r.events=y;apple.Tracking.track(o,o.text,apple.Tracking.formatMetricsData(r))}})}function d(f){var g={quicklinks:"Quick Link",defaultlinks:"Direct Link"};return g.hasOwnProperty(f)?g[f]:"Suggested Search"}function c(f){return f.indexOf("shop")<0}function a(f){return f&&f.classList.contains("ac-gn-searchresults-link")}}());Package("apple.util");Math.clamp=function(c,b,a){return Math.min(Math.max(b,c),a)};apple.util.aliasMethodChain=function(b,d,c,a){b[d+"Without"+c.charAt(0).toUpperCase()+c.substring(1)]=b[d];b[d]=a};apple.util.elementSupportsAttribute=function(a,b){var c=document.createElement(a);if(b in c){return true}else{return false}};apple.util.makeSubclass=function(a,c){function b(){}b.prototype=c.prototype;a.prototype=new b();a.prototype.constructor=a;a.superclass=c;if(c.prototype.constructor!=c){c.prototype.constructor=c}a.prototype.base=function(f){var d=this;var e=c.prototype[f];if("function"!=typeof(e)){return e}return function(){return e.apply(d,arguments)}}};apple.util.TEMPLATE_REGEX=/\$\{(\w+)\}/g;apple.util.expandTemplate=function(b,d,a){function c(g,e){var f=d[e];if(null===f||"undefined"===typeof(f)){return a}return f}return b.replace(this.TEMPLATE_REGEX,c)};apple.util.addOverflowEllipsis=function(f,d){var b=Element.getStyle(f,"display"),g=(f.textContent||f.innerText),a=0,c=0,e=g.length,h=g;f.style.display="inline";if(f.offsetWidth<=d){Element.setStyle(f,"display",b);return}while(f.offsetWidth!=d&&(a<e)){c=Math.floor(a+((e-a)/2));h=g.substr(0,c)+"&hellip;";f.innerHTML=h;if(f.offsetWidth<d){a=c+1}else{e=c}}f.innerHTML=h;Element.setStyle(f,"display",b)};apple.util.assignId=Element.assignId;apple.util.applyDefaults=Object.applyDefaults;apple.util.merge=Object.merge;Object.extend(Element,{hide:function(a){if(typeof a.cssDisplayCache=="undefined"){var b=a.style.display;if(b!="none"){a.cssDisplayCache=b}}a.style.display="none"},show:function(a){a.style.display=a.cssDisplayCache||"";a.cssDisplayCache=undefined},getDimensions:function(c){c=$(c);var g=Element.getStyle(c,"display");if(g&&g!="none"){return{left:c.offsetLeft,top:c.offsetTop,width:c.offsetWidth,height:c.offsetHeight}}var b=c.style;var f=b.visibility;var d=b.position;var a=b.display;b.visibility="hidden";b.position="absolute";b.display="block";var e={width:c.offsetWidth,height:c.offsetHeight,left:c.offsetLeft,top:c.offsetTop};b.display=a;b.position=d;b.visibility=f;return e},getMarginBox:function(d){var c=Element.getStyles(d,["marginTop","marginBottom","marginRight","marginLeft"]);for(var b in c){c[b]=parseInt(c[b],10)||0}var a=c.marginLeft+c.marginRight;var e=c.marginTop+c.marginBottom;return{width:d.offsetWidth+a,height:d.offsetHeight+e}},setMarginBox:function(f,b){var e=Element.getStyles(f,["marginTop","marginBottom","marginRight","marginLeft","paddingTop","paddingBottom","paddingRight","paddingLeft","borderTopWidth","borderBottomWidth","borderRightWidth","borderLeftWidth"]);for(var d in e){e[d]=parseInt(e[d],10)||0}var c=e.marginLeft+e.marginRight+e.borderLeftWidth+e.borderRightWidth+e.paddingLeft+e.paddingRight;var a=e.marginTop+e.marginBottom+e.borderTopWidth+e.borderBottomWidth+e.paddingTop+e.paddingBottom;f.style.width=(b.width-c)+"px";f.style.height=(b.height-a)+"px"},makeClipping:function(a){a=$(a);if(!a){return a}a._originalOverflow=a.style.overflow||a.style.overflowY||a.style.overflowX;a.style.overflow="hidden";return a},undoClipping:function(a){a=$(a);if(!a||!("_originalOverflow" in a)){return a}a.style.overflow=a._originalOverflow||"";a._originalOverflow=null;return a},makePositioned:function(c,a){c=$(c);if(!c){return c}a=a||"relative";var b=Element.getStyle(c,"position");if("relative"==b||"absolute"==b||a==b){return c}c._originalPosition=b;c.style.position=a||"relative";if(window.opera){c.style.top=c.style.left="0"}return c},undoPositioned:function(a){a=$(a);if(!a||!("_originalPosition" in a)){return a}a.style.position=a._originalPosition||"";a._originalPosition=null;return a},getPositionedOffset:function(b){b=$(b);var a=0;var d=0;do{a+=b.offsetTop||0;d+=b.offsetLeft||0;b=b.offsetParent;if(b){if(b.tagName=="BODY"){break}var c=Element.getStyle(b,"position");if(c=="relative"||c=="absolute"){break}}}while(b);return{left:d,top:a}},makeAbsolute:function(b){b=$(b);if(b.style.position=="absolute"){return}var f=Element.getPositionedOffset(b);var e=f.top-parseFloat(Element.getStyle(b,"margin-top")||0);var d=f.left-parseFloat(Element.getStyle(b,"margin-left")||0);var c=b.clientWidth-parseFloat(Element.getStyle(b,"padding-left")||0)-parseFloat(Element.getStyle(b,"padding-right")||0);var a=b.clientHeight-parseFloat(Element.getStyle(b,"padding-top")||0)-parseFloat(Element.getStyle(b,"padding-bottom")||0);b._originalLeft=b.style.left;b._originalTop=b.style.top;b._originalWidth=b.style.width;b._originalHeight=b.style.height;b._originalPosition=b.style.position;b.style.position="absolute";b.style.top=e+"px";b.style.left=d+"px";b.style.width=c+"px";b.style.height=a+"px"},undoMakeAbsolute:function(a){a=$(a);if(a.style.position!="absolute"){return}a.style.position=a._originalPosition;a.style.left=a._originalLeft;a.style.top=a._originalTop;a.style.width=a._originalWidth;a.style.height=a._originalHeight},getElementsByClassName:function(b,a){return Element.queryAll(a,"."+b)},getOpacity:function(a){return Element.getStyles(a,"opacity")},setOpacity:function(a,b){a=$(a);if(b==1||b===""){a.style.opacity=""}else{if(b<0.00001){a.style.opacity=0}else{a.style.opacity=b}}return a},getPadding:function(c){var a=document.defaultView;var b=a.getComputedStyle(c,null);return{left:parseFloat(b.paddingLeft)||0,top:parseFloat(b.paddingTop)||0,right:parseFloat(b.paddingRight)||0,bottom:parseFloat(b.paddingBottom)||0}}});var useOpacity=(typeof document.createElement("div").style.opacity!="undefined");if(!useOpacity){Object.extend(Element,{setOpacity:function(a,d){a=$(a);var c=Element.getStyle(a,"filter");var b=a.style;if(d==1||d===""){b.filter=c.replace(/alpha\([^\)]*\)/gi,"");return a}if(d<0.00001){d=0}b.filter=c.replace(/alpha\([^\)]*\)/gi,"")+"alpha(opacity="+(d*100)+")";return a}})}if(coherent.Browser.IE){Object.extend(Element,{getPadding:function(b){var a=b.currentStyle;return{left:parseFloat(a.paddingLeft)||0,top:parseFloat(a.paddingTop)||0,right:parseFloat(a.paddingRight)||0,bottom:parseFloat(a.paddingBottom)||0}}})}Object.extend(Event,{sendMouseEvent:(function(){if(document.createEvent){return function(f,c,a,b){var d=document.createEvent("MouseEvents");if(d.initMouseEvent){d.initMouseEvent(c,a,b,window,0,0,0,0,0,false,false,false,false,0,null)}else{d=document.createEvent("UIEvents");d.initEvent(c,a,b);d.view=window;d.detail=0;d.screenX=0;d.screenY=0;d.clientX=0;d.clientY=0;d.ctrlKey=false;d.altKey=false;d.metaKey=false;d.shiftKey=false;d.button=0;d.relatedTarget=null}return f.dispatchEvent(d)}}else{return function(f,c,a,b){var d=document.createEventObject("MouseEvents");d.bubbles=a;d.cancelable=b;d.view=window;d.detail=0;d.screenX=0;d.screenY=0;d.clientX=0;d.clientY=0;d.ctrlKey=false;d.altKey=false;d.metaKey=false;d.shiftKey=false;d.button=1;return f.fireEvent("on"+c,d)}}})(),isNumpadNumKey:function(a){return a>=96&&a<=111},isAlphaNumKey:function(a){if(!this._reverseKeys){this._reverseKeys=(function(){var d={};var c=Event.KEYS;for(var b in c){d[c[b]]=b}return d})()}return this.isNumpadNumKey(a)||!this._reverseKeys[a]},mousePosition:function(b){var c={x:0,y:0};if(b.pageX||b.pageY){c.x=b.pageX;c.y=b.pageY}else{var a=document.documentElement||document.body;c.x=b.clientX+a.scrollLeft-a.clientLeft;c.y=b.clientY+a.scrollTop-a.clientTop}return c},isMouseOverElement:function(e,d){var b=Event.mousePosition(e);var h=Element.getRect(d);var g=h.top;var a=g+d.offsetHeight;var f=h.left;var c=f+d.offsetWidth;return(b.x>=f&&b.x<=c&&b.y>=g&&b.y<=a)},onUnload:function(a){if(!arguments.callee.__fn){arguments.callee.__fn=function(){var b=arguments.callee.__handlers;while(b.length){(b.pop())()}delete arguments.callee.__handlers};Event.observe(window,"unload",arguments.callee.__fn);arguments.callee.__fn.__handlers=[]}arguments.callee.__fn.__handlers.push(a)},fixEvent:function(b){if(!b){if(window.event){b=window.event}}if(coherent.Browser.IE){if(!b.target){b.target=b.srcElement}if(!b.currentTarget){b.currentTarget=b.srcElement}if(!b.layerX){b.layerX=b.offsetX}if(!b.layerY){b.layerY=b.offsetY}var c=(b.srcElement&&b.srcElement.ownerDocument)?b.srcElement.ownerDocument:document;var a=(c.compatMode=="BackCompat")?c.body:c.documentElement;if(!b.pageX){b.pageX=b.clientX+(a.scrollLeft||0)}if(!b.pageY){b.pageY=b.clientY+(a.scrollTop||0)}if(b.type=="mouseover"){b.relatedTarget=b.fromElement}if(b.type=="mouseout"){b.relatedTarget=b.toElement}}return b},KEYS:{KEY_BACKSPACE:8,KEY_TAB:9,KEY_CLEAR:12,KEY_ENTER:13,KEY_SHIFT:16,KEY_CTRL:17,KEY_ALT:18,KEY_PAUSE:19,KEY_CAPS_LOCK:20,KEY_ESCAPE:27,KEY_SPACE:32,KEY_PAGE_UP:33,KEY_PAGE_DOWN:34,KEY_END:35,KEY_HOME:36,KEY_LEFT_ARROW:37,KEY_UP_ARROW:38,KEY_RIGHT_ARROW:39,KEY_DOWN_ARROW:40,KEY_INSERT:45,KEY_DELETE:46,KEY_HELP:47,KEY_LEFT_WINDOW:91,KEY_RIGHT_WINDOW:92,KEY_SELECT:93,KEY_NUMPAD_0:96,KEY_NUMPAD_1:97,KEY_NUMPAD_2:98,KEY_NUMPAD_3:99,KEY_NUMPAD_4:100,KEY_NUMPAD_5:101,KEY_NUMPAD_6:102,KEY_NUMPAD_7:103,KEY_NUMPAD_8:104,KEY_NUMPAD_9:105,KEY_NUMPAD_MULTIPLY:106,KEY_NUMPAD_PLUS:107,KEY_NUMPAD_ENTER:108,KEY_NUMPAD_MINUS:109,KEY_NUMPAD_PERIOD:110,KEY_NUMPAD_DIVIDE:111,KEY_F1:112,KEY_F2:113,KEY_F3:114,KEY_F4:115,KEY_F5:116,KEY_F6:117,KEY_F7:118,KEY_F8:119,KEY_F9:120,KEY_F10:121,KEY_F11:122,KEY_F12:123,KEY_F13:124,KEY_F14:125,KEY_F15:126,KEY_NUM_LOCK:144,KEY_SCROLL_LOCK:145}});window.JSONP={get:function(b,i){if(!b){return{}}var d=((new Date()).getTime()+Math.floor(Math.random()*100000)).toString(32);var l=new coherent.Deferred();var e=i.callbackParamName||"callback";var g="apple_jsonp_callback_"+d,f=i.params||{},k;if(i.enableCache){k="apple_jsonp_callback";var j=f.find;window.queryParamsToFunctionNameMap=window.queryParamsToFunctionNameMap||{};window.queryParamsToFunctionNameMap[j]=g;if(!window[k]){window[k]=function(){var n=arguments[0];j=n.body.query;var m=window.queryParamsToFunctionNameMap[j];if(m&&window[m]){window[m](n)}}}}else{k=g}f[e]=k;var a=b+((-1==b.indexOf("?"))?"?":"&")+Object.toQueryString(f);var c;var h=document.createElement("script");h.type="text/javascript";h.src=a;window[g]=function(){var n=arguments[0];try{l.callback(n)}catch(o){}h.parentNode.removeChild(h);try{delete window[g]}catch(m){}};document.getElementsByTagName("HEAD")[0].appendChild(h);return l}};Package("apple");window.JSONRPC=(function(){function a(k,j){var m=document.createElement("form");m.action=k;m.method="post";var n;var i;var q={};var l=(function(){return function(r,p,t){var o=document.createElement("input");o.name=p;o.type="hidden";r.appendChild(o);o.value=t}})();for(n in j){i=j[n];if(j[n]===q[n]){continue}if(i instanceof Array){i.forEach(function(o){l(m,n,o)})}else{l(m,n,i)}}m.style.position="absolute";m.style.visibility="hidden";m.style.height="0px";m.style.width="0px";document.body.appendChild(m);m.submit()}function g(j,i){if(!j){return}i=Object.toQueryString(i);if(i){if(j.indexOf("?")){j+="&"}else{j+="?"}j+=i}window.location.href=j}function h(j){if(!j){return false}var o=false;var i=parseInt(j.head.status,10);switch(i){case 301:case 302:case 303:case 304:case 305:case 306:case 307:o=true;break;default:break}if(!o){return false}var m=j.head.data;var l=m.url;var n=m.method;var k=m.args;if("post"===n){a(l,k)}else{g(l,k)}return true}function e(j){if(!j){return true}var i=parseInt(j.head.status,10);if(i>=400&&i<600){return true}return false}function d(j,i){var l;if(i.head&&i.head.data&&i.head.data.microEvent){l=i.head.data.microEvent}else{if(i.body&&i.body.microEvent){l=i.body.microEvent;delete i.body.microEvent}}var k;if(i.head&&i.head.data&&i.head.data.metrics){k=i.head.data.metrics}else{if(i.body&&i.body.metrics){k=i.body.metrics;delete i.body.metrics}}if(!l&&!k&&!j){return}k=Object.extend(j||{},k);apple.metrics.fireEventCollection({microEvent:l,metrics:k})}var c={sync:false,responseContentType:"application/json"};var b=[];function f(o,k,m,j){function l(p){var q;d(j.metrics,p);if(h(p)){q=new Error("Response redirected");q.redirect=true}else{if(e(p)){q=new Error("Response returned errors")}}if(q){q.response=p;return q}return p.body}j=Object.applyDefaults(j,c);var n=j.protocol;var i=(n==="JSONP")?JSONP.get(k,j):XHR.request(o,k,m,j);i.addCallback(l);b.forEach(function(p){i.addCallback(p)},this);return i}f.get=function(j,k,i){return f("GET",j,k,i)};f.post=function(j,k,i){return f("POST",j,k,i)};f.__registerGlobalCallback=function(i){b.push(i)};return f})();window.DeferredJSON=Class.create(coherent.KVO,{constructor:function(a){Object.extend(this,a)},__keysToIgnore:Set("actionKey","_url","url","_version","version","loading","clearOldKeys"),__factory__:function(d){var b=Array.from(arguments);var a=this;function c(){}return function(){if(d){["extractContent","extractUpdates","setCallback"].forEach(function(f){if(f in d&&"string"===typeof(d[f])){d[f]=this[d[f]].bind(this)}},this)}c.prototype=a.prototype;var e=new c();a.prototype.constructor.apply(e,b);return e}},url:function(){return this._url},version:function(){return this._version},setUrl:function(a){this._url=a;return a},setVersion:function(a){this._version=a;return a},refresh:function(){this.setValueForKey(true,"loading");var a=this.url();if(!a){return null}var b=JSONRPC.get(a,this.extraArgs,{sync:this.sync});b.addMethods(this.set.bind(this),this.failure.bind(this));return b},performAction:function(c,b){var a=Object.extend({},this.extraArgs);a=Object.extend(a,b);if(!this.actionKey){throw new Error("actionKey value not set.")}a[this.actionKey]=c;return this.sendRequest(this.url(),a)},sendRequest:function(c,b,a){a=a||{method:"post"};this.setValueForKey(true,"loading");var e=JSONRPC[a.method](c,b);e.addMethods(this.set.bind(this),this.failure.bind(this));return e},failure:function(a){if(!a.redirect){this.setValueForKey(false,"loading")}return a},hasContent:function(){return Set.toArray(this.keys()).length},keys:function(){return this.__contentKeys||new Set()},setByUrl:function(b){var a={timeout:5000};req=XHR.get(b,null);req.addMethods(this.recommendationSuccess.bind(this),this.failure.bind(this))},recommendationSuccess:function(a){if(typeof a!=="object"){a=JSON.parse(a)}if(a&&typeof(a)==="object"&&"body" in a){this.set(a.body)}},set:function(c){this.__contentKeys=this.__contentKeys||new Set();if(c.url){this.setUrl(c.url)}this.setVersion(c.version?c.version:null);if(!c.content&&!c.update&&!c.replace){return this.refresh()}this.setValueForKey(false,"loading");var b=c.content||{};var d=c.update;var e=c.content?true:false;if(c.replace){for(var f in c.replace){b[f]=c.replace[f]}}if(!b.addObserverForKeyPath){b=coherent.KVO.adaptTree(b)}if(d&&this.extractUpdates){d=this.extractUpdates(d)}function a(m,j){var g=j.mutableKeys(),l,k;if(m){this.mutableKeys().forEach(function(n){if(g.indexOf(n)===-1&&this[n]){j.setValueForKey(null,n);g.push(n)}},this)}function h(n){if(!n){return}var o=(n in j&&j[n]!==null)?"add":"remove";Set[o](this.__contentKeys,n);this.willChangeValueForKey(n);this[n]=j[n]}function i(n){if(!n){return}this.didChangeValueForKey(n)}g.forEach(h,this);g.forEach(i,this);if(d&&d.data){for(l in d.data){k=d.data[l];if(typeof k=="object"&&k!==null){k=coherent.KVO.adaptTree(k)}this.setValueForKeyPath(k,l)}}if(this.setCallback){this.setCallback(j)}return j}if(this.extractContent){b=this.extractContent(b)}if(b===false){return false}else{if(b instanceof coherent.Deferred){b.addCallback(a.bind(this,e));return b}else{return a.call(this,e,b)}}}});$P(window.DeferredJSON.prototype,"set","Content");Package("apple.behavior.metrics");apple.behavior.metrics.autoCrossOriginMicroEventsEnabled=true;apple.behavior.metrics.ClickMap=function(a){this.anchorClickHandler=function(b){var d=b.target||b.srcElement,c;c=Element.locateAncestor(d,function(e){return e.tagName==="A"},a);if(c){apple.behavior.metrics.storePageEventData(c,b)}};this.formSubmitHandler=function(b){var c=b.target||b.srcElement;if(c&&c.nodeName&&c.nodeName.toLowerCase()==="form"){apple.behavior.metrics.storePageEventData(c,b)}}};apple.behavior.metrics.getClickMapId=function(d){var a,c,b=/s_objectID=['"](.*)['"]/i;if(d){a=d.getAttribute("data-s-object-id")||null;if(!a){c=d.getAttribute("onclick")||"";if(b.test(c)){a=b.exec(c)[1]}}}return a||null};apple.behavior.metrics.isCrossOriginLink=function(b){var a=function(c){return("origin" in c)?c.origin:(c.protocol+"//"+c.hostname)};return(this.isValidLink(b)&&a(b)!==a(document.location))};apple.behavior.metrics.isExternalLink=function(b){if(this.isValidLink(b)){var e=apple.Tracking.getSitecatalystInstance()||window.s||{},c=e.linkInternalFilters||"",d=false,a=false;if("hostname" in b&&b.hostname.length&&c.length>0){c=c.split(/\s*,\s*/i);while(!d&&c.length){d=(b.hostname.indexOf(c.shift())!==-1)}a=!d}return a}return false};apple.behavior.metrics.isTargetingOtherWindow=function(b,a){if(!b||!a){return false}var c=(b.target||"").toLowerCase();return((a.metaKey||a.ctrlKey||a.shiftKey)||(["","_self","_parent","_top"].indexOf(c)===-1)||(window.name.length>0&&c.length>0&&c!==window.name))};apple.behavior.metrics.isValidLink=function(c){var a=false,b;if(c.nodeName.toLowerCase()==="a"){b=(c.getAttribute("href")||"").trim();a=(b.length>0&&b.indexOf("#")!==0&&b.indexOf("about:")!==0&&b.indexOf("javascript:")!==0)}return a};apple.behavior.metrics.storeDataForFuturePageEvent=function(b,d){var h,g={timestamp:(new Date()).getTime()},i=metricsStorage,c;c=document.createElement("a");c.setAttribute("href",b);if(c.hostname&&(c.hostname!==window.document.location.hostname)){return}for(var a in d){g[a]=d[a]}h=apple.metrics.getStorageKey(b);g=window.JSON.stringify(g);try{i.set(h,g);i.set(apple.metrics.Metrics.CONSTANTS.pageLoadDataKeyLatestKeyName,h)}catch(f){}};apple.behavior.metrics.parseMetricsDataFromElement=function(b){var d,c,g=apple.Tracking.getSitecatalystInstance(),a,e,f={},j=[],h=["eVar1","eVar5","eVar20","eVar21","eVar30","eVar31","prop37","prop42"];for(d=0;d<h.length;d++){a=h[d],e=a.toLowerCase(),c=b.getAttribute("data-"+e);if(c&&c.length){c=c.replace(/\[pageName\]/,g.pageName||"");f[a]=c;j.push(a)}}return{keys:j,vars:f,metrics:Object.extend({linkTrackVars:j.join(","),linkTrackEvents:""},f)}};apple.behavior.metrics.storePageEventData=function(d,j){var i=d.pathname||d.action,e=false,b=true,a=this.isExternalLink(d),c;if(!j){return}if("defaultPrevented" in j){b=(j.defaultPrevented!==true)}else{if("returnValue" in j){b=(j.returnValue!==false)}}c=this.parseMetricsDataFromElement(d);e=(this.autoCrossOriginMicroEventsEnabled&&(a||this.isCrossOriginLink(d)));if(b===true&&e===true){var f=this.isTargetingOtherWindow(d,j),g=(a)?"e":"o",h=d.href||d.action;if(f===true){apple.Tracking.track(d,h,c.metrics,null,g)}else{Event.preventDefault(j);apple.Tracking.track(d,h,c.metrics,function(){window.location=h},g)}}else{this.storeDataForFuturePageEvent(i,c.vars)}};apple.behavior.metrics.captureProp42AndSubmitForm=function(a){};apple.behavior.metrics.cleanupStaleStorage=function(){var e=metricsStorage,b=24*60*60*1000,a=(new Date()).getTime(),g=apple.metrics.transformKey(apple.metrics.Metrics.CONSTANTS.pageLoadDataKeyPrefix),j=e.length(),h,c,f,d;for(d=j-1;d>=0;d--){h=e.getKey(d);if(h&&h.indexOf(g)!==-1){c=e.get(h);c=c?apple.data.json.parse(c):{};f=c.timestamp||a;if((a-f)>=b){e.remove(h)}}}};Event.onLoad(function(){if(!apple.metrics.evarDataNodesEnabled){return}var b=document.body,a=new apple.behavior.metrics.ClickMap(b);Event.observe(b,"click",a.anchorClickHandler.bind(a));Event.observe(b,"submit",a.formSubmitHandler.bind(a));apple.behavior.metrics.cleanupStaleStorage.delay(2000)});Package("apple.behavior");apple.behavior.Striper=function(){var b=null;var d=["odd","even"];var a=5;function c(h){var f=h.getElementsByTagName("tbody");for(var e=0;e<f.length;e++){var i=f[e].getElementsByTagName("tr");for(var g=0;g<i.length;g++){var j=i[g].className.split(" ");for(var k=0;k<d.length;k++){if(j.indexOf(d[k])!=-1){j.splice(j.indexOf(d[k]),1)}}j.push(d[g%d.length]);i[g].className=j.join(" ")}}}return function(h){var g;var f;if("undefined"===typeof h){var e=document.getElementsByTagName("table");if(null!==b&&"string"===typeof b){for(f=0;f<e.length;f++){if(e[f].className.indexOf(b)!=-1){g.push(e[f])}}}else{g=e}}else{if("string"===typeof h){g=[document.getElementById(h)]}else{g=[h]}}for(f=0;f<Math.min(a,g.length);f++){c(g[f])}for(var j=10;f<g.length;f++){window.setTimeout(function(){var i=g[f];return function(){c(i)}}(),j);j+=10}}}();Event.onDomReady(apple.behavior.Striper);Package("apple.behavior");apple.behavior.TextFieldPlaceholder=(function(){if(!(coherent&&coherent.TextField)){return null}var a="placeholder";var h="field-with-placeholder";var m=Element.regexForClassName(h);var l=coherent.TextField.prototype;var b=l.init;var j=l.onkeydown;var n=l.becomeFirstResponder;var o=l.setMarkerValue;var q=l.clearMarkerValue;var e=l.presentError;var v=l.endEditing;var g=l.onkeyup;coherent.TextField.prototype.init=t;coherent.TextField.prototype.presentError=c;coherent.TextField.prototype.onkeyup=r;coherent.TextField.prototype.endEditing=f;function u(p){var z=p.viewElement();var y=Element.query('label[for="'+z.id+'"].'+a);if(!y&&p.nullPlaceholder&&p.nullPlaceholder.toString()){y=document.createElement("label");y.setAttribute("for",z.id);y.htmlFor=z.id;y.innerHTML="<span>"+p.nullPlaceholder+"</span>";y.className=a}else{if(y){try{if(y.getElementsByTagName("span")[0]){p.nullPlaceholder=y.getElementsByTagName("span")[0].firstChild.nodeValue}else{p.nullPlaceholder=y.innerHTML}}catch(A){return false}}else{return false}}p.label=y;var B=z.parentNode;if(B.nodeName.toUpperCase()!="SPAN"){B=document.createElement("span");z.parentNode.replaceChild(B,z)}if(!m.test(B.className)){Element.addClassName(B,h)}if(z.parentNode!=B){B.appendChild(z)}B.insertBefore(y,z);return true}function k(p){if(u(p)){p.onkeydown=i;p.becomeFirstResponder=d;p.setMarkerValue=x;p.clearMarkerValue=w;Event.observe(p.viewElement(),"input",p.clearMarkerValue.bind(p));Event.observe(p.viewElement(),"paste",p.clearMarkerValue.bind(p));Event.onDomReady(function(){if(p.viewElement().value&&!p.validationError){p.clearMarkerValue()}var y=p.id;if(y){window.setTimeout(function(){if(Element.query("#"+y+":-webkit-autofill")&&coherent.Browser.Chrome){p.clearMarkerValue()}},10)}})}}function t(){b.call(this);k(this);if(this.viewElement().value){this.clearMarkerValue()}}function i(p){j.call(this,p);var y=p.keyCode;if(Event.isAlphaNumKey(y)||y==32||y==8||y==46){this.clearMarkerValue()}}function d(){Element.addClassName(this.label,"focus");return n.call(this)}function x(p){if(p=="nullPlaceholder"){this.viewElement().value="";this.label.style.display="";Element.removeClassName(this.label,"hidden");Element.removeClassName(this.label,"focus")}}function c(p){var y=this.viewElement().parentNode;Element.addClassName(y,coherent.Style.kInvalidValueClass);return e.call(this,p)}function w(){var p=this.viewElement().parentNode;Element.removeClassName(p,coherent.Style.kInvalidValueClass);Element.addClassName(this.label,"hidden")}function f(){Element.removeClassName(this.viewElement().parentNode,coherent.Style.kEditingClass);v.call(this)}function r(p){g.call(this,p);if(this.updateTimer){Element.addClassName(this.viewElement().parentNode,coherent.Style.kEditingClass);if(this.viewElement().value==""){Element.removeClassName(this.label,"hidden")}}}return function(p){if(p instanceof coherent.TextField){if(p.markerValue){p.clearMarkerValue()}k(p)}}})();(function(){if(!window.apple){window.apple={}}if(!window.apple.data){window.apple.data={}}if(!window.apple.data.xml){window.apple.data.xml={}}var d=function d(i){return !!(i.ownerDocument&&i.ownerDocument.evaluate)},b=function b(i){return !!(i.ownerDocument&&"selectNodes" in i.ownerDocument)},h="first",a="all",g=function g(k,j){var l,m=[],i;if(d(k)){l=k.ownerDocument.evaluate(j,k,null,XPathResult.ANY_TYPE,null);i=l.iterateNext();while(i){m.push(i);i=l.iterateNext()}}else{if(b(k)){m=k.selectNodes(j)}else{throw c("UserAgent does not support xPath evaluation on this node")}}return m},f=function f(k,j){var l,i;if(d(k)){l=k.ownerDocument.evaluate(j,k,null,XPathResult.ANY_TYPE,null);i=l.iterateNext()}else{if(b(k)){i=k.selectSingleNode(j)}else{throw c("UserAgent does not support xPath evaluation on this node")}}return i},e=function e(){var j=arguments[0],k=arguments[1]||j,l=arguments[2]||arguments[1],i;switch(j){case h:i=f(k,l);break;case a:i=g(k,l);break;default:i=g(k,l);break}return i},c=function c(j){j="An error occurred"||j;var i="AppleDataXmlError";return{name:i,message:j}};apple.data.xml.FIRST=h;apple.data.xml.ALL=a;apple.data.xml.find=e;apple.data.xml.error=c})();Package("apple.fx");apple.fx.Animator=function(a){this._direction=1;this.t=0;this.config=Object.applyDefaults(a,arguments.callee.DEFAULTS)};apple.fx.Animator.DEFAULTS={actions:[],duration:250,frameRate:60,callback:null};apple.fx.Animator.prototype.setDuration=function(a){this.config.duration=a};apple.fx.Animator.prototype.finishNow=function(){function a(b){b(1);if("finish" in b){b.finish(1)}}this.config.actions.forEach(a)};apple.fx.Animator.prototype.stop=function(){if(this._timer){window.clearTimeout(this._timer)}this._timer=0};apple.fx.Animator.prototype.play=function(a,b){this.stop();if("function"==typeof(a)){a=[a]}if(a&&this.config.actions!=a){if(0<this.t&&1>this.t){this.finishNow()}this.config.actions=a.filter(function(c){return null!==c&&"undefined"!=typeof(c)});this.t=0}if(1==this.t){this.t=0}this._direction=1;this._run(this.config.actions,this._direction,this.t,b||this.config.callback)};apple.fx.Animator.prototype.reverse=function(a){this.stop();this._direction=(this._direction>0)?-1:1;this._run(this.config.actions,this._direction,this.t,a||this.config.callback)};apple.fx.Animator.prototype._run=function(g,n,h,o){var p=this;var b;var e=this.config.duration;var k=g.length;var j;var f=Math.round(1000/this.config.frameRate);for(j=0;j<k;++j){if("setup" in g[j]){g[j].setup()}}function m(){p._timer=0;for(j=0;j<k;++j){if("finish" in g[j]){g[j].finish(p.t)}}if(o){o(p.t)}}function d(){var i=(new Date()).getTime()-b;if(i>e){i=e}p.t=Math.round(i/e*1000)/1000;for(j=0;j<k;++j){g[j](p.t)}if(i==e){m();return}p._timer=window.setTimeout(a,f)}function l(){var i=(new Date()).getTime()-b;if(i>e){i=e}p.t=1-i/e;for(j=0;j<k;++j){g[j](p.t)}if(i==e){m();return}p._timer=window.setTimeout(a,f)}var a=d;if(n<0){a=l;h=1-h}function c(){b=(new Date()).getTime()-e*h;a()}this._timer=window.setTimeout(c,0)};Package("apple.fx");apple.fx.ContentSwapper=function(a){a=Object.applyDefaults(a,arguments.callee.DEFAULTS);this.base("constructor")(a)};apple.util.makeSubclass(apple.fx.ContentSwapper,apple.fx.Animator);apple.fx.ContentSwapper.DEFAULTS={duration:1000,transition:"crossfade"};Class.extend(apple.fx.ContentSwapper,{fixElementDimensions:function(d){var c=$(this._measureDiv);if(!c){c=document.createElement("div");this._measureDiv=Element.assignId(c);c.style.position="relative";var b=$(this.config.id);b.appendChild(c)}d._originalWidth=d.style.width;d._originalHeight=d.style.height;if(d.style.width&&d.style.height){return}var i=d.style.display;d.style.display="block";var l=Element.getStyles(d,["width","height","paddingTop","paddingRight","paddingBottom","paddingLeft"]);function g(m){var h=m.lastChild;while(h&&h.nodeType!==1){h=h.previousSibling}return h}var k=0,e,a=g(d);while(a){e=parseFloat(Element.getStyles(a,"marginBottom")||0,10);if(e<0){k+=e}a=g(a)}var j=parseInt(l.width||0,10)-parseFloat(l.paddingLeft||0,10)-parseFloat(l.paddingRight||0,10);var f=parseInt(l.height||0,10)-parseFloat(l.paddingTop||0,10)-parseFloat(l.paddingBottom||0,10)+k;d.style.width=j+"px";d.style.height=f+"px";d.style.display=i},undoFixElementDimensions:function(a){a.style.width=a._originalWidth||"";a.style.height=a._originalHeight||""},swap:function(g,e,d,h,b){e=$(e);d=$(d);this.fixElementDimensions(e);this.fixElementDimensions(d);var f=[].concat(this._setup(g,e,d));if(b){f=f.concat(b)}var a=$(this.config.id);Element.makeClipping(a);Element.makePositioned(a);Element.makePositioned(e,"absolute");Element.makePositioned(d,"absolute");function c(){Element.undoPositioned(d);Element.undoPositioned(e);Element.undoClipping(a);Element.undoPositioned(a);this.undoFixElementDimensions(d);this.undoFixElementDimensions(e);a.style.height="";a.style.width="";if(h){h()}}this.play(f,c.bind(this))},_setup:function(g,e,b){var a=$(this.config.id);var d=a.offsetHeight-parseFloat(Element.getStyle(a,"padding-top")||0)-parseFloat(Element.getStyle(a,"padding-bottom")||0);var c=apple.fx;g=g||"crossfade";a.style.height=d+"px";var f=[];switch(g){case"fadein":f.push(new c.FadeIn(apple.fx.linearTween,b));f.push(new c.Hide(null,e));break;case"crossfade":case"swapfade":if(e&&b){f.push(new c.FadeOutIn(apple.fx.linearTween,e,b))}else{if(e){f.push(new c.FadeOut(apple.fx.linearTween,e))}else{if(b){f.push(new c.FadeIn(apple.fx.linearTween,b))}}}break;case"left":case"right":f.push(new c.Pan(apple.fx.easeInOutSine,e,b,g=="left"?-1:1));break;case"up":case"down":f.push(new c.Scroll(apple.fx.easeInOutSine,e,b,g=="up"?-1:1));break;default:if(e&&b){f.push(new c.CrossFade2(apple.fx.linearTween,e,b))}else{if(e){f.push(new c.FadeOut(apple.fx.linearTween,e))}else{if(b){f.push(new c.FadeIn(apple.fx.linearTween,b))}}}break}if(e&&b){e.style.zIndex=1;b.style.zIndex=2;f.push(new c.Resize(apple.fx.easeInOutSine,a,Element.getDimensions(b),Element.getDimensions(e)))}return new apple.fx.Chain(f)}});Package("apple.fx");apple.fx.CrossFade=function(a,b){if(!a||a<10){a=this.getDefaultSpeed()}if(!b){b=this.getDefaultIncrement()}this.fadeSpeed=a;this.fadeInc=b;this.fadeStep=0};apple.fx.CrossFade.DEFAULT_SPEED=8;apple.fx.CrossFade.DEFAULT_INCREMENT=0.05;apple.fx.CrossFade.prototype.getDefaultSpeed=function(){return apple.fx.CrossFade.DEFAULT_SPEED};apple.fx.CrossFade.prototype.getDefaultIncrement=function(){return apple.fx.CrossFade.DEFAULT_INCREMENT};apple.fx.CrossFade.prototype.fade=function(a,c,e){a=[].concat(a);c=[].concat(c);if(this.lastFromObjects){this.stopAnimation();this.lastFromObjects.forEach(Element.hide)}this.lastFromObject=a;this.fadeStep=0;function b(f){Element.setStyles(f,{top:"0px",left:"0px",opacity:1});Element.show(f)}function d(f){Element.setStyles(f,{top:"0px",left:"0px",opacity:0});Element.show(f)}a.forEach(b);c.forEach(d);this._fade(a,c,e)};apple.fx.CrossFade.prototype.swap=apple.fx.CrossFade.prototype.fade;function roundToPlaces(c,b){if(!b){return Math.round(c)}var a=Math.pow(10,b);return Math.round(c*a)/a}apple.fx.CrossFade.prototype._fade=function(b,d,g){this.stopAnimation();this.fadeStep=roundToPlaces(this.fadeStep+this.fadeInc,6);if(this.fadeStep<1){function f(h){return function(i){Element.setOpacity(i,h)}}var a=f(this.fadeStep);var e=f(roundToPlaces(1-this.fadeStep,6));(d||[]).forEach(a);(b||[]).forEach(e);var c=this;this.timer=window.setTimeout(function(){c._fade(b,d,g)},this.fadeSpeed)}else{this._finishFade(b,d,g)}};apple.fx.CrossFade.prototype._finishFade=function(a,b,d){function c(e){Element.setOpacity(e,1)}this.lastFromObject=null;this.stopAnimation();(a||[]).forEach(Element.hide);(b||[]).forEach(c);if(d){d()}};apple.fx.CrossFade.prototype.stopAnimation=function(){if(this.timer){window.clearTimeout(this.timer)}};Package("apple.fx");apple.fx.fadeShow=function(b,e,g,f){b=$(b);var a=Element.getStyle(b,"opacity");if(a<1){e=(1-a)*e}else{Element.setStyle(b,"opacity",0)}Element.show(b);var d=new apple.fx.Animator({duration:e});var c=new apple.fx.Fade(b,g,a,1);return{play:function(){d.play(c,f)}}};apple.fx.fadeHide=function(b,e,h,g){b=$(b);var a=Element.getStyle(b,"opacity");e=a*e;function f(){Element.hide(b);Element.setStyle(b,"opacity",1);if(g){g(b,d)}}var d=new apple.fx.Animator({duration:e});var c=new apple.fx.Fade(b,h,a,0);return{play:function(){d.play(c,f)}}};Package("apple.fx");apple.fx.Morph=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS)};apple.fx.Morph.prototype.DEFAULTS={duration:500,frameDelay:25,callback:function(){},style:{},easing:function(a){return 0.5+Math.sin((a+1.5)*Math.PI)/2}};apple.fx.Morph.prototype.start=function(a){if(this._timer){return}var b=$(this.config.element);if(!b){return}if(a){this.config=Object.applyDefaults(a,this.DEFAULTS)}this._animator=this.animate.bind(this);this._now=0;this._start=Object.applyDefaults(Element.getRect(b,true),Element.getDimensions(b));this._start.opacity=Element.getStyle(b,"opacity");var c=Element.getRect(b.parentNode,true);this._start.top-=c.top;this._start.left-=c.left;this._delta={};for(var d in this.config.style){this._delta[d]=this.config.style[d]-this._start[d];if(!this._delta[d]){delete this._delta[d]}}this._timer=window.setTimeout(this._animator,this.config.frameDelay)};apple.fx.Morph.prototype.stop=function(){if(!this._timer){return}window.clearTimeout(this._timer);this._timer=0;this._animator=null};apple.fx.Morph.prototype.animate=function(){var a;var b=$(this.config.element);if(!b){return}this._now+=this.config.frameDelay;for(var c in this._delta){a=this.config.easing(this._now/this.config.duration)*this._delta[c]+this._start[c];if("opacity"==c){Element.setStyle(b,"opacity",a)}else{b.style[c]=a+"px"}}if(this._now>=this.config.duration){if(this.config.callback){this.config.callback()}return}this._timer=window.setTimeout(this._animator,this.config.frameDelay)};Package("apple.fx");apple.fx.SwapFade=function(a){this.duration=a||200;this._timer=null};apple.fx.SwapFade.prototype._stopAnimation=function(){window.clearTimeout(this._timer);this._timer=null};apple.fx.SwapFade.prototype.swap=function(f,l,m){this._stopAnimation();var e=10;var c=0;var h=this.duration;var d=h/2;var b=false;function k(n){Element.setStyle(n,"top","0px");Element.setStyle(n,"left","0px");Element.setOpacity(n,1);Element.show(n)}function a(n){Element.setStyle(n,"top","0px");Element.setStyle(n,"left","0px");Element.setOpacity(n,0);Element.show(n)}function j(n){Element.hide(n);Element.setOpacity(n,1)}f.forEach(k);l.forEach(a);function i(){c+=e;function n(p){if(p<0){p=0}else{if(p>1){p=1}}p=Math.round(p*100)/100;return function(o){Element.setOpacity(o,p)}}if(c<d){f.forEach(n(1-c/d))}else{if(!b){b=true;f.forEach(j)}l.forEach(n((c-d)/d))}if(c>h){l.forEach(n(1));this._timer=null;if(m){m()}return}this._timer=window.setTimeout(g,e)}var g=i.bind(this);this._timer=window.setTimeout(g,e)};Package("apple.fx");apple.fx.Swoosh=function(c,b,a){this.viewerId=c;if(!b){b=apple.fx.Swoosh.DEFAULT_PAN_SPEED}if(!a){a=apple.fx.Swoosh.DEFAULT_PAN_INCREMENT}this.panSpeed=b;this.panIncrement=a};apple.fx.Swoosh.DEFAULT_PAN_SPEED=20;apple.fx.Swoosh.DEFAULT_PAN_INCREMENT=40;apple.fx.Swoosh.prototype.getDefaultSpeed=function(){return apple.fx.Swoosh.DEFAULT_PAN_SPEED};apple.fx.Swoosh.prototype.getDefaultIncrement=function(){return apple.fx.Swoosh.DEFAULT_PAN_INCREMENT};apple.fx.Swoosh.prototype.getViewer=function(){return $(this.viewerId)};apple.fx.Swoosh.prototype.pan=function(a,d,c,e){if(this.lastFromObject){this.stopAnimation();Element.hide(this.lastFromObject)}this.lastFromObject=d;var b=this.getViewWidth();Element.setStyles(d,{top:"0px",left:"0px"});Element.setStyles(c,{top:"0px",left:(a?b:-b)+"px"});Element.show(d);Element.show(c);this._pan(Math.PI,b,a,d,c,e)};apple.fx.Swoosh.prototype.getViewWidth=function(){return parseInt(Element.getStyle(this.getViewer(),"width"),10)};apple.fx.Swoosh.prototype._pan=function(g,d,c,f,e,h){this.stopAnimation();g+=Math.PI/this.panIncrement;if(g<=(2*Math.PI)){var a=Math.floor((d/2)*(1+Math.cos(g)));if(c){a=-a}Element.setStyle(f,"left",a+"px");Element.setStyle(e,"left",(a+(c?d:-d))+"px");var b=this;this.timer=window.setTimeout(function(){b._pan(g,d,c,f,e,h)},this.panSpeed)}else{this._finishPan(f,e,h)}};apple.fx.Swoosh.prototype._finishPan=function(b,a,c){this.lastFromObject=null;this.stopAnimation();Element.hide(b);if(c){c()}};apple.fx.Swoosh.prototype.stopAnimation=function(){if(this.timer){window.clearTimeout(this.timer);this.timer=null}};Package("apple.fx");var halfPI=Math.PI/2;var PI=Math.PI;apple.fx.linearTween=function(a){return a};apple.fx.easeInSine=function(a){return 1-Math.cos(a*halfPI)};apple.fx.easeOutSine=function(a){return Math.sin(a*halfPI)};apple.fx.easeInOutSine=function(a){return(1-Math.cos(a*PI))/2};apple.fx.easeInBack=function(a,b){if(b==undefined){b=1.70158}return a*a*((b+1)*a-b)};apple.fx.easeOutBack=function(a,b){if(b==undefined){b=1.70158}a=a-1;return(a*a*((b+1)*a+b)+1)};apple.fx.easeOutBackStrong=function(a,b){if(b==undefined){b=1.70158*1.5}a=a-1;return(a*a*((b+1)*a+b)+1)};apple.fx.Chain=function(){var c;if(1==arguments.length&&"function"==typeof(arguments[0])){return arguments[0]}if(1==arguments.length&&arguments[0] instanceof Array){c=arguments[0]}else{c=Array.from(arguments)}c=c.filter(function(i){return null!==i&&"undefined"!=typeof(i)});var f=c.length;var e=0;var b=0;var h=0;var j=[];var g=[];for(var d=0;d<f;++d){g[d]=b;if(!("duration" in c[d])){c[d].duration=1}b+=c[d].duration;j[d]=b}function a(k){if(e==f){return}var i=((k*b)-g[e])/c[e].duration;if(i>1){i=1}c[e](i);if(i<1){return}if("finish" in c[e]){c[e].finish(i)}e++;if(e==f){return}if("setup" in c[e]){c[e].setup()}a(k)}a.setup=function(){e=0;if("setup" in c[e]){c[e].setup()}};a.finish=function(i){};return a};apple.fx.Blend=function(){var d;if(1==arguments.length&&"function"==typeof(arguments[0])){return arguments[0]}if(1==arguments.length&&arguments[0] instanceof Array){d=arguments[0]}else{d=Array.from(arguments)}d=d.filter(function(e){return null!==e&&"undefined"!=typeof(e)});var a=d.length;var c;function b(e){for(c=0;c<a;++c){d[c](e)}}b.setup=function(){for(c=0;c<a;++c){if("setup" in d[c]){d[c].setup()}}};b.finish=function(e){for(c=0;c<a;++c){if("finish" in d[c]){d[c].finish(e)}}};return b};apple.fx.AdjustCurve=function(b,a,e){a=a||0;e=e||1;if(0===a&&1===e){return b}var c=e-a;var d=a/c;return function(f){return b(Math.min(1,f/c-d))}};apple.fx.Fade=function(c,b,g,f){var e=f-g;var d=(0===f)?["","none"]:["none",""];function a(h){Element.setOpacity(b,g+e*c(h))}a.setup=function(){Element.setOpacity(b,g);b.style.display=""};a.finish=function(h){h=h?1:0;b.style.display=d[h];Element.setOpacity(b,h?f:g)};return a};apple.fx.FadeIn=function(b,a){return apple.fx.Fade(b,a,0,1)};apple.fx.FadeOut=function(b,a){return apple.fx.Fade(b,a,1,0)};apple.fx.CrossFade2=function(f,d,c){var b;var e;function a(g){Element.setOpacity(d,f(1-g));Element.setOpacity(c,f(g))}a.setup=function(){b=Element.getStyle(d,"position");e=Element.getStyle(c,"position");d.style.display="";Element.setOpacity(d,1);d.style.position="absolute";Element.setOpacity(c,0);c.style.display="";c.style.position="absolute"};a.finish=function(g){c.style.display=(g?"":"none");Element.setOpacity(c,1);d.style.display=(g?"none":"");Element.setOpacity(d,1);c.style.position=e;d.style.position=b};return a};apple.fx.FadeOutIn=function(d,c,b){function a(e){e*=2;if(e<=1){Element.setOpacity(c,d(1-e));Element.setOpacity(b,0)}else{Element.setOpacity(c,0);Element.setOpacity(b,d(e-1))}}a.setup=function(){c.style.display="";Element.setOpacity(c,1);Element.setOpacity(b,0);b.style.display=""};a.finish=function(e){b.style.display=(e?"":"none");Element.setOpacity(b,1);c.style.display=(e?"none":"");Element.setOpacity(c,1)};return a};apple.fx.Pan=function(h,f,e,g){var d=f.offsetWidth;g=g||1;var c=((g>0)?-d:d);var b=g*d;function a(i){var j=Math.round(b*h(i));f.style.left=j+"px";e.style.left=c+j+"px"}a.setup=function(){f.style.display="";e.style.left=c+"px";e.style.display=""};a.finish=function(i){if(1==i){f.style.display="none";f.style.left="0"}};return a};apple.fx.Scroll=function(h,f,d,g){var a=f.offsetHeight;g=g||1;var c=((g>0)?-a:a);var e=g*a;function b(i){var j=Math.round(e*h(i));f.style.top=j+"px";d.style.top=c+j+"px"}b.setup=function(){f.style.display="";d.style.top=c+"px";d.style.display=""};b.finish=function(i){if(1==i){f.style.display="none";f.style.top="0"}};return b};apple.fx.MoveBy=function(f,d,h){var c=h.x||h.left||0;var a=h.y||h.top||0;var e;var g;function b(i){var j=f(i);d.style.left=e+Math.round(c*j)+"px";d.style.top=g+Math.round(a*j)+"px"}b.setup=function(){e=parseFloat(Element.getStyle(d,"left")||0);g=parseFloat(Element.getStyle(d,"top")||0)};return b};apple.fx.MoveTo=function(f,d,h){var c;var a;var e;var g;function b(i){var j=f(i);d.style.left=e+Math.round(c*j)+"px";d.style.top=g+Math.round(a*j)+"px"}b.setup=function(){e=parseFloat(Element.getStyle(d,"left")||0);g=parseFloat(Element.getStyle(d,"top")||0);if("x" in h||"left" in h){c=(h.x||h.left)-e}else{c=0}if("y" in h||"top" in h){a=(h.y||h.top)-g}else{a=0}};return b};apple.fx.Move=function(b,c,h,i){var f;var d;var g;var e;function a(j){var k=b(j);c.style.left=g+Math.round(f*k)+"px";c.style.top=e+Math.round(d*k)+"px"}a.setup=function(){if("x" in h||"left" in h){g=(h.x||h.left)}else{g=parseFloat(Element.getStyle(c,"left")||0)}if("y" in h||"top" in h){g=(h.y||h.top)}else{e=parseFloat(Element.getStyle(c,"top")||0)}if("x" in i||"left" in i){f=(i.x||i.left)-g}else{f=0}if("y" in i||"top" in i){d=(i.y||i.top)-e}else{d=0}};return a};apple.fx.FadeInBackgroundImage=function(f,b,e){var d=Element.assignId(b);var c=document.getElementById(d+"_fadingBackgroundImage");if("url("!=e.substr(0,4).toLowerCase()){e="url("+e+")"}if(!c){c=document.createElement("div");c.id=d+"_fadingBackgroundImage";c.style.display="none";c.style.position="absolute";c.style.top="0";c.style.left="0";c.style.zIndex="0";b.insertBefore(c,b.firstChild)}c.style.backgroundImage=e;function a(g){Element.setOpacity(c,f(g))}a.setup=function(){Element.makePositioned(b);Element.makeClipping(b);c.style.backgroundPosition=Element.getStyle(b,"backgroundPosition");c.style.backgroundRepeat=Element.getStyle(b,"backgroundRepeat");c.style.width=b.offsetWidth+"px";c.style.height=b.offsetHeight+"px";Element.setOpacity(c,0);c.style.display=""};a.finish=function(h){function g(){c.style.display="none";Element.setOpacity(c,1);Element.undoPositioned(b);Element.undoClipping(b)}window.setTimeout(g,10)};return a};apple.fx.SetClassName=function(d,c,b){function a(e){c.className=b}a.duration=0;return a};apple.fx.SetInnerHTML=function(c,b,d){function a(e){b.innerHTML=d}a.duration=0;return a};apple.fx.SetInnerText=function(d,b,c){function a(e){var f=document.createTextNode(c);b.innerHTML="";b.appendChild(f)}a.duration=0;return a};apple.fx.Resize=function(d,c,b,f){var e=null;function a(g){var h=c.style;g=d(g);h.height=Math.round(g*e.height+f.height)+"px";h.width=Math.round(g*e.width+f.width)+"px"}a.setup=function(){Element.makeClipping(c);if(!f){f=Element.getDimensions(c)}e={width:b.width-f.width,height:b.height-f.height}};a.finish=function(h){var g=c.style;if(h){g.height=Math.round(b.height)+"px";g.width=Math.round(b.width)+"px"}else{g.height=Math.round(f.height)+"px";g.width=Math.round(f.width)+"px"}Element.undoClipping(c)};return a};apple.fx.Morph=function(f,e,d,h){var g=null;var a=true;var c=true;function b(i){var j=e.style;i=f(i);if(a){j.left=Math.round(i*g.left+h.left)+"px";j.top=Math.round(i*g.top+h.top)+"px"}if(c){j.height=Math.round(i*g.height+h.height)+"px";j.width=Math.round(i*g.width+h.width)+"px"}}b.setup=function(){if(!h){h=Element.getDimensions(e)}var i=Element.getPadding(e);a=("left" in d&&"left" in h&&"top" in d&&"top" in h);c=("width" in d&&"width" in h&&"height" in d&&"height" in h);g={left:d.left-h.left-i.left,top:d.top-h.top-i.top,width:d.width-h.width-i.left-i.right,height:d.height-h.height-i.top-i.bottom}};b.finish=function(j){var i=e.style;if(j){if(a){i.top=Math.round(d.top)+"px";i.left=Math.round(d.left)+"px"}if(c){i.height=Math.round(d.height)+"px";i.width=Math.round(d.width)+"px"}}else{if(a){i.top=Math.round(h.top)+"px";i.left=Math.round(h.left)+"px"}if(c){i.height=Math.round(h.height)+"px";i.width=Math.round(h.width)+"px"}}};return b};apple.fx.Hide=function(c,b){function a(d){}a.finish=function(d){b.style.display=d?"none":""};return a};apple.fx.ResizeImage=function(d,c,b,f){var e=null;function a(i){var k=c.style;var j;var g;i=d(i);k.height=(j=Math.round(i*e.height+f.height))+"px";k.width=(g=Math.round(i*e.width+f.width))+"px";c.width=g;c.height=j}a.setup=function(){if(!f){f=Element.getDimensions(c)}e={width:b.width-f.width-(parseFloat(Element.getStyle(c,"padding-left"))||0)-(parseFloat(Element.getStyle(c,"padding-right"))||0),height:b.height-f.height-(parseFloat(Element.getStyle(c,"padding-top"))||0)-(parseFloat(Element.getStyle(c,"padding-bottom"))||0)}};a.finish=function(l){var g;var j;var i=c.style;var k=l?b:f;i.height=(j=Math.round(k.height))+"px";i.width=(g=Math.round(k.width))+"px";c.height=j;c.width=g};return a};apple.fx.ColourRgbRegex=/^rgb\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*\)$/i;apple.fx.ColourHexRegex=/^\#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})$/;apple.fx.ChangeColour=function(e,f,c,h,b){var i;function d(k){var l=k.match(apple.fx.ColourRgbRegex);if(l){return[Math.clamp(parseInt(l[1],10),0,255),Math.clamp(parseInt(l[2],10),0,255),Math.clamp(parseInt(l[3],10),0,255)]}l=k.match(apple.fx.ColourHexRegex);if(l){var o=l[1];var n;var m;var j;if(3==o.length){n=o.charAt(0)+o.charAt(0);m=o.charAt(1)+o.charAt(1);j=o.charAt(2)+o.charAt(2)}else{n=o.slice(0,2);m=o.slice(2,4);j=o.slice(4,6)}return[Math.clamp(parseInt(n,16),0,255),Math.clamp(parseInt(m,16),0,255),Math.clamp(parseInt(j,16),0,255)]}throw new Error("Invalid colour string: "+k)}function g(j){j=Math.round(Math.clamp(j,0,255));if(j<16){return"0"+j.toString(16)}else{return j.toString(16)}}function a(j){j=e(j);var k=["#",g(b[0]+i[0]*j),g(b[1]+i[1]*j),g(b[2]+i[2]*j)].join("");f.style[c]=k}a.setup=function(){b=d(b||Element.getStyle(f,c));h=d(h);i=[h[0]-b[0],h[1]-b[1],h[2]-b[2]]};return a};apple.fx.ChangeColor=apple.fx.ChangeColour;Package("apple.io.json");apple.io.json.invoke=function(c){var a=null;var e=c.preventCache||false;var f=c.sync||false;var b=c.method||"get";function g(j){var l;if(j.head&&j.head.data&&j.head.data.metrics){l=j.head.data.metrics}else{if(j.body&&j.body.metrics){l=j.body.metrics;delete j.body.metrics}}if(!l&&!c.metrics){return}var k=Object.extend(c.metrics||{},l);apple.metrics.fireEvent(k)}function i(j){if(apple.io.json.isRedirect(j)){if(c.redirect){c.redirect(j)}apple.io.json.redirect(j);return}if(apple.io.json.hasErrors(j)){if(c.error){c.error(j)}return}g(j);if(j.preScript){coherent.Scripts.install(j.preScript)}if(c.success){c.success(j)}if(j.postScript){coherent.Scripts.install(j.postScript)}apple.io.json.evaluateScriptKeys(j.body,c.scriptKeys)}function h(j){if(c.error){c.error(j)}}try{a=XHR.request(b,c.url,c.urlArgs,{sync:f,responseContentType:"application/json"});a.addMethods(i,h)}catch(d){if(c.error){c.error(d)}}return a};apple.io.json.redirect=function(b){var a=b.head.data;if(a&&a.url){if("post"==a.method){apple.io.json.issuePostRedirect(a.url,a.args)}else{apple.io.json.issueGetRedirect(a.url,a.args)}}};apple.io.json.issuePostRedirect=function(c,b){if(c){var e=document.createElement("form");e.action=c;e.method="post";var f;var a;var g={};function d(j,i,k){var h=document.createElement("input");j.appendChild(h);h.type="hidden";h.name=i;h.value=k}for(f in b){a=b[f];if(b[f]===g[f]){continue}if(a instanceof Array){a.forEach(function(h){d(e,f,h)})}else{d(e,f,a)}}e.style.position="absolute";e.style.visibility="hidden";e.style.height="0px";e.style.width="0px";document.body.appendChild(e);e.submit()}};apple.io.json.issueGetRedirect=function(b,a){if(b){var c=null;if(a){c=Object.toQueryString(a)}if(c){if(b.indexOf("?")<0){b+="?"+c}else{b+=c}}window.location.href=b}};apple.io.json.isRedirect=function(d){var a=false;try{if(d){var b=parseInt(d.head.status,10);switch(b){case 301:case 302:case 303:case 304:case 305:case 306:case 307:a=true;break;default:break}}}catch(c){}return a};apple.io.json.hasErrors=function(d){var a=false;try{if(d){var b=parseInt(d.head.status,10);if(b==200){a=false}else{if(b>=400&&b<600){a=true}}}else{a=true}}catch(c){}return a};apple.io.json.evaluateScriptKeys=function(d,c){if(d&&c){for(var b=0;b<c.length;b++){var e=d[c[b]];if(e){var a=coherent.Scripts.extract(e).scripts;coherent.Scripts.install(a)}}}};apple.io.json.createSimpleJsonMsg=function(a){var b={head:{status:"200"},body:{content:a}};return b};Package("apple.quicktime");apple.quicktime._initialised=false;apple.quicktime._version=undefined;apple.quicktime.DEFAULTS={activeXClassId:"clsid:02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",activeXCodebase:"http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0",mimeType:"video/quicktime",autoplay:true,cache:true,controller:false,enablejavascript:true,showlogo:false,saveembedtags:true,scale:"aspect"};apple.quicktime.mobileSafari=!!navigator.userAgent.match(/Mobile.*Safari/);apple.quicktime.isInstalled=function(){return(this.mobileSafari||this._version||this.getVersion())?true:false};apple.quicktime.getVersion=function(){if(this._version||this._initialised){return this._version}this._initialised=true;var c=window.navigator.plugins;var a=c?c.length:0;if(c&&a){var g;for(g=0;g<a;++g){var h=c[g];var d=h.name.match(/quicktime\D*([\.\d]*)/i);if(d&&d[1]){return(this._version=d[1])}}}else{try{var f=new window.ActiveXObject("QuickTimeCheckObject.QuickTimeCheck"),b=f.QuickTimeVersion.toString(16);this._version=[b.charAt(0),b.charAt(1),b.charAt(2)].join(".")}catch(j){}return this._version}return this._version};apple.quicktime.isVersionCompatible=function(b){function a(f,h){var e=parseInt(f[0],10);if(isNaN(e)){e=0}var g=parseInt(h[0],10);if(isNaN(g)){g=0}if(e===g){if(f.length>1){return a(f.slice(1),h.slice(1))}else{return true}}else{if(e<g){return true}else{return false}}}var c=String(b).split(/\./);var d=String(this.getVersion()).split(/\./);return a(c,d)};apple.quicktime.createMovie=function(b,a){var d=document.createElement("OBJECT");b=Object.applyDefaults(Object.clone(b),this.DEFAULTS);function c(f){if(!(f in b)){return}d.setAttribute(f,b[f])}function e(f){var g=document.createElement("PARAM");if(!(f in b)){return}g.setAttribute("name",f);g.setAttribute("value",b[f]);d.appendChild(g)}["width","height","name","id","class","title","bgcolor"].forEach(c);["src","autoplay","cache","controller","enablejavascript","showlogo","saveembedtags","loop"].forEach(e);if(window.ActiveXObject){d.setAttribute("classid",b.activeXClassId);d.setAttribute("codebase",b.activeXCodebase)}else{d.setAttribute("data",b.src);d.setAttribute("type",b.mimeType)}a.appendChild(d);return d};apple.quicktime.logProperties=function(a){function b(f){try{return[f,a["Get"+f]()].join(": ")}catch(d){return d.message}}var c;c=["PluginStatus","AutoPlay","ControllerVisible","Rate","Time","Volume","Mute","MovieName","MovieID","StartTime","EndTime","BgColor","IsLooping","LoopIsPalindrome","PlayEveryFrame","HREF","Target","QTNEXTUrl","URL","KioskMode","Duration","MaxTimeLoaded","TimeScale","MovieSize","MaxBytesLoaded","TrackCount","Matrix","Rectangle","Language"].map(b);console.log(c.join("\n"))};Package("apple.widget");apple.widget.AlternateProductsUpdater=function(a){this.config=a||{};Object.applyDefaults(this.config,apple.widget.AlternateProductsUpdater.DEFAULTS);Event.onDomReady(this.init.bind(this))};apple.widget.AlternateProductsUpdater.DEFAULTS={priceId:"price",shippingId:"shipping",priceClass:"price",shippingClass:"availability",labelSuffix:"-label"};apple.widget.AlternateProductsUpdater.prototype.init=function(){var b=document.getElementById(this.config.elementId);if(!b){return}var c=b.getElementsByTagName("label");if(!c){return}var d=this.selectProduct.bindAsEventListener(this);function a(g){var e=g.htmlFor;g.id=e+this.config.labelSuffix;var f=document.getElementById(e);Event.observe(f,"click",d)}Array.forEach(c,a,this)};apple.widget.AlternateProductsUpdater.prototype.selectProduct=function(a){var b=(a.srcElement||a.target);this.updateSelectedProduct(b)};apple.widget.AlternateProductsUpdater.prototype.updateSelectedProduct=function(f){var b=document.getElementById(f.id+this.config.labelSuffix);if(!b){return}var e=document.getElementById(this.config.priceId);var a=document.getElementById(this.config.shippingId);var c=Element.getElementsByClassName(this.config.priceClass,b);var d=Element.getElementsByClassName(this.config.shippingClass,b);if(e&&c&&c.length>0){e.innerHTML=c[0].innerHTML}if(a&&d&&d.length>0){a.innerHTML=d[0].innerHTML}};Package("apple.widget");apple.widget.AnimatedTextWidget=(function createAnimatedTextWidget(){var d=window.coherent,b=d.Markers,a=d.Animator,c=window.Element,g=c.getStyle,e=c.getStyles,f=c.setStyle,i=c.setStyles,h=c.undoClipping,j="px";return Class.create(d.View,{__viewClassName__:"apple.AnimatedText",animated:true,observeVisibleChange:function(t,v,m){var r=this.viewElement(),q=e(r,["display","paddingTop","paddingBottom"]),k={width:r.scrollWidth,height:r.scrollHeight},o=q.display,l=!!t.newValue,n=(parseFloat(q.paddingTop)||0)+(parseFloat(q.paddingBottom)||0),p,u;if(l===o){return}c.makeClipping(r);if(t.newValue){i(r,{height:0+j,display:""});a.setStyles(r,{height:Math.max(0,r.scrollHeight-n)},{duration:300,curve:d.easing.inOutSine,callback:function(){f(r,"height","");h(r)}})}else{f(r,"height",Math.max(r.offsetHeight-n,r.offsetHeight)+j);a.setStyles(r,{height:0},{duration:300,curve:d.easing.inOutSine,callback:function(){i(r,{display:"none",height:""});h(r)}})}},translateValue:function(n){var l=this.viewElement(),m=true,k=this.attributeOrProperty;if(this.formatter){n=this.formatter.stringFromValue(n)}switch(n){case"":case null:case undefined:if(typeof this.nullPlaceHolder==="string"||c.hasAttribute(l,"nullPlaceHolder")){n=k("nullPlaceholder")}break;case d.Markers.NoSelection:n=k("noSelectionPlaceholder");break;case d.Markers.MultipleValues:n=k("multipleValuesPlaceholder");break;default:n=String(n);m=false;break}if(m){c.addClassName(l,d.Style.kMarkerClass)}else{c.removeClassName(l,d.Style.kMarkerClass)}return n},observeTextChange:function(p,o,l){var k=this.viewElement(),m=this.translateValue(p.newValue),n;if(!this.animated||"none"===g(k,"display")){n=document.createTextNode(m);k.innerHTML="";k.appendChild(n);return}if(m===k.innerText){return}a.innerText(k,m,300)},observeHtmlChange:function(q,p,l){var k=this.viewElement(),n=q.newValue,m=this.translateValue(n),o;if(!this.animated||"none"===g(k,"display")){if(m!==n){o=document.createTextNode(m);k.innerHTML="";k.appendChild(o);return}k.innerHTML=m;return}if(typeof m==="string"){if(m!==n){this.observeTextChange(q,p,l);return}if(typeof m==="string"&&m.trim()===String(k.innerHTML).trim()){return}a.innerHTML(k,m,300)}}})})();Package("apple.widget");apple.widget.AutoCompleter=function(a,c,b){this.country=c;this.field=b;this.cur=-1;this.layer=null;this.textbox=a;this.init()};Object.extend(apple.widget.AutoCompleter.prototype,{init:function(){var a=this;this.textbox.onkeyup=function(b){if(!b){b=window.event}a.handleKeyUp(b)};this.textbox.onkeydown=function(b){if(!b){b=window.event}a.handleKeyDown(b)};this.textbox.onblur=function(){a.hideSuggestions()};this.createDropDown()},autosuggest:function(b,a){if(b.length>0){if(a){this.typeAhead(b[0])}this.showSuggestions(b)}else{this.hideSuggestions()}},createDropDown:function(){var c=this;this.layer=document.createElement("div");this.layer.className="AutoCompleterResults";if(coherent.Browser.Safari){var a=/AppleWebKit\/(\d+(?:\.\d+)?)/;var b=a.exec(navigator.userAgent);if(b&&parseInt(b[1],10)>=523){this.layer.className+=" capable"}}this.layer.style.visibility="hidden";this.layer.style.left="-5000px";this.layer.style.top="0px";this.layer.onmousedown=this.layer.onmouseup=this.layer.onmouseover=function(e){e=e||window.event;var d=e.target||e.srcElement;if(e.type=="mousedown"){var f=d.firstChild.nodeValue;if(f!==null){c.textbox.value=d.firstChild.nodeValue;c.hideSuggestions()}}else{if(e.type=="mouseover"){c.highlightSuggestion(d)}else{c.textbox.focus()}}};document.body.appendChild(this.layer)},handleKeyDown:function(a){switch(a.keyCode){case 38:this.previousSuggestion();return;case 40:this.nextSuggestion();return;case 13:this.cancelEvent(a);this.hideSuggestions();return;case 27:this.hideSuggestions();return;default:return}},cancelEvent:function(a){a.cancelBubble=true;a.returnValue=false;if(a.stopPropagation){a.stopPropagation();a.preventDefault()}},handleKeyUp:function(a){var c=a.keyCode;var b;if(c==8||c==46){this.autosuggest(this.search(this.textbox.value),false)}else{if(c<32||(c>=33&&c<46)||(c>=112&&c<=123)){return}else{this.autosuggest(this.search(this.textbox.value),true)}}},showSuggestions:function(g){var a=Element.getRect(this.textbox);this.layer.style.top=(a.top+this.textbox.offsetHeight)+"px";this.layer.style.left=(a.left+this.textbox.offsetWidth/2)+"px";this.layer.style.width="";var f=null;this.layer.innerHTML="";var h=document.createElement("div");h.className="top";h.innerHTML='<span class="left"></span><span class="right"></span>';var d=document.createElement("div");d.className="middle";var c=document.createElement("div");c.className="bottom";c.innerHTML='<span class="left"></span><span class="right"></span>';var b=document.createElement("ul");for(var e=0;e<g.length;e++){f=document.createElement("li");f.appendChild(document.createTextNode(g[e]));b.appendChild(f)}d.appendChild(b);this.layer.appendChild(h);this.layer.appendChild(d);this.layer.appendChild(c);this.layer.style.visibility="visible";this.layer.style.width=d.offsetWidth+"px";this.layer.style.marginLeft=-0.5*this.layer.offsetWidth+"px"},hideSuggestions:function(){this.layer.style.visibility="hidden"},highlightSuggestion:function(b){var a=this.layer.getElementsByTagName("li");for(var c=0;c<a.length;c++){a[c].className=a[c]==b?"selected":""}},nextSuggestion:function(){var b=this.layer.getElementsByTagName("li");if(b.length>0&&this.cur<b.length-1){var a=b[++this.cur];this.highlightSuggestion(a);this.textbox.value=a.firstChild.nodeValue}},previousSuggestion:function(){var b=this.layer.getElementsByTagName("li");if(b.length>0&&this.cur>0){var a=b[--this.cur];this.highlightSuggestion(a);this.textbox.value=a.firstChild.nodeValue}},selectRange:function(a,b){if(this.textbox.createTextRange){var c=this.textbox.createTextRange();c.moveStart("character",a);c.moveEnd("character",b-this.textbox.value.length);c.select()}else{if(this.textbox.setSelectionRange){this.textbox.setSelectionRange(a,b)}}},search:function(e){var d=[];var a=apple.widget.AutoCompleter.data[this.country][this.field];if(e.length>0){e=e.toUpperCase()+" ";while(e.length>1&&d.length===0){e=e.substring(0,e.length-1);var b=a[e.substring(0,1)];if(b){for(var c=0;c<b.length;c++){if(b[c].indexOf(e)===0){d.push(b[c])}}}}}return d},typeAhead:function(b){if(this.textbox.createTextRange||this.textbox.setSelectionRange){if(b&&this.textbox.value&&b.indexOf(this.textbox.value)===0){var a=this.textbox.value.length;this.textbox.value=b;this.selectRange(a,b.length)}}}});apple.widget.AutoCompleter.requestURL="";apple.widget.AutoCompleter.requestParams={};apple.widget.AutoCompleter.willRequest=false;apple.widget.AutoCompleter.requestTimer=null;apple.widget.AutoCompleter.requestCallback=null;apple.widget.AutoCompleter.data=null;apple.widget.AutoCompleter.registerInput=function(a,d,c){apple.widget.AutoCompleter.willRequest=true;var b=apple.widget.AutoCompleter.requestParams;if(!(d in b)){b[d]={}}if(!(c in b[d])){b[d][c]=[]}b[d][c].push(a)};apple.widget.AutoCompleter.requestData=function(){if(apple.widget.AutoCompleter.willRequest===false){return}var d={p:"apple.widget.AutoCompleter.processData"};for(var i in apple.widget.AutoCompleter.requestParams){if(!(i in d)){d[i]=[]}for(var g in apple.widget.AutoCompleter.requestParams[i]){d[i].push(g)}}var b=apple.widget.AutoCompleter.requestURL;var h=(b.indexOf("?")!=-1)?"&":"?";b+=h+Object.toQueryString(d);var a=document.createElement("script");a.src=b;function e(){apple.widget.AutoCompleter.requestCallback=function(){}}apple.widget.AutoCompleter.requestCallback=function(c){window.clearTimeout(apple.widget.AutoCompleter.requestTimer);apple.widget.AutoCompleter.requestTimer=null;apple.widget.AutoCompleter.processData(c)};apple.widget.AutoCompleter.requestTimer=window.setTimeout(e,10000);document.getElementsByTagName("HEAD")[0].appendChild(a)};apple.widget.AutoCompleter.processData=function(d){apple.widget.AutoCompleter.data=d;var e=apple.widget.AutoCompleter.requestParams;for(var g in e){for(var b in e[g]){for(var a=0;a<e[g][b].length;a++){apple.widget.AutoCompleter.create(e[g][b][a],g,b)}}}};apple.widget.AutoCompleter.create=function(e,d,c){var b=apple.widget.AutoCompleter.data;var a=document.getElementById(e);if(a){if(a.setAttribute){a.setAttribute("AUTOCOMPLETE","off")}new apple.widget.AutoCompleter(a,d,c)}};Event.onDomReady(apple.widget.AutoCompleter.requestData);Package("apple.widget");function _makePartFinder(f){var a=f.length,c;if(1==a){var e=f[0];function g(){return[document.getElementById(e)]}g.single=function(i){return document.getElementById(e)};g.isPart=function(i){return i.id==e};return g}function b(){c={};for(var j=0;j<a;++j){c[f[j]]=true}}function h(i){return i.id in c}function d(){var j=[];for(var k=0;k<a;++k){j.push(document.getElementById(f[k]))}return j}d.single=function(i){return document.getElementById(f[i])};d.isPart=function(i){b();this.isPart=h;return h(i)};return d}apple.widget.BaseWidget=function(b,a){if(1==arguments.length){a=b||{}}else{a=a||{};if("string"!=typeof(b)){a.id=Element.assignId(b)}else{a.id=b||a.id}}this._partCache={};this._widgetId=a.id;this.setConfig(a);Event.onDomReady(this.init.bind(this))};Class.extend(apple.widget.BaseWidget,{setConfig:function(b){for(var a=this.constructor;a&&Object!==a;a=a.superclass){Object.applyDefaults(b,a.DEFAULTS||{})}this.config=b},init:function(){},widget:function(){return document.getElementById(this._widgetId)},observeParts:function(b,e,d){var f=this.parts(b);var a=f.length;var c;for(c=0;c<a;++c){Event.observe(f[c],e,d)}},observePart:function(a,d,c){var b=this.part(a);Event.observe(b,d,c)},stopObservingParts:function(b,e,d){var f=this.parts(b);var a=f.length;var c;for(c=0;c<a;++c){Event.stopObserving(f[c],e,d)}},isPart:function(a,b){if(!(a in this._partCache)){this.parts(a)}return this._partCache[a].isPart(b)},part:function(a,b){b=b||0;if(a in this._partCache){return this._partCache[a].single(b)}return this.parts(a)[b]},parts:function(j){if(j in this._partCache){return this._partCache[j]()}var f=this.widget();var l=j.split(".");var b;var h;var a=[];var e;if(0===l.length||2<l.length){return[]}if(1==l.length){b=f.getElementsByTagName(l[0]);h=a.length=b.length;for(e=0;e<h;++e){a[e]=Element.assignId(b[e])}}else{var k=[];var g=0;var c=new RegExp("(?:^|\\s+)"+l[1]+"(?:\\s+|$)");b=f.getElementsByTagName(l[0]||"*");h=k.length=a.length=b.length;for(e=0;e<h;++e){var d=b[e];if(!c.test(d.className)){continue}a[g]=Element.assignId(d);k[g]=d;++g}a.length=g;k.length=g;b=k}this._partCache[j]=_makePartFinder(a);return Array.from(b)}});Package("apple.widget");apple.widget.ColumnEqualizer=function(a){this.elementList=typeof(a)==="string"?Element.queryAll(a):a;this.calculateHeights()};apple.widget.ColumnEqualizer.prototype.calculateHeights=function(){var a=0,b=0;this.elementList.forEach(function(c){b=c.style.height;c.style.height="";a=Math.max(a,parseInt(Element.getStyles(c,"height").replace("px",""),10));c.style.height=b});this.elementList.forEach(function(c){Element.setStyle(c,"height",a+"px")})};Package("apple.widget");apple.widget.ContentSwitcher=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS);this._activateTimer=null;Event.onDomReady(this.init.bind(this))};apple.widget.ContentSwitcher.STYLE={switchOnClick:0,switchOnHover:1};apple.widget.ContentSwitcher.prototype.nodesById=function(a){switch(typeof(a)){case"string":return[$(a)];case"undefined":return[];default:if(a instanceof Array){return a.map($)}if(!a){return[]}return[a]}};apple.widget.ContentSwitcher.prototype.DEFAULTS={hoverDelay:200,activeContentClass:"active",inactiveContentClass:"inactive",activeButtonClass:"active",inactiveButtonClass:"inactive",style:apple.widget.ContentSwitcher.STYLE.switchOnClick,transition:{swap:function(d,b,e){d=[].concat(d);b=[].concat(b);function c(f){f.style.display="none"}function a(f){f.style.display=""}d.forEach(c);b.forEach(a);if(e){e()}}}};apple.widget.ContentSwitcher.prototype.init=function(){var h=apple.widget.ContentSwitcher.STYLE;var f=h.switchOnHover==(this.config.style&h.switchOnHover);var c=this.mouseOverButton.bindAsEventListener(this);var i=this.mouseOutButton.bindAsEventListener(this);var g=this.buttonClicked.bindAsEventListener(this);for(var b in this.config.buttons){var d=$(b);var e=this.config.buttons[b];if("string"==typeof(e)){this.config.buttons[b]=e.split(/\s*,\s*/g)}if(!d){continue}if(f){Event.observe(d,"mouseover",c);Event.observe(d,"mouseover",c);Event.observe(d,"mouseout",i);Event.observe(d,"click",Event.stop)}else{Event.observe(d,"click",g)}}this._activeButtonId=this.findInitialActiveButton();this._activeContentIds=this.config.buttons[this._activeButtonId]||[this.overviewId];this._initialActiveButton=this._activeButtonId;this._initialActiveContentIds=this._activeContentIds;if(!this.config.containerId){return}var a=$(this.config.containerId);Event.observe(a,"mouseout",this.mouseOutContainer.bindAsEventListener(this));Event.observe(a,"mouseover",this.mouseOverContainer.bindAsEventListener(this))};apple.widget.ContentSwitcher.prototype.findInitialActiveButton=function(){if(this.config.overviewId){return undefined}for(var e in this.config.buttons){var b=$(e);var d=this.config.buttons[e];if(!b||!d){continue}var a=Element.regexForClassName(this.config.activeContentClass);if(a.test(b.className)){return e}function c(g){var f=$(g);return a.test(b.className)}if(this.nodesById(d).some(c,this)){return e}}return undefined};apple.widget.ContentSwitcher.prototype.reset=function(){if(this._activeButtonId==this._initialActiveButton){return}this.activateButton(this._initialActiveButton);this.activateContent(this._initialActiveContentIds)};apple.widget.ContentSwitcher.prototype.activateButton=function(b){var a;if(this._activeButtonId){a=$(this._activeButtonId);Element.addClassName(a,this.config.inactiveButtonClass);Element.removeClassName(a,this.config.activeButtonClass)}this._activeButtonId=b;if(!b){return}a=$(b);Element.removeClassName(a,this.config.inactiveButtonClass);Element.addClassName(a,this.config.activeButtonClass)};apple.widget.ContentSwitcher.prototype.activateContent=function(a){var c=this._activeContentIds||[];var f=a||[];var e=this.nodesById(c);var b=this.nodesById(f);function d(h){this.beforeHideContent(h.id);Element.removeClassName(h,this.config.activeContentClass);Element.addClassName(h,this.config.inactiveContentClass)}function g(h){this.beforeShowContent(h.id);Element.removeClassName(h,this.config.inactiveContentClass);Element.addClassName(h,this.config.activeContentClass)}e.forEach(d,this);b.forEach(g,this);this._activeContentIds=(a||[]);this.config.transition.swap(e,b);c.forEach(this.afterHideContent,this);f.forEach(this.afterShowContent,this)};apple.widget.ContentSwitcher.prototype.findTarget=function(a){if(!a){return a}while(!a.id&&"body"!=a.nodeName){a=a.parentNode}if(!a.id){return null}return a};apple.widget.ContentSwitcher.prototype.mouseOverButton=function(b){var d=this.findTarget(Event.fixEvent(b).target);if(!d){return}var e=this.config.buttons[d.id];var a;if(!e||e==this._activeContentId){return}function c(){this.activateButton(d.id);this.activateContent(e)}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this._activateTimer=window.setTimeout(c.bind(this),this.config.hoverDelay)};apple.widget.ContentSwitcher.prototype.mouseOutButton=function(b){b=Event.fixEvent(b);var c=this.findTarget(b.currentTarget);if(!c){return}var a=b.relatedTarget;while(a&&a!=c&&a.nodeName!="body"){a=a.parentNode}if(a==c){return}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this._activateTimer=null};apple.widget.ContentSwitcher.prototype.mouseOverContainer=function(a){var b=Event.fixEvent(a).target};apple.widget.ContentSwitcher.prototype.mouseOutContainer=function(b){b=Event.fixEvent(b);var c=b.currentTarget;if(!c){return}if(!this.config.overviewId){return}var a=b.relatedTarget;while(a&&a!=c&&a.nodeName!="body"){a=a.parentNode}if(a==c){return}this.activateContent([this.config.overviewId]);this.activateButton(null)};apple.widget.ContentSwitcher.prototype.buttonClicked=function(c){var d=this.findTarget(Event.fixEvent(c).target);if(!d){return}var a=this.config.buttons[d.id];var b;if(!a||d.id==this._activeButtonId){return}if(this._activateTimer){window.clearTimeout(this._activateTimer)}this.activateButton(d.id);this.activateContent(a);Event.stop(c)};apple.widget.ContentSwitcher.prototype.beforeShowContent=function(a){};apple.widget.ContentSwitcher.prototype.beforeHideContent=function(a){};apple.widget.ContentSwitcher.prototype.afterShowContent=function(a){};apple.widget.ContentSwitcher.prototype.afterHideContent=function(a){};Package("apple.widget");apple.widget.CrossFader=Class.create(coherent.View,{exposedBindings:["locked"],paused:false,timer:null,selectedIndex:null,items:PartList("div.slide"),indicator:coherent.ListView("div.indicator",{contentBinding:"indicatorContent",selectedIndexBinding:"selectedIndex",enabledBinding:"locked(NOT)",innerHTML:'<span tabindex="0"></span>'}),previousButton:coherent.Anchor("a.previous",{action:"showPreviousItem"}),nextButton:coherent.Anchor("a.next",{action:"showNextItem"}),init:function(){var c=this.items();var a=c.length;var b=this.viewElement();this.setValueForKey(false,"locked");this.setValueForKey(0,"selectedIndex");Element.addClassName(c[0],"faded_in");if(a<2){if(Element.query(b,"div.pagination")){Element.query(b,"div.pagination").style.display="none"}return}for(var d=1;d<a;d++){Element.addClassName(c[d],"faded_out")}if(this.indicator){var e=this.items().map(function(g,f){return{value:"Item "+(f+1)}});this.setValueForKey(coherent.KVO.adapt(e),"indicatorContent");this.addObserverForKeyPath(this,this.observeSelectedIndexChange,"selectedIndex")}Event.observe(b,"mouseover",this.pause.bindAsEventListener(this));Event.observe(b,"mouseout",this.resume.bindAsEventListener(this));this.resume()},observeSelectedIndexChange:function(a){if(this.locked){return}this.switchItems(a.oldValue,a.newValue,250)},showPreviousItem:function(d){if((typeof(d)==="undefined"&&this.paused)||this.locked){return}var c;if(typeof(d)!=="undefined"){c=250}var b=this.selectedIndex;var a;if(b===0){a=this.items().length-1}else{a=b-1}this.switchItems(b,a,c)},showNextItem:function(d){if((typeof(d)==="undefined"&&this.paused)||this.locked){return}var c;if(typeof(d)!=="undefined"){c=250}var b=this.selectedIndex;var a;if(b==this.items().length-1){a=0}else{a=b+1}this.switchItems(b,a,c)},switchItems:function(e,d,c){c=c||apple.widget.CrossFader.FADE_DURATION;if(this.timer){window.clearTimeout(this.timer);this.timer=null}var a=this;function b(){a.setValueForKey(d,"selectedIndex");a.setValueForKey(false,"locked");a.resume()}this.setValueForKey(true,"locked");Element.replaceClassName(this.items(e),"faded_in","fading_out");coherent.Animator.replaceClassName(this.items(e),"fading_out","faded_out",{duration:c,only:["opacity"],discreteTransitionPoint:1});Element.replaceClassName(this.items(d),"faded_out","fading_in");coherent.Animator.replaceClassName(this.items(d),"fading_in","faded_in",{duration:c,only:["opacity"],discreteTransitionPoint:1,callback:b})},pause:function(a){this.paused=true;if(this.timer){window.clearTimeout(this.timer)}this.timer=null},resume:function(a){if(a){this.paused=false}if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.showNextItem.bind(this),apple.widget.CrossFader.SLIDE_DELAY)}});apple.widget.CrossFader.SLIDE_DELAY=6000;apple.widget.CrossFader.FADE_DURATION=750;Package("apple");apple.Dialog=Class.create({constructor:function(a){this.createOverlay()},createOverlay:function(){var a=document.createElement("div");a.className="overlay";document.body.appendChild(a);this.overlay=new coherent.Overlay(a)}});Package("apple.widget");apple.widget.EmailSubscription=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.EmailSubscription,apple.widget.BaseWidget);var ServerStatus={good:"SUCCESS",bad:"ERROR",busy:"BUSY",off:"OFF",on:"ON",format:"FORMAT"};apple.widget.EmailSubscription.DEFAULTS={emailPlaceholder:"example: user@example.com",submitUrl:"email-server-reply.txt",urlArgs:{},argName:"emailAddress",emailFieldSpec:"input.notify_email",submitButtonSpec:".notify_submit",formSpec:"form",fadeDuration:350,showForm:{SUCCESS:false,ERROR:false,BUSY:false,ON:true,OFF:false,FORMAT:true},loadingClass:"loading",rpcTimeout:10000,emailRegex:/^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,4}$/i};apple.widget.EmailSubscription.prototype.init=function(){var f={duration:this.config.fadeDuration};this._animator=new apple.fx.Animator(f);this.setStatus("OFF");this.setStatus("ON");var b=this.part(this.config.formSpec);var e=this.part(this.config.emailFieldSpec);var a={placeholder:this.config.emailPlaceholder};this._field=new apple.widget.TextField(e.id,a);var d=this.part(this.config.submitButtonSpec);var c=this.submitHandler.bindAsEventListener(this);Event.observe(d,"click",c);Event.observe(b,"submit",c)};apple.widget.EmailSubscription.prototype.partSpecForStatus=function(a){return"div.notify_"+(a||"").toLowerCase()};apple.widget.EmailSubscription.prototype.setStatus=function(g,j,l){g=g||"ERROR";if(g==this._status){return}var f=this.widget();var a=this.part(this.config.formSpec);var b=this.config.showForm[this._status];var k=this.config.showForm[g];var h=this.part(this.partSpecForStatus(this._status));var i=this.part(this.partSpecForStatus(g));if(!this._status){a.style.display=k?"block":"none";i.style.display="block";this._status=g;return}if(l){a.style.display=k?"block":"none";i.style.display="block";h.style.display="none";this._status=g;return}var c=new apple.fx.Fade(apple.fx.linearTween,h,1,0);var e=new apple.fx.Fade(apple.fx.linearTween,i,0,1);var m;var d=[c,e];if(b!=k){if(k){m=new apple.fx.Fade(apple.fx.linearTween,a,0,1);d=[c,new apple.fx.Blend(e,m)]}else{m=new apple.fx.Fade(apple.fx.linearTween,a,1,0);d=[new apple.fx.Blend(c,m),e]}}this._status=g;this._animator.play(new apple.fx.Chain(d),j)};apple.widget.EmailSubscription.prototype.rpc=function(d,g,c){if(-1!=d.indexOf("?")){d=d+"&"}else{d=d+"?"}d+="bustCache="+(new Date()).getTime().toString(16)+":"+Math.random();var f;var b=document.createElement("script");b.src=d;function a(){window.clearTimeout(f);f=null;if(g){g.apply(window,arguments)}}function e(){window.signalStatus=function(){};if(c){c()}}window.signalStatus=a;f=window.setTimeout(e,this.config.rpcTimeout);document.getElementsByTagName("HEAD")[0].appendChild(b)};apple.widget.EmailSubscription.prototype.submitHandler=function(e){(e.target||e.srcElement).blur();Event.stop(e);var g=this.widget();var h=this.part(this.config.emailFieldSpec);if(!h||!this.config.submitUrl){return}var f=h.value||"";if(!f.match(this.config.emailRegex)){this.setStatus("FORMAT");h.focus();h.select();return}Element.addClassName(g,this.config.loadingClass);function d(){Element.removeClassName(g,this.config.loadingClass)}function a(j){j=j.replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();var i=ServerStatus[j];this.setStatus(i,d.bind(this))}var c=Object.applyDefaults({},this.config.urlArgs);c[this.config.argName]=f;var b=[this.config.submitUrl,Object.toQueryString(c)].join("?");this.rpc(b,a.bind(this),a.bind(this,"busy"))};Package("apple.widget");apple.widget.Engraver=function(a){this.config=a;this.timer=null};apple.widget.Engraver.DEFAULT_DELAY=1000;apple.widget.Engraver.prototype.validateConfig=function(){if(!this.config){return false}var a=this.getTextFields();if(!a){return false}for(var b=0;b<a.length;b++){if(!a[b]){return false}}if(!this.getEngraveImage()){return false}return true};apple.widget.Engraver.prototype.connectEvents=function(){if(!this.attachedEvents){if(!this.validateConfig()){return}function a(c){var b=this.getTextFields();for(var d=0;d<b.length;d++){var e=$(b[d]);e.setAttribute("autocomplete","off");Event.observe(e,"onkeyup",(function(f){this.valueChanged(f)}).bind(this));Event.observe(e,"onchange",(function(f){this.valueChanged(f)}).bind(this));Event.observe(e,"drop",(function(f){this.valueChanged(f)}).bind(this));Event.observe(e,"dragdrop",(function(f){this.valueChanged(f)}).bind(this));Event.observe(e,"onfocus",(function(f){this.valueChanged(f)}).bind(this))}}Event.onDomReady(a.bind(this));this.attachedEvents=true}};apple.widget.Engraver.prototype.valueChanged=function(a){if(this.timer){window.clearTimeout(this.timer)}this.timer=window.setTimeout(this.engrave.bind(this),this.getDelay())};apple.widget.Engraver.prototype.getTextFields=function(){return this.config.textFields};apple.widget.Engraver.prototype.getEngraveImage=function(){return this.config.engraveImageId};apple.widget.Engraver.prototype.getBaseUrl=function(){return this.config.baseUrl};apple.widget.Engraver.prototype.getDelay=function(){if(this.config.delay){return parseInt(this.config.delay,10)}return apple.widget.Engraver.DEFAULT_DELAY};apple.widget.Engraver.prototype.engrave=function(){var h=$(this.getEngraveImage()),e=this.getBaseUrl(),a=this.getTextFields(),g=e.indexOf("?"),d=g>=0,f=(e.length>g+1);if(!d){e+="?"}var b=true;for(var c=0;c<a.length;c++){if($(a[c]).value!==""){b=false;break}}for(c=0;c<a.length;c++){e+=f?"&":"";f=true;e+=this.getLineArgument($(a[c]).value,c)}if(h){h.setAttribute("src",e)}};apple.widget.Engraver.prototype.getLineArgument=function(c,b){c=this.encode(c);var a="th";if(b%2==1){a="tl"}return a+"="+c};apple.widget.Engraver.prototype.encode=function(b){try{return encodeURIComponent(b)}catch(a){return escape(b)}};Package("apple.widget");apple.widget.FormFormatter=function(a){var b=".user-form-block .field-with-placeholder > input";this.init(b)};Object.extend(apple.widget.FormFormatter.prototype,{inlineBlockCompensation:4,init:function(a){var b=this.gatherRows(a);this.parseRows(b)},gatherRows:function(a){var c=Element.queryAll(a),b=[];c.forEach(function(d){b.push(d.parentNode.parentNode)});return b.distinct()},parseRows:function(b){var a,c;b.forEach(function(d){a=Element.queryAll(d,"> *");a=this.parseChildren(a);a.adjustable=this.determineRelativeFlexFields(a.adjustable);this.formatRow(d,a)}.bind(this));return c},parseChildren:function(b){var d={adjustable:[],nonadjustable:[]},a,c;b.forEach(function(e){a=Element.getDimensions(e).width;if(a===0&&!this.isEmptyNode(e)){a=this.unhideAndCalculate(e)}if(this.isChildATextField(e)){Element.addClassName(e,"text-input")}c=(this.isChildATextField(e)&&!this.isFieldWidthDeclared(e))?d.adjustable:d.nonadjustable;c.push({node:e,width:a})}.bind(this));return d},determineRelativeFlexFields:function(f){var d=f.length,h=[],c=0,g,e=0,b=0;if(d===1){f[0].relativeWidth=1}else{f.forEach(function(i){g=Element.query(i.node,"input");c=g.maxLength;h.push(c);e=e+c});for(var a=0;a<d;a++){b=Math.round((h[a]/e)*100);b=b/100;f[a].relativeWidth=b}}return f},formatRow:function(h,d){var a=Element.getDimensions(h).width,f=0,b=0,e=0,g=0,c=0;if(a===0){a=this.unhideAndCalculate(h)}d.nonadjustable.forEach(function(i){b=b+i.width});e=a-b;d.adjustable.forEach(function(i){c=Math.round((i.relativeWidth*e)-this.inlineBlockCompensation);Element.setStyle(i.node,"width",c+"px")}.bind(this))},isChildATextField:function(c){var a=Element.query(c,"input[type=text]"),b=Element.query(c,"input[type=password]");return(a||b)?true:false},isFieldWidthDeclared:function(d){var a=Element.getDimensions(d).width,c=0,b=Element.getStyle(d,"minWidth");if(a===0){a=this.unhideAndCalculate(d)}d.style.width="auto";if(b!="0px"){d.style.minWidth=0}c=Element.getDimensions(d).width;if(c===0){c=this.unhideAndCalculate(d)}d.style.width=a+"px";if(b!="0px"){d.style.minWidth=b}return(a==c)?false:true},isEmptyNode:function(a){return(a.innerHTML==="")?true:false},unhideAndCalculate:function(c){var a=this.findHiddenParent(c),b=0;if(a){a.style.display="block";b=Element.getDimensions(c).width;a.style.display="none"}return b},findHiddenParent:function(b){var a=b.parentNode,c;if(a==document||!a){return false}if(a.style){c=a.style.display}return(c=="none")?a:this.findHiddenParent(a)}});Package("apple.widget");apple.widget.FormSubmitter=function(a){this.config=a;Event.onDomReady(this.init.bind(this))};apple.widget.FormSubmitter.prototype.init=function(){if(this._initialized){return}Event.observe(this.getForm(),"onsubmit",(function(a){this.formHandler(a)}).bind(this));Event.observe(this.getSubmit(),"onclick",(function(a){this.submitHandler(a)}).bind(this));this._initialized=true};apple.widget.FormSubmitter.prototype.getForm=function(){return $(this.config.formId)?$(this.config.formId):document.forms[this.config.formId]};apple.widget.FormSubmitter.prototype.getSubmit=function(){return $(this.config.submitId)};apple.widget.FormSubmitter.prototype.formHandler=function(a){return true};apple.widget.FormSubmitter.prototype.submitHandler=function(a){return true};apple.widget.SelectLinkFormSubmitter=apple.widget.FormSubmitter;apple.widget.SelectLinkFormSubmitter.prototype.getSelect=function(){return $(this.config.selectId)};apple.widget.SelectLinkFormSubmitter.prototype.formHandler=function(b){var c=this.getForm();var a=this.getSelect();if(c&&a&&a.options&&a.options[a.selectedIndex].value){c.action=a.options[a.selectedIndex].value}return true};Package("apple.widget");apple.widget.Gallery=function(a){this.config=a;this.index=0;if(!this.config.initial){this.config.initial=this.getTypeImage()}this.setMediaType(this.config.initial);this.setShowingAlt(false);this.setupImages();this.setupMovies();this.setupFX()};apple.widget.Gallery.FX_NONE=0;apple.widget.Gallery.FX_PAN=1;apple.widget.Gallery.FX_FADE=2;apple.widget.Gallery.TYPE_IMAGE=100;apple.widget.Gallery.TYPE_MOVIE=101;apple.widget.Gallery.prototype.getFxNone=function(){return apple.widget.Gallery.FX_NONE};apple.widget.Gallery.prototype.getFxPan=function(){return apple.widget.Gallery.FX_PAN};apple.widget.Gallery.prototype.getFxFade=function(){return apple.widget.Gallery.FX_FADE};apple.widget.Gallery.prototype.getTypeImage=function(){return apple.widget.Gallery.TYPE_IMAGE};apple.widget.Gallery.prototype.getTypeMovie=function(){return apple.widget.Gallery.TYPE_MOVIE};apple.widget.Gallery.prototype.setupImages=function(){if(!this.hasImages()){return}function d(f){c[f]++;window.setTimeout(e.bind(null,f),10)}function e(i){function h(){b[g][i+"Image"]=j;if(!l){return}window.clearTimeout(l);d(i)}function f(){l=0;window.clearTimeout(l);d(i)}var l=0;var g=c[i];if(g>=a){return}var k=b[g][i];if(!k){d(i);return}var j=new Image();j.onload=h;j.src=k;l=window.setTimeout(f,2000)}var c={thumb:0,full:0};var b=this.config.images;var a=b.length;e("thumb");e("full")};apple.widget.Gallery.prototype.setupMovies=function(){if(this.hasMovies()){if(!this.config.movie.full){this.config.movie.full={}}if(!this.config.movie.full.elementId){this.config.movie.full.elementId=Element.uniqueId()}for(var c=0;c<this.config.movies.length;c++){if(this.config.movies[c].thumb){var d=new Image();d.src=this.config.movies[c].thumb;this.config.movies[c].thumbImage=d}if(this.config.movies[c].full){var a=this.config.movies[c];var b=this.findIdName(a.full);if(!b){b=this.config.movie.full.elementId+c;a.full.push("id");a.full.push(b)}a.elementId=b;a.full.push("enablejavascript");a.full.push("true");var e=new apple.quicktime.QuickTime(a.full);a.xml=e.generateOBJECTTextXHTML()}}}};apple.widget.Gallery.prototype.setupFX=function(){if(this.config.fade){this.fader=new apple.fx.CrossFade(this.config.fade.speed,this.config.fade.increment)}if(this.config.swoosh){this.swoosher=new apple.fx.Swoosh(this.config.viewer.elementId,this.config.swoosh.speed,this.config.swoosh.increment)}};apple.widget.Gallery.prototype.next=function(){if(this.isShowingImage()){this._showImage(this.index+1,this.getFxPan())}else{this._showMovie(this.index+1,this.getFxNone())}};apple.widget.Gallery.prototype.previous=function(){if(this.isShowingImage()){this._showImage(this.index-1,this.getFxPan())}else{this._showMovie(this.index-1,this.getFxNone())}};apple.widget.Gallery.prototype.image=function(a){if(!this.isShowingImage()){this.swapMedia()}this._showImage(a,this.getFxFade())};apple.widget.Gallery.prototype.movie=function(a){if(!this.isShowingMovie()){this.swapMedia()}this._showMovie(a,this.getFxNone())};apple.widget.Gallery.prototype.hasImages=function(){return this.config.images&&this.config.images.length};apple.widget.Gallery.prototype.hasMovies=function(){return this.config.movies&&this.config.movies.length};apple.widget.Gallery.prototype.isShowingImage=function(){return(this.mediaType==this.getTypeImage())};apple.widget.Gallery.prototype.isShowingMovie=function(){return(this.mediaType==this.getTypeMovie())};apple.widget.Gallery.prototype.setMediaType=function(a){this.mediaType=a};apple.widget.Gallery.prototype.swapMedia=function(){this.stopAnimations();var a=this.getMovieElement();var b=this.getActiveImage();if(this.isShowingImage()){Element.hide(b);a.innerHTML="";Element.show(a);this.changeThumbImageState(this.getTypeImage(),this.index,-1);this.setMediaType(this.getTypeMovie())}else{Element.show(b);a.innerHTML="";Element.hide(a);this.changeThumbImageState(this.getTypeMovie(),this.index,-1);this.setMediaType(this.getTypeImage())}this.index=-1};apple.widget.Gallery.prototype._showMovie=function(a,d){if(a==this.index){return}if(!this.hasMovies()){return}var f=this.index;if(a>=this.config.movies.length){a=0}else{if(a<0){a=this.config.movies.length-1}}this.changeThumbImageState(this.getTypeMovie(),f,a);this.stopAnimations();var b=this.getMovieElement();Element.hide(b);try{var e=null;if(f>=0){e=$(this.config.movies[f].elementId)}if(e){e.Stop();Element.hide(e);while(b.hasChildNodes()){b.removeChild(b.firstChild)}b.innerHTML=""}}catch(c){b.innerHTML=""}b.innerHTML=this.config.movies[a].xml;Element.show(b);this.index=a};apple.widget.Gallery.prototype._showImage=function(a,c){if(a==this.index){return}if(!this.hasImages()){return}var d=this.index;var b=(a>=d);if(a>=this.config.images.length){a=0}else{if(a<0){a=this.config.images.length-1}}this.changeThumbImageState(this.getTypeImage(),this.index,a);this.stopAnimations();if(c==this.getFxFade()){if(this.fader){this.fadeImage(this.config.images[a])}else{this.getActiveImage().src=this.config.images[a].fullImage.src;this.getActiveImage().alt=this.config.images[a].alt}}else{if(c==this.getFxPan()){if(this.swoosher){this.panImage(b,this.config.images[a])}else{this.getActiveImage().src=this.config.images[a].fullImage.src;this.getActiveImage().src=this.config.images[a].alt}}}this.index=a};apple.widget.Gallery.prototype.getActiveImage=function(){if(this.isShowingAlt()){return this.getAltFullImage()}else{return this.getFullImage()}};apple.widget.Gallery.prototype.stopAnimations=function(){if(this.fader){this.fader.stopAnimation()}if(this.swoosher){this.swoosher.stopAnimation()}};apple.widget.Gallery.prototype.isShowingAlt=function(){return this.showingAlt};apple.widget.Gallery.prototype.setShowingAlt=function(a){return this.showingAlt=a};apple.widget.Gallery.prototype._resetImages=function(b,a){Element.setOpacity(b,1);Element.setOpacity(a,1)};apple.widget.Gallery.prototype.fadeImage=function(c){var b=!this.isShowingAlt();this.setShowingAlt(b);var d=null;var a=null;if(b){d=this.getFullImage();a=this.getAltFullImage()}else{d=this.getAltFullImage();a=this.getFullImage()}a.src=c.fullImage.src;a.alt=c.alt;this._resetImages(d,a);this.fader.fade(d,a)};apple.widget.Gallery.prototype.panImage=function(b,d){var c=!this.isShowingAlt();this.setShowingAlt(c);var e=null;var a=null;if(c){e=this.getFullImage();a=this.getAltFullImage()}else{e=this.getAltFullImage();a=this.getFullImage()}a.src=d.fullImage.src;a.alt=d.alt;this._resetImages(e,a);this.swoosher.pan(b,e,a)};apple.widget.Gallery.prototype.changeThumbImageState=function(d,c,a){var b=this.getThumbAnchor(d,c);var e=this.getThumbAnchor(d,a);if(b){b.className=this.config.image.thumb.cssClass}if(e){e.className=this.config.image.thumb.cssActiveClass}};apple.widget.Gallery.prototype.getFullImage=function(){return $(this.config.image.full.elementId)};apple.widget.Gallery.prototype.getAltFullImage=function(){var a=this.config.image.full.elementId+"Alt";var b=$(a);if(!b){var c=this.getFullImage();b=c.cloneNode(false);b.id=a;var d=this.getViewer();d.appendChild(b)}return b};apple.widget.Gallery.prototype.getMovieElement=function(){var a=this.config.movie.full.elementId;var b=$(a);if(!b){b=document.createElement("div");b.id=a;Element.setStyle(b,"position","absolute");Element.setStyle(b,"display","block");Element.setStyle(b,"left","0px");Element.setStyle(b,"top","0px");var c=this.getViewer();c.appendChild(b)}return b};apple.widget.Gallery.prototype.getViewer=function(){return $(this.config.viewer.elementId)};apple.widget.Gallery.prototype.getThumbAnchorId=function(b,a){var c=null;if(b==this.getTypeImage()){c=this.config.image.thumb.elementId+a}else{c=this.config.movie.thumb.elementId+a}return c};apple.widget.Gallery.prototype.getThumbAnchor=function(b,a){return $(this.getThumbAnchorId(b,a))};apple.widget.Gallery.prototype.getThumbImage=function(b,a){var c=null;if(b==this.getTypeImage()){c=this.config.images[a].thumbImage}else{c=this.config.movies[a].thumbImage}return c};apple.widget.Gallery.prototype.outputImageThumbs=function(){if(this.hasImages()){var b=null;b=$(this.config.image.thumb.elementId);for(var a=0;a<this.config.images.length;a++){var c=new apple.widget.Gallery.ClickWrapper(this,a,this.getTypeImage());this.createThumb(b,this.getThumbAnchorId(this.getTypeImage(),a),this.config.images[a].thumbImage.src,false,this.config.image.thumb,c)}if(this.isShowingImage()){this.index=-1;this._showImage(0,this.getFxNone())}}};apple.widget.Gallery.prototype.outputMovieThumbs=function(){if(this.hasMovies()){var b=null;b=$(this.config.movie.thumb.elementId);for(var a=0;a<this.config.movies.length;a++){var c=new apple.widget.Gallery.ClickWrapper(this,a,this.getTypeMovie());this.createThumb(b,this.getThumbAnchorId(this.getTypeMovie(),a),this.config.movies[a].thumbImage.src,false,this.config.movie.thumb,c)}if(this.isShowingMovie()){this.index=-1;this._showMovie(0,this.getFxNone())}}};apple.widget.Gallery.prototype.createThumb=function(d,h,g,c,b,e){var a=this.createAnchorNode(h,c,b.cssActiveClass,b.cssClass);a.onclick=function(){e.onClick()};var f=this.createImageNode(g,b.width,b.height);a.appendChild(f);d.appendChild(a)};apple.widget.Gallery.prototype.createImageNode=function(d,b,a){var c=document.createElement("img");Element.setStyle(c,"height",a+"px");Element.setStyle(c,"width",b+"px");c.src=d;return c};apple.widget.Gallery.prototype.createAnchorNode=function(e,c,b,d){var a=document.createElement("a");a.id=e;if(c){if(b){a.className=b}}else{if(d){a.className=d}}return a};apple.widget.Gallery.prototype.findIdName=function(b){for(var a=0;a<b.length;a+=2){var c=b[a].toLowerCase();var d=b[a+1];if("name"==c||"id"==c){return d}}return null};apple.widget.Gallery.ClickWrapper=function(a,b,c){this.gallery=a;this.index=b;this.type=c};apple.widget.Gallery.ClickWrapper.prototype.onClick=function(){if(this.type==this.gallery.getTypeImage()){this.gallery.image(this.index)}else{this.gallery.movie(this.index)}};Package("apple.widget");apple.widget.Gallery2=function(a){this.base("constructor")(a);this._groupThumbs={};this._activeGroup=0;this._imageId=[];this._activeImageIndex=0;this._quicktimeInstalled=false;this._loadedImages={};this._mediaClass=null;this._mediaType=null};apple.util.makeSubclass(apple.widget.Gallery2,apple.widget.BaseWidget);apple.widget.Gallery2.DEFAULTS={activeClass:"active",disabledClass:"disabled",imageClass:"image",mediaClass:"media",movieClass:"movie",thumbGroupClass:"thumbnails",thumbMouseOver:false,allowWrapping:true,movieFirstFrame:{pattern:/\.m[o|4]v$/,replace:"-first.jpg"},moviePosterFrame:{pattern:/\.m[o|4]v$/,replace:".jpg"}};apple.widget.Gallery2.prototype.cssClassRegex=/css-class\((.*?)\)/;apple.widget.Gallery2.prototype.movieRegex=/\.m[o|4]v$/;apple.widget.Gallery2.prototype.jsvrRegex=/jsvr$/;apple.widget.Gallery2.RIGHT="right";apple.widget.Gallery2.LEFT="left";apple.widget.Gallery2.FADE="";apple.widget.Gallery2.prototype.init=function(){var i=$(this.config.galleryId);if(!i){return}this._quicktimeInstalled=apple.quicktime.isInstalled();this._mediaClass=this.config.imageClass;Element.addClassName(i,this.config.imageClass);Element.removeClassName(i,this.config.movieClass);var b=Element.queryAll(i,"."+this.config.mediaClass)[0];if(!b){return}this._mediaId=Element.assignId(b);var g={id:this._mediaId,duration:400};this._swapper=new apple.fx.ContentSwapper(g);function a(){var j=document.createElement("div");var k=document.createElement("img");j.appendChild(k);k.style.position="absolute";k.style.left="50%";k.style.top="50%";j.style.position="absolute";j.style.left="0";j.style.top="0";j.style.width="100%";j.style.height="100%";j.style.display="none";j.style.zIndex="2";b.appendChild(j);return j}var e=b.getElementsByTagName("img")[0];var h=e.src;e.parentNode.removeChild(e);e=a();this._imageId[0]=Element.assignId(e);this._setImage(0,h,this.config.imageClass);e.style.display="";e=a();this._imageId[1]=Element.assignId(e);if(this.config.jsvrOptions){this._createVrContainer(this.config.jsvrOptions);this._sampleVrImage(this.config.jsvrOptions)}this._createNavigation(i);var f=this.thumbClicked.bindAsEventListener(this);function d(m,l){var k=m.getElementsByTagName("a");function j(o){var p=Element.assignId(o);var n=o.href;if(n==h){this._activeThumbId=p;this._activeGroup=l;Element.addClassName(o,this.config.activeClass)}else{Element.removeClassName(o,this.config.activeClass)}o._groupIndex=l;this._groupThumbs[l].push(p);if(!n.match(this.movieRegex)){return}if(!this._quicktimeInstalled){n=n.replace(this.config.moviePosterFrame.pattern,this.config.moviePosterFrame.replace);o.href=this._movieFrameSrc(o,this.config.moviePosterFrame)}}Event.observe(m,"click",f);this._groupThumbs[l]=[];Array.forEach(k,j,this)}var c=Element.queryAll(i,"."+this.config.thumbGroupClass);Array.forEach(c,d,this);Event.observe(i,"mousedown",this.mouseDown.bindAsEventListener(this));this._updateNavigation()};apple.widget.Gallery2.prototype._setImage=function(a,g,d,h){function c(){this._mediaSize={width:f.width,height:f.height};if(!("devicePixelRatio" in window&&window.devicePixelRatio>1)){e.width=f.width;e.height=f.height}e.src=g;e.style.marginTop=-(f.height/2)+"px";e.style.marginLeft=-(f.width/2)+"px";if(h){h.call(this)}}var b=$(this._imageId[a]);var e=b.firstChild;var f=new Image();b.className=d||"";f.onload=c.bind(this);f.src=g};apple.widget.Gallery2.prototype._updateMediaClass=function(b){if(b==this._mediaClass){return}var a=$(this.config.galleryId);Element.addClassName(a,b);Element.removeClassName(a,this._mediaClass);this._mediaClass=b};apple.widget.Gallery2.prototype._createNavigation=function(c){var b;b=document.createElement("a");b.className="prev";b.href="#";b.onclick=this.prevButtonClicked.bindAsEventListener(this);this._prevButtonId=Element.assignId(b);c.appendChild(b);b=document.createElement("a");b.className="next";b.href="#";b.onclick=this.nextButtonClicked.bindAsEventListener(this);this._nextButtonId=Element.assignId(b);c.appendChild(b)};apple.widget.Gallery2.prototype._getMovie=function(){return $(this._movieId)};apple.widget.Gallery2.prototype._hideMovie=function(){var a=this._getMovie();if(a&&!this._playingMovie&&apple.quicktime.mobileSafari){a.parentNode.removeChild(a);return}if(!this._movieController){return}a.parentNode.style.backgroundImage="";this._movieController.hideMovie();var b=a.parentNode};apple.widget.Gallery2.prototype._movieLoaded=function(b){var a=$(this.config.galleryId);this._updateMediaClass(this._mediaType);var c=$(this._imageId[this._activeImageIndex]);var d=b.parentNode;d.className=this._mediaType;b.parentNode.style.backgroundImage="url("+c.firstChild.src+")";this._movieController.showMovie(this._mediaSize.width,this._mediaSize.height);c.style.display="none";this._movieController.play()};apple.widget.Gallery2.prototype._movieFrameSrc=function(c,d){d=d||this.config.movieFirstFrame;var b=$(c);if(!b){return""}var e=this._stripFolder(b.href);var g=b.getElementsByTagName("img")[0];if(!g){return""}var f=g.src;var a=f.lastIndexOf("/");if(-1==a){return""}f=[f.substr(0,a),e].join("/");return f.replace(d.pattern,d.replace)};apple.widget.Gallery2.prototype._stripFolder=function(b){var a=b.lastIndexOf("/");if(-1==a){return b}return b.substr(a+1)};apple.widget.Gallery2.prototype._playMovie=function(c,e){var b=apple.quicktime.mobileSafari?this.config.moviePosterFrame:this.config.movieFirstFrame;var a=this._movieFrameSrc(this._activeThumbId,b);function d(){var f=this._getMovie();if(coherent.Browser.Safari||apple.quicktime.mobileSafari||!f){this._createMovie(c);return}this._movieController.hideMovie();this._movieController.loadMovie(c)}this._swapImages(a,e,d.bind(this))};apple.widget.Gallery2.prototype._showVr=function(a){if(!this.vr){this._positionVrContainer(a);this.vr=new apple.VR(a)}this.vrContainer.style.display="block";this._updateMediaClass(this._mediaType);var b=$(this._imageId[this._activeImageIndex]);b.style.display="none"};apple.widget.Gallery2.prototype._hideVr=function(a){if(this.vrContainer){this.vrContainer.style.display="none"}};apple.widget.Gallery2.prototype._createVrContainer=function(a){this.vrContainer=document.createElement("div");this.vrContainer.id=a.container;var b=$(this._mediaId);b.appendChild(this.vrContainer)};apple.widget.Gallery2.prototype._positionVrContainer=function(b){var a=(this.vrContainer.parentNode.offsetWidth-this.sampleVrImage.width)/2;var c=(this.vrContainer.parentNode.offsetHeight-this.sampleVrImage.height)/2;this.vrContainer.style.position="absolute";this.vrContainer.style.left=a+"px";this.vrContainer.style.top=c+"px";this.vrContainer.style.width=this.sampleVrImage.width+"px";this.vrContainer.style.height=this.sampleVrImage.height+"px"};apple.widget.Gallery2.prototype._sampleVrImage=function(a){var d=a.imagePath.match(/^([^#]*)(#+)([^#]*)$/);var c=d[2].length;var b="1";while(b.length<c){b="0"+b}var e=d[1]+b+d[3];this.sampleVrImage=new Image();this.sampleVrImage.src=e};apple.widget.Gallery2.prototype._createMovie=function(d){var f=$(this._mediaId);var e=document.createElement("div");var b;if(this._movieId){b=$(this._movieId);b.parentNode.removeChild(b)}f.appendChild(e);e.style.position="absolute";e.style.left="0";e.style.top="0";e.style.width="100%";e.style.height="100%";e.style.backgroundPosition="center center";e.style.backgroundRepeat="no-repeat";this._movieId=Element.uniqueId();var c={src:d,id:this._movieId,width:this.config.movieWidth,height:this.config.movieHeight,autoplay:false,bgcolor:this.config.movieBackground};b=apple.quicktime.createMovie(c,e);b.style.position="absolute";b.style.left="50%";b.style.top="50%";b.style.marginLeft=(-this._mediaSize.width/2)+"px";b.style.marginTop=(-this._mediaSize.height/2)+"px";if(apple.quicktime.mobileSafari){return $(this._movieId)}var a={movieId:this._movieId,onload:this._movieLoaded.bind(this)};this._movieController=new apple.widget.MovieController(this.config.controllerId,a);this._movieController.hideMovie();return $(this._movieId)};apple.widget.Gallery2.prototype._swapImages=function(c,f,h){var a=$(this.config.galleryId);var e=this._activeImageIndex?0:1;var d=$(this._imageId[this._activeImageIndex]);var g=$(this._imageId[e]);if(!d||!g){return}function b(){d.style.display="";this._activeImageIndex=e;this._hideVr();this._hideMovie();if(!this._playingMovie){this._updateMediaClass(this._mediaType)}this._swapper.swap(f,d,g,h)}if(this._movieController){this._movieController.stop()}g.style.display="none";this._setImage(e,c,this._mediaType,b)};apple.widget.Gallery2.prototype.showAsset=function(a,b){if(a.match(this.movieRegex)){this._playingMovie=true;this._playMovie(a,b)}else{if(a.match(this.jsvrRegex)){this._showVr(this.config.jsvrOptions)}else{this._playingMovie=false;this._swapImages(a,b)}}};apple.widget.Gallery2.prototype._updateNavigation=function(){var a=this._groupThumbs[this._activeGroup];var c=a.indexOf(this._activeThumbId);var b=$(this._prevButtonId);var d=$(this._nextButtonId);if(1==a.length){b.style.display="none";d.style.display="none";return}b.style.display="";d.style.display="";if(this.config.allowWrapping){return}if(!c){Element.addClassName(b,this.config.disabledClass)}else{Element.removeClassName(b,this.config.disabledClass)}if(a.length==c+1){Element.addClassName(d,this.config.disabledClass)}else{Element.removeClassName(d,this.config.disabledClass)}};apple.widget.Gallery2.prototype._activateThumb=function(d){var b;if(this._activeThumbId){b=$(this._activeThumbId);Element.removeClassName(b,this.config.activeClass)}this._activeThumbId=d;b=$(this._activeThumbId);Element.addClassName(b,this.config.activeClass);var c;var a=(b.rel||"");c=a.match(this.cssClassRegex);if(c&&c[1]){this._mediaType=c[1]}else{if(b.href.match(this.movieRegex)){this._mediaType=this.config.movieClass}else{this._mediaType=this.config.imageClass}}this._updateNavigation()};apple.widget.Gallery2.prototype.thumbClicked=function(c){var d=c.target||c.srcElement;var a=$(this.config.galleryId);Event.stop(c);while(d&&d!=a&&d.nodeName.toLowerCase()!="a"){d=d.parentNode}if(d==a){return}var b=d.href;if(!b){return}d.blur();if(this._activeThumbId==d.id){return}this._activeGroup=d._groupIndex;this._activateThumb(d.id);this.showAsset(b)};apple.widget.Gallery2.prototype.nextButtonClicked=function(e){var b=this._groupThumbs[this._activeGroup];var d=b.indexOf(this._activeThumbId);Event.stop(e);d++;if(!this.config.allowWrapping&&d==b.length){return}if(d==b.length){d=0}var a=b[d];var c=$(a).href;this._activateThumb(a);this.showAsset(c,apple.widget.Gallery2.LEFT)};apple.widget.Gallery2.prototype.prevButtonClicked=function(e){var b=this._groupThumbs[this._activeGroup];var d=b.indexOf(this._activeThumbId);Event.stop(e);d--;if(!this.config.allowWrapping&&d<0){return}if(d<0){d=b.length-1}var a=b[d];var c=$(a).href;this._activateThumb(a);this.showAsset(c,apple.widget.Gallery2.RIGHT)};apple.widget.Gallery2.prototype.mouseDown=function(b){var c=b.srcElement||b.target;var a=this._getMovie();if(c==a){return}Event.stop(b)};Package("apple.widget");apple.widget.HelpMessage=Class.create(coherent.Overlay,{__structure__:{},container:Part(".container"),content:Part(".content"),target:Part(".target"),innerHTML:'<div class="container"><table><tr class="t"><td class="l"><span></span></td><td class="m"><span></span></td><td class="r"><span></span></td></tr><tr class="m"><td class="l"></td><td class="msg"><div class="content"></div></td><td class="r"></td></tr><tr class="b"><td class="l"></td><td class="m"></td><td class="r"></td></tr></table><span class="target"></span></div>',containerAlign:"help-left",displaying:false,inTimeout:null,inTimeoutFor:250,shouldShow:true,helpClassName:"help-message",constructor:function(a,b,c){this.base(this.constructWrapper(a),b,c);this.__unposition()},constructWrapper:function(c){var b=("string"===typeof(c))?document.getElementById(c):c;this.srcElementId=Element.assignId(b);this.srcElement=b;var a=document.createElement("DIV");Element.assignId(a);Element.addClassName(a,this.helpClassName);document.body.appendChild(a);return a},init:function(){var b=this.getSrcElement(),c=this.viewElement(),d=this.content(),a=this.container();var e=Event.observe;e(b,"mouseover",this.__mouse.bindAsEventListener(this));e(b,"mouseout",this.__mouse.bindAsEventListener(this));e(b,"click",this.__mouse.bindAsEventListener(this));e(c,"mouseout",this.__mouse.bindAsEventListener(this));e(document.body,"touchstart",this.__touchstart.bindAsEventListener(this));e(window,"blur",this.__mouse.bindAsEventListener(this));this.transitionEndListener=this.__transitionEnd.bind(this)},getSrcElement:function(){return this.srcElement||document.getElementById(this.srcElementId)},__mouse:function(a){this.__clearDelay();this.inTimeout=this.toggle.bindAndDelay(this,this.inTimeoutFor,a.type,(a.relatedTarget||a.toTarget))},__touchstart:function(a){if(a.target.id!==this.srcElementId){this.__clearDelay();this.inTimeout=this.toggle.bindAndDelay(this,this.inTimeoutFor,a.type,a.target)}},__clearDelay:function(){window.clearTimeout(this.inTimeout);this.inTimeout=null},__loadContent:function(){var f=this.content(),b=this.container(),e=this.target(),g=document.getElementById(this.srcElementId),a,i,c,d,h;if(!this.loadedContent){i=document.getElementById(g.getAttribute("rel"));this.loadedContent="<p>This is the default help message. Maybe you need to setup the help message element?</p>";if(i){a=i.className;d=i.innerHTML;this.setContentWidth();this.shouldShow=true}else{this.shouldShow=false}f.innerHTML=d;c=g.cloneNode(true);c.id=null;c.onclick=null;c.removeAttribute("id");c.removeAttribute("onclick");e.innerHTML="";e.onclick='return apple.widget.HelpMessage.click("'+this.srcElementId+'");';e.appendChild(c);this.loadedContent=f.innerHTML}Element.addClassName(f,a);f.innerHTML=this.loadedContent;b.className="container";if(Element.hasClassName(g,"top")){Element.addClassName(b,"text-top")}else{Element.addClassName(b,"text-bottom")}if(Element.hasClassName(g,"left")){Element.addClassName(b,"text-left")}else{Element.addClassName(b,"text-right")}},setContentWidth:function(){var a=document.getElementById(this.srcElementId),b=document.getElementById(a.getAttribute("rel")),c=b.style.width;if(!c){c="200px"}Element.setStyle(this.content(),"width",c)},__position:function(){var e=this.viewElement(),g=this.container(),b=Element.getRect(g),a=document.getElementById(this.srcElementId),f=Element.getRect(a);var d=Element.query("#ac-gn-segmentbar"),c=0;var c=(d?d.offsetHeight:0);Element.setStyles(e,{top:(Element.hasClassName(a,"top")?f.bottom-c:f.top-c)+"px",left:(Element.hasClassName(a,"left")?f.right:f.left)+"px"})},__unposition:function(){var a=this.viewElement();Element.setStyles(a,{top:"-9000em",left:"",width:"",height:""})},__transitionEnd:function(){this.container().removeEventListener("webkitTransitionEnd",this.transitionEndListener,false);this.__unposition()},toggle:function(c,a){var b=this.viewElement(),d=a;switch(c){case"click":case"mouseover":if(this.displaying===true){return}this.display();break;case"touchstart":case"mouseout":case"blur":if(this.displaying!==true){return}do{if(d===b){return}}while((d=d&&d.parentNode));this.hide();return;default:break}},display:function(){var a=this.container();this.__loadContent();if(!this.shouldShow){return}this.__position();if((coherent.Browser.Safari||coherent.Browser.MobileSafari)&&typeof(WebKitTransitionEvent)!="undefined"){Element.addClassName(a,"show")}else{coherent.Animator.addClassName(a,"show",{duration:150})}apple.metrics.fireMicroEvent({feature:"help overlay",part:$(this.srcElementId).getAttribute("rel"),action:"show",eVar:"eVar21"});this.displaying=true;this.__clearDelay()},hide:function(){var b=this.viewElement(),a=this.container();coherent.Animator.removeClassName(a,"show",{duration:150,callback:this.__unposition.bind(this)});this.displaying=false;this.__clearDelay()}});apple.widget.HelpMessage.loadAll=function(a,c){if(arguments.length<2){c=a;a=null}function b(){var f=a?Element.queryAll(a,c):Element.queryAll(a),e=f.length,d,g;for(g=0;g<e;g++){d=coherent.View.fromNode(f[g]);if(d){d.teardown()}new apple.widget.HelpMessage(f[g])}}Event.onLoad(b)};apple.widget.HelpMessage.click=function(a){return($(a)||document.body).onclick()};Package("apple.widget");apple.widget.HoverManager=function(b,a){if(apple.widget.HoverManager.sharedManager){return apple.widget.HoverManager.sharedManager}apple.widget.HoverManager.sharedManager=this;a=Object.applyDefaults(a,arguments.callee.DEFAULTS);this.configs=b||[];this.hovers=[];this.activeHover=null;this._sourceClickedHandler=this.sourceClicked.bindAsEventListener(this);this._mouseOverHandler=this.mouseOver.bindAsEventListener(this);this._mouseOutHandler=this.mouseOut.bindAsEventListener(this);this._contentClicked=this.contentClicked.bindAsEventListener(this);this._behaviour=a.behaviour;this._showDelay=a.showDelay;this._hideDelay=a.hideDelay;Event.onDomReady(this.init.bind(this));return this};apple.widget.HoverManager.sharedManager=null;apple.widget.HoverManager.BEHAVIOUR={CLICK_OUTSIDE_TO_CLOSE:1,CLICK_INSIDE_TO_CLOSE:2,MOUSE_OVER_TO_OPEN:4,MOUSE_OUT_TO_CLOSE:8,CLICK_SOURCE_TO_OPEN:16};apple.widget.HoverManager.DEFAULTS={showDelay:1000,hideDelay:1000,behaviour:(apple.widget.HoverManager.BEHAVIOUR.CLICK_OUTSIDE_TO_CLOSE|apple.widget.HoverManager.BEHAVIOUR.CLICK_SOURCE_TO_OPEN|apple.widget.HoverManager.BEHAVIOUR.MOUSE_OVER_TO_OPEN|apple.widget.HoverManager.BEHAVIOUR.MOUSE_OUT_TO_CLOSE)};apple.widget.HoverManager.prototype.init=function(){function a(b,d){var c=new apple.widget.Hover(b,this)}this.configs.forEach(a,this);if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_OUTSIDE_TO_CLOSE){this._bodyClickedHandler=this.bodyClicked.bindAsEventListener(this);Event.observe(document.body,"onclick",this._bodyClickedHandler)}Event.onUnload(this.cleanup.bind(this))};apple.widget.HoverManager.prototype.manageHover=function(c){if(!c){return}var d=$(c.config.sourceId);var b=$(c.config.contentId);if(!d||!b){return}var a=this.hovers.length;this.hovers.push(c);d.hoverIndex=a;b.hoverIndex=a;if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_SOURCE_TO_OPEN){Event.observe(d,"click",this._sourceClickedHandler)}if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.MOUSE_OVER_TO_OPEN){Event.observe(d,"mouseover",this._mouseOverHandler);Event.observe(b,"mouseover",this._mouseOverHandler);Event.observe(d,"mouseout",this._mouseOutHandler);Event.observe(b,"mouseout",this._mouseOutHandler)}if(this._behaviour&apple.widget.HoverManager.BEHAVIOUR.CLICK_INSIDE_TO_CLOSE){Event.observe(b,"click",this._contentClickedHandler)}};apple.widget.HoverManager.prototype.cleanup=function(){function a(b){var c=$(b.config.sourceId);b.cleanup()}this.hovers.forEach(a);this.hovers.length=0;if(this._bodyClickedHandler){Event.stopObserving(document.body,"onclick",this._bodyClickedHandler);this._bodyClickedHandler=null}this.cancelShowing();this.cancelHiding()};apple.widget.HoverManager.prototype.findHoverNode=function(a){while(a&&a.nodeName!="BODY"){if("hoverIndex" in a){return a}a=a.parentNode}return null};apple.widget.HoverManager.prototype.sourceClicked=function(a){var b=this.findHoverNode(a.target||a.srcElement);if(!b){return}this.showHover(b,true);Event.stop(a)};apple.widget.HoverManager.prototype.bodyClicked=function(a){if(!this.activeHover){return}if(Event.isMouseOverElement(a,$(this.activeHover.config.contentId))){return}this.hideHover(null,true);Event.stop(a)};apple.widget.HoverManager.prototype.mouseOver=function(a){var c=this.findHoverNode(a.srcElement||a.target);if(!c){return}var b=this.findHoverNode(a.relatedTarget||a.fromElement);if(b&&c==b){return}c.hasMouse=true;var d=c.sourceId||c.id;this.showHover(d)};apple.widget.HoverManager.prototype.mouseOut=function(b){var c=this.findHoverNode(b.srcElement||b.target);if(!c){return}var a=this.findHoverNode(b.relatedTarget||b.toElement);if(a&&c==a){return}c.hasMouse=false;var d=c.sourceId||c.id;if(this._showingSourceId==d||this._behaviour&apple.widget.HoverManager.BEHAVIOUR.MOUSE_OUT_TO_CLOSE){this.hideHover(d)}};apple.widget.HoverManager.prototype.contentClicked=function(a){var b=this.findHoverNode(a.srcElement||a.target);if(!b){return}this.hideHover(b.sourceId,true);Event.stop(a)};apple.widget.HoverManager.prototype.showHover=function(c,d){c=$(c);if(!c){return}if(c.id==this._hidingSourceId){this.cancelHiding()}if(d&&c.id==this._showingSourceId){this.cancelShowing();this.activeHover.show(true);return}var b=this.hovers[c.hoverIndex];if(b==this.activeHover){return}if(this._showing){this.cancelShowing()}if(this.activeHover){this.activeHover.hide();this.activeHover=b;b.show();this.cancelHiding();return}if(d){this.activeHover=b;b.show(true);return}function a(){this.cancelShowing();b.show(true)}this.activeHover=b;this._showingSourceId=c.id;this._showing=window.setTimeout(a.bind(this),this._showDelay)};apple.widget.HoverManager.prototype.cancelShowing=function(){window.clearTimeout(this._showing);this._showing=this._showingSourceId=0};apple.widget.HoverManager.prototype.cancelHiding=function(){window.clearTimeout(this._hiding);this._hiding=this._hidingSourceId=0};apple.widget.HoverManager.prototype.hideHover=function(c,d){c=c||(this.activeHover?this.activeHover.config.sourceId:null);c=$(c);if(!c){return}var b=this.hovers[c.hoverIndex];if(c.id==this._showingSourceId){this.cancelShowing();this.activeHover=null;return}if(this.activeHover&&b!=this.activeHover){b.hide();return}if(d){b.hide(true);this.activeHover=null;return}function a(){this.cancelHiding();b.hide(true);this.activeHover=null}this._hidingSourceId=c.id;this._hiding=window.setTimeout(a.bind(this),this._hideDelay)};apple.widget.HoverManager.prototype.beforeShowHover=function(a){};apple.widget.HoverManager.prototype.beforeHideHover=function(a){};Package("apple.widget");var STATES={hidden:0,showing:1,shown:2,hiding:3};apple.widget.Hover=function(a,b){function d(g,f){var e=[];while(e.length<f){e=e.concat(g)}e.length=f;return e}function c(f){var e=[].concat(f);function g(h){if(!(typeof h==="string"||h instanceof String)){return h}return apple.widget.Hover.LAYOUT_NAMES[h]}return e.map(g)}this.config=Object.applyDefaults(a,apple.widget.Hover.DEFAULTS);this.config.sourcePadding=d(this.config.sourcePadding,4);this.config.contentOffset=d(this.config.contentOffset,4);this.config.pointerOffset=d(this.config.pointerOffset,4);this.config.allowedLayouts=c(this.config.allowedLayout||this.config.allowedLayouts);this.manager=b||new apple.widget.HoverManager();Event.observe(window,"load",this.init.bind(this))};apple.widget.Hover.prototype.init=function(){var a=this.close.bindAsEventListener(this);this.currentLayout=apple.widget.Hover.NO_LAYOUT;var f=this._wrapContent();if(!f){return}var e=Element.getElementsByClassName("wdgt-mdl",f)[0];if(this.config.width){f.style.width=this.config.width}if(e&&this.config.height>=parseInt(Element.getStyles(e,"height"),10)){e.style.height=this.config.height}function d(j){Event.observe(j,"onclick",a)}var b=Element.getElementsByClassName("close-link",f);Array.forEach(b,d);var g=Element.queryAll(document,"#indicator_hover_content a");Array.forEach(g,d);var i=Element.getRect(f,true);function c(k){var j=Element.getDimensions(k);var l=Element.getRect(k,true);j.left=l.left-i.left;j.top=l.top-i.top;return j}var h=Element.getElementsByClassName("triangle",f);this.pointerInfo=Array.map(h,c);if(f&&(Element.getStyle(f,"display")!="none")){this._state=STATES.visible}else{this._state=STATES.hidden}this.manager.manageHover(this)};apple.widget.Hover.prototype.cleanup=function(){};apple.widget.Hover.DEFAULT_SHOW_Z_INDEX=1000;apple.widget.Hover.DEFAULT_HIDE_Z_INDEX=999;apple.widget.Hover.NO_LAYOUT=null;apple.widget.Hover.TOP_LAYOUT=0;apple.widget.Hover.RIGHT_LAYOUT=1;apple.widget.Hover.BOTTOM_LAYOUT=2;apple.widget.Hover.LEFT_LAYOUT=3;apple.widget.Hover.DEFAULTS={sourcePadding:[0,0,-2,-10],contentOffset:[20,40],pointerOffset:[8,10],fadeInDuration:300,fadeOutDuration:500,closeLink:"Close",allowedLayouts:[apple.widget.Hover.TOP_LAYOUT,apple.widget.Hover.RIGHT_LAYOUT,apple.widget.Hover.BOTTOM_LAYOUT,apple.widget.Hover.LEFT_LAYOUT]};apple.widget.Hover.POINTER_INDEX=[3,2,0,1];apple.widget.Hover.LAYOUT_NAMES={top:apple.widget.Hover.TOP_LAYOUT,bottom:apple.widget.Hover.BOTTOM_LAYOUT,left:apple.widget.Hover.LEFT_LAYOUT,right:apple.widget.Hover.RIGHT_LAYOUT};apple.widget.Hover.prototype._wrapContent=function(){var a=$(this.config.contentId);if(!a){return null}var e=a.parentNode;a.parentNode.removeChild(a);a.id="";a.className="";var c=Element.uniqueId();var f=document.createElement("div");f.id=this.config.contentId;f.sourceId=this.config.sourceId;f.className=[a.className,"popup-wdgt"].join(" ");f.innerHTML=['<div class="wdgt-top"><div></div>','<span class="triangle"></span>',"</div>",'<div class="wdgt-mdl">','<div class="wdgt-right">','<span class="triangle"></span>',"</div>",'<div class="wdgt-left">','<a class="close-link" href="#">',this.config.closeLink,"</a>",'<div id="',c,'"></div>','<span class="triangle"></span>',"</div>","</div>",'<div class="wdgt-btm">',"<div></div>",'<span class="triangle"></span>',"</div>"].join("");document.body.appendChild(f);var b=$(c);b.parentNode.replaceChild(a,b);return f};apple.widget.Hover.prototype.show=function(c){var a=$(this.config.contentId);if(!a){return}switch(this._state){case STATES.shown:return;case STATES.showing:coherent.Animator.setStyles(a,{opacity:1},{duration:0,cleanup:true});this._state=STATES.shown;return;default:break}a.style.visibility="hidden";a.style.display="block";this.position();this.manager.beforeShowHover(this);this.setContentZIndex(apple.widget.Hover.DEFAULT_SHOW_Z_INDEX);function b(){this._state=STATES.shown}if(!c){a.style.display="block";b.call(this);return}this._state=STATES.showing;Element.setOpacity(a,0);a.style.visibility="visible";coherent.Animator.setStyles(a,{opacity:1},{duration:this.config.fadeInDuration,callback:b.bind(this),cleanup:true})};apple.widget.Hover.prototype.hide=function(c){var b=$(this.config.contentId);if(!b){return}switch(this._state){case STATES.hidden:return;case STATES.hiding:coherent.Animator.setStyles(b,{opacity:0},{duration:0,callback:a.bind(this),cleanup:true});this._state=STATES.hidden;return;default:break}this.manager.beforeHideHover(this);this.setContentZIndex(apple.widget.Hover.DEFAULT_HIDE_Z_INDEX);function a(){b.style.display="none";this._state=STATES.hidden}if(!c){a.call(this);return}this._state=STATES.hiding;coherent.Animator.setStyles(b,{opacity:0},{duration:this.config.fadeOutDuration,callback:a.bind(this),cleanup:true})};apple.widget.Hover.prototype.toggle=function(){switch(this._state){case STATES.hidden:case STATES.hiding:this.show();return;case STATES.shown:case STATES.showing:this.hide();return;default:return}};apple.widget.Hover.prototype.close=function(a){this.manager.hideHover(this.config.sourceId,true);Event.stop(a)};apple.widget.Hover.prototype._getCurrentPointer=function(){var a=$(this.config.contentId);if(!a){return null}var b=Element.getElementsByClassName("triangle",a);if(!b){return null}return b[apple.widget.Hover.POINTER_INDEX[this.currentLayout]]};apple.widget.Hover.prototype._showPointer=function(){var a=this._getCurrentPointer();if(!a){return}a.style.display="block"};apple.widget.Hover.prototype._hidePointer=function(){var a=this._getCurrentPointer();if(!a){return}a.style.display="none"};apple.widget.Hover.prototype.setContentZIndex=function(b){var a=$(this.config.contentId);if(!a){return}a.style.zIndex=b};apple.widget.Hover.prototype._createPositionContext=function(){var a={contentElem:$(this.config.contentId),sourceElem:$(this.config.sourceId),sourcePosition:{left:0,top:0},sourceBox:{height:0,width:0},contentBox:{height:0,width:0}};if(!a.contentElem||!a.sourceElem){return null}a.contentElem.style.left="0";a.contentElem.style.top="0";a.pageOffset=Element.getRect(a.contentElem);a.sourcePosition=Element.getRect(a.sourceElem);a.sourceBox=Element.getDimensions(a.sourceElem);a.contentBox=Element.getDimensions(a.contentElem);return a};apple.widget.Hover.prototype._computeContentPosition=function(d,c){var a={left:0,top:0,pointerStyle:"",pointerOffset:0};c=c||this._createPositionContext();if(!c){return a}var b=this.pointerInfo[apple.widget.Hover.POINTER_INDEX[d]];switch(d){case apple.widget.Hover.TOP_LAYOUT:a.top=c.sourcePosition.top-c.contentBox.height-this.config.sourcePadding[d];a.left=c.sourcePosition.left-this.config.contentOffset[d];break;case apple.widget.Hover.BOTTOM_LAYOUT:a.top=c.sourcePosition.top+c.sourceBox.height+this.config.sourcePadding[d];a.left=c.sourcePosition.left-this.config.contentOffset[d];break;case apple.widget.Hover.LEFT_LAYOUT:a.left=c.sourcePosition.left-c.contentBox.width-this.config.sourcePadding[d]-b.width;a.top=c.sourcePosition.top-this.config.contentOffset[d];break;case apple.widget.Hover.RIGHT_LAYOUT:a.left=c.sourcePosition.left+c.sourceBox.width+this.config.sourcePadding[d]-b.left;a.top=c.sourcePosition.top-this.config.contentOffset[d];break;default:break}return a};apple.widget.Hover.prototype._findBestLayout=function(d){d=d||this._createPositionContext();if(!d){return null}var a=d.contentBox.width*d.contentBox.height;var b=Element.getViewport();b.bottom=b.top+b.height;b.right=b.left+b.width;var c=null;function g(l){var h=this._computeContentPosition(l,d);var o=Math.max(b.top,h.top);var j=Math.min(b.bottom,h.top+d.contentBox.height);var n=Math.max(b.left,h.left);var k=Math.min(b.right,h.left+d.contentBox.width);var i=(j-o)*(k-n);var m={layout:l,position:h,overlap:i,fits:(i>=a)};if(!c&&m.fits){c=m}return m}var e=this.config.allowedLayouts.map(g,this);if(1==e.length){return e[0]}if(c){return c}function f(h){if(!c||h.overlap>c.overlap){c=h}}e.forEach(f);return c};apple.widget.Hover.prototype.position=function(){var c=this._createPositionContext();if(!c){return}var a=Element.getElementsByClassName("triangle",c.contentElem);Array.forEach(a,function(f){f.style.display="none"});var d=this._findBestLayout(c);if(!d){return}this.currentLayout=d.layout;c.contentElem.style.position="absolute";c.contentElem.style.top=(d.position.top)+"px";c.contentElem.style.left=(d.position.left)+"px";var e=this._getCurrentPointer();if(!e){return}var b=this.pointerInfo[apple.widget.Hover.POINTER_INDEX[d.layout]];switch(d.layout){case apple.widget.Hover.TOP_LAYOUT:case apple.widget.Hover.BOTTOM_LAYOUT:e.style.left=(this.config.pointerOffset[d.layout]+this.config.contentOffset[d.layout]-b.width/2)+"px";break;case apple.widget.Hover.LEFT_LAYOUT:case apple.widget.Hover.RIGHT_LAYOUT:e.style.top=(this.config.pointerOffset[d.layout]+this.config.contentOffset[d.layout]-b.top-b.height/2)+"px";break;default:break}e.style.display="block"};Package("apple.widget");apple.widget.ImageButton=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.ImageButton,apple.widget.BaseWidget);apple.widget.ImageButton.DEFAULTS={disabledClass:"disabled",activeClass:"active"};apple.widget.ImageButton.prototype.init=function(){var a=this.widget();a._disabledClass=this.config.disabledClass;this._mousedownHandler=this.mousedown.bindAsEventListener(this);this._mouseupHandler=this.mouseup.bindAsEventListener(this);this._mouseoutHandler=this.mouseout.bindAsEventListener(this);this._mouseoverHandler=this.mouseover.bindAsEventListener(this);a.innerHTML="";Event.observe(a,"mousedown",this._mousedownHandler);apple.widget.ImageButton._checkIds.push(a.id);apple.widget.ImageButton.installDisabledChecker()};apple.widget.ImageButton.prototype.disable=function(){var a=this.widget();a.disabled=true;if(a.disabled){Element.addClassName(a,this.config.disabledClass)}else{Element.removeClassName(a,this.config.disabledClass)}};apple.widget.ImageButton.prototype.enable=function(){var a=this.widget();a.disabled=false};apple.widget.ImageButton._checkIds=[];apple.widget.ImageButton.removeDisabledChecker=function(){if(!apple.widget.ImageButton._disabledCheckerTimer){return}window.clearInterval(apple.widget.ImageButton._disabledCheckerTimer);apple.widget.ImageButton._disabledCheckerTimer=0};apple.widget.ImageButton.installDisabledChecker=function(){if(apple.widget.ImageButton._disabledCheckerTimer){return}Event.onUnload(apple.widget.ImageButton.removeDisabledChecker);apple.widget.ImageButton._disabledCheckerTimer=window.setInterval(apple.widget.ImageButton.disabledChecker,500)};apple.widget.ImageButton.disabledChecker=function(){function a(c){var b=$(c);if(!b){return}if(b.disabled){Element.addClassName(b,b._disabledClass)}else{Element.removeClassName(b,b._disabledClass)}}apple.widget.ImageButton._checkIds.forEach(a)};apple.widget.ImageButton.prototype.mousedown=function(a){var b=this.widget();Element.addClassName(b,this.config.activeClass);Event.observe(b,"mouseout",this._mouseoutHandler);Event.observe(b,"mouseover",this._mouseoverHandler);Event.observe(document,"mouseup",this._mouseupHandler);this._active=true};apple.widget.ImageButton.prototype.mouseup=function(a){var b=this.widget();Element.removeClassName(b,this.config.activeClass);Event.stopObserving(b,"mouseout",this._mouseoutHandler);Event.stopObserving(b,"mouseover",this._mouseoverHandler);Event.stopObserving(document,"mouseup",this._mouseupHandler);this._active=false};apple.widget.ImageButton.prototype.mouseover=function(a){if(!this._active){Element.addClassName(this.widget(),this.config.activeClass)}this._active=true};apple.widget.ImageButton.prototype.mouseout=function(a){if(this._active){Element.removeClassName(this.widget(),this.config.activeClass)}this._active=false};Package("apple.widget");apple.widget.ImageButtonLinks=function(a){this.config=a;Event.onDomReady(this.init.bind(this))};apple.widget.ImageButtonLinks.prototype.init=function(){if(this._initialized){return}this._initialized=true;if(this.config.buttonIds&&this.config.imageIds&&this.config.buttonIds.length==this.config.imageIds.length){for(var c=0;c<this.config.buttonIds.length&&c<this.config.imageIds.length;c++){var b=$(this.config.buttonIds[c]);var e=$(this.config.imageIds[c]);if(b&&e){var a=(function(){this.style.backgroundPosition="bottom left"}).bind(b);var d=(function(){this.style.backgroundPosition="top left"}).bind(b);Event.observe(b,"onmouseover",a);Event.observe(b,"onmouseout",d);Event.observe(e,"onmouseover",a);Event.observe(e,"onmouseout",d)}}}};Package("apple.widget");apple.widget.LinkManager=function(a){this.setConfig(a);if(coherent.Browser.IE){Event.observe(window,"load",this.init.bind(this))}Event.onDomReady(this.init.bind(this))};apple.widget.LinkManager.prototype.constructor=apple.widget.LinkManager;apple.widget.LinkManager.DEFAULTS={markerClass:"superlink",hoverClass:"superlink-hover",activeClass:"superlink-active",ignoreClass:"superlink-ignore",disclosureClass:"more",disclosureOpenClass:"open",disclosureRegex:/(?:^|\s)disclosure\(([^)]*)\)(?:$|\s)/,popupWidthRegex:(/w(\d+)(-|$)/i),popupHeightRegex:(/h(\d+)(-|$)/i),popupPrefix:"popup-",engravingGalleryRel:"engravingGallery",socialSharingRel:"social-sharing",learnMore3GUSRel:"dataPlan3G",learnMore3GRel:"dataPlan",relatedLinkDataAttribute:"data-relatedlink",relatedClassName:"relatedlink"};apple.widget.LinkManager.prototype.init=function(){window.setTimeout(this.rescanDocument.bind(this),10);Event.observe(document.body,"DOMNodeInserted",this.documentChanged.bindAsEventListener(this));if(coherent.Browser.IE){Event.observe(window,"resize",this.documentChanged.bindAsEventListener(this))}};apple.widget.LinkManager.prototype.setConfig=function(b){b=b||{};for(var a=this.constructor;a&&Object!==a;a=a.superclass){Object.applyDefaults(b,a.DEFAULTS||{})}this.config=b};apple.widget.LinkManager.prototype.rescanDocument=function(){this.manageLinks(document)};apple.widget.LinkManager.prototype.documentChanged=function(a){if(this._rescanTimer){window.clearTimeout(this._rescanTimer)}this._rescanTimer=window.setTimeout(this.rescanDocument.bind(this),250)};apple.widget.LinkManager.prototype.getPopupAttributes=function(f){var e={location:(f.indexOf("l")!=-1?"yes":"no"),menubar:(f.indexOf("m")!=-1?"yes":"no"),toolbar:(f.indexOf("t")!=-1?"yes":"no"),status:(f.indexOf("s")!=-1?"yes":"no"),scrollbars:(f.indexOf("!b")!=-1?"no":"yes"),resizable:(f.indexOf("!r")!=-1?"no":"yes")};var c=this.config.popupWidthRegex.exec(f);var g=this.config.popupHeightRegex.exec(f);if(c&&c[1]){e.width=c[1]}if(g&&g[1]){e.height=g[1]}var d=[];for(var b in e){d.push(b+"="+e[b])}return d.join(",")};apple.widget.LinkManager.prototype.relatedLinkRequest=function(d,f){var c=d.getAttribute(this.config.relatedLinkDataAttribute),e=Element.query("a["+this.config.relatedLinkDataAttribute+'="'+c+'"]');if(!e){return}try{this._sendingClick=true;var a=Event.sendMouseEvent(e,"click",true,true);if(!a){return}if(!coherent.Browser.Safari){var b=window.open(e.href,e.target||"_self",f||"");b.focus()}Event.stop(event)}finally{this._sendingClick=false}};apple.widget.LinkManager.prototype.observeRelatedLinks=function(c,e,b){var d=Element.queryAll("["+this.config.relatedLinkDataAttribute+'="'+e+'"]'),a=this;Array.forEach(d,function(f){if(f.nodeName.toUpperCase()==="A"){return}Event.observe(f,"click",function(){a.relatedLinkRequest.call(a,c,b)});Element.addClassName(f,this.config.relatedClassName)},this)};apple.widget.LinkManager.prototype.manageLinks=function(o){var a=document.getElementsByTagName("a");if(!a.length){return}var b=this.config.disclosureClass;var n=this.config.disclosureRegex;var c=this.config.disclosureOpenClass;var i=this.config.markerClass;var j=this.config.popupPrefix;var l=this.config.engravingGalleryRel;var h=this.config.socialSharingRel;var u=this.config.learnMore3GUSRel;var k=this.config.learnMore3GRel;var f=document.body;var q=this.mouseOverLink.bindAsEventListener(this);var d=this.mouseOutLink.bindAsEventListener(this);var r=this.mouseDownLink.bindAsEventListener(this);var g=this.parentClicked.bindAsEventListener(this);this.mouseUp=this.mouseUp.bindAsEventListener(this);var p=this.dragStarted.bindAsEventListener(this);function t(w){var v=w.parentNode;if(v==f){return null}while(v&&f!=v){if(Element.hasClassName(v,i)){return v}v=v.parentNode}return w.parentNode}function m(B){var x;var D;var v;if(B._managed){return}B._managed=true;if(B.target&&j==B.target.slice(0,j.length)){x=this.getPopupAttributes(B.target);B.target=B.target.replace(/[^\w]/g,"");D=this.popupLinkClicked.bindAsEventListener(this,x);Event.observe(B,"click",D)}if(Element.hasClassName(B,b)&&!!(v=n.exec(B.rel))){var z=$(v[1]);var A=document.createElement("div");var e=Element.assignId(A);var w=Element.hasClassName(B,c);z.parentNode.replaceChild(A,z);A.appendChild(z);D=this.disclosureLinkClicked.bindAsEventListener(this,e,z);Event.observe(B,"click",D);if(!w){Element.makeClipping(A);A.style.height="0";z.style.height="auto"}}if(B.rel==l){Event.observe(B,"click",this.engravingGalleryLinkClicked)}if(B.rel==h){Event.observe(B,"click",this.socialSharingLinkClicked)}if(B.rel==u||B.rel==k){Event.observe(B,"click",this.learnMore3GLinkClicked)}var y=B.getAttribute(this.config.relatedLinkDataAttribute);if(y){this.observeRelatedLinks(B,y,x)}if(!Element.hasClassName(B,i)){return}var C=t(B);if(!C){return}Element.assignId(C);Element.addClassName(C,i);C._linkId=Element.assignId(B);Event.observe(C,"mouseover",q);Event.observe(C,"mouseout",d);Event.observe(C,"mousedown",r);if(x){D=this.parentClicked.bindAsEventListener(this,x);Event.observe(C,"click",D)}else{Event.observe(C,"click",g)}if(coherent.Browser.IE){Event.observe(C,"dragstart",p);Event.observe(C,"selectstart",p)}}Array.forEach(a,m,this)};apple.widget.LinkManager.prototype.findAnchor=function(b){var a=document.body;while(b&&a!=b){if("_linkId" in b){return null}if("a"==b.tagName.toLowerCase()){return b}b=b.parentNode}return null};apple.widget.LinkManager.prototype.findLink=function(b){var a=document.body;while(b&&a!=b){if(b.className.indexOf(this.config.ignoreClass)>-1){return null}if("_linkId" in b){return b}b=b.parentNode}return null};apple.widget.LinkManager.prototype.mouseOverLink=function(a){var b=this.findLink(a.target||a.srcElement);if(!b){return}if(this._activeLinkId&&this._activeLinkId!=b.id){return}if(this._activeLinkId==b.id){Element.addClassName(b,this.config.activeClass)}else{Element.addClassName(b,this.config.hoverClass)}};apple.widget.LinkManager.prototype.mouseOutLink=function(a){var b=this.findLink(a.target||a.srcElement);if(!b){return}if(this._activeLinkId&&this._activeLinkId!=b.id){return}if(this._activeLinkId==b.id){Element.removeClassName(b,this.config.activeClass);Element.addClassName(b,this.config.hoverClass)}else{Element.removeClassName(b,this.config.hoverClass)}};apple.widget.LinkManager.prototype.mouseDownLink=function(a){if(a.which==Event.LEFT_MOUSE&&!Event.isModifiedKey(a)){var b=this.findLink(a.target||a.srcElement);if(!b){return}Event.observe(document,"mouseup",this.mouseUp);this._activeLinkId=b.id;Element.addClassName(b,this.config.activeClass);Element.removeClassName(b,this.config.hoverClass);Event.stop(a)}};apple.widget.LinkManager.prototype.mouseUp=function(a){Event.stopObserving(document,"mouseup",this.mouseUp);var c=$(this._activeLinkId);var b=this.findLink(a.target||a.srcElement);this._activeLinkId=undefined;if(c){Element.removeClassName(c,this.config.activeClass);Element.removeClassName(c,this.config.hoverClass)}this.mouseOverLink(a)};apple.widget.LinkManager.prototype.popupLinkClicked=function(d,c){if(this._sendingClick){return}var b=this.findAnchor(d.target||d.srcElement);var a=window.open(b.href,b.target||"_blank",c||"");a.focus();Event.preventDefault(d)};apple.widget.LinkManager.prototype.parentClicked=function(f,e){if(!Event.isModifiedKey(f)){if(this._sendingClick){return}var g=f.target||f.srcElement;var d=this.findLink(g);if(!d){return}var c=this.findAnchor(g);if(c&&c.id!=d._linkId){return}c=c||$(d._linkId);if(!c){return}Event.stop(f);try{this._sendingClick=true;var a=Event.sendMouseEvent(c,"click",true,true);if(!a){return}if(!coherent.Browser.Safari){var b=window.open(c.href,c.target||"_self",e||"");b.focus()}Event.stop(f)}finally{this._sendingClick=false}}};apple.widget.LinkManager.prototype.dragStarted=function(a){Event.stop(a);return false};apple.widget.LinkManager.prototype.disclosureLinkClicked=function(b,i,g){function k(l){l=parseInt(l||0,10);if(isNaN(l)){return 0}return l}var e=k(Element.getStyle(g,"border-left-width"))+k(Element.getStyle(g,"border-right-width"));var j=k(Element.getStyle(g,"border-top-width"))+k(Element.getStyle(g,"border-bottom-width"));var a={width:g.scrollWidth+e,height:g.scrollHeight+j};var h=this.findAnchor(b.target||b.srcElement);var d=Element.hasClassName(h,this.config.disclosureOpenClass);var f=$(i);var c;if(this.disclosureAnimator){this.disclosureAnimator.stop()}this.disclosureAnimator=new apple.fx.Animator();if(d){c=new apple.fx.Resize(apple.fx.easeInOutSine,f,{width:a.width,height:0},a);Element.removeClassName(h,this.config.disclosureOpenClass)}else{this.trackDisclosureClick(f);c=new apple.fx.Resize(apple.fx.easeInOutSine,f,a,{width:a.width,height:0});Element.addClassName(h,this.config.disclosureOpenClass)}this.disclosureAnimator.play(c);Event.stop(b)};apple.widget.LinkManager.prototype.trackDisclosureClick=function(e){var a=e.getElementsByTagName("div");if(!a){return}if(a.count===0){return}var d=a[0].id;var g=window.state;var f=window.s||null;if(!f){return}var c=apple.metrics.Metrics.getProductSubstring(f.products);var b={slot:"",feature:"Learn More",action:"Selected: "+d};if(typeof(g)!="undefined"){b.part=g.summary.part}else{b.part=c}apple.metrics.fireMicroEventNoDuplicates(b)};apple.widget.LinkManager.prototype.engravingGalleryLinkClicked=function(a){var d=window.s||null;if(!d){return}var b=apple.metrics.Metrics.getProductSubstring(d.products);var c={slot:"",feature:"Engraving-Gallery",part:b,action:"Selected"};apple.metrics.fireMicroEventNoDuplicates(c)};apple.widget.LinkManager.prototype.socialSharingLinkClicked=function(b){var a=b.target.className;var e=window.s||null;if(!e){return}var c=apple.metrics.Metrics.getProductSubstring(e.products);var d={slot:"",feature:a,part:c,action:""};apple.metrics.fireMicroEventNoDuplicates(d);apple.metrics.fireEvent({events:"event7"})};apple.widget.LinkManager.prototype.learnMore3GLinkClicked=function(a){var d=window.s||null;if(!d){return}var b=apple.metrics.Metrics.getProductSubstring(d.products);var c={slot:"",feature:"Learn More 3G",part:b,action:"Selected"};apple.metrics.fireMicroEventNoDuplicates(c)};window.gLinkManager=new apple.widget.LinkManager();Package("apple.widget");apple.widget.Movie=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.Movie,apple.widget.BaseWidget);apple.widget.Movie.DEFAULTS={autoplay:true,loop:false,wrapperClass:"movieWrapper"};apple.widget.Movie.prototype.init=function(){if(!apple.quicktime.isInstalled()){return}var a;var f=this.widget();var d;if(!f){return}switch(f.tagName.toLowerCase()){case"a":this.config.src=f.href;a=f.parentNode;d=f.getElementsByTagName("img")[0];d=f.removeChild(d);a.replaceChild(d,f);break;case"img":d=f;a=d.parentNode;break;default:console.log("Movie cannot initialise from "+f.tagName+"#"+this.config.id);return}this._posterId=this.config.id+"_poster";this._movieId=this.config.id+"_movie";this.config=Object.applyDefaults(this.config,{width:d.width,height:d.height});var c=document.createElement("div");c.style.visibility="hidden";c.style.position="relative";c.className=this.config.wrapperClass;c.id=f.id;d=a.replaceChild(c,d);d.id=this._posterId;c.appendChild(d);var e={autoplay:false,id:this._movieId};e=Object.applyDefaults(e,this.config);apple.quicktime.createMovie(e,c);var b={movieId:this._movieId,onload:this.movieLoaded.bind(this)};this.controller=new apple.widget.MovieController(this.config.controllerId,b);this.controller.hideMovie();c.style.visibility="visible"};apple.widget.Movie.prototype.movieLoaded=function(d){var f=document.getElementById(this._posterId);var g=this.config.width;var a=this.config.height;var h=this.config.autoplay;var c=this.controller;c.hideMovie();var e=this;function b(){f.style.display="none";c.showMovie(g,a);if(h){d.Play()}}coherent.Animator.setStyles(f,{opacity:0},{duration:500,callback:b,cleanup:true})};Package("apple.widget");apple.widget.MovieController=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.MovieController,apple.widget.BaseWidget);apple.widget.MovieController.DEFAULTS={create:false,disabledClass:"disabled",activeClass:"active",loadingClass:"loading",errorClass:"error",playingClass:"playing",pausedClass:"paused",onload:function(){},monitorInterval:500,playButtonSpec:"button"};apple.widget.MovieController.prototype.init=function(){this._duration=0;this._loading=true;this.monitorProgress();var a=this.widget();if(!a){return}a.style.display="none";Element.addClassName(a,this.config.pausedClass);Element.removeClassName(a,this.config.playingClass);var d=this.part(this.config.playButtonSpec);new apple.widget.ImageButton(d);Event.observe(d,"click",this.playButtonClicked.bind(this));var c=a.getElementsByTagName("div")[0];this._meterId=Element.assignId(c);this._meterWidth=c.offsetWidth;Event.observe(c,"mousedown",this.meterMouseDown.bind(this));var b=c.getElementsByTagName("span")[0];this._barId=Element.assignId(b)};apple.widget.MovieController.prototype._getMovie=function(){return $(this.config.movieId)};apple.widget.MovieController.prototype._updateMeter=function(b){var a=this.widget();if(!a||this._vr){return}b=b||this._getMovie();if(!b){return}try{var c=b.GetRate()}catch(h){return}if(c&&!this._playing){this._playing=true;Element.addClassName(a,this.config.playingClass);Element.removeClassName(a,this.config.pausedClass)}else{if(!c&&this._playing){this._playing=false;Element.addClassName(a,this.config.pausedClass);Element.removeClassName(a,this.config.playingClass)}}if(!this._duration){this._duration=b.GetDuration()}if(!this._duration){return}var f=$(this._meterId);this._meterWidth=f.offsetWidth-4;var d=$(this._barId);if(!d||this._meterWidth<0){return}var g=(b.GetTime()*this._meterWidth/this._duration);if(this._lastLeft==g){return}this._lastLeft=g;d.style.left=g+"px";d.style.width=(this._meterWidth-g+2)+"px"};apple.widget.MovieController.prototype.monitorProgress=function(){if(apple.quicktime.mobileSafari){return}var b=this.widget();function c(){var d=this._getMovie();if(!d){return}this._duration=d.GetDuration();this.config.onload(d);this._vr=d.GetIsVRMovie();if(!b){return}if(this._vr){coherent.Animator.setStyles(b,{opacity:0},{duration:250,callback:function(){b.style.display="none"},cleanup:true})}else{Element.setOpacity(b,0);b.style.display="";coherent.Animator.setStyles(b,{opacity:1},{duration:250,cleanup:true})}}function a(){var f=this._getMovie();if(!f){return}try{var d=(f.GetPluginStatus()||"").split(":")[0].toLowerCase();this._updateMeter(f);switch(d){case"playable":case"complete":if(!this._loading){break}this._loading=false;if(b){Element.removeClassName(b,this.config.loadingClass)}window.setTimeout(c.bind(this),10);break;case"error":if(b){Element.removeClassName(b,this.config.loadingClass);Element.addClassName(b,this.config.errorClass)}break;default:break}}catch(g){}}this._monitor=window.setInterval(a.bind(this),this.config.monitorInterval)};apple.widget.MovieController.prototype.playButtonClicked=function(b){this.part(this.config.playButtonSpec).blur();var a=this._getMovie();if(!a){return}if(a.GetRate()){a.Stop()}else{a.Play()}};apple.widget.MovieController.prototype._updateTimeoutExpired=function(a){this._updateTimeFromPosition(this._lastPos)};apple.widget.MovieController.prototype._updateTimeFromPosition=function(d){var a=this._getMovie();if(!a){return}d-=this._baseX;if(d<0){d=0}else{if(d>this._meterWidth){d=this._meterWidth}}var c=$(this._barId);if(c){c.style.left=d+"px";c.style.width=(this._meterWidth-d+2)+"px"}var b=a.GetDuration()*d/this._meterWidth;a.SetTime(b);this._moveTimeout=0};apple.widget.MovieController.prototype.meterMouseUp=function(b){Event.stopObserving(document,"mouseup",this._mouseUpHandler);Event.stopObserving(document,"mousemove",this._mouseMoveHandler);this._updateTimeFromPosition((b||window.event).clientX);var a=this._getMovie();if(!a){return}if(this._previousRate){a.Play()}};apple.widget.MovieController.prototype.meterMouseMoved=function(a){this._lastPos=(a||window.event).clientX;this._moveTimeout=this._moveTimeout||window.setTimeout(this._updateHandler,10)};apple.widget.MovieController.prototype.meterMouseDown=function(b){b=b||window.event;var a=this._getMovie();var c=$(this._meterId);if(!a){return}this._previousRate=a.GetRate();a.Stop();this._baseX=Element.getRect(c,true).left-document.body.scrollLeft-document.documentElement.scrollLeft;this._updateHandler=this._updateTimeoutExpired.bind(this);this._mouseMoveHandler=this.meterMouseMoved.bind(this);this._mouseUpHandler=this.meterMouseUp.bind(this);Event.observe(document,"mousemove",this._mouseMoveHandler);Event.observe(document,"mouseup",this._mouseUpHandler);Event.stop(b);this._updateTimeFromPosition(b.clientX)};apple.widget.MovieController.prototype.hideMovie=function(){var b=this._getMovie();if(!b){return}b.width=1;b.height=1;b.style.width="1px";b.style.height="1px";var a=this.widget();if(!a){return}a.style.display="none"};apple.widget.MovieController.prototype.showMovie=function(c,d){var b=this._getMovie();if(!b){return}b.width=c;b.height=d;b.style.width=c+"px";b.style.height=d+"px";var a=this.widget();if(!a){return}a.style.display=""};apple.widget.MovieController.prototype.stop=function(){var a=this._getMovie();if(!a){return}a.Stop()};apple.widget.MovieController.prototype.play=function(){var a=this._getMovie();if(!a){return}a.Play()};apple.widget.MovieController.prototype.loadMovie=function(d){var b=this._getMovie();if(!b){return}var a=this.widget();if(a){Element.addClassName(a,this.config.loadingClass)}this._loading=true;try{b.Stop();b.SetURL(d);b.SetAutoPlay(false);b.SetControllerVisible(false)}catch(c){console.log("SetURL: "+c.message)}};Package("apple.widget");apple.widget.ProductCluster=function(a){this.config=a;this.resetPages();function b(){window.clearInterval(this._firefoxTimer)}function c(){Event.onUnload(b.bind(this));this._firefoxTimer=window.setInterval(this.checkScroll.bind(this),2000)}if(coherent.Browser.Mozilla){Event.onDomReady(c.bind(this))}Event.observe(window,"scroll",this.checkScroll.bind(this));Event.observe(window,"load",this.checkScroll.bind(this))};apple.widget.ProductCluster.prototype.encodeURL=function(d,a){if(!a){a=this.config.baseURL}for(var b in d){var c=d[b];if(c&&c.length){if(a.indexOf("?")>0){a+="&"+b+"="+c}else{a+="?"+b+"="+c}}}return a};apple.widget.ProductCluster.prototype.gotoPage=function(f,e,d,c){var b=this.encodeURL({p:f,f:e,s:d,n:c});var a=this;apple.io.json.invoke({url:b,success:function(g){a.switchContent(a.config.contentId,g)}});return false};apple.widget.ProductCluster.prototype.sort=function(e,d,c){var b=this.encodeURL({f:e,s:d,n:c});var f=$("product-loading-sort");if(f){f.style.display="inline"}var a=this;apple.io.json.invoke({url:b,success:function(g){a.config.sort=d;a.switchContent(a.config.contentId,g);if(f){f.style.display="none"}}});return false};apple.widget.ProductCluster.prototype.gotoNode=function(d,c){var b=this.encodeURL({n:d,s:c});var e=$("product-loading-filter");if(e){e.style.display="inline"}var a=this;apple.io.json.invoke({url:b,success:function(f){a.config.childNode=d;a.config.sort=c;a.switchContent(a.config.contentId,f);if(e){e.style.display="none"}}});return false};apple.widget.ProductCluster.prototype.gotoFilter=function(e,d,c){var b=this.encodeURL({f:e,s:c,n:d});var a=this;apple.io.json.invoke({url:b,success:function(f){a.config.filter=e;a.config.sort=c;a.config.childNode=d;a.switchContent(a.config.contentId,f)}});return false};apple.widget.ProductCluster.prototype.resetPages=function(){this.checkingScroll=false;this.pagePositions=new Array();this.loadedPages=new Array()};apple.widget.ProductCluster.prototype.loadPage=function(c){if(this.loadedPages[c]){return}this.loadedPages[c]=1;var b=this.encodeURL({p:""+c,f:this.config.filter,s:this.config.sort,n:this.config.childNode},this.config.pageURL);var a=this;apple.io.json.invoke({url:b,success:function(f){var d=a.config.pageIdPrefix+c+a.config.pageIdSuffix;var e=a.config.pageIdPrefix+c;a.switchContent(d,f);c=$(e);var h=$(d);var g=function(){if(Element.getMarginBox(c).height<Element.getMarginBox(h).height){var i=Element.getMarginBox(h);i.height++;Element.setMarginBox(c,i)}};Element.setOpacity(h,0);h.style.display="";coherent.Animator.setStyles(h,{opacity:1},{duration:600,cleanup:true,callback:g})}})};apple.widget.ProductCluster.prototype.checkScroll=function(){if(this.checkingScroll){return}this.checkingScroll=true;var b=Element.getViewport().top;var e=b+Element.getViewport().height;var d=e+this.config.scrollBuffer;var c=b-this.config.scrollBuffer;for(var f=this.config.pages-1;f>=1;f--){var a=this.config.pageIdPrefix+f;if(!this.pagePositions[f]){var h=$(a);if(h){this.pagePositions[f]=Element.getRect(h).top}}var g=Element.getMarginBox($(a));if(c<=this.pagePositions[f]+g.height&&d>=this.pagePositions[f]){this.loadPage(f)}}this.checkingScroll=false};apple.widget.ProductCluster.prototype.setupEmptyPages=function(t,e,f,d,h,k){this.config.pages=e;this.resetPages();var j="";if(this.config.loadingIconUrl){j='<img class="product-loading-tile" src="'+this.config.loadingIconUrl+'">'}var n="";for(var b=1;b<this.config.pages;b++){n+='<div class="product-page" id="'+this.config.pageIdPrefix+b+'">\n';n+='<div class="product-page-grid hidden" id="'+this.config.pageIdPrefix+b+this.config.pageIdSuffix+'"></div>\n';var l=d;if(b==this.config.pages-1){l=h}var m;for(var a=0;a<l;a++){m=(((b-1)*d+a) in k);if(a==l-1&&b==this.config.pages-1){n+='<ul class="product-row last-row'}else{n+='<ul class="product-row'}n+=m?' has-specials">':'">';n+='<li class="product first-tile">'+j+"</li>";for(var o=1;o<f-1;o++){n+='<li class="product">'+j+"</li>"}n+='<li class="product last-tile">'+j+"</li>";n+="</ul>\n"}n+="</div>\n"}var q=$(t);q.innerHTML=n;if(coherent.Browser.MobileSafari){for(var g=1;g<e;g++){this.loadPage(g)}}};apple.widget.ProductCluster.prototype.switchContent=function(a,c){if(c.body.content){var b=$(a);b.innerHTML=c.body.content}};Package("apple.widget");apple.widget.ProductDetailsContentMenu=Class.create(coherent.View,{init:function(){var a=Element.queryAll("#contents ul li a");Array.forEach(a,function(b){var c=b.getAttribute("href");if(Element.query(c)===null){b.parentNode.style.display="none"}})}});Package("apple.widget");apple.widget.ProductFilter=function(b,a){this.base("constructor")(b,a);this._expanded=false;this._filters=[];this._selectionIndex=-1};apple.util.makeSubclass(apple.widget.ProductFilter,apple.widget.BaseWidget);apple.widget.ProductFilter.DEFAULTS={expandedClass:"expanded",controlSpec:"ul.filter-controls",expandLinkSpec:".expand-link",secondaryFilterClass:"secondary",contractLinkSpec:".contract-link",selectedClass:"selected",filterListSpec:"ul.filter-items",animateDuration:50};apple.widget.ProductFilter.prototype.init=function(){var f=this.widget();var e=this.part(this.config.filterListSpec);var b=this.part(this.config.controlSpec);if(!f||!e||!b){return}b.style.display="block";this._expanded=Element.hasClassName(f,this.config.expandedClass);this._animator=new apple.fx.Animator();var a=this.part(this.config.expandLinkSpec);var c=this.part(this.config.contractLinkSpec);if(!a||!c){return}Event.observe(a,"click",this.expandLinkClicked.bindAsEventListener(this));Event.observe(c,"click",this.contractLinkClicked.bindAsEventListener(this));var d=this.filterClicked.bindAsEventListener(this);Event.observe(e,"click",d);function g(i,h){this._filters.push(Element.assignId(i));if(Element.hasClassName(i,this.config.selectedClass)){this._selectionIndex=h}i.filterIndex=h;if(this._expanded||Element.hasClassName(i,this.config.selectedClass)||!Element.hasClassName(i,this.config.secondaryFilterClass)){return}i.style.display="none"}Array.forEach(e.getElementsByTagName("li"),g,this);f.style.display="none";f.style.display="block"};apple.widget.ProductFilter.prototype.expandFilters=function(i){var d=[];var e=this.widget();var g=this.part(this.config.filterListSpec);var b=g.getElementsByTagName("li")[0].offsetWidth;function h(j,l){var n=$(j);if(l==this._selectionIndex||Element.hasClassName(n,this.config.selectedClass)||!Element.hasClassName(n,this.config.secondaryFilterClass)){return}n.style.width=b+"px";n.style.height="auto";var m=Element.getDimensions(n);n.style.width="";var k=new apple.fx.Resize(apple.fx.easeInOutSine,n,m,{width:b,height:0});var o=new apple.fx.Fade(apple.fx.linearTween,n,0,1);d.push(new apple.fx.Blend(k,o))}var a=this.part(this.config.expandLinkSpec);var f=this.part(this.config.contractLinkSpec);a.style.visibility="hidden";f.style.visibility="hidden";this._filters.forEach(h,this);if(!d.length){return}function c(){a.style.visibility="";f.style.visibility="";Element.addClassName(e,this.config.expandedClass);this._expanded=true;if(i){i()}}this._animator.setDuration(d.length*this.config.animateDuration);this._animator.play(new apple.fx.Chain(d),c.bind(this))};apple.widget.ProductFilter.prototype.contractFilters=function(i){var d=[];var e=this.widget();var g=this.part(this.config.filterListSpec);var b=g.getElementsByTagName("li")[0].clientWidth;function h(j,l){var n=$(j);if(l==this._selectionIndex||Element.hasClassName(n,this.config.selectedClass)||!Element.hasClassName(n,this.config.secondaryFilterClass)){return}n.style.width=b+"px";var m=Element.getDimensions(n);n.style.width="";var k=new apple.fx.Resize(apple.fx.easeInOutSine,n,{width:b,height:0},m);var o=new apple.fx.Fade(apple.fx.linearTween,n,1,0);d.push(new apple.fx.Blend(k,o))}var a=this.part(this.config.expandLinkSpec);var f=this.part(this.config.contractLinkSpec);a.style.visibility="hidden";f.style.visibility="hidden";this._filters.forEach(h,this);if(!d.length){return}function c(){a.style.visibility="";f.style.visibility="";Element.removeClassName(e,this.config.expandedClass);this._expanded=false;if(i){i()}}this._animator.setDuration(d.length*this.config.animateDuration);this._animator.play(new apple.fx.Chain(d),c.bind(this))};apple.widget.ProductFilter.prototype.selectFilter=function(a){if(a==this._selectionIndex){return}var b=this._filters[this._selectionIndex];var c=this._filters[a];this._selectionIndex=a;if(b){Element.removeClassName($(b),this.config.selectedClass)}if(c){Element.addClassName($(c),this.config.selectedClass)}};apple.widget.ProductFilter.prototype.expandLinkClicked=function(a){var b=a.target||a.srcElement;b.blur();Event.stop(a);this.expandFilters()};apple.widget.ProductFilter.prototype.contractLinkClicked=function(a){var b=a.target||a.srcElement;b.blur();Event.stop(a);this.contractFilters()};apple.widget.ProductFilter.prototype.findFilterNode=function(a){var b=this.widget();while(a!=b&&!("filterIndex" in a)){a=a.parentNode}if(!("filterIndex" in a)){return null}return a};apple.widget.ProductFilter.prototype.filterClicked=function(a){var c=a.target||a.srcElement;c.blur();Event.stop(a);var b=this.findFilterNode(c);if(!b){return}this.selectFilter(b.filterIndex);if(this._expanded){this.contractFilters(this.filterContent.bind(this))}else{this.filterContent()}};apple.widget.ProductFilter.prototype.filterContent=function(){var b=$(this._filters[this._selectionIndex]);if(!b){return}var a=b.getElementsByTagName("a")[0];if(!a){return}window.open(a.href,"_self")};Package("apple.widget");apple.widget.ProductTrailer=Class.create(coherent.View,{__structure__:{"a.video-trailer":coherent.Anchor({action:"createOverlay"})},trailerInnerHTML:'<div class="trailer-overlay"><div class="video"><a href="">Placeholder</a></div></div>',init:function(){},createOverlay:function(){var a=document.getElementById("trailerOverlay"),b=Element.query("a.video-trailer").href;if(!this.trailerOverlay){this.trailerOverlay=new coherent.Overlay(a)}this.trailerOverlay.display({classname:"overlay",html:this.trailerInnerHTML});this.videoSource=Element.query(".video a");this.videoSource.setAttribute("href",b);this.videoController()},videoController:function(){if(this.videoPlayer){return}console.log(this);var a=Element.query(".trailer-overlay .video");var c=this.videoSource.href;var b={autoplay:"true",width:320,height:240};delete coherent.View.viewLookup["volume-track"];delete coherent.View.viewLookup["control-track"];this.videoPlayer=Media.create(a,c,b);if(this.videoPlayer){if(!coherent.Browser.MobileSafari){this.videoControls=new Media.ControlsWidget(a);this.videoPlayer.setControlPanel(this.videoControls)}var e=function(){d.parentNode.removeChild(d);a.appendChild(this.videoPlayer.video().object());a.appendChild(this.videoControls.element);this.videoControls.play()}.bind(this);var d=document.createElement("div");Element.addClassName(d,"endstate");Event.observe(d,"click",e);this.videoPlayer.setDelegate({didEnd:function(){this.videoControls.pause();this.videoPlayer.setTime(0);this.videoPlayer.reset();a.appendChild(d);a.removeChild(this.videoControls.element);a.removeChild(this.videoPlayer.video().object())}.bind(this)})}},overlayVisibleChange:function(c,a,b){if(!c.newValue){this.videoControls.pause()}}});Package("apple.widget");apple.widget.SchoolFinder=Class.create(coherent.View,{__structure__:{"#loading":coherent.View({visibleBinding:"loading"}),"div#instructions":coherent.View({visibleBinding:"lastQuery(not)"}),"div#no-results":coherent.View({visibleBinding:"noResults"}),"table#schools-table":coherent.ListView({contentBinding:"results.schools",visibleBinding:"schoolCount",selectedObjectBinding:"school"}),"table#schools-table td.name":coherent.View({htmlBinding:"*.name"}),"table#schools-table td.location":coherent.View({htmlBinding:"*.location"}),"table#schools-table td.level":coherent.View({htmlBinding:"*.type"}),"#filter-HiEd":coherent.ToggleButton({selectionBinding:"filterSelection"}),"#filter-K12":coherent.ToggleButton({selectionBinding:"filterSelection"}),"#schoolQuery":coherent.TextField({valueBinding:"query",action:"submitQuery",sendsActionOnEndEditing:false}),"#schoolSearch":coherent.Button({action:"submitQuery",visibleBinding:"loading(not)"}),"#resultCount ":coherent.View({visibleBinding:"schoolCount"}),"#resultCount span":coherent.View({htmlBinding:"schoolCount"}),"div.more-information":coherent.View({visibleBinding:"lastQuery",animated:true}),"#school-submit":coherent.Button({animated:true,visibleBinding:"school",action:"goToSchool"})},keyDependencies:{schoolCount:["results"],noResults:["results","loading","lastQuery"]},init:function(){this.lastType=this.valueForKey("filterSelection");this.addObserverForKeyPath(this,this.resultsChanged,"results");this.addObserverForKeyPath(this,this.submitQuery,"filterSelection");Event.observe($("schoolQuery"),"click",this.textFieldClicked.bind(this));Event.observe(window,"load",function(){$("schoolQuery").focus()});if(coherent.Browser.MobileSafari){var a=Element.query("div.search-results");Element.addClassName(a,"flexible")}},textFieldClicked:function(){if($("schoolQuery").value===""){this.setValueForKey(null,"query");this.setValueForKey(null,"lastQuery");this.setValueForKey(coherent.KVO.adaptTree({schools:[]}),"results")}},schoolCount:function(){if(this._results&&"schools" in this._results){return this._results.schools.length}else{return 0}},noResults:function(){return(this.schoolCount()===0&&this.lastQuery&&!this.loading)},resultsChanged:function(c,a,b){this.setValueForKey(null,"school");apple.behavior.Striper.delay(0,$("schools-table"))},getResults:function(){return this._results},setResults:function(b){if(b.schools){b.schools.forEach(function(c){c.setValueForKey(c.city+", "+c.state+" "+c.zipcode,"location")})}this._results=b;var a=Element.query(this.viewElement(),"div.search-results td");if(a){a.scrollIntoView()}},submitQuery:function(){var c=this.query;var b=this.valueForKey("filterSelection");if(c===this.lastQuery&&b===this.lastType){return}if(c){var e={query:c,type:b},d=this.queryReturned.bind(this),a=this.queryFailed.bind(this);this.setValueForKey(true,"loading");JSONRPC.get(this.queryURL,e).addMethods(d,a);this.lastType=b;this.setValueForKey(c,"lastQuery")}},queryReturned:function(a){var b={query:this.lastQuery+" - "+this.valueForKey("filterSelection"),pageName:window.s?window.s.pageName:null,results:(a&&a.schools)?a.schools.length:0};this.setValueForKey(false,"loading");this.setValueForKey(coherent.KVO.adaptTree(a),"results")},queryFailed:function(){this.setValueForKey(false,"loading");this.setValueForKey(coherent.KVO.adaptTree({schools:[]}),"results")},goToSchool:function(){var a={school:this.school.name,pageName:window.s?window.s.pageName:null,query:this.lastQuery};window.location=this.school.url}});Package("apple");apple.SiteSearch=Class.create(coherent.Form,{defaultOptions:{suggestionsEnabled:false,suggestionsUrl:null,dropDownMenuClassName:"search-auto-complete",selectedClassName:coherent.Browser.MobileSafari?"iosHighlight":"selected",initialKeypressDelay:50,keypressDelay:250,showDelay:200,closeDelay:500,requestTimeOut:5000,text:{searchHeading:"Bsquedas",productHeading:"Productos",categoryHeading:"Categoras"}},dataBinding:[],markupTemplate:'<div class="sp-wrapper"><ul><li></li></ul></div>',searchFieldset:coherent.View(".autocomplete",{}),searchField:coherent.TextField('input[type="text"]',{valueBinding:"searchValue"}),__structure__:{".search-reset":coherent.View({visibleBinding:"showReset"}),".search-spinner":coherent.View({visibleBinding:"showSpinner"})},dropDownItemMaxWidth:undefined,formSubmissionStarted:false,onsubmit:function(a){Event.stop(a);if(!this.options.suggestionsEnabled){this.fireMetricsAndSubmit()}},init:function(){var a=this,b=Element.queryAll(".search-reset");this.base();this.options=Object.applyDefaults(this.options,this.defaultOptions);this.setupSearchField();if(this.options.suggestionsEnabled){this.enableKeyboardObservers();this.buildDropDownMenu()}this.toggleResetButton();this.requestCounter=0;this.searchFocusFlag=false;this._hiddenParams=this._hiddenParamQueryString();if(b&&b.length>0){b.forEach(function(c){Event.observe(c,"click",a.resetSearchField.bind(a))})}},setupSearchField:function(){this.searchField.viewElement().removeAttribute("placeholder");this.searchField.viewElement().setAttribute("aria-autocomplete","list");this.searchField.viewElement().setAttribute("aria-expanded","false");Event.observe(this.searchField.viewElement(),"focus",this.focus.bind(this));Event.observe(this.searchField.viewElement(),"blur",this.blur.bind(this));var b=Element.query(this.viewElement(),"button[type=submit]");if(b&&this.options.suggestionsEnabled){Event.observe(b,"keypress",this.killReturn.bind(this));var a=this;Event.observe(b,"click",function(c){if(Element.hasClassName(a.options.headerSelector,"searchmode")){a.select()}});Event.observe(b,"keypress",function(c){if(c.keyCode===Event.KEY_RETURN){a.select()}})}},killReturn:function(a){if(a.keyCode===Event.KEY_RETURN){Event.preventDefault(a)}},enableKeyboardObservers:function(){Event.observe(this.searchField.viewElement(),"keydown",this.keydown.bind(this));if(this.searchFieldset){Event.observe(this.searchFieldset.viewElement(),"keypress",this.keypress.bind(this));Event.observe(this.searchFieldset.viewElement(),"keypress",this.killReturn.bind(this))}Event.observe(this.searchField.viewElement(),"keyup",this.keyup.bind(this));Event.observe(this.searchField.viewElement(),"paste",this.paste.bind(this));Event.observe(this.searchField.viewElement(),"text",this.keyup.bind(this))},buildDropDownMenu:function(){var b=document.createElement("div");this.dropDownMenuId=Element.assignId(b);b.className=this.options.dropDownMenuClassName;Element.setStyle(b,"display","none");b.setAttribute("aria-hidden","true");b.innerHTML=this.markupTemplate;if(this.searchFieldset){this.appendDropDownMenu(b);this.searchField.viewElement().setAttribute("aria-owns",this.dropDownMenuId)}var a=b.getElementsByTagName("ul")[0];this.resultsListId=Element.assignId(a);a.setAttribute("role","listbox");Event.observe(a,"mousedown",this.selectOnClick.bindAsEventListener(this));Event.observe(a,"mouseover",this.selectMenuItem.bindAsEventListener(this))},appendDropDownMenu:function(a){this.searchFieldset.viewElement().appendChild(a)},focus:function(a){if(this.searchField.viewElement().id!=="find"){Element.addClassName(this.searchFieldset.viewElement(),"focused")}},blur:function(a){this.hide();if(this.searchField.viewElement().id!=="find"){Element.removeClassName(this.searchFieldset.viewElement(),"focused")}},keydown:function(a){switch(a.keyCode){case Event.KEY_UP:case Event.KEY_DOWN:if(this.resultsVisible){switch(a.keyCode){case Event.KEY_UP:this.activatePrev();break;case Event.KEY_DOWN:this.activateNext();break;default:break}Event.stop(a)}break;default:break}},keyup:function(a){switch(a.keyCode){case Event.KEY_ESC:this.hide();var b=Element.query(this.viewElement(),"button[type=submit]");b.disabled=false;Element.removeClassName(b,"disabled");Event.stop(a);break;case Event.KEY_RETURN:if(!this.formSubmissionStarted){this.preprocessRequest()}Event.stop(a);break;default:if(!Event.isMetaKey(a)){this.preprocessRequest()}break}this.toggleResetButton();this.checkStateSubmitButton()},keypress:function(b){var a=Element.query(this.viewElement(),".search-reset"),c=b.target||b.srcElement;if(b.keyCode===Event.KEY_RETURN){if(c===a){Event.stop(b);this.resetSearchField(b)}else{this.select()}}},paste:function(d){var c=this;function b(){c.preprocessRequest()}b.delay(10)},toggleResetButton:function(){if(this.searchField.viewElement().value.length>0){this.setValueForKey(true,"showReset")}else{this.setValueForKey(false,"showReset")}},checkStateSubmitButton:function(){var a=Element.query(this.viewElement(),"button[type=submit]");if(a&&this.searchField.viewElement().value.length>0){a.disabled=false;Element.removeClassName(a,"disabled")}else{a.disabled=true;Element.addClassName(a,"disabled")}},resetSearchField:function(c){var b=this.viewElement(),a=c.target||c.srcElement;if(b.contains(a)){this.setValueForKey("","searchValue");this.toggleResetButton();this.searchField.viewElement().focus();this.hide()}this.checkStateSubmitButton()},preprocessRequest:function(){var a;(this.requestCounter<3)?a=this.options.initialKeypressDelay:a=this.options.keypressDelay;this.setValueForKey(this.searchField.viewElement().value.replace(/^\s+$/,""),"searchValue");if(this.searchValue.length<1){this.processNoResults()}else{if(this.keyupTimeout){window.clearTimeout(this.keyupTimeout);this.keyupTimeout=null}this.keyupTimeout=this.requestSuggestionsFor.bindAndDelay(this,a,this.searchValue)}},requestSuggestionsFor:function(f){var e,d,a,c;this.cancelOutstanding();if(!window.navigator.onLine){return}this.requestCounter=this.requestCounter+1;this.setValueForKey(true,"showSpinner");c={find:f};var b={params:c,enableCache:true,callbackParamName:"method",protocol:"JSONP"};this.jsonpresponse=JSONRPC.get(this.options.suggestionsUrl,c,b);this.jsonpresponse.addCallback(this.processJSONPResponse.bind(this));this.__waitingTimer=this.cancelOutstanding.bindAndDelay(this,this.options.requestTimeOut)},processJSONPResponse:function(){this.resetSelection();if(this.__waitingTimer){window.clearTimeout(this.__waitingTimer)}if(this.searchValue.length>0&&this.jsonpresponse&&this.jsonpresponse._result){var a=this.jsonpresponse._result;this.query=a.query.toLowerCase();if(a&&a.results&&((a.results.category&&a.results.category.length)||(a.results.product&&a.results.product.length)||(a.results.search&&a.results.search.length))){this.changeData(a.results)}else{this.processNoResults()}}else{this.processNoResults()}},cancelOutstanding:function(){try{if(this.jsonpresponse){this.jsonpresponse.cancel()}}catch(a){}if(this.__waitingTimer){window.clearTimeout(this.__waitingTimer)}this.processNoResults()},addSectionList:function(h,g){var c={},a=-1,j=this.dropDownMenuId+"_"+h,f='<li class="section" id="'+j+'"><p>'+this.options.text[h+"Heading"]+"</p></li>";this.dataBinding.push({});for(var e=0,b=g.length;e<b;e++){var d=Object.applyDefaults(g[e],{section:h,rank:e+1,resultCount:b});this.dataBinding.push(d);c.display=c.original=this.sanitizeHtml(g[e].term);c.title=c.original.replace(/\"/g,"&quot;");if(h==="search"){f+='<li role="option"><span title="'+c.title+'">'+c.display+"</span></li>"}else{f+='<li role="option"><span title="'+c.title+'"><a>'+c.display+"</a></span></li>"}}return f},changeData:function(c){var b=$(this.resultsListId);var d=b.innerHTML="";this.LastSuggestions=c;this.dataBinding=[];if(c.search&&c.search.length>0){d+=this.addSectionList("search",c.search)}if(c.product&&c.product.length>0){d+=this.addSectionList("product",c.product)}if(c.category&&c.category.length>0){d+=this.addSectionList("category",c.category)}if(d){b.innerHTML=d;this.changeSelectedIndex(null);var a=$(this.dropDownMenuId);Element.setStyle(a,"display","");a.setAttribute("aria-hidden","false");this.searchField.viewElement().setAttribute("aria-expanded","true");this.resultsVisible=true;this.truncateAndHighlight(b);this.setValueForKey(false,"showSpinner")}},sanitizeHtml:function(b){var a=document.createElement("textarea");a.innerHTML=b;return a.value},truncateAndHighlight:function(d){var j,q,a,u,h=this.dropDownItemMaxWidth,f,g,r,b,e,c;var p=document.documentElement.style,o=("textOverflow" in p||"OTextOverflow" in p);for(var m=0,k=d.childNodes.length;m<k;m++){if(d.childNodes[m].className!=="section"){j=d.childNodes[m];j.setAttribute("menuIndex",m);j.setAttribute("aria-selected","false");this.resultslistElementId=Element.assignId(j);q=j.getElementsByTagName("span");if(q&&q.length>0){u=q[0];if(h===undefined){h=parseInt(Element.getStyle(u,"width"),10);this.dropDownItemMaxWidth=h=isNaN(h)?0:h}a=u.getElementsByTagName("a");if(a&&a.length>0){u=a[0]}}if(!o){apple.util.addOverflowEllipsis(u,h)}g=(u.textContent||u.innerText);b=this.dataBinding[m].highlights;var l="",t;for(t=b.length-1;t>=0;t--){e=b[t][0];c=b[t][1];if(e<g.length){l="<strong>"+g.substring(e,c)+"</strong>"+g.substring(c)+l;g=g.substring(0,e)}}u.innerHTML=g+l}}},selectMenuItem:function(b){var c=b.target||b.srcElement,a=Element.locateAncestor(c,function(d){return d.tagName==="LI"});if(a){this.changeSelectedIndex(a.getAttribute("menuIndex"),true);Event.stop(b)}},changeSelectedIndex:function(f,i){var j;var e=$(this.resultsListId),a=e.childNodes,h=(f!==null&&!isNaN(f)&&f<0)?a.length-1:f,g=this.selectedIndex,c=this.options.selectedClassName,i=i?i:false;if(g!==null&&!isNaN(g)&&g>=0){Element.removeClassName(a[g],c);a[g].setAttribute("aria-selected","false");forceRedraw(a[g])}if(h!==null&&!isNaN(h)){j=a[h%a.length];if(this.listItemHasHeading(j)){this.skipSectionHeading(g,h)}else{Element.addClassName(a[h%a.length],c);e.offset=e.offset+a[h%a.length].offset;a[h%a.length].setAttribute("aria-selected","true");this.searchField.viewElement().setAttribute("aria-activedescendant",j.getAttribute("id"));forceRedraw(a[h%a.length]);this.selectedIndex=(h%a.length);var k=a[h%a.length],d=e.offsetHeight,b=(Math.floor(k.offsetTop/d))*d;if(!i&&b!==e.scrollTop){e.scrollTop=b}}}else{this.selectedIndex=h}},skipSectionHeading:function(b,a){if(b===null||a>b){this.changeSelectedIndex(a+1)}else{this.changeSelectedIndex(a-1)}},listItemHasHeading:function(a){return(a.getElementsByTagName("p").length===1)},updateSearchFieldValue:function(a){this.searchField.viewElement().value=a},activatePrev:function(){if(this.selectedIndex===null||isNaN(this.selectedIndex)){this.selectedIndex=1}this.changeSelectedIndex(this.selectedIndex-1)},activateNext:function(){if(this.selectedIndex===null||isNaN(this.selectedIndex)){this.selectedIndex=-1}this.changeSelectedIndex(this.selectedIndex+1)},hide:function(){if(this.searchFocusFlag===true){this.searchFocusFlag=false;this.searchField.viewElement().focus();return}this.hideImpl();this.resetSelection()},hideImpl:function(){if(this.options.suggestionsEnabled){var a=$(this.dropDownMenuId);Element.setStyle(a,"display","none");this.resultsVisible=false;a.setAttribute("aria-hidden","true");this.searchField.viewElement().setAttribute("aria-expanded","false")}},processNoResults:function(){this.hide();this.setValueForKey(false,"showSpinner")},selectOnClick:function(a){var b=a.target||a.srcElement;if(b.nodeName.toUpperCase()==="UL"){this.searchFocusFlag=true;return}this.select()},reset:function(){this.setValueForKey(false,"showSpinner");this.setValueForKey(false,"showReset");this.hide()},resetSelection:function(){delete this.selectedIndex},select:function(){this.hideImpl.bindAndDelay(this,100);this.searchField.viewElement().focus();this.fireMetricsAndSubmit();this.formSubmissionStarted=true},_hiddenParamQueryString:function(){var c=this.viewElement(),e=Element.queryAll(c,"input[type=hidden]"),b={};if(e){for(var a=0,d=e.length;a<d;a++){b[e[a].name]=e[a].value}}return Object.toQueryString(b)},fireMetricsAndSubmit:function(){if(Element.query(this.viewElement(),"button[type=submit]").disabled){return}var c=this.selectedIndex?this.dataBinding[this.selectedIndex]:null,b=function(d){return encodeURIComponent(d.replace(/[\s\'\"]+/g,"-"))},a=function(){var e,d,f=window.location;if(c&&c.path){c.path+=(c.path.indexOf("?")===-1)?"?":"&";c.path+=this._hiddenParams;f.href=c.path}else{if(c){this.updateSearchFieldValue(c.term)}e=this.searchField.viewElement().form.action;e=e.replace("&amp;","&");e=e.replace(f.search,"");d=this.searchField.viewElement().value;f.href=e+"/"+b(d)+f.search}}.bind(this);this.getSearchConfig();this.fireMetricsEvent(c,function(){this.action=null;if(this.LastSuggestions&&this.LastSuggestions.search){var d=[];for(var f=0,e=this.LastSuggestions.search.length;f<e;f++){d.push(this.LastSuggestions.search[f].term)}}apple.behavior.metrics.storePageEventData(this.viewElement());a()}.bind(this))},getSearchConfig:function(){var a=new apple.metrics.Metrics({});var b=a.getObjectCookie()||{};if(b.searchConfig){this.addSearchConfigValueToForm(b.searchConfig)}},addSearchConfigValueToForm:function(b){var a=document.createElement("input");a.setAttribute("type","hidden");a.setAttribute("name","searchConfig");a.setAttribute("value",b);this.viewElement().appendChild(a)},fireMetricsEvent:function(a,d){var b={linkTrackVars:"events,eVar2",linkTrackEvents:"event8",events:"event8"},c=this.searchField.viewElement().value;if(!a){b.eVar2=c}else{b.eVar2=a.term;b.linkTrackVars+=",eVar23";b.eVar23=[c,a.section,a.resultCount,a.term,a.rank].join(" | ")}apple.Tracking.track(this.viewElement(),"search",b,d)}});var forceRedraw=(function(){var a;if(coherent.Browser.IE===8){a=function(c){var b=c.paddingLeft;c.paddingLeft="1px";window.setTimeout(function(){c.paddingLeft=b},1)}}else{a=function(b){}}return a})();Package("apple");apple.SiteSearchLiquid=Class.create(apple.SiteSearch,{setupSearchField:function(){this.base();var c=Element.query(this.viewElement(),"button[type=reset]"),b=Element.query(this.viewElement(),"button[type=submit]"),a=this;if(c){Event.observe(c,"keydown",this.buttonFocusOut.bindAsEventListener(this))}if(b){Event.observe(b,"click",function(d){if(Element.hasClassName(document.querySelector(a.options.headerSelector),"searchmode")){a.select()}})}Event.observe(document.body,"touchend",this.searchCloseMenu.bindAsEventListener(this))},searchCloseMenu:function(a){var b=this,d=$(a.target)||$(a.srcElement),c=Element.locateAncestor(d,function(e){return e.id==="gh-tab-search"});if(Element.hasClassName(document.querySelector(b.options.headerSelector),"searchmode")&&!c){Element.removeClassName(b.searchFieldset.viewElement(),"focused");Element.removeClassName(document.querySelector(b.options.headerSelector),"searchmode active");document.querySelector(".gh-search-input").blur();Element.addClassName(document.querySelector(b.options.inputLabelSelector),"a11y");Element.removeClassName(document.querySelector(b.options.inputLabelSelector),"focus")}},appendDropDownMenu:function(a){this.searchFieldset.viewElement().parentElement.appendChild(a)},blur:function(a){if(this.searchField.viewElement().id!=="find"){Element.removeClassName(this.searchFieldset.viewElement(),"focused")}},buttonFocusOut:function(a){if(a.keyCode===Event.KEY_TAB&&!a.shiftKey){this.hide()}}});Package("apple.widget");apple.widget.SlidingTrackStack=function(b,a,c){c=c||{};this.narrow=false;this.trackStack=[];this.settings=Object.applyDefaults(c,{animated:true,trackFloatSelector:null,stackFloatSelector:null,minHeight:655,hasStack:true,floatingClassName:"floating",offscreenClassName:"offscreen",lastClassName:"last",narrowClassName:"narrow"});this.buildTrackStack(b,a)};apple.widget.SlidingTrackStack.prototype.buildTrackStack=function(c,b){var f=a(c)?Element.query(c):c,e,d;this.trackStack.push({track:f,trackId:f.id,floater:this.getFloater(f)});if(this.settings.hasStack){e=a(b)?Element.queryAll(b):b;e.forEach(function(g){d=this.getFloater(g);this.trackStack.push({track:g,trackId:g.id,floater:this.getFloater(g)})},this)}function a(g){return typeof g==="string"}this.setScrollInfo();Event.observe(window,"scroll",this.viewportScrolled.bind(this));Event.observe(window,"resize",this.viewportResized.bind(this));Event.observe(f,"click",this.scrollToCoords.bind(this))};apple.widget.SlidingTrackStack.prototype.getFloater=function(b,a){return a?Element.query(a):b.children[0]};apple.widget.SlidingTrackStack.prototype.setScrollInfo=function(){var d=0,b=0,a=this.trackStack.length,c;for(b;b<a;b++){c=this.trackStack[b];if(c.floating){this.unsetFloating(c)}c.offset=d;c.trackRect=Element.getRect(c.track);c.floatRect=Element.getRect(c.floater);if(c.floating){this.setFloating(c)}d=d+c.floatRect.height}this.viewportResized()};apple.widget.SlidingTrackStack.prototype.scrollToCoords=function(a){if(this.narrow||!a){return}var h=Element.getViewport(),g=a.target||a.srcElement,c=Element.locateAncestor(g,function(j){return j.tagName.toLowerCase()=="div"}),f=c.className.replace(/\s.*/,""),i=0,b=this.trackStack.length,d,e;for(i;i<b;i++){if(c.className==this.trackStack[i].track.className){d=this.trackStack[i];break}}if(!d){return}e=d.floatRect.top-d.offset;if(e==Element.getViewport().top){d=this.trackStack[i+1];if(!d){return}e=d.floatRect.top-d.offset}if(this.settings.animated){coherent.Animator.scrollTo([0,e])}else{window.scrollTo(0,e)}};apple.widget.SlidingTrackStack.prototype.setFloating=function(a){Element.addClassName(a.track,this.settings.floatingClassName);Element.removeClassName(a.track,this.settings.lastClassName);Element.setStyle(a.floater,"position","fixed");Element.setStyle(a.floater,"top",a.offset+"px")};apple.widget.SlidingTrackStack.prototype.unsetFloating=function(a){Element.removeClassName(a.track,this.settings.floatingClassName);Element.removeClassName(a.track,this.settings.lastClassName);Element.removeClassName(a.track,this.settings.offscreenClassName);Element.setStyle(a.floater,"position","");Element.setStyle(a.floater,"top","")};apple.widget.SlidingTrackStack.prototype.viewportScrolled=function(){var a=Element.getViewport(),f=0,d=0,c=0,b=this.trackStack.length,e;if(this.narrow){return}for(c;c<b;c++){e=this.trackStack[c];if(e.trackRect.top<=a.top+e.offset){this.setFloating(e);e.floating=true;f=c}else{this.unsetFloating(e);e.floating=false}d=a.top+e.offset+e.floatRect.height;if(d>=e.trackRect.bottom){Element.addClassName(e.track,this.settings.offscreenClassName)}else{Element.removeClassName(e.track,this.settings.offscreenClassName)}}Element.addClassName(this.trackStack[f].track,this.settings.lastClassName)};apple.widget.SlidingTrackStack.prototype.viewportResized=function(){var e=document.documentElement.clientWidth,b=document.documentElement.clientHeight,c=coherent.Browser.IE?document.body.scrollWidth:document.documentElement.scrollWidth,a=this.trackStack.length,d=0;if(coherent.Browser.MobileSafari||e<c||b<this.settings.minHeight){this.narrow=true}else{this.narrow=false}if(this.narrow){for(d;d<a;d++){this.unsetFloating(this.trackStack[d])}Element.addClassName(this.trackStack[0].track,this.settings.narrowClassName)}else{this.viewportScrolled();Element.removeClassName(this.trackStack[0].track,this.settings.narrowClassName)}};Package("apple.widget");apple.widget.SlidingTrackView=Class.create((function(){var j={PINNED_TOP:"pinned_top",FLOATING:"floating",PINNED_BOTTOM:"pinned_bottom"};var c="load";var g="touchstart";var e="touchmove";var a="touchend";var f="touchcancel";var i="scroll";var k="resize";var h=[c,g,e,a,f,i,k];var d=coherent.Browser.MobileSafari?-121:0;var b={pinned_top:function(){if(!coherent.Browser.MobileSafari){if(!this.isFloatingDisabled&&this._trackFrame.top<d&&this._viewport.height>=this._itemFrame.height){if(this._trackFrame.bottom<this._itemFrame.height){return this.setState(j.PINNED_BOTTOM)}if(this._viewport.height>this._itemFrame.height){return this.setState(j.FLOATING)}}}},floating:function(){if(!coherent.Browser.MobileSafari){if(this.isFloatingDisabled||this._trackFrame.top>d||this._viewport.height===this._itemFrame.height||this._trackFrame.bottom==this._itemFrame.bottom){return this.setState(j.PINNED_TOP)}if(this._trackFrame.bottom<=this._itemFrame.bottom){return this.setState(j.PINNED_BOTTOM)}}},pinned_bottom:function(){if(!coherent.Browser.MobileSafari){if(this._itemFrame.top>=d){if(this._itemFrame.bottom===this._trackFrame.bottom&&this._trackFrame.top>=d){return this.setState(j.PINNED_TOP)}else{return this.setState(j.FLOATING)}}}}};return{constructor:function(t,v){var u=coherent.Browser.IE!==6&&Element.isFixedPositionSupported();var m=/AppleWebKit\/(\d+(?:\.\d+)?)/;var r=m.exec(navigator.userAgent);var p=(r&&parseInt(r[1],10)>=536);if(u||p){var q=h.length;var l=Array.from(t.childNodes);var n;var o;this.view=t;while((o=l.shift())){if(o.nodeType==1&&!n){n=o;continue}if(v==undefined){v=""}if(!!v.cleanup){t.removeChild(o)}}this.isFloatingDisabled=false;this.shouldHideFloating=coherent.Browser.MobileSafari;this._item=coherent.View.fromNode(n);if(this._item===null){this._item=new coherent.View(n)}this._viewport=Element.getViewport();this._trackFrame=Element.getRect(t,true);this._itemFrame=Element.getRect(n,true);this.setState(j.PINNED_TOP);this.updateItemPosition();this._item.addObserverForKeyPath(this,this.itemFrameChanged,"frame");Event.observe(window,"pageshow",this.pageShowHandler.bindAsEventListener(this));if(window.addEventListener){while(q--){window.addEventListener(h[q],this,false)}}else{this.boundHandleEvent=this.handleEvent.bindAsEventListener(this);while(q--){Event.observe(window,h[q],this.boundHandleEvent)}}}},pageShowHandler:function(m){var l=h.length;if(m.persisted){if(window.addEventListener){while(l--){window.removeEventListener(h[l],this,false)}}else{this.boundHandleEvent=this.handleEvent.bindAsEventListener(this);while(l--){Event.observe(window,h[l],this.boundHandleEvent)}}}},iOSRail:function(){var m=document.getElementById("secondary"),q=195,l=(window.pageYOffset+this._itemFrame.height),n=(this._trackFrame.height+q),p=(window.pageYOffset>q)?((window.pageYOffset-q)+"px"):0,o=document.documentElement.clientHeight;if(this._itemFrame.height>this._viewport.height){m.style.top="0px"}else{if(this._trackFrame.top<=0){if(l<=n){m.style.top=p;m.style.bottom=""}else{m.style.bottom="0px";m.style.top=""}}else{m.style.bottom="";m.style.top="0px"}}},handleEvent:function(l){switch(l.type){case c:case k:this.viewportResized();break;default:if(this.shouldHideFloating){switch(l.type){case f:case i:this.iOSRail();break;default:break}}this.viewportScrolled();break}},viewportResized:function(m){var l=this._viewport?this._viewport.width:0;this._viewport=Element.getViewport();if(coherent.Browser.Safari){this.setState(j.PINNED_TOP)}if(coherent.Browser.IE){this.isFloatingDisabled=document.documentElement.clientWidth<document.body.scrollWidth}else{this.isFloatingDisabled=document.documentElement.clientWidth<document.documentElement.scrollWidth}this.viewportScrolled()},viewportScrolled:function(){this._trackFrame=Element.getRect(this.view,true);this._itemFrame=Element.getRect(this._item.viewElement(),true);this.updateItemPosition()},updateItemPosition:function(){if("willResizeFrame" in this._item){var l=Object.applyDefaults({},this._itemFrame);l.top=Math.max(0,this._trackFrame.top);l.bottom=Math.min(this._trackFrame.bottom,this._viewport.height);l.height=l.bottom-l.top;if(this._viewport.height>this._itemFrame.height&&this._item.willResizeFrame(l)){this._itemFrame=this._item.resizeFrame(l)}}this._stateSwitcher()},itemFrameChanged:function(n,l,m){this._itemFrame=n.newValue;this.updateItemPosition()},setState:function(m){if(this._currentState==m){return}var l=this.view;Element.removeClassName(l,this._currentState);Element.addClassName(l,m);this._currentState=m;this._stateSwitcher=b[m]}}})());Package("apple.widget");apple.widget.SmartTextField=function(a){this.textAreaNodeId=a.textAreaElementId;this.errNodeId=a.errDivElementId;this.checkServerURL=a.checkServerURL;this.sid=a.sid;this.partNumber=a.partNumber;this.inFlight=false;this.resubmit=false;this.serverError="";this.wrappedText="";this.previewDivId="";this.timer=-1;this.cancelledRequest=false;$(this.textAreaNodeId).stf=this;Event.onDomReady(this.init.bind(this))};apple.widget.SmartTextField.prototype.init=function(){var a=$(this.textAreaNodeId);var c=null;var b=(function(d){if(c){window.clearTimeout(c)}c=this.afterKeypress.bindAndDelay(this,1000,d)}).bind(this);Event.observe(a,"keyup",b)};apple.widget.SmartTextField.prototype.checkServer=function(){this.timer=-1;this.inFlight=true;this.resubmit=false;var e=this;if(this.checkServerURL){var d=function(f){if(!e.cancelledRequest){if(f!="BAD REQUEST"&&f.substring(0,6)!="<html>"){e.inFlight=false;e.serverError="";if(e.resubmit){e.resubmit=false;e.checkServerSoon()}if(f.substr(0,2)!="OK"){e.serverError=f}if(f.substr(0,3)=="OK:"){e.wrappedText=f.substring(3);if(e.previewDivId){$(e.previewDivId).innerHTML=e.wrappedText}}e.showError()}}};var a=function(f){return};var c={mt:$(e.textAreaNodeId).value,pn:this.partNumber,wosid:this.sid};var b=XHR.post(this.checkServerURL,c);b.addMethods(d,a)}};apple.widget.SmartTextField.prototype.checkServerSoon=function(){this.cancelledRequest=false;if(!this.inFlight){if(this.timer!=-1){window.clearTimeout(this.timer)}var a=this;this.timer=window.setTimeout(function(){a.checkServer()},500)}else{this.resubmit=true}};apple.widget.SmartTextField.prototype.afterKeypress=function(a){this.checkServerSoon();return};apple.widget.SmartTextField.prototype.showError=function(){var a=$(this.errNodeId);a.innerHTML=this.serverError.replace(/</,"&lt;")};apple.widget.SmartTextField.prototype.setPreviewDivId=function(a){this.previewDivId=a};apple.widget.SmartTextField.prototype.cancelRequest=function(){this.cancelledRequest=true;this.inFlight=false;this.resubmit=false};Package("apple.widget");apple.widget.SuggestViewController=Class.create(coherent.ViewController,{__structure__:{},init:function(){}});Package("apple.widget");apple.widget.SyncContent=function(a){this.config=a;this.change()};apple.widget.SyncContent.prototype.getContent=function(){var a=null;var b=(function(c){if(c.body&&c.body.content){a=c.body.content}}).bind(this);apple.io.json.invoke({url:this.getUrl(),sync:true,success:b,scriptKeys:["content"]});return a};apple.widget.SyncContent.prototype.change=function(){var a=this.getContent();if(a){document.write(a)}};apple.widget.SyncContent.prototype.getUrl=function(){return this.config.url};Package("apple.widget");apple.widget.TabController=function(a){this.base("constructor")(a)};apple.util.makeSubclass(apple.widget.TabController,apple.widget.BaseWidget);apple.widget.TabController.DEFAULTS={activeClass:coherent.Style.kActiveClass,inactiveClass:"inactive",transition:"crossfade",animate:false,autoRotate:false,advanceInterval:8000,transitionDuration:1000};apple.widget.TabController.prototype.init=function(){var c=$(this.config.contentId),j=this.config.selectedTabId,i=this.tabContentIdFromTabId(j),b,g,h,e=window.location.hash.match(/^#tab(\d+)$/),d,a,f=Element;if(!$(i)){b=document.createElement("div");b.id=this.config.contentId;b.className=c.className;c.id=i;c.className="";c=c.parentNode.replaceChild(b,c);b.appendChild(c)}g={id:this.config.contentId,duration:this.config.transitionDuration,transition:this.config.transition};this._swapper=new apple.fx.ContentSwapper(g);this.getTabIds();this.setupWrapperEvents();if(j){a=$(j).parentElement;if(a&&!f.hasClassName(a,this.config.activeClass)){f.addClassName(a,this.config.activeClass)}}if(c){f.addClassName(c,"tab-container")}if(e&&e[1]){e=parseInt(e[1],10)-1;for(d in this.config.tabs){if(this.config.tabs.hasOwnProperty(d)){h=d.match(/(\d+)$/);if(!h||h[1]!==e){continue}this.selectTab(d);break}}}this.resume()};apple.widget.TabController.prototype.calculateTabHeights=function(g){var b=$(g),a=document.createElement("li"),d,j,e,c,f,h;a.innerHTML='<a href="#"><strong>one line</strong></a>';b.appendChild(a);d=parseInt(Element.getStyles(a.getElementsByTagName("strong")[0],"height"),10);b.removeChild(a);j=b.getElementsByTagName("strong");e=j.length;for(c=0;c<e;c+=1){f=j[c];h=parseInt(Element.getStyles(f,"height"),10);if(h>d){Element.addClassName(f.parentNode.parentNode,"two-line")}}};apple.widget.TabController.prototype.getTabIds=function(){var a;this.config.tabIds=[];for(a in this.config.tabs){if(this.config.tabs.hasOwnProperty(a)){this.config.tabIds.push(a)}}return this.config.tabIds};apple.widget.TabController.prototype.setupWrapperEvents=function(){var a;if(!this.config.wrapperId){return}a=$(this.config.wrapperId);if(a){Event.observe(a,"mouseover",this.pause.bindAsEventListener(this));Event.observe(a,"mouseout",this.resume.bindAsEventListener(this))}};apple.widget.TabController.prototype.pause=function(){if(!this.config.autoRotate){return}this.paused=true;if(this.timer){window.clearTimeout(this.timer)}this.timer=null};apple.widget.TabController.prototype.resume=function(a){if(!this.config.autoRotate){return}if(a){this.paused=false}if(this.timer){window.clearTimeout(this.timer)}this.timer=this.showNextTab.bindAndDelay(this,this.config.advanceInterval)};apple.widget.TabController.prototype.showNextTab=function(){var a,c,b;if(this.paused||this.locked){return}a=this.config.selectedTabId;c=this.config.tabIds||this.getTabIds();b=c.indexOf(a);if(b===c.length-1){b=0}else{b+=1}this.selectTab(c[b],"advance")};apple.widget.TabController.prototype.preloadNextTab=function(){var a=this.config.selectedTabId,g=this.config.tabIds||this.getTabIds(),d=g.indexOf(a),c,b,f;if(d===g.length-1){d=0}else{d+=1}c=g[d];if($(this.tabContentIdFromTabId(c))){return}function e(i){var h;if(!i||!i.body){return}h=coherent.Scripts.extract(i.body.content);this.insertTabContent(c,h)}b=this.config.tabContentUrl||this.config.tabs[c];b=b.url||b;b=apple.util.expandTemplate(b,{tabId:c});f={url:b,success:e.bind(this),scriptKeys:["content"]};apple.io.json.invoke(f)};apple.widget.TabController.prototype.tabContentIdFromTabId=function(a){return[this.config.contentId,a].join("_")};apple.widget.TabController.prototype.insertTabContent=function(b,c){var a,d;if($(this.tabContentIdFromTabId(b))){return null}a=$(this.config.contentId);d=document.createElement("div");d.id=this.tabContentIdFromTabId(b);Element.setInnerHTML(d,c);d.style.display="none";a.appendChild(d);return d};apple.widget.TabController.prototype.activateTab=function(b){var e,d,a,f=this;if(this.config.selectedTabId){e=$(this.config.selectedTabId);if(!this.config.animate){Element.removeClassName(e,this.config.activeClass);Element.removeClassName(e.parentNode,this.config.activeClass);Element.addClassName(e,this.config.inactiveClass);Element.addClassName(e.parentNode,this.config.inactiveClass)}d=this.tabContentIdFromTabId(this.config.selectedTabId)}this.config.selectedTabId=b;if(b){e=$(b);if(this.config.animate){coherent.Animator.replaceClassName(e,this.config.inactiveClass,this.config.activeClass,{duration:250,curve:coherent.easing.outSine});coherent.Animator.replaceClassName(e.parentNode,this.config.inactiveClass,this.config.activeClass,{duration:250,curve:coherent.easing.outSine})}else{Element.removeClassName(e,this.config.inactiveClass);Element.removeClassName(e.parentNode,this.config.inactiveClass);Element.addClassName(e,this.config.activeClass);Element.addClassName(e.parentNode,this.config.activeClass)}a=this.tabContentIdFromTabId(b)}function c(){f.locked=false;f.resume();$(a).style.zoom=1;if(f.config.autoRotate){f.preloadNextTab()}}this._swapper.swap(this.config.transition,d,a,c)};apple.widget.TabController.prototype.selectTab=function(d,g){var j,c,h,a,e,b,i;if(g===undefined){g="click"}if(this.locked){return}if(this.config.selectedTabId===d){return}if(g==="click"){this.config.autoRotate=false}j=this.tabContentIdFromTabId(d);if(this.timer){window.clearTimeout(this.timer);this.timer=null}this.locked=true;c=this.config.baseMetrics;if(c!=="undefined"&&c&&g==="click"){h=this.config.tabs[d].displayName;a=apple.util.expandTemplate(c,{index:h});apple.metrics.Metrics.reportCustomLink(null,a)}if(this.config.selectedTabId){e=$(this.config.selectedTabId);if(this.config.animate){coherent.Animator.replaceClassName(e,this.config.activeClass,this.config.inactiveClass,{duration:250,curve:coherent.easing.inSine});coherent.Animator.replaceClassName(e.parentNode,this.config.activeClass,this.config.inactiveClass,{duration:250,curve:coherent.easing.inSine})}}if($(j)){this.activateTab(d);return}function f(l){var k;if(this.config.selectedTabId===d){return}if(!l||!l.body){return}k=coherent.Scripts.extract(l.body.content);this.insertTabContent(d,k);this.activateTab(d)}b=this.config.tabContentUrl||this.config.tabs[d];b=b.url||b;b=apple.util.expandTemplate(b,{tabId:d});i={url:b,success:f.bind(this),scriptKeys:["content"]};apple.io.json.invoke(i)};Package("apple.widget");apple.widget.TextField=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.TextField,apple.widget.BaseWidget);apple.widget.TextField.DEFAULTS={placeholder:"No Value",placeholderClass:"placeholder"};apple.widget.TextField.prototype.init=function(){var b=this.widget();Event.observe(b,"focus",this.fieldReceivedFocus.bindAsEventListener(this));Event.observe(b,"blur",this.fieldLostFocus.bindAsEventListener(this));this._maxLength=b.maxLength||-1;var a=(b.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(""!==a&&this.config.placeholder!==a){return}b.maxLength=this.config.placeholder.length;b.value=this.config.placeholder;Element.addClassName(b,this.config.placeholderClass)};apple.widget.TextField.prototype.fieldReceivedFocus=function(a){var c=this.widget();var b=(c.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(this.config.placeholder===b){c.value=""}if(-1!=this._maxLength){c.maxLength=this._maxLength}else{c.removeAttribute("maxLength")}Element.removeClassName(c,this.config.placeholderClass)};apple.widget.TextField.prototype.fieldLostFocus=function(a){var c=this.widget();var b=(c.value||"").replace(/^\s+/,"").replace(/\s+$/,"");if(""!==b){return}Element.addClassName(c,this.config.placeholderClass);this._maxLength=c.maxLength||-1;c.maxLength=this.config.placeholder.length;c.value=this.config.placeholder};Package("apple.widget");apple.widget.VoteController=function(a){this.config=Object.applyDefaults(a,this.DEFAULTS);Event.onDomReady(this.init.bind(this))};apple.widget.VoteController.prototype.DEFAULTS={voteYesValue:1,voteNoValue:0,voteClass:"vote",voteYesClass:"yes",voteNoClass:"no",messageClass:"useful",voteIdRegex:/-(\w+)$/,fadeDuration:200};apple.widget.VoteController.prototype.init=function(){var a=document.getElementById(this.config.elementId);if(!a){return}this.attachVoteEvents(Element.getElementsByClassName(this.config.voteYesClass,a),this.voteYes.bindAsEventListener(this));this.attachVoteEvents(Element.getElementsByClassName(this.config.voteNoClass,a),this.voteNo.bindAsEventListener(this))};apple.widget.VoteController.prototype.attachVoteEvents=function(b,c){function a(d){Event.observe(d,"click",c)}Array.forEach(b,a)};apple.widget.VoteController.prototype.voteYes=function(a){var b=(a.srcElement||a.target);Event.stop(a);this.sendVote(b,this.config.voteYesValue)};apple.widget.VoteController.prototype.voteNo=function(a){var b=(a.srcElement||a.target);Event.stop(a);this.sendVote(b,this.config.voteNoValue)};apple.widget.VoteController.prototype.sendVote=function(e,b){var d=this.getVoteElem(e);var f=this.getVoteId(d);if(f){apple.io.json.invoke({url:this.config.requestUrl,urlArgs:{voteId:f,vote:b}})}if(this.config.type=="answer"){var a=Element.query(d,"input[name='featureType']");var c=a?a.value:null;this.reportEvent(b,c)}this.displayFeedbackMessage(e)};apple.widget.VoteController.prototype.displayFeedbackMessage=function(g){var e=this.getMessageElem(g);var f=this.getVoteElem(g);var h=this.config.feedbackMessage;var c=this.config.fadeDuration;var b=document.createElement("p");b.className="vote-msg";b.setAttribute("role","alert");b.setAttribute("tabindex","-1");var d=function(){b.innerHTML=h;e.parentNode.removeChild(e);f.innerHTML="";f.appendChild(b);Element.setOpacity(f,0);coherent.Animator.setStyles(f,{opacity:1},{duration:c,cleanup:true});f.firstChild.focus()};var a=parseInt(Element.getStyles(f,"height"),10);if(!isNaN(a)){f.style.height=Math.max(a,0)+"px"}coherent.Animator.setStyles(f,{opacity:0},{duration:c,callback:d})};apple.widget.VoteController.prototype.getVoteElem=function(b){var c=this.config.voteClass;var a=b.parentNode;while(a&&a!=document.body){if(a.className==c){return a}a=a.parentNode}return null};apple.widget.VoteController.prototype.getMessageElem=function(c){var a=null;var b=this.getVoteElem(c);var d=Element.getElementsByClassName(this.config.messageClass,b);if(d&&d.length>0){a=d[0]}return a};apple.widget.VoteController.prototype.getVoteId=function(b){if(!b||!b.id){return null}var c=null;var a=this.config.voteIdRegex.exec(b.id);if(a&&a.length>1){c=a[1]}return c};apple.widget.VoteController.prototype.reportEvent=function(a,b){var c=(a==1)?"Useful":"Not Useful";apple.metrics.fireMicroEvent({page:window.s.pageName,feature:(b||"Product")+" vote",part:window.s.prop25,action:c})};Package("apple.widget");apple.widget.WhyBuyEmailSubscription=function(b,a){this.base("constructor")(b,a)};apple.util.makeSubclass(apple.widget.WhyBuyEmailSubscription,apple.widget.BaseWidget);var ServerStatus={good:"SUCCESS",bad:"ERROR",busy:"BUSY",off:"OFF",on:"ON",format:"FORMAT"};apple.widget.WhyBuyEmailSubscription.DEFAULTS={emailPlaceholder:"example: user@example.com",submitUrl:"email-server-reply.txt",urlArgs:{},argName:"emailAddress",emailFieldSpec:"input.notify_email",submitButtonSpec:".notify_submit",formSpec:"form",fadeDuration:350,showForm:{SUCCESS:false,ERROR:false,BUSY:false,ON:true,OFF:false,FORMAT:true},loadingClass:"loading",rpcTimeout:10000,emailRegex:/^[A-Z0-9._%+-]+@(?:[A-Z0-9-]+\.)+[A-Z]{2,4}$/i};apple.widget.WhyBuyEmailSubscription.prototype.init=function(){var f={duration:this.config.fadeDuration};this._animator=new apple.fx.Animator(f);this.setStatus("OFF");this.setStatus("ON");var b=this.part(this.config.formSpec);var e=this.part(this.config.emailFieldSpec);var a={placeholder:this.config.emailPlaceholder};this._field=new apple.widget.TextField(e.id,a);this._actions=[];var d=this.part(this.config.submitButtonSpec);var c=this.submitHandler.bindAsEventListener(this);Event.observe(d,"click",c);Event.observe(b,"submit",c)};apple.widget.WhyBuyEmailSubscription.prototype.showHideForm=function(a){var b=this.config.showForm[this._status];var d=this.config.showForm[a];var c=this.part(this.config.formSpec);if(b!=d){if(d){this._actions.push(new apple.fx.Fade(apple.fx.linearTween,c,0,1))}else{this._actions.push(apple.fx.Fade(apple.fx.linearTween,c,1,0))}}};apple.widget.WhyBuyEmailSubscription.prototype.displayStatusUpdate=function(a){var b=Element.query("#email_notification .notify_on p");b.style.opacity="0";a="notify_"+a.toLowerCase();b.innerHTML=this.config.msgText[a];this._actions.push(new apple.fx.Fade(apple.fx.linearTween,b,0,1))};apple.widget.WhyBuyEmailSubscription.prototype.partSpecForStatus=function(a){return"div.notify_"+(a||"").toLowerCase()};apple.widget.WhyBuyEmailSubscription.prototype.setStatus=function(g,j,l){g=g||"ERROR";if(g==this._status){return}var f=this.widget();var a=this.part(this.config.formSpec);var b=this.config.showForm[this._status];var k=this.config.showForm[g];var h=this.part(this.partSpecForStatus(this._status));var i=this.part(this.partSpecForStatus(g));if(!this._status){a.style.display=k?"block":"none";i.style.display="block";this._status=g;return}if(l){a.style.display=k?"block":"none";i.style.display="block";h.style.display="none";this._status=g;return}var c=new apple.fx.Fade(apple.fx.linearTween,h,1,0);var e=new apple.fx.Fade(apple.fx.linearTween,i,0,1);var m;var d=[c,e];if(g!="ON"&&g!="OFF"){this.displayStatusUpdate(g);this.showHideForm(g);this._status=g;this._animator.play(new apple.fx.Chain(this._actions),j)}else{if(b!=k){if(k){m=new apple.fx.Fade(apple.fx.linearTween,a,0,1);d=[c,new apple.fx.Blend(e,m)]}else{m=new apple.fx.Fade(apple.fx.linearTween,a,1,0);d=[new apple.fx.Blend(c,m),e]}}this._status=g;this._animator.play(new apple.fx.Chain(d),j)}};apple.widget.WhyBuyEmailSubscription.prototype.rpc=function(d,g,c){if(-1!=d.indexOf("?")){d=d+"&"}else{d=d+"?"}d+="bustCache="+(new Date()).getTime().toString(16)+":"+Math.random();var f;var b=document.createElement("script");b.src=d;function a(){window.clearTimeout(f);f=null;if(g){g.apply(window,arguments)}}function e(){window.signalStatus=function(){};if(c){c()}}window.signalStatus=a;f=window.setTimeout(e,this.config.rpcTimeout);document.getElementsByTagName("HEAD")[0].appendChild(b)};apple.widget.WhyBuyEmailSubscription.prototype.submitHandler=function(e){(e.target||e.srcElement).blur();Event.stop(e);var g=this.widget();var h=this.part(this.config.emailFieldSpec);if(!h||!this.config.submitUrl){return}var f=h.value||"";if(!f.match(this.config.emailRegex)){this.setStatus("FORMAT");h.focus();h.select();return}Element.addClassName(g,this.config.loadingClass);function d(){Element.removeClassName(g,this.config.loadingClass)}function a(j){j=j.replace(/^\s*/,"").replace(/\s*$/,"").toLowerCase();var i=ServerStatus[j];this.setStatus(i,d.bind(this))}var c=Object.applyDefaults({},this.config.urlArgs);c[this.config.argName]=f;var b=[this.config.submitUrl,Object.toQueryString(c)].join("?");this.rpc(b,a.bind(this),a.bind(this,"busy"))};Package("apple.widget");apple.widget.EngravedPod=Class.create(coherent.View,{exposedBindings:["engravingText","productId","picassoUrl","backgroundImage"],innerHTML:'<img class="engraving" src="">',__structure__:{"img.background":coherent.ImageView({srcBinding:"backgroundImage"}),"img.engraving":coherent.ImageView({srcBinding:"engravedImage",visibleBinding:"pending(not)"})},keyDependencies:{prepareEngravedImage:["picassoUrl","productId","backgroundImage","engravingText"]},productId:"",backgroundImage:"",picassoUrl:"",init:function(){},prepareEngravedImage:function(){if(!this.picassoUrl||!this.productId||!this.backgroundImage||!this.engravingText){return}if(this.__imageTimer){window.clearTimeout(this.__imageTimer);this.__imageTimer=null}var a=(this.engravingText||"").split("\n"),c={th:a[0]||"",tl:a[1]||"",i:this.backgroundImage},b=this.picassoUrl,d=[b,Object.toQueryString(c)].join((b.indexOf("?")>=0)?"&":"?");this.setValueForKey(true,"pending");this.__imageTimer=window.setTimeout(function(){this.setValueForKey(d,"engravedImage");this.setValueForKey(false,"pending")}.bind(this),50)}});Package("apple");apple.EngravingGalleryController=Class.create(coherent.ViewController,{__structure__:{"div.tabs ul":coherent.ListView({selectedIndexBinding:"selectedTabIndex",enabledBinding:"waiting(not)",animated:"true",action:"noop"}),"div.preview":apple.widget.EngravedPod({picassoUrlBinding:"selectedVariation.picassoUrl",classBinding:"viewClass",productIdBinding:"selectedProduct.productId",backgroundImageBinding:"selectedVariation.backer",engravingTextBinding:"engravingText"}),"ul.ipod-list":coherent.ListView({contentBinding:"products",selectedObjectBinding:"selectedProduct",visibleBinding:"showProducts",action:"noop"}),"ul.ipod-list a":coherent.Anchor({titleBinding:"*.title"}),"ul.ipod-list img":coherent.ImageView({altBinding:"*.productId",srcBinding:"*.productImage"}),"ul.variations":coherent.ListView({contentBinding:"productVariations",selectedObjectBinding:"selectedVariation",visibleBinding:"showVariations",action:"noop"}),"ul.variations a":coherent.Anchor({titleBinding:"*.label",classBinding:"selectedProduct.productId"}),"ul.variations span":coherent.Anchor({textBinding:"*.label",classBinding:"*.swatch"}),"div.engravings":coherent.ListView({contentBinding:"engravings",selectedIndexBinding:"selectedTabIndex",animated:"true",action:"noop"}),"div.engravings ul":coherent.ListView({contentBinding:"*.content",selectedObjectBinding:"*.selectedEngraving",action:"noop"}),"div.engravings ul a":coherent.View({htmlBinding:"*.text"})},keyDependencies:{viewClass:["selectedVariation","selectedProduct","engravings"],showVariations:["productVariations"],engravingText:["selectedTabIndex"]},init:function(){this.view.superview().addObserverForKeyPath(this,this.overlayVisibleChange,"visible");Array.forEach(Element.queryAll("div.engravings ul"),function(b){Array.forEach(b.getElementsByTagName("li"),function(c,d){Element.addClassName(c,"item"+(d+1))})});this.shuffleTab=Element.query(this.viewElement(),"ul.shuffle");if(this.shuffleTab){var a=Element.query(this.viewElement(),"ul.ipod-list li");if(a){a.style.display="none"}}this.addObserverForKeyPath(this,"observeSelectedEngravingChange","engravings.selectedEngraving")},videoController:function(){if(this.videoPlayer){return}var a=document.getElementById("video-container");var c=document.getElementById("video-href").getAttribute("href");var b={autoplay:"true",width:640,height:360};delete coherent.View.viewLookup["volume-track"];delete coherent.View.viewLookup["control-track"];this.videoPlayer=Media.create(a,c,b);if(this.videoPlayer){if(!coherent.Browser.MobileSafari){this.videoControls=new Media.ControlsWidget(a);this.videoPlayer.setControlPanel(this.videoControls)}var e=function(){d.parentNode.removeChild(d);a.appendChild(this.videoPlayer.video().object());a.appendChild(this.videoControls.element);this.videoControls.play()}.bind(this);var d=document.createElement("div");Element.addClassName(d,"endstate");Event.observe(d,"click",e);this.videoPlayer.setDelegate({didEnd:function(){this.videoControls.pause();this.videoPlayer.setTime(0);this.videoPlayer.reset();a.appendChild(d);a.removeChild(this.videoControls.element);a.removeChild(this.videoPlayer.video().object())}.bind(this)})}},selectedTabIndex:function(){return this.__selectedTabIndex},setSelectedTabIndex:function(d){if(!this.engravings){return(this.__selectedTabIndex=d)}this.setValueForKey(true,"waiting");var g=this.engravings;var f=d==g.length-2;var b=this.__selectedTabIndex==g.length-2;var h=d==g.length-1;var a=this.__selectedTabIndex==g.length-1;var c=Element.query(this.viewElement(),"#video-container");this.__selectedTabIndex=d;if(h&&c){if(c.firstChild){if(this.videoControls){this.videoControls.show()}this.setSelectedProduct(this.products[4])}else{this.videoController.bindAndDelay(this,500)}this.setSelectedProduct(this.products[4])}else{if(a&&c){if(c.firstChild){if(this.videoControls){this.videoControls.pause()}this.setSelectedProduct(this.products[1])}else{this.setSelectedProduct(this.products[1])}}}if(f&&this.shuffleTab){this.setSelectedProduct(this.products[0])}else{if((b&&this.shuffleTab)&&!h){this.setSelectedProduct(this.products[1])}}var e=g[this.__selectedTabIndex];if(!e.selectedEngraving){e.setValueForKey(e.content[0],"selectedEngraving")}else{this.updateEngravingText(e.selectedEngraving)}(function(){this.setValueForKey(false,"waiting")}).bindAndDelay(this,500);return d},selectedProduct:function(){return this.__selectedProduct},setSelectedProduct:function(b){this.willChangeValueForKey("productVariations");this.__selectedProduct=b;this.didChangeValueForKey("productVariations");var a;this.shuffleTab?a=!(b==this.products[0]||b==this.prod):a=!(b==this.prod);this.setValueForKey(a,"showProducts");var c=this.productVariations();this.setValueForKey(c[0],"selectedVariation");return b},updateEngravingText:function(c){var a=c.text||"";var b=a.split(/<\s*br\s*\/?>/i).map(function(d){return d.trim()}).join("\n");this.setValueForKey(b,"engravingText")},observeSelectedEngravingChange:function(a){if(1!==a.indexes.length){return}this.updateEngravingText(a.newValue[0])},viewClass:function(){if(!this.__selectedProduct){return"preview"}if(!this.selectedVariation){return"preview "+this.__selectedProduct.productId}var a=this.__selectedProduct.productId+"_"+this.selectedVariation.swatch;return["preview",this.__selectedProduct.productId,a].join(" ")},showVariations:function(){var a=this.productVariations();return a.length>1},productVariations:function(){if(!this.__selectedProduct||!this.productData){return[]}var a=this.__selectedProduct.productId;return this.productData[a]||[]},noop:function(a,b){Event.stop(b)},overlayVisibleChange:function(c,a,b){if(!c.newValue&&this.videoPlayer){this.videoControls.pause()}},setInitialSelections:function(b){this.setValueForKey(true,"waiting");var a=this.products[b.selectedProduct||0];this.setSelectedProduct(a);var c=this.productVariations();this.setValueForKey(c[b.selectedVariationIndex||0],"selectedVariation");this.setSelectedTabIndex.bindAndDelay(this,10,b.selectedTab)}});Package("apple");apple.EngravingViewController=Class.create(coherent.ViewController,{__structure__:{".one-click":coherent.View({visibleBinding:"showOneClickButtons"}),'input[type="checkbox"]':coherent.ToggleButton({checkedBinding:"thisIsGift"}),".outline_box .close":coherent.Anchor({action:"hide"}),"p.toggle":coherent.View({visibleBinding:"overlayHidden",animated:true}),"p.toggle a":coherent.Anchor({action:"show"})},engravingOverlay:coherent.View(".outline_box"),skipEngravingLink:coherent.Anchor(".outline_box .alert_bubble a"),engravingForm:Part("form#engraving_form"),addEngravingButton:Part('.add-engraving button[type="submit"]'),skipEngravingButton:Part('.skip-engraving button[type="submit"]'),saveEngravingButton:Part('#engraving-options button[type="submit"][name="save"]'),cancelEngravingButton:Part('#engraving-options button[type="submit"][name="cancel"]'),microEventData:{addEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Add engraving"},skipEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Skip engraving"},editEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Edit Engraving"},closeEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Close engraving box"},continueWithoutEngraving:{eVar:"eVar5",feature:"engraving buttons",action:"Continue"}},init:function(){Event.observe(window,"unload",function(){});this.checkOneClickSettings();this.addObserverForKeyPath(this,this.observeThisIsGiftCheckbox,"thisIsGift");this.observeThisIsGiftCheckbox();var c="";if(this.skipEngravingLink){c=this.skipEngravingLink}if(c&&!apple.buyFlowVersionId){Event.observe(this.skipEngravingLink.viewElement(),"click",this.handleClick.bind(this))}this.productImage=Element.query(this.viewElement(),"#EngraveDynamicImage");var b=Element.queryAll(this.viewElement(),"#engraving_form button[type=submit]");if(b&&-1!==b.length){for(var a=b.length;a>0;a--){b[a-1].clicked=false;Event.observe(b[a-1],"click",this.handleClick.bind(this));Event.stopObserving(b[a-1],"click",this.handleClick.bind(this))}}if(document.getElementById("gift-checkbox")){Event.observe(document.getElementById("gift-checkbox"),"focus",this.showGiftPopup);Event.observe(document.getElementById("gift-checkbox"),"blur",this.hideGiftPopup);Event.observe(document.getElementById("gift-checkbox"),"keyup",this.handleGiftCheckboxKeyUp);Event.observe(document.getElementById("gift-checkbox"),"keypress",this.handleGiftCheckboxKeypress)}},showGiftPopup:function(a){var b=new apple.widget.HoverManager(),c=b.findHoverNode(a.target||a.srcElement);if(!c){return}b.showHover(c,true)},hideGiftPopup:function(a){var b=new apple.widget.HoverManager(),c=b.findHoverNode(a.target||a.srcElement);if(!c){return}b.hideHover(c,true)},handleGiftCheckboxKeypress:function(a){if(a.keyCode===Event.KEY_RETURN){Event.stop(a)}},handleGiftCheckboxKeyUp:function(b){if(b.keyCode===Event.KEY_ESC){Event.stop(b);var c=new apple.widget.HoverManager(),a=b.target||b.srcElement,d=c.findHoverNode(a);if(!d){return}c.hideHover(d,true)}},checkOneClickSettings:function(){var a=apple.cookie("appleconfig3");if(a===null){a=apple.cookie("AppleConfig3")}this.oneClickEnabled=(a!==null)?true:false},observeThisIsGiftCheckbox:function(a){if(this.oneClickEnabled){this.hideOneClickButtonsIfThisIsGift()}},hideOneClickButtonsIfThisIsGift:function(){if(this.valueForKey("thisIsGift")){this.setValueForKey(false,"showOneClickButtons")}else{this.setValueForKey(true,"showOneClickButtons")}},show:function(b){var a=this.engravingOverlay.viewElement();a.style.display="block";coherent.Animator.setStyles(a,{opacity:1},{duration:200});this.setValueForKey(false,"overlayHidden");this.disableShowObserver();var c=this.microEventData.editEngraving;c.node=b;apple.metrics.fireMicroEventNoDuplicates(c)},hide:function(b){var a=this.engravingOverlay.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:200,callback:function(){a.style.display="none"}});this.setValueForKey(true,"overlayHidden");Element.query("p.toggle").style.display="block";this.enableShowObserver();var c=this.microEventData.closeEngraving;c.node=b;apple.metrics.fireMicroEventNoDuplicates(c)},enableShowObserver:function(){Event.observe(this.productImage,"click",this.observeClick.bind(this))},disableShowObserver:function(){Event.stopObserving(this.productImage,"click",this.observeClick.bind(this))},observeClick:function(a){if(this.overlayHidden){this.show()}},handleClick:function(f){try{if((f.currentTarget&&f.currentTarget.name&&f.currentTarget.name.match(/buyNow/i))||(f.srcElement&&f.srcElement.name&&f.srcElement.name.match(/buyNow/i))){if(apple.cookie("as_qbe")){apple.fcs.setFcsDataForQbe()}}}catch(g){}var a=f.target||f.srcElement,c=Element.locateAncestor(a,function(e){return e.tagName.toLowerCase()=="button"});var d=Element.queryAll(this.viewElement(),"#engraving_form button[type=submit]");for(var b=d.length;b>0;b--){if(d[b-1].clicked){d[b-1].disabled=true;Event.stop(f)}Element.addClassName(d[b-1],"disabled");d[b-1].clicked=true}this.fireMicroEventAndSubmitOrRedirect(f)},fireMicroEventAndSubmitOrRedirect:function(e){var a=e.target||e.srcElement,d=Element.locateAncestor(a,function(g){return g.tagName.toLowerCase()=="button"}),c=function(g,j,k){var i=j.form,h;h=document.createElement("input");h.type="hidden";h.value=j.value;h.name=j.name;i.appendChild(h);Event.preventDefault(g);apple.metrics.fireMicroEvent(k,function(){i.submit()})};var b="";if(this.skipEngravingLink){b=this.skipEngravingLink.viewElement().id}if(d===this.addEngravingButton()){var f=this.microEventData.addEngraving;f.node=d;c(e,d,f)}else{if(d===this.skipEngravingButton()){var f=this.microEventData.continueWithoutEngraving;f.node=d;c(e,d,f)}else{if(d===this.saveEngravingButton()||d===this.cancelEngravingButton()){return true}else{if(a.id===b){Event.preventDefault(e);var f=this.microEventData.skipEngraving;f.node=this.skipEngravingLink.viewElement();apple.metrics.fireMicroEvent(f,function(){window.location=a.href})}}}}}});Package("apple");apple.EngravingStepController=Class.create(apple.EngravingViewController,{skipEngravingLink:coherent.Anchor(".outline_box .alert_bubble a",{hrefBinding:"skipEngravingUrl"}),compoundButtonAddEngravingButton:Part('.add-engraving .dynamic-menu li.BuyNow button[type="submit"]'),compoundButtonSkipEngravingButton:Part('.skip-engraving .dynamic-menu li.BuyNow button[type="submit"]'),init:function(){this.submitClicked=false;this.isBuyFlow=apple.buyFlowVersionId;if(this.isBuyFlow){this.storageDelegate=new apple.buyFlowStorageDelegate({session:true,hash:true,expires:apple.buyFlowExpiry||3600000,expiryInMs:true});this.storageDelegate.checkBuyFlowComplete();if(this.storageDelegate.hasEntriesForStep()){this.populateEngravingMessage();this.populateGiftSelection()}else{var b=Element.queryAll(this.engravingForm(),'input[type="text"]');b.forEach(function(e){e.value=""})}if(this.skipEngravingLink){this.setSkipEngravingLink();Event.observe(this.skipEngravingLink.viewElement(),"click",this.skipEngravingSubmit.bind(this))}var d=$("gift-checkbox");if(d){Event.observe(d,"change",this.onCheckboxChange.bindAsEventListener(this))}var a=Element.queryAll(this.viewElement(),".compound-button .dynamic-menu ul li a");if(a){var c=this;a.forEach(function(e){Event.observe(e,"click",c.bindEngravingActionsToLink.bind(c))})}}this.base();Element.replaceClassName(this.viewElement(),"loading","init");Event.observe(window,"pageshow",function(f){if(f.persisted){if(this.storageDelegate){this.storageDelegate.storage.init();this.storageDelegate.checkBuyFlowComplete();if(this.storageDelegate.hasEntriesForStep()){this.populateEngravingMessage()}}}}.bind(this))},bindEngravingActionsToLink:function(a){var b=a.target||a.srcElement,c=Element.locateAncestor(b,function(d){return d.tagName.toLowerCase()=="fieldset"});if(Element.hasClassName(c,"add-engraving")){this.addEngravingSubmit(a)}else{if(Element.hasClassName(c,"skip-engraving")){this.skipEngravingSubmit(a)}}},handleClick:function(d){var h=d.target||d.srcElement,b=Element.locateAncestor(h,function(i){return i.tagName.toLowerCase()=="button"});if(this.submitClicked===true){Event.stop(d);return}this.submitClicked=true;var e,c=Element.queryAll('.add-engraving button[type="submit"]'),g=c.length,a=0;for(a;b&&a<g;a++){if(c[a].value==b.value){e=c[a]}}var f="";if(this.skipEngravingLink){f=this.skipEngravingLink.viewElement().id}this.submitClicked=true;if(b===e||b===this.compoundButtonAddEngravingButton()){this.addEngravingSubmit(d)}else{if(b===this.skipEngravingButton()||b===this.compoundButtonSkipEngravingButton()){this.skipEngravingSubmit(d)}else{if(h.id===f){this.skipEngravingSubmit(d)}else{this.skipEngravingSubmit(d)}}}},addEngravingSubmit:function(d){if(this.isBuyFlow){var c=this.storageDelegate.entriesForSelector("not-engraved")||this.storageDelegate.entriesForSelector("acc-not-engraved"),b=Element.query(this.viewElement(),'input[name="productEngrave"]');if(c){var a=$("skip-engraving");if(a&&a.checked){a.checked=false}this.storageDelegate.removeSelected("not-engraved");if(b){this.storageDelegate.setPartNumber(b.value)}if(this.storageDelegate.entriesForSelector("acc-not-engraved")){this.storageDelegate.removeSelected("acc-not-engraved")}}}this.submitForm(d,"add")},skipEngravingSubmit:function(c){var a=$("skip-engraving"),b=Element.query(this.viewElement(),'input[name="product"]');if(a){a.checked=true}if(this.isBuyFlow&&b){this.storageDelegate.setPartNumber(b.value)}this.submitForm(c,"skip")},submitForm:function(b,e){if(this.isBuyFlow){this.storageDelegate.save(this);var g=Element.query('input[name="product"]'),f=g&&Element.query('input[name="secondary_product"]');if(f&&f.value==g.value){f.value=""}if(e==="skip"){this.removeEngravingMessageFromStorage()}var c=b.target||b.srcElement,d=c&&Element.locateAncestor(c,function(j){return j.tagName.toLowerCase()==="button"}),i=d&&d.name;if(i){if(i!=="proceed"){this.storageDelegate.setBuyFlowComplete()}}else{if(c.id===this.skipEngravingLink.viewElement().id){var a=this.addEngravingButton();var h=this.compoundButtonAddEngravingButton();if(a&&a.name!=="proceed"||h&&h.name!=="proceed"){this.storageDelegate.setBuyFlowComplete()}}}}this.fireMicroEventAndSubmitOrRedirect(b)},onCheckboxChange:function(a){var b=a.target||a.srcElement;if(this.isBuyFlow&&b){if(b.checked){this.storageDelegate.setSelected(b.name,b.checked)}else{this.storageDelegate.removeSelected(b.name)}if(this.skipEngravingLink){this.setSkipEngravingLink()}}},setSkipEngravingLink:function(d){var b,g=this.skipEngravingLink.viewElement().href,c=g.split("?"),f,a,e;if(!this.originalUrlParams){this.originalUrlParams=c&&Object.fromQueryString(c[1]||"")}if(this.isBuyFlow){e=this.storageDelegate.storage.inFallback&&this.storageDelegate.storage.wantHash;b=e?Object.fromQueryString(window.location.search):this.storageDelegate.entriesForSession(true)||{}}f=Object.merge(this.originalUrlParams,b);a=c[0]+"?"+Object.toQueryString(f);this.setValueForKey(a,"skipEngravingUrl")},populateEngravingMessage:function(){var b=this.storageDelegate.entriesForStep(true),a=Element.queryAll(this.engravingForm(),'input[type="text"]'),c=false;a.forEach(function(e){var d=e.name;if(b[d]){if(coherent.Browser.Mozilla){e.value=b[d]}else{e.setAttribute("value",b[d])}}(function(){if(!c){e.focus();c=true}}).bindAndDelay(this,0)})},populateGiftSelection:function(){var a=this.storageDelegate.entriesForStep(true),b=$("gift-checkbox");if(b){if(a[b.name]){b.checked=true}else{b.checked=false}}},removeEngravingMessageFromStorage:function(){var a=this.storageDelegate.entriesForStep(true),b=Element.queryAll(this.engravingForm(),'input[type="text"]'),c=this;b.forEach(function(e){var d=e.name;if(a[d]){c.storageDelegate.removeSelected(d)}})}});Package("apple");apple.stylesheet=function(b){if(b){this.__stylesheet=document.getElementById(b)}else{b=this.__ID_PREFIX+(new Date()).getTime()}if(!this.__stylesheet){var a=document.createElement("style");a.setAttribute("id",b);document.getElementsByTagName("head")[0].appendChild(a);if(a.sheet){this.__stylesheet=a.sheet}else{this.__stylesheet=document.styleSheets[document.styleSheets.length-1]}}};if(!CSSStyleSheet.prototype.addRule){CSSStyleSheet.prototype.addRule=function(a,d,b){var c=a+"{"+d+"}";return CSSStyleSheet.prototype.insertRule.call(this,c,b)}}apple.stylesheet.prototype.__ID_PREFIX="stylesheet-";apple.stylesheet.prototype.insertRule=function(a,e,b){var d=[];if(b!==undefined){b=(this.__stylesheet.cssRules!==undefined)?this.__stylesheet.cssRules.length:this.__stylesheet.rules.length}for(var c in e){d.push(c+":"+e[c])}this.__stylesheet.addRule(a,d.join(";"),b);return b};(function(b){var d={MobileSafari:{shouldAddClassName:coherent.Browser.MobileSafari,className:"ios"}};for(var a in d){var c=d[a];if(c.shouldAddClassName){Element.addClassName(b,c.className)}}if(!coherent.Browser.MobileSafari){Element.addClassName(b,"no-touch")}})(document.documentElement);Package("apple.masthead");apple.masthead.MastHeadViewController=(function(){return Class.create(coherent.ViewController,{getTooltipTrigger:Part("#call-apple"),init:function(){var c=$("u_tele"),b=this.getTooltipTrigger();this.drawer=$("contact-drawer");if(!c||!this.drawer){return}if(this.drawer&&coherent.Browser.IE!==8){Element.addClassName(this.drawer,"opacity")}var a={owner:this,onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave};this.drawer.setAttribute("aria-hidden","true");this.addTrackingInfo("call-apple",a);this.addTrackingInfo("contact-drawer",a);Event.observe(b,"mouseout",this.closeMenu.bindAsEventListener(this));Event.observe(b,"click",this.showHoursOfOperation.bindAsEventListener(this));Event.observe(b,"blur",this.closeMenu.bindAsEventListener(this));Event.observe(b,"keydown",this.tooltipKeydown.bindAsEventListener(this));Event.observe(this.drawer,"mouseout",this.closeMenu.bindAsEventListener(this));Event.observe(document.body,"click",this.ontouchend.bindAsEventListener(this));Event.observe(document.body,"touchstart",this.ontouchstart.bindAsEventListener(this))},tooltipKeydown:function(a){if(a.keyCode===Event.KEY_ESC){this.closeMenu(a)}},showHoursOfOperation:function(b){if(!this.__setleftValue){var a=174;var c=a/2-Element.getRect(Element.query(".contact")).width/2;c=Element.query(".contact").offsetLeft-Math.floor(c);this.drawer.style.left=c+"px";this.__setleftValue=true}this.drawer.setAttribute("aria-hidden","false");Element.addClassName($("call-apple"),"open");Element.addClassName(this.drawer,"open-drawer");apple.metrics.fireMicroEvent({eVar:"prop41",feature:"Chat",action:"Call 800-MY-APPLE link"})},closeMenu:function(b){var a=$("call-apple-content");var c=b.toElement||b.relatedTarget;if(this.drawer&&Element.hasClassName(this.drawer,"open-drawer")&&c!==this.drawer&&c!==a&&c!==a.parentNode){this.drawer.setAttribute("aria-hidden","true");Element.removeClassName(this.drawer,"open-drawer");Element.removeClassName($("call-apple"),"open")}},onmouseenter:function(a){this.hoverNodeId=a.id;if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}},onmouseleave:function(b){if(b.id!==this.hoverNodeId){return}if(this.__timer){window.clearTimeout(this.__timer);this.__timer=null}function a(){this.__timer=null;if(this.drawer&&Element.hasClassName(this.drawer,"open-drawer")){Element.removeClassName(this.drawer,"open-drawer");Element.removeClassName($("call-apple"),"open")}}this.__timer=a.bindAndDelay(this,3000);this.hoverNodeId=""},ontouchstart:function(a){var b=a.target||a.srcElement;do{if(b&&b.id==="contact-drawer"||b.id==="call-apple"){return}b=b.parentNode}while(b&&b!==document.body);if(b===document.body){this.closeMenu(a)}},teardown:function(){var a=this.getTooltipTrigger();Event.stopObserving(a,"mouseover",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"mouseout",this.closeMenu.bindAsEventListener(this));Event.stopObserving(a,"click",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"focus",this.showHoursOfOperation.bindAsEventListener(this));Event.stopObserving(a,"blur",this.closeMenu.bindAsEventListener(this));Event.stopObserving(a,"keydown",this.tooltipKeydown.bindAsEventListener(this));Event.stopObserving(this.drawer,"mouseout",this.closeMenu.bindAsEventListener(this));Event.stopObserving(document.body,"click",this.ontouchend.bindAsEventListener(this));Event.stopObserving(document.body,"touchstart",this.ontouchstart.bindAsEventListener(this))}})})();Event.onLoad(function(){var a=Element.query(".masthead");if(a){new apple.masthead.MastHeadViewController(a)}});Package("apple.widget");apple.widget.CountrySelector=Class.create(coherent.View,{mouseoverDelay:150,showDuration:250,mouseoutDelay:50,hideDuration:250,contentLoaded:false,trigger:coherent.Anchor("a.trigger",{action:"show"}),triggeredByKeyboard:false,potentialTriggeredByKeyboard:false,init:function(){this.getPreviousAndNextSiblings();var a=Element.query(".country-selector");if(a){var b=Element.assignId(a);this.viewElement().appendChild(a);this.countrySelector=new coherent.View(b)}this.positionCountrySelector();Event.observe(this.previousFocussableElement,"focus",this.hide.bind(this));Event.observe(this.nextFocussableElement,"focus",this.hide.bind(this));Event.observe(this.viewElement(),"mouseover",this.mouseover.bind(this));Event.observe(this.viewElement(),"mouseout",this.mouseout.bind(this));Event.observe(this.countrySelector.viewElement(),"click",this.selectCountry.bind(this));Event.observe(this.trigger.viewElement(),"focus",this.focusTriggeredByKeyboard.bind(this));Event.observe(this.trigger.viewElement(),"blur",this.blurTriggeredByKeyboard.bind(this));this.preloadCountrySelectorSprite.bindAndDelay(this,3000);this._touchstart=this.touchstart.bind(this);this.keyDownObserver=this.observeKeyDown.bind(this);if(this.countrySelector.viewElement().innerHTML.trim().length>0){this.contentLoaded=true}this.trigger.viewElement().setAttribute("aria-haspopup","true");this.trigger.viewElement().setAttribute("aria-owns","change-country-list");this.countrySelector.viewElement().setAttribute("aria-hidden","true");this.listOfCountries=Element.queryAll(".country-selector a");this.listOfCountriesLength=this.listOfCountries.length;this.lastCountryLink=this.listOfCountries[this.listOfCountriesLength-1];this.firstCountryLink=this.listOfCountries[0]},getPreviousAndNextSiblings:function(){var c=this.trigger.viewElement();var d=Element.queryAll(".apple-footer a");for(var b=0,a=d.length;b<a;b++){if(d[b]==c){this.previousFocussableElement=d[b-1];this.nextFocussableElement=d[b+1];return}}},positionCountrySelector:function(){var e=119;var d=this.trigger.viewElement().offsetWidth;var b=this.viewElement().previousSibling;while(b.nodeType!=1){b=b.previousSibling}var a=b.getElementsByTagName("a")[0].offsetWidth;var c=Math.round(d/2)+a-e;this.countrySelector.viewElement().style.left=c+"px"},preloadCountrySelectorSprite:function(){var a=this.trigger.viewElement();Element.addClassName(a,"preload-country-selector-sprite")},mouseover:function(){if(coherent.Browser.MobileSafari){return}this.showTimer=this.show.bindAndDelay(this,this.mouseoverDelay);if(this.hideTimer){window.clearTimeout(this.hideTimer);this.hideTimer=null}},mouseout:function(){if(coherent.Browser.MobileSafari){return}this.hideTimer=this.hide.bindAndDelay(this,this.mouseoutDelay);if(this.showTimer){window.clearTimeout(this.showTimer);this.showTimer=null}},touchstart:function(c){var a=Element.query(".apple-footer .country-selector");if(a.style.display=="block"){var b=c.target;do{if(b&&b===Element.query(".country-selector")){return}b=b.parentNode}while(b&&b!==document.body);this.hide()}},show:function(){this.countrySelector.viewElement().style.display="block";coherent.Animator.setStyles(this.countrySelector.viewElement(),{opacity:1},{duration:this.showDuration});this.enableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","false");if(this.potentialTriggeredByKeyboard===true){this.triggeredByKeyboard=true;this.firstCountryLink.focus()}},hide:function(){var a=this.countrySelector.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:this.hideDuration,callback:function(){a.style.display="none"}});if(this.triggeredByKeyboard){this.triggeredByKeyboard=false}this.disableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","true")},focusTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=true},blurTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=false},enableCloseObservers:function(){Event.observe(document.body,"keydown",this.keyDownObserver);Event.observe(document.body,"touchstart",this._touchstart)},disableCloseObservers:function(){Event.stopObserving(document.body,"keydown",this.keyDownObserver);Event.stopObserving(document.body,"touchstart",this._touchstart)},observeKeyDown:function(b){var e=b.keyCode||b.which,a=b.shiftKey,c=Element.query("a.trigger"),d=b.target||b.srcElement;if(e==Event.KEY_ESC){this.hide();c.focus();if(d===c){this.triggeredByKeyboard=true}}if(e==Event.KEY_TAB&&d===this.firstCountryLink&&a===true){Event.stop(b);this.lastCountryLink.focus()}if(e==Event.KEY_TAB&&d===this.lastCountryLink&&a===false){Event.stop(b);this.firstCountryLink.focus()}},selectCountry:function(a){Event.stop(a);var b=a.target||a.srcElement;if(b.nodeName==="A"){this.country=b;this.reportEvent();this.redirect.bindAndDelay(this,500)}},reportEvent:function(){apple.metrics.fireMicroEvent({feature:"Country",action:"Selected: "+this.country.title})},redirect:function(){window.location=this.country.href}});Package("apple.widget");apple.widget.FooterView=Class.create(coherent.View,{mouseoverDelay:150,showDuration:250,mouseoutDelay:50,hideDuration:250,triggeredByKeyboard:false,potentialTriggeredByKeyboard:false,countrySelector:coherent.View(".country-selector"),countryListItem:coherent.View("#change-country"),formatCookie:"platformPref=",__structure__:{"#mobile":coherent.Anchor({action:"handleFormatSwitch"}),"#format-switcher":coherent.View({visibleBinding:"showSwitcher"})},trigger:coherent.Anchor("a.trigger",{action:"show"}),init:function(){if(this.countrySelector!==null){this.initCountrySelector()}this.displayFormatSwitcher()},getPreviousAndNextSiblings:function(){var c=this.trigger.viewElement();var d=Element.queryAll(".apple-footer a");for(var b=0,a=d.length;b<a;b++){if(d[b]==c){this.previousFocussableElement=d[b-1];this.nextFocussableElement=d[b+1];return}}},initCountrySelector:function(){this.getPreviousAndNextSiblings();var a=Element.query(".country-selector");this.countryListItem.viewElement().appendChild(a);this.positionCountrySelector();Event.observe(this.previousFocussableElement,"focus",this.hide.bind(this));Event.observe(this.nextFocussableElement,"focus",this.hide.bind(this));Event.observe(this.countryListItem.viewElement(),"mouseover",this.mouseover.bind(this));Event.observe(this.countryListItem.viewElement(),"mouseout",this.mouseout.bind(this));Event.observe(document.body,"click",this.hide.bindAsEventListener(this));Event.observe(this.countrySelector.viewElement(),"click",this.selectCountry.bind(this));Event.observe(this.trigger.viewElement(),"focus",this.focusTriggeredByKeyboard.bind(this));Event.observe(this.trigger.viewElement(),"blur",this.blurTriggeredByKeyboard.bind(this));this.preloadCountrySelectorSprite.bindAndDelay(this,3000);this._touchstart=this.touchstart.bind(this);this.trigger.viewElement().setAttribute("aria-haspopup","true");this.trigger.viewElement().setAttribute("aria-owns","change-country-list");this.countrySelector.viewElement().setAttribute("aria-hidden","true");this.listOfCountries=Element.queryAll(".country-selector a");this.listOfCountriesLength=this.listOfCountries.length;this.lastCountryLink=this.listOfCountries[this.listOfCountriesLength-1];this.firstCountryLink=this.listOfCountries[0]},positionCountrySelector:function(){var e=119;var d=this.trigger.viewElement().offsetWidth;var b=this.countryListItem.viewElement().previousSibling;while(b.nodeType!=1){b=b.previousSibling}var a=b.getElementsByTagName("a")[0].offsetWidth;var c=Math.round(d/2)+a-e;this.countrySelector.viewElement().style.left=c+"px"},preloadCountrySelectorSprite:function(){var a=this.trigger.viewElement();Element.addClassName(a,"preload-country-selector-sprite")},mouseover:function(){if(coherent.Browser.MobileSafari){return}this.showTimer=this.show.bindAndDelay(this,this.mouseoverDelay);if(this.hideTimer){window.clearTimeout(this.hideTimer);this.hideTimer=null}},mouseout:function(){if(coherent.Browser.MobileSafari){return}this.hideTimer=this.hide.bindAndDelay(this,this.mouseoutDelay);if(this.showTimer){window.clearTimeout(this.showTimer);this.showTimer=null}},touchstart:function(c){var a=Element.query(".apple-footer .country-selector");if(a.style.display=="block"){var b=c.target;do{if(b&&b===Element.query(".country-selector")){return}b=b.parentNode}while(b&&b!==document.body);this.hide()}},show:function(){this.countrySelector.viewElement().style.display="block";coherent.Animator.setStyles(this.countrySelector.viewElement(),{opacity:1},{duration:this.showDuration});this.enableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","false");if(this.potentialTriggeredByKeyboard===true){this.triggeredByKeyboard=true;this.firstCountryLink.focus()}},hide:function(b){var c=b?(b.target||b.srcElement):undefined;if(c&&c===this.countrySelector.viewElement()||c===this.trigger.viewElement()){return}var a=this.countrySelector.viewElement();coherent.Animator.setStyles(a,{opacity:0},{duration:this.hideDuration,callback:function(){a.style.display="none"}});if(this.triggeredByKeyboard){this.triggeredByKeyboard=false}this.disableCloseObservers();this.countrySelector.viewElement().setAttribute("aria-hidden","true")},focusTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=true},blurTriggeredByKeyboard:function(){this.potentialTriggeredByKeyboard=false},enableCloseObservers:function(){Event.observe(document.body,"keydown",this.observeKeyDown.bindAsEventListener(this));Event.observe(document.body,"touchstart",this._touchstart)},disableCloseObservers:function(){Event.stopObserving(document.body,"keydown",this.observeKeyDown.bindAsEventListener(this));Event.stopObserving(document.body,"touchstart",this._touchstart)},observeKeyDown:function(b){var e=b.keyCode,a=b.shiftKey,c=Element.query("a.trigger"),d=b.target||b.srcElement;if(e==Event.KEY_ESC){this.hide();c.focus();if(d===c){this.triggeredByKeyboard=true}}if(e==Event.KEY_TAB&&d===this.firstCountryLink&&a===true){Event.stop(b);this.lastCountryLink.focus()}if(e==Event.KEY_TAB&&d===this.lastCountryLink&&a===false){Event.stop(b);this.firstCountryLink.focus()}},selectCountry:function(a){Event.stop(a);var b=a.target||a.srcElement;if(b.nodeName==="A"){this.country=b;this.reportEvent();this.redirect.bindAndDelay(this,500)}},reportEvent:function(){apple.metrics.fireMicroEvent({feature:"Country",action:"Selected: "+this.country.title})},redirect:function(){window.location=this.country.href},handleFormatSwitch:function(a){this.fireFormatChangeEvent(a);(function(){this.deleteFormatCookie(a)}).bindAndDelay(this,500)},fireFormatChangeEvent:function(c){var a=c&&c.viewElement();if(a&&a.hasAttribute("data-sprop36")){var d=a.getAttribute("data-sprop36");var b=apple.metrics._stringToEvent(d);b.eVar="prop36";b.excludeAosNamespace=true;apple.metrics.fireMicroEvent(b)}},deleteFormatCookie:function(a){var b=new Date();b.setDate(b.getDate()-1);document.cookie=this.formatCookie+"''; expires="+b.toUTCString()+"; path=/; domain=.apple.com";window.location.reload()},displayFormatSwitcher:function(){if(document.cookie.match(this.formatCookie)||Element.query(this.viewElement(),".format-switcher-show")){this.setValueForKey(true,"showSwitcher")}else{this.setValueForKey(false,"showSwitcher")}}});coherent.DynamicMenu=Class.create(coherent.View,{exposedBindings:["model"],init:function(){this.addObserverForKeyPath(this,this.updateState,"model.open")},updateState:function(b){var a=this.valueForKeyPath("model.open");if(a){this.openMenu()}else{this.closeMenu()}this.setValueForKeyPath(a,"model.contentUpdated");this.setValueForKeyPath(a,"model.isOpen")},closeMenu:function(a){Element.removeClassName(this.viewElement(),"visible");if(this.model.manager){this.model.manager.clear()}},openMenu:function(c){Element.addClassName(this.viewElement(),"visible");if(this.model.contentURL&&!this.model.response){this.addObserverForKeyPath(this,this.model.contentResponse,"model.response");var b=XHR.get(this.model.contentURL);b.addMethods(this.getResponseDelegate(),this.getResponseDelegate());this.viewElement().innerHTML="<div class='spinner'></div>"}if(this.model.manager){var a=this.model.manager.getLastView();if(a){a.setValueForKeyPath(false,"model.open")}this.model.manager.setNextView(this)}},getResponseDelegate:function(){var a=this;return function(b){a.setValueForKeyPath(b,"model.response");a.setValueForKeyPath(b,"model.contentUpdated")}}});coherent.DynamicMenuManager=Class.create({lastId:null,setNextView:function(a){this.lastId=a.viewElement().id},clear:function(){this.lastId=null},getLastId:function(){return this.lastId},getLastElem:function(){return $(this.getLastId())},getLastView:function(){if(this.getLastElem()){return coherent.View.fromNode(this.getLastElem())}}});coherent.CompoundLink=Class.create(coherent.View,{exposedBindings:["menuModel"],__structure__:{".dynamic-menu":coherent.DynamicMenu({modelBinding:"*.menuModel"}),"a[target!=_blank]":coherent.Anchor({action:"resetMenu"}),".handle a":coherent.Anchor({action:"click"})},init:function(){Event.observe(this.viewElement(),"mouseover",this.viewOver.bindAsEventListener(this));Event.observe(this.viewElement(),"mouseout",this.viewOut.bindAsEventListener(this))},getMenu:function(){return Element.query(this.viewElement(),".dynamic-menu")},viewOver:function(){window.clearTimeout(this.valueForKey("viewOverTimeout"))},viewOut:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open")},250);this.setValueForKey(b,"viewOverTimeout")},click:function(b,a){Event.stop(a);if(this.valueForKeyPath("menuModel.open")){this.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}else{this.setValueForKeyPath(true,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":2000})}},resetMenu:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(a.viewElement(),{"z-index":"auto"})},350);this.setValueForKey(b,"viewOverTimeout");this.setValueForKeyPath(false,"handleDown")}});coherent.CompoundButton=Class.create(coherent.View,{exposedBindings:["menuModel","name","value","menuEnabled"],__structure__:{".dynamic-menu":coherent.DynamicMenu({modelBinding:"*.menuModel"})},getPrimaryButton:Part(".button"),getPrimaryButtonLabel:Part(".button .label"),getHandle:Part(".handle"),getAccount:Part(".button.active.init.account"),getPreSignBtn:Part(".button.active.init.alt"),getMenu:Part(".dynamic-menu"),init:function(){if(this.getHandle()){coherent.page.addTrackingInfo(this.viewElement().id,{owner:this,onmouseenter:this.onmouseenter,onmouseleave:this.onmouseleave});this.addObserverForKeyPath(this,this.updateHandle,"menuModel.open");this.addObserverForKeyPath(this,this.reposition,"menuModel.contentUpdated");this.addObserverForKeyPath(this,this.updateHandle,"handleDown");Element.addClassName(this.viewElement(),"init");Element.addClassName(this.getPrimaryButton(),"init");Element.addClassName(this.getHandle(),"init");var a=this.getHandle(),b=this.getMenu();if(a){a.setAttribute("aria-haspopup","true");a.setAttribute("aria-owns",b.id)}if(b){b.setAttribute("role","menu");b.setAttribute("aria-hidden","true")}window.setTimeout(this.initButtonHandlers.bind(this),0);Event.observe(document.body,"keyup",this.onblurMenu.bindAsEventListener(this));Event.observe(document.body,"click",this.closeMenu.bindAsEventListener(this));Event.observe(document.body,"ontouchstart",this.documentTouch.bindAsEventListener(this));if(a){Event.observe(a,"keydown",this.keydownHandle.bindAsEventListener(this,false));Event.observe(a,"click",this.clickHandle.bindAsEventListener(this));Event.observe(a,"mousedown",this.mousedownHandle.bindAsEventListener(this));Event.observe(a,"beforeactivate",this.beforeactivateHandle.bindAsEventListener(this));Event.observe(a,"ontouchstart",this.clickHandle.bindAsEventListener(this))}if(this.getAccount()!=null){Event.observe(this.getAccount(),"click",this.clickHandle.bindAsEventListener(this))}if(this.getPreSignBtn()!=null){Event.observe(this.getPreSignBtn(),"click",this.clickHandle.bindAsEventListener(this))}}},canToggleMenu:true,currentlySelectedMenuItem:0,existingMenuListener:false,preventIE8Focus:false,initButtonHandlers:function(){var b=this.getHandle(),c=this.getMenu(),d=Element.queryAll(c,"li"),a=this.viewElement();this.menuItems=Element.findFocusables(c,false);this.menuItems=this.menuItems.filter(function(e){var f=Element.locateAncestor(e,function(g){return g.nodeName.toLowerCase()==="li"},a);return f?f.style.display!=="none":true});this.menuItems.forEach(function(e){e.setAttribute("role","menuitem");if(e.nodeName=="A"){Event.observe(e,"keydown",this.followLink.bindAsEventListener(this))}},this);d.forEach(function(e){e.setAttribute("role","presentation")})},observeHtmlChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButtonLabel().innerHTML=c.newValue}},observeValueChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButton().attributes.value.nodeValue=c.newValue}},observeNameChange:function(c,b,a){if(c.newValue&&this.getPrimaryButton()){this.getPrimaryButton().name=c.newValue}},observeMenuEnabledChange:function(d,c,b){if(d.newValue!==null){var a=(this.canToggleMenu=d.newValue)?Element.addClassName:Element.removeClassName;a(this.viewElement(),coherent.CompoundButton.compoundBtnClassName);this.viewElement().parentNode.className+=""}},resetMenu:function(){var a=this;var b=window.setTimeout(function(){a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(a.viewElement(),{"z-index":"auto"})},350)},updateHandle:function(a){if(this.getHandle()){if(this.valueForKeyPath("menuModel.open")||this.valueForKeyPath("handleDown")){Element.addClassName(this.getHandle(),"hover")}else{Element.removeClassName(this.getHandle(),"hover");Element.removeClassName(this.getHandle(),"clicked")}}},clickHandle:function(a){var b=this;this.preventIE8Focus=false;Event.stop(a);window.setTimeout(function(){if(document.activeElement===b.getHandle()){b.keydownHandle(a,true)}else{b.toggleMenuState()}},0)},mousedownHandle:function(a){Event.stop(a);this.preventIE8Focus=true},beforeactivateHandle:function(a){if(this.preventIE8Focus){Event.stop(a)}},toggleMenuState:function(){var a=this.__relativeSource;if(a.valueForKeyPath("menuModel.open")){this.getMenu().setAttribute("aria-hidden","true");a.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}else{this.getMenu().setAttribute("aria-hidden","false");a.setValueForKeyPath(true,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":20000});Element.addClassName(this.getHandle(),"clicked")}},closeMenu:function(a){if(this.__relativeSource.valueForKeyPath("menuModel.open")){this.getMenu().setAttribute("aria-hidden","true");this.__relativeSource.setValueForKeyPath(false,"menuModel.open");Element.setStyles(this.viewElement(),{"z-index":"auto"})}},documentTouch:function(a){if(this.menuItems.indexOf(a.target)==-1){this.closeMenu(a)}},keydownHandle:function(b,a){if(a||b.keyCode===Event.KEY_DOWN||b.keyCode===32||b.keyCode===Event.KEY_UP){if(!a){Event.stop(b)}this.toggleMenuState();if(!this.existingMenuListener){Event.observe(this.getMenu(),"keydown",this.keydownMenu.bindAsEventListener(this,this.menuItems));this.existingMenuListener=true}this.menuItems[0].focus()}},keydownMenu:function(a){if(a.keyCode===Event.KEY_ESC){Event.preventDefault(a);this.closeMenu(a);this.currentlySelectedMenuItem=0;this.getHandle().focus()}if(a.keyCode===Event.KEY_DOWN){Event.preventDefault(a);if(this.currentlySelectedMenuItem<this.menuItems.length-1){this.currentlySelectedMenuItem+=1}else{this.currentlySelectedMenuItem=0}this.menuItems[this.currentlySelectedMenuItem].focus()}if(a.keyCode===Event.KEY_UP){Event.preventDefault(a);if(this.currentlySelectedMenuItem>0){this.currentlySelectedMenuItem-=1}else{this.currentlySelectedMenuItem=this.menuItems.length-1}this.menuItems[this.currentlySelectedMenuItem].focus()}},onblurMenu:function(a){var b=this;if(a.keyCode===Event.KEY_TAB){if(b.menuItems.indexOf(document.activeElement)==-1){b.closeMenu(a)}}},followLink:function(a){if(a.keyCode===32){Event.preventDefault(a);Event.sendMouseEvent(a.target||a.srcElement,"click",true,true)}},reposition:function(g){if(g.newValue){Element.setStyles(this.getMenu(),{width:"auto",right:0,left:"auto"});var b=Element.getRect(this.getPrimaryButton());var a=Element.getRect(this.getHandle());var f=Element.getRect(this.getMenu());var e=b.width;var c=a.height;if(!Element.hasClassName(document.body,"ns")){c+=1}var d=f.left;Element.setStyles(this.getMenu(),{width:(f.width>e?f.width:e)+"px",top:c+"px",right:(d<0?"auto":0),left:(d<0?0:"auto")})}},findFormFromElement:function(b){var a=b.parentElement||b.parentNode;if(a.tagName=="FORM"){return a}else{return this.findFormFromElement(a)}},teardown:function(){var b=this.getHandle();if(b){Event.stopObserving(b,"keydown",this.keydownHandle.bindAsEventListener(this,false));Event.stopObserving(b,"click",this.clickHandle.bindAsEventListener(this));Event.stopObserving(b,"mousedown",this.mousedownHandle.bindAsEventListener(this));Event.stopObserving(b,"beforeactivate",this.beforeactivateHandle.bindAsEventListener(this));Event.stopObserving(b,"ontouchstart",this.clickHandle.bindAsEventListener(this))}Event.stopObserving(document.body,"keydown",this.onblurMenu.bindAsEventListener(this));Event.stopObserving(document.body,"click",this.closeMenu.bindAsEventListener(this));Event.stopObserving(document.body,"ontouchstart",this.documentTouch.bindAsEventListener(this));if(this.getAccount()!=null){Event.stopObserving(this.getAccount(),"click",this.clickHandle.bindAsEventListener(this))}if(this.getPreSignBtn()!=null){Event.stopObserving(this.getPreSignBtn(),"click",this.clickHandle.bindAsEventListener(this))}if(this.menuItems&&this.existingMenuListener){this.existingMenuListener=false;this.menuItems.forEach(function(d){if(d.nodeName=="A"){Event.stopObserving(d,"keydown",this.followLink(this))}},this)}var c=b&&coherent.View.fromNode(this.getHandle());c&&c.teardown();var a=this.getMenu()&&coherent.View.fromNode(this.getMenu());a&&a.teardown();this.base()}});coherent.CompoundButton.compoundBtnClassName="compound-button";apple.ImageSetView=Class.create(coherent.ImageSetView,{PIXEL_RATIO_COOKIE_NAME:"pxro",init:function(){var a=parseInt(apple.cookie(this.PIXEL_RATIO_COOKIE_NAME),10);if(a){this.setValueForKey(a,"pxRatio")}}});Package("apple.widget");apple.widget.EqualizeCopy=function(){var b=Element.queryAll(".equalize .copy");if(b){var a=0,c=0;b.forEach(function(d){Element.setStyle(d,"height","");c=parseInt(Element.getStyles(d,"height").replace("px",""),10);a=Math.max(a,c)});b.forEach(function(d){Element.setStyle(d,"height",a+"px")})}};apple.SocialSharingCompoundLink=Class.create(coherent.CompoundLink,{__structure__:{"a[target]":coherent.Anchor({action:"linkClicked"})},linkClicked:function(e,a){var d="";var b=new coherent.URL(document.location.href);if(b){var c=b.path.match(/(\w{5,7}\/\w)$/);if(c&&c.length>1){d=c[1]}}apple.metrics.fireMicroEvent({eVar:"eVar6",part:d,feature:"Sharing",action:e.viewElement().className+" post"});this.resetMenu()}});apple.initSocialSharingCompoundLinks=function(){var d=new coherent.DynamicMenuManager();var a=Element.queryAll(".socialsharing");for(var c=0;c<a.length;c++){Element.queryAll(a[c],"a[target]").forEach(function(f){if(f){var g=f.href;var e=g.match(/\?vid2\=|&vid2\=/i);if(e===null){if(g.indexOf("?")>-1){g=/&$/.test(g)?g+"vid2=web":g+"&vid2=web"}else{g=g+"?vid2=web"}f.href=g}}}.bind(this));var b={menuModel:{manager:d}};new apple.SocialSharingCompoundLink(a[c],b,{menuModelBinding:"*.menuModel"})}};Event.onLoad(apple.initSocialSharingCompoundLinks);coherent.FormField=Class.create(coherent.View,{exposedBindings:["value","name"],observeValueChange:function(b){var a=this.viewElement();a.value=b.newValue},observeNameChange:function(d,c,b){var a=this.viewElement();a.name=d.newValue}});apple.AddToCartCompoundButton=Class.create(coherent.CompoundButton,{exposedBindings:["model","modes"],__structure__:{"a[target]":coherent.Anchor({action:"linkClicked"}),"button.button":coherent.FormField({nameBinding:"$modes.$model.primaryButtonMode$.name",titleBinding:"$modes.$model.primaryButtonMode$.title",classBinding:"$modes.$model.primaryButtonMode$.buttonClass"}),".handle":coherent.View({classBinding:"$modes.$model.primaryButtonMode$.handleClass",action:"click"}),"button.button .label":coherent.View({textBinding:"$modes.$model.primaryButtonMode$.html"}),".BuyNow":coherent.View({visibleBinding:"model.buyNowEnabled",enabledBinding:"model.buyNowAvailable"}),".BuyNow button":coherent.FormField({nameBinding:"$modes.$model.buyNowButtonMode$.name",titleBinding:"$modes.$model.buyNowButtonMode$.title",textBinding:"$modes.$model.buyNowButtonMode$.html",enabledBinding:"model.buyNowAvailable"}),".BuyNow-SignUp":coherent.View({visibleBinding:"model.buyNowEnabled(not)",enabledBinding:"model.buyNowAvailable"})},init:function(){this.base();var a=$("gift-checkbox");if(a){Event.observe(a,"click",this.giftStateChanged.bind(this))}},giftStateChanged:function(a){var b=a.target?a.target.checked:a.srcElement.checked;this.setValueForKeyPath(!b,"model.buyNowAvailable");if(this.model.buyNowEnabled){if(!this.model.buyNowAvailable){this.setValueForKeyPath("default","model.primaryButtonMode");this.setValueForKeyPath("buynow","model.buyNowButtonMode")}else{this.setValueForKeyPath("buynow","model.primaryButtonMode");this.setValueForKeyPath("default","model.buyNowButtonMode")}}},linkClicked:function(d,a){var b=this.findFormFromElement(d.viewElement())["product"];var c=b?b.value:"";apple.metrics.fireMicroEvent({eVar:"eVar6",part:c,feature:"Sharing",action:d.viewElement().className+" post"});this.resetMenu();if(coherent.Browser.IE&&coherent.Browser.IE==7){this.base()}}});apple.buyNowEnabled=apple.cookie("as_qbe");apple.initAddToCartCompoundButtons=function(){var n=new coherent.DynamicMenuManager();var k=Element.queryAll(".compound-button.add-to-cart");for(var f=0,d=k.length;f<d;f++){var e=coherent.View.fromNode(k[f]);if(e){e.teardown()}var b=Element.query(k[f],"button.button");var a=Element.query(k[f],"button.handle");var j=Element.query(b,".label");var o=$("gift-checkbox");var h={menuModel:{manager:n},buttonModel:{buyNowAvailable:o?!o.checked:true,buyNowEnabled:apple.buyNowEnabled?true:false,primaryButtonMode:"default"},buttonModes:{"default":{name:b.name,title:b.title,value:b.value,html:j.textContent||j.innerText,buttonClass:b?b.className:"",handleClass:a?a.className:""}}};if(apple.buyNowEnabled){var m=Element.query(k[f],".BuyNow button");if(m){h.buttonModel.buyNowButtonMode="buynow";h.buttonModes.buynow={name:m.name,title:m.title,value:m.value,html:m.textContent||m.innerText,buttonClass:"button transactional",handleClass:"handle transactional"}}if(m&&h.buttonModel.buyNowAvailable){h.buttonModel.primaryButtonMode="buynow";h.buttonModel.buyNowButtonMode="default"}}new apple.AddToCartCompoundButton(k[f],h,{modelBinding:"*.buttonModel",modesBinding:"*.buttonModes",menuModelBinding:"*.menuModel"})}var g=Element.query("#fcspro");if(g){var c=Element.query(".compound-button.add-to-cart button.button.transactional");if(c&&c.name&&c.name.match(/buy-now/i)){Event.observe(c,"click",apple.fcs.setFcsDataForQbe)}}};Event.onLoad(apple.initAddToCartCompoundButtons);typeof window.apple==="undefined"&&(window.apple={});(function(l){try{l.sessionStorage.setItem("pbCheck","1");l.sessionStorage.removeItem("pbCheck")}catch(k){return}var f=document.getElementsByTagName("script");var b=f[f.length-1];var o=b&&b.innerHTML;var c={};try{c=o?JSON.parse(o):{}}catch(k){}c.scaleFactor=1;c.offsetY=(c.offsetY||80)*c.scaleFactor;if(c.skip||l.isAppleStoreAppDisabled){return}var n="AppleStoreAppBannerViews";var g="AppleStoreAppBannerSessionViews";c.sessionViewLimit=c.sessionViewLimit||1;var j=function(r,e){this.storage=r;this.MAX_EXPIRY=e&&e.DEFAULT_EXPIRY||365};j.prototype.setItem=function(t,u,r){var e=this.storage.getItem(t);var v={value:u,timestamp:(Date.now()+(typeof r==="number"?r:this.MAX_EXPIRY)*86400000)};this.storage.setItem(t,JSON.stringify(v))};j.prototype.getItem=function(r){var e=this.storage.getItem(r);if(e){e=JSON.parse(e);if(e.timestamp>Date.now()){return e.value}else{this.storage.removeItem(r)}}return null};var p=new j(l.localStorage,{DEFAULT_EXPIRY:c.expiry});var m=new j(l.sessionStorage,{DEFAULT_EXPIRY:c.expiry});function i(u,x,t,y){this.xhr=new l.XMLHttpRequest();function w(e){if(e.target&&e.target.status===200){x(e.target)}else{t(e.target)}}function r(e){t(e.target)}this.xhr.onload=w;this.xhr.onerror=r;try{this.xhr.open(y||"GET",u,true);this.xhr.send()}catch(v){t(v)}}function h(r){var t=RegExp("(?:<script.*?>)((\n|\r|.)*?)(?:<\/script>)","img");var e=[];var u=new String(r.replace(t,function(){e.push(arguments[1]);return""}));u.scripts=e;return u}function a(A){l["mobile-banner-loaded"]=true;var w=document.getElementById("page");w&&w.setAttribute("aria-hidden","true");w.setAttribute("tabindex","-1");var e=document.createDocumentFragment();var y="ontouchstart" in l;var G=document.createElement("DIV");G.innerHTML=[,'    <div aria-label="Download the Apple Store app" id="applestoreapp" role="dialog"  ',(c.scaleFactor!==1?'style="-webkit-transform: scale(0.32)"':""),">","        <section>",A,"        </section>","    </div>",'    <div id="applestoreapp-mask">',"    </div>"].join("");e.appendChild(G);var J=G.querySelector("#applestoreapp");var K=J.querySelector("section");document.body.insertBefore(e,document.body.firstChild);var L=J.querySelector(".app-download-modal-inside"),x="app overlay displayed",r=L.getAttribute("data-prop36"),D=(r)?u(r):u(x);setTimeout(function(){if(L){w.style.display="none"}},1000);function I(){G.parentNode.removeChild(G);b.parentNode.removeChild(b)}function z(M,V,P){M.preventDefault();M.stopPropagation();var U=document.getElementById("page");U.style.display="";if(V||false){var S=J.querySelector(".close"),O="app overlay close button clicked",T=P.getAttribute("data-prop36"),Q=(T)?u(T):u(O)}var W=parseInt(p.getItem(n),10)||0;var N=parseInt(m.getItem(g),10)||0;p.setItem(n,W+1);m.setItem(g,N+1);K.removeEventListener("touchstart");var R=document.body;R.removeEventListener("gesturechange");R.removeEventListener("gestureend");U&&U.setAttribute("aria-hidden","false");U.removeAttribute("tabindex");J.setAttribute("aria-hidden","true");J.setAttribute("tabindex","-1");G.style.display="none"}function v(P,O){P.preventDefault();P.stopPropagation();var N=J.querySelector(".download-button"),S="app overlay download link clicked",R=O.getAttribute("data-prop36"),Q=(R)?u(R):u(S),T=encodeURIComponent(apple.cookie("s_vi")),M=P.target.href;if(T!=="null"){M+=M.indexOf("?")>=0?"&":"?";M+="ses="+T}p.setItem(n,c.viewLimit);m.setItem(g,c.sessionViewLimit);z(P,false);l.setTimeout(function(){l.location.href=M},500)}function H(O){var N=O.target;var M=null;var P=null;while(N&&N!==K&&N!==document.documentElement){if(N.className){if(!!N.className.match(/close/)){P=N;break}if(!!N.className.match(/download-button/)){M=N;break}}N=N.parentNode}if(P){z(O,true,N)}if(M){v(O,N)}}function t(M){var N;if(l.pageYOffset===0){N=0}else{N=(Math.max(c.offsetY,l.pageYOffset))/c.scaleFactor}}function u(M){if(l.s){l.s.tl(true,"o","Mobile Overlay",{linkTrackVars:"prop36",prop36:M})}}if(y){K.addEventListener("touchstart",H,false);var F=document.getElementById("applestoreapp-mask");F.addEventListener("touchmove",function(M){M.preventDefault()},true)}else{K.addEventListener("mousedown",H,false);K.addEventListener("mousemove",function(M){M.preventDefault()},true)}J.className="revealed";var B=K.querySelectorAll("#apstoreurl,#apstoreurl2");if(B&&B.length){for(var E=0,C=B.length;E<C;E++){B[E].setAttribute("href",c.storeUrl)}}}function d(){new i(c.bannerNodeUrl,function(e){a(h(e.responseText))},function(e){console.log("error",e)})}function q(){c.bannerNodeUrl=c.bannerNodeUrl||l.appleStoreAppBannerNode;c.storeUrl=c.storeUrl||l.appleStoreAppUrl;if(l.appleStoreAppBannerExpiry!=undefined){c.expiry=l.appleStoreAppBannerExpiry}else{c.expiry=30}if(l.appleStoreAppBannerViewLimit!=undefined){c.viewLimit=l.appleStoreAppBannerViewLimit}else{c.viewLimit=2}if(m.getItem(g)<c.sessionViewLimit&&p.getItem(n)<c.viewLimit){if(l.isAnotherDialogOpen){l.__defineSetter__("dialog-dismissed",function(e){e&&d()})}else{d()}}}l.scrollTo(0,0);if(typeof l.apple==="undefined"){q()}else{l.apple.MobileBanner=q}})(window);Event.onDomReady(function(g){if(/#(.*)Replacement/.test(window.location.href)){if(!coherent.Browser.IE||coherent.Browser.IE>=9){window.location.hash=""}var f,d,e=Element.query("#productReplacedMessageOverlayContent"),a=Element.query("#productReplacedMessageOverlayCloseButton"),c="productReplacedMessageOverlay";if(!e){return}d=document.createElement("DIV");d.id=c;d.className="overlay";document.body.appendChild(d);f=new coherent.Overlay(c);f.setDelegate({willShowOverlay:function(){if(a){Event.observe(a,"click",f.hide.bind(f))}}});f.display({sourceId:"productReplacedMessageOverlayContent"});if(Element.query(".product-details")){function b(){var k=Element.query("#productReplacedMessageOverlay.overlay"),n=Element.query("#productReplacedMessageOverlay.overlay a"),h=Element.query("#productReplacedMessageOverlayCloseButton"),l=Element.query("#productReplacedMessageOverlayContent h2"),j=Element.query(".productReplacedMessageOverlayContentBody"),m=Element.query(".product-details #page");if(k&&n&&j&&l&&m){k.setAttribute("role","dialog");k.setAttribute("aria-hidden","false");k.appendChild(n);j.setAttribute("id","PRMOverlayContentBody");l.setAttribute("id","PRMOverlayContentHeader");k.setAttribute("aria-labelledby","PRMOverlayContentHeader");k.setAttribute("aria-describedby","PRMOverlayContentBody");m.setAttribute("aria-hidden","true");h.setAttribute("aria-describedby","productReplacedMessageOverlayContent");Event.observe(h,"click",i);Event.observe(n,"click",i);Event.observe(h,"keydown",i);Event.observe(n,"keydown",i);Event.observe(k,"keydown",function(p){o()});Event.observe(Element.query(".overlayScreen"),"click",function(p){i(p)})}function o(){Element.preventFocus(m,true);Element.queryAll(":[tabindex=0]").forEach(function(p){p.setAttribute("data-tabindex",p.getAttribute("tabindex"));p.setAttribute("tabindex","-1")})}function i(p){if(p.type=="click"||(p.type=="keydown"&&(p.keyCode=="13"||p.keyCode=="32"||p.keyCode=="27"))){m.removeAttribute("aria-hidden");Element.restoreFocus(m,true)}}}b()}}});Package("apple.fcs");function supportsLocalStorage(){try{return window.localStorage}catch(a){return false}}function getDataFromCookie(b){var d=document.cookie.split(";");for(var c=0;d.length>c;c++){var a=d[c].substr(0,d[c].indexOf("="));var e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a===b){return decodeURIComponent(e)}}}function getReferrerDomain(){var c=document.referrer;if(!(typeof c==="undefined")){var b=c.split("/");if(b!=null&&b.length>=3){var a=b[2]}return a}return" "}function updateFcsData(a,b){if(typeof a==="string"&&a==="AC"){return true}return b}apple.fcs.setFcsDataForQbe=function(){try{var b=document.getElementsByName("fcs1")[0];if(b&&b.value===""){b.value=localStorage.getItem("fcs1")}else{b.value=decodeURIComponent(b.value)}localStorage.removeItem("fcs1")}catch(c){}try{var a=document.getElementsByName("fcs2")[0];if(a&&a.value===""){a.value=localStorage.getItem("fcs2")}else{a.value=decodeURIComponent(a.value)}localStorage.removeItem("fcs2")}catch(c){}};apple.fcs.storeFcsData=function(){this.localStorageKey="fcs1";this.localStorageCounterKey="fcs2";if(supportsLocalStorage()){var a=localStorage.getItem(this.localStorageKey);if(a==null){data={RD:getReferrerDomain(),LPU:document.URL,AC:false,SST:Math.round(new Date().getTime()/1000)};localStorage.setItem(this.localStorageKey,JSON.stringify(data));localStorage.setItem(this.localStorageCounterKey,1)}else{var b=localStorage.getItem(this.localStorageCounterKey);localStorage.setItem(this.localStorageCounterKey,++b)}}};apple.fcs.appendFcsData=function(a){var f=a;var b=/\?/ig;var d=a.match(b);try{if(typeof(localStorage.getItem("fcs1"))!=="undefined"&&localStorage.getItem("fcs1")!==null){if(d){f=f+"&f1="+encodeURIComponent(localStorage.getItem("fcs1"))}else{f=f+"?f1="+encodeURIComponent(localStorage.getItem("fcs1"))}}if(typeof(localStorage.getItem("fcs2"))!=="undefined"&&localStorage.getItem("fcs2")!==null){if(f.match(b)){f=f+"&f2="+encodeURIComponent(localStorage.getItem("fcs2"))}else{f=f+"?f2="+encodeURIComponent(localStorage.getItem("fcs2"))}}return f}catch(c){return a}};apple.fcs.flushFcsData=function(){localStorage.removeItem("fcs1");localStorage.removeItem("fcs2")};apple.fcs.setAcceptCookie=function(){try{var a=localStorage.getItem("fcs1");if(typeof(a)!="undefined"&&a!=null){localStorage.setItem("fcs1",JSON.stringify(JSON.parse(a,updateFcsData)))}}catch(b){}};function EqualizeControllerMixinClass(){}EqualizeControllerMixinClass.prototype.equalizeSectionHeight=function(){var f=Element.query(".ipod-selection");if(f){var d=Element.query(f,"#primary .box-content");var c=Element.query(f,".rail .box-content");var g=Element.query(f,".rail .title-bar");if(d&&c&&g){c.style.minHeight="";f.style.height="auto";var e=f.offsetHeight||f.scrollHeight;f.style.height=e+"px";if(!this.primaryBoxContentStyle){this.primaryBoxContentStyle=Element.getStyles(d)}if(!this.rightRailBorderBottomWidth){this.rightRailBorderBottomWidth=Element.getStyles(c,Element.PROPERTIES[8])}if(!this.rightRailBorderTopWidth){this.rightRailBorderTopWidth=Element.getStyles(c,Element.PROPERTIES[6])}var b=g.offsetHeight||g.scrollHeight;var a=e-b-parseInt(this.rightRailBorderBottomWidth||0,10)+parseInt(this.primaryBoxContentStyle.borderTopWidth||0,10)+parseInt(this.primaryBoxContentStyle.borderBottomWidth||0,10);a=a-parseInt(this.rightRailBorderTopWidth||0);c.style.height="auto";c.style.minHeight=a+"px"}}};EqualizeControllerMixinClass.getInstance=function(){if(!EqualizeControllerMixinClass.__instance){EqualizeControllerMixinClass.__instance=new EqualizeControllerMixinClass()}return EqualizeControllerMixinClass.__instance};EqualizeControllerMixinClass.prototype.apply=function(a){a.prototype.equalizeSectionHeight=EqualizeControllerMixinClass.getInstance().equalizeSectionHeight};EqualizeControllerMixin=new EqualizeControllerMixinClass();Package("apple");apple.RetailAvailabilitySearchTrigger=Class.create(coherent.View,{exposedBindings:["availability","partNumber","storeNumber","showLink"],OMNITURE_FEATURE_NAME:"storeLocator",OMNITURE_PROPERTY_NAME:"prop37",__structure__:{".cold-start":coherent.View({visibleBinding:"partNumber&&showView&&storeNumber(not)"}),".warm-start":coherent.View({visibleBinding:"partNumber&&showView&&storeNumber"}),".retail-availability-search-availability-value":coherent.View({htmlBinding:"availability"}),".retail-availability-search-trigger":coherent.Button({visibleBinding:"showLink"}),".disclaimer":coherent.View({visibleBinding:"showView"})},init:function(){this.__partNumber=this.viewElement().getAttribute("data-part");this.__productTitle=this.viewElement().getAttribute("data-title");this.__eligibility=this.viewElement().getAttribute("data-eligibility");this.__showStoreSearchLink=this.viewElement().getAttribute("data-showstoresearchlink");if(this.__partNumber){this.setValueForKeyPath(this.__partNumber,"partNumber");this.setValueForKeyPath(this.__productTitle,"productTitle");this.setValueForKeyPath(this.__eligibility==="true","showView");this.setValueForKeyPath(this.__showStoreSearchLink==="true","showLink")}Element.addClassName(this.viewElement(),"ready");Element.queryAll(this.viewElement(),".retail-availability-search-trigger").forEach(function(a){Event.observe(a,"click",this.buttonClicked.bind(this))},this);this.addObserverForKeyPath(this,this.showHideLink,"showLink")},showHideLink:function(a){Element.queryAll(this.viewElement(),".retail-availability-search-trigger").forEach(function(b){Element.setStyle(b,"display",(a.newValue)?" inline-block":"none")})},buttonClicked:function(a){this.fireEvent(this.valueForKeyPath("storeNumber")?{action:"See more stores",events:"event29, event32"}:{action:"Check availability",events:"event29, event31"});this.viewAction="click";this.sendAction();this.viewAction=null;Event.stop(a)},fireEvent:function(a){a=a||{action:"unknown"};a.eVar=this.OMNITURE_PROPERTY_NAME;a.page=s.pageName;a.feature=this.OMNITURE_FEATURE_NAME;apple.metrics.fireMicroEvent(a)}});Package("apple");apple.RetailAvailabilitySearchOverlay=Class.create(coherent.View,{exposedBindings:["storeList","partNumber","storeNumber","productTitle"],resultsPerPage:6,currentPage:0,__hash:{},actionTypes:{cancel:1,select:2,search:3},OMNITURE_FEATURE_NAME:"storeLocator",OMNITURE_PROPERTY_NAME:"prop37",searchQueryView:coherent.TextField("#retail-availability-search-query",{valueBinding:"searchQuery",action:"performSearch",enabledBinding:"searching(not)",sendsActionOnEndEditing:false,continuallyUpdatesValue:true}),storeListView:coherent.View("#retail-availability-search-store-list",{action:"changeSelection"}),init:function(){this.addObserverForKeyPath(this,this.observeSearchingChange.bind(this),"searching");this.setValueForKeyPath(true,"showInfo");this.__initialStoreListInnerHTML="";if(this.storeListView){this.__initialStoreListInnerHTML=this.storeListView.viewElement().innerHTML}},__structure__:{"#retail-availability-search-form-spinner":coherent.View({visibleBinding:"searching"}),"#retail-availability-search-search-button":coherent.Anchor({enabledBinding:"searching(not)",action:"performSearch"}),"#retail-availability-search-product-name":coherent.View({htmlBinding:"productTitle"}),"#retail-availability-search-previous-button":coherent.Anchor({visibleBinding:"showPreviousButton",action:"showPrevious"}),"#retail-availability-search-next-button":coherent.Anchor({visibleBinding:"showNextButton",action:"showNext"}),"#retail-availability-search-photo":coherent.ImageView({srcBinding:"content.storeImageUrl"}),"#retail-availability-search-directions-button":coherent.Anchor({hrefBinding:"content.directionsUrl",enabledBinding:"content.directionsUrl",action:"directionsButtonActionHandler"}),"#retail-availability-search-reservation-button":coherent.Anchor({hrefBinding:"content.reservationUrl",enabledBinding:"content.reservationUrl",action:"reservationButtonActionHandler"}),"#retail-availability-search-cancel-button":coherent.Anchor({action:"cancel"}),"#retail-availability-search-select-store-button":coherent.Anchor({enabledBinding:"enableSelectButton",action:"saveSelection"}),"#retail-availability-search-name":coherent.View({textBinding:"content.storeDisplayName||content.address.address"}),"#retail-availability-search-locality":coherent.View({textBinding:"content.address.address2",visibleBinding:"content.address.address2"}),"#retail-availability-search-region":coherent.View({textBinding:"content.address.address3",visibleBinding:"content.address.address3"}),"#retail-availability-search-tel":coherent.View({textBinding:"content.phoneNumber",visibleBinding:"content.phoneNumber"}),"#retail-availability-search-info-placeholder":coherent.View({visibleBinding:"showInfo"}),"#retail-availability-search-error-placeholder":coherent.View({visibleBinding:"showDetails(not)&&showInfo(not)",textBinding:"errorText"}),"#retail-availability-search-profile":coherent.View({visibleBinding:"showDetails&&showInfo(not)"}),".retail-availability-search-actions":coherent.View({visibleBinding:"showDetails&&showInfo(not)"}),"#retail-availability-search-hours-info":coherent.View({htmlBinding:"content.storeHours"}),".special-hour-label":coherent.View({visibleBinding:"content.specialHours"}),"#retail-availability-special-hours-info":coherent.View({htmlBinding:"content.specialHours"}),"#retail-availability-search-specialhours-button":coherent.Anchor({visibleBinding:"content.viewAllSpecialHours",hrefBinding:"content.directionsUrl",enabledBinding:"content.directionsUrl",action:"directionsButtonActionHandler"})},showErrorBubbleView:function(a){var c=this;function b(){var d=c.searchQueryView.viewElement();Element.addClassName(d,coherent.Style.kInvalidValueClass);c.setValueForKeyPath(true,"showErrorBubble");coherent.Bubble.display({classname:"bubble retail-availability-overlay-bubble",error:c.oldError,target:d});d.setAttribute("aria-describedby","coherent_bubble_node");c.focusLocationField()}if(this.showErrorBubble&&!(this.oldError.description.toString()===a.description.toString())){this.setValueForKeyPath(a,"oldError");this.hideErrorBubbleView();b.delay(200)}else{this.setValueForKeyPath(a,"oldError");b()}},hideErrorBubbleView:function(){Element.removeClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass);coherent.Bubble.hide({target:this.searchQueryView.viewElement()});this.setValueForKeyPath(false,"showErrorBubble");this.__validationError=false},clearAllErrors:function(){if(this.showErrorBubble||this.__validationError){if(this.zipValidation.pattern.test(this.searchQueryView.viewElement().value)){this.hideErrorBubbleView()}else{Element.addClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass)}}},focusLocationField:function(){this.searchQueryView.viewElement().focus()},validSearchQueryView:function(){var a=this.searchQuery;this.__validationError=true;if(!a){Element.addClassName(this.searchQueryView.viewElement(),coherent.Style.kInvalidValueClass);this.searchQueryView.blur();this.showErrorBubbleView(new coherent.Error({description:this.zipValidation?this.zipValidation.requiredError:"Please enter the mandatory field"}));return false}else{if(this.zipValidation.pattern&&!this.zipValidation.pattern.test(a)){this.searchQueryView.blur();this.showErrorBubbleView(new coherent.Error({description:this.zipValidation?this.zipValidation.invalidFormatError:"Zip code is not valid"}));return false}else{this.__validationError=false;return true}}},performSearch:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return(d.nodeName==="BUTTON"&&d.id==="retail-availability-search-search-button")||(d.nodeName==="INPUT"&&d.id==="retail-availability-search-query")},this.viewElement());if(b&&this.validSearchQueryView()){this.setValueForKeyPath(true,"searching");this.performAction(this.actionTypes.search)}},performAction:function(a){this.viewAction=a;this.sendAction();this.viewAction=null},reset:function(){this.storeListView.viewElement().innerHTML=this.__initialStoreListInnerHTML;this.setValueForKeyPath(null,"searchQuery");this.setValueForKeyPath(false,"showNextButton");this.setValueForKeyPath(false,"showPreviousButton");this.setValueForKeyPath(true,"showInfo")},changeSelection:function(a,d){var c=Element.locateAncestor(d.target||d.srcElement,function(f){return f.nodeName==="LABEL"&&Element.hasAttribute(f,"for")},a.viewElement());if(c){var b=c.parentNode.childNodes[0]}if(d.target.tagName==="INPUT"){var b=d.target||d.srcElement}var e=b.getAttribute("value");this.setStoreSelected(e)},saveSelection:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return d.nodeName==="BUTTON"&&d.id==="retail-availability-search-select-store-button"},this.viewElement());if(b){if(this.currentStoreNumber){this.fireEvent({action:"Retail store selected",events:"event37"});this.storeNumber=this.currentStoreNumber;this.performAction(this.actionTypes.select)}}},cancel:function(a,c){var b=Element.locateAncestor(c.target||c.srcElement,function(d){return d.nodeName==="BUTTON"&&d.id==="retail-availability-search-cancel-button"},this.viewElement());if(b){this.performAction(this.actionTypes.cancel)}},showNext:function(a,b){if(this.currentPage<this.totalPageCount-1){this.fireEvent({action:"next",slot:"pageIndex"+this.currentPage});this.gotoPage(++this.currentPage)}},showPrevious:function(a,b){if(this.currentPage>0){this.fireEvent({action:"prev",slot:"pageIndex"+this.currentPage});this.gotoPage(--this.currentPage)}},gotoPage:function(a){this.setValueForKeyPath(a!==this.totalPageCount-1,"showNextButton");this.setValueForKeyPath(a!==0,"showPreviousButton");var b=this.storeListView.viewElement();if(b){b.scrollTop=a*b.offsetHeight}this.currentPage=a},directionsButtonActionHandler:function(b,c){this.fireEvent({action:"Driving Directions"});var a=b.viewElement();window.open(a.href,a.target)},reservationButtonActionHandler:function(b,c){this.fireEvent({action:"Store Workshops"});var a=b.viewElement();window.open(a.href,a.target)},fireEvent:function(a){a=a||{action:"unknown"};a.eVar=this.OMNITURE_PROPERTY_NAME;a.page=s.pageName;a.feature=this.OMNITURE_FEATURE_NAME;apple.metrics.fireMicroEvent(a)},observeStoreListChange:function(a){if(a.newValue){this.stores=coherent.KVO.adaptTree(a.newValue);this.setStoreList();if(this.stores[0]){this.setStoreSelected(this.stores[0].storeNumber)}}},showErrorMessage:function(a){this.stores=[];this.setStoreList(true);this.setValueForKeyPath(a,"errorText");this.setValueForKeyPath(false,"showDetails")},setStoreList:function(p){var j=this.storeListView.viewElement();var a=document.createDocumentFragment();var g=this.partNumber;j.innerHTML="";this.__hash={};this.currentPage=0;this.setValueForKeyPath(false,"showInfo");var r,o=this.stores.length,n=0;this.__firstStore=null;for(r=0;r<o;r++){var f=this.stores[r];if(f&&(!f.partsAvailability||!f.partsAvailability[g])){f.partsAvailability[g]={pickupDisplay:"unknown",pickupSearchQuote:this.unknownError,storeSelectionEnabled:false}}if(f&&f.partsAvailability&&f.partsAvailability[g]&&f.partsAvailability[g].pickupDisplay&&f.partsAvailability[g].pickupDisplay!=="ineligible"){f.pageIndex=Math.floor(r/this.resultsPerPage);var k=document.createElement("li");k.className="retail-availability-search-store-item";var u=document.createElement("label");u.className="retail-availability-search-store-label";u.setAttribute("for","retail-availability-search-store-selection-"+f.storeNumber);f.listElement=u;var h=document.createElement("span");h.className="store-info";var m=document.createElement("span");m.className="store-name strong block";m.title=f.storeDisplayName;m.innerHTML=f.storeDisplayName;var t=document.createElement("span");t.className="store-location";t.title=f.city+(f.city&&f.state?", ":"")+f.state;t.innerHTML=f.city+(f.city&&f.state?", ":"")+f.state;var q=document.createElement("span");q.className="store-availability";var b=document.createElement("span");b.className=f.partsAvailability[g].pickupDisplay;b.innerHTML=f.partsAvailability[g].pickupSearchQuote;q.appendChild(b);h.appendChild(m);h.appendChild(t);u.appendChild(h);u.appendChild(q);var v=document.createElement("input");v.id="retail-availability-search-store-selection-"+f.storeNumber;v.type="radio";v.className="retail-availability-search-selection a11y";v.name="retail-availability-search-selection";v.value=f.storeNumber;f.inputElement=v;k.appendChild(v);k.appendChild(u);a.appendChild(k);if(!this.__firstStore){this.__firstStore=f}f.storeNumber&&(this.__hash[f.storeNumber]=f)}else{n++}}this.totalPageCount=Math.ceil((o-n)/this.resultsPerPage);if(p){this.totalPageCount=1}var d=this.totalPageCount*this.resultsPerPage;var e=d-o+n;if(e){var c=document.createElement("li");c.className="retail-availability-search-store-item";c.innerHTML='<label class="retail-availability-search-store-label empty"><span class="store-info"></span><span class="store-availability"></span></label>';for(r=0;r<e;r++){a.appendChild(c.cloneNode(true))}}j.appendChild(a);this.gotoPage(0)},__highlightStoreSelection:function(a){for(var c in this.__hash){var b=this.__hash[c];if(b&&b.listElement){if(c===a){b.inputElement&&(b.inputElement.checked=true);Element.addClassName(b.listElement,"selected")}else{Element.removeClassName(b.listElement,"selected")}}}},setStoreSelected:function(a){if(!this.__hash[a]){if(this.__firstStore&&this.__firstStore.storeNumber){a=this.__firstStore.storeNumber}}this.setValueForKeyPath(a,"currentStoreNumber");this.__highlightStoreSelection(a);var b=this.__hash[a];if(b){if(b.city&&b.address){b.address.address3=b.city;if(b.state){b.address.address3+=", "+b.state}if(b.address.postalCode){b.address.address3+=" "+b.address.postalCode}}this.setValueForKeyPath(b,"content");if(b.partsAvailability&&b.partsAvailability[this.partNumber]){this.setValueForKeyPath(b.partsAvailability[this.partNumber].storeSelectionEnabled,"enableSelectButton")}this.setValueForKeyPath(true,"showDetails")}},observeSearchingChange:function(a){if(!a.newValue){this.focusLocationField.bindAndDelay(this,500)}}});Package("apple");apple.RetailAvailabilitySearchViewController=Class.create(coherent.ViewController,{overlay:apple.RetailAvailabilitySearchOverlay("#retail-availability-search",{storeListBinding:"stores",partNumberBinding:"partNumber",productTitleBinding:"productTitle",storeNumberBinding:"storeNumber",action:"overlayActionHandler"}),trigger:apple.RetailAvailabilitySearchTrigger(".retail-availability-search-info",{storeNumberBinding:"storeNumber",action:"triggerActionHandler"}),__overlay:coherent.Overlay("#retail-availability-search-overlay",{delegate:{}}),init:function(){this.overlay.zipValidation=this.validation.zip;this.overlay.unknownError=this.availabilityUnknownError;this.overlay.ineligibleError=this.availabilityIneligibleError;this.__partNumbers=[];this.__triggerHash={};var d=Element.queryAll(this.viewElement(),".retail-availability-search-info");var a=this.cookie&&apple.cookie(this.cookie.name);for(var c=0,b=d.length;c<b;c++){var f=d[c];var g=coherent.View.fromNode(f);var e=g.partNumber;if(this.__triggerHash[e]||!g.showView){continue}this.__triggerHash[e]=g;this.__partNumbers.push(e)}if(a){this.setValueForKeyPath(a,"storeNumber");this.getStoreAvailabilityInfo()}if(b===1){if(this.__partNumbers[0]){coherent.dataModel.setValueForKey(coherent.KVO.adaptTree({partNumber:this.__partNumbers[0]}),"retailAvailabilitySearchProduct")}coherent.dataModel.addObserverForKeyPath(this,this.observeProductChange.bind(this),"retailAvailabilitySearchProduct")}else{this.observeProductChange=function(){}}if(this.__overlay){this.__overlay.delegate.willHideOverlay=function(){this.stores=null;this.overlay.hideErrorBubbleView();this.overlay.reset()}.bind(this);this.__overlay.delegate.didShowOverlay=function(){this.overlay.focusLocationField.bindAndDelay(this.overlay,300)}.bind(this)}},overlayActionHandler:function(a,b){if(a.viewAction){if(a.viewAction===this.overlay.actionTypes.cancel){this.hideOverlay()}else{if(this.partNumber){if(a.storeNumber&&a.viewAction===this.overlay.actionTypes.select){this.saveStoreSelection(a.storeNumber);var c=this.__partNumbers[0]?this.__partNumbers:this.partNumber;this.getAvailabilityForStore(c,a.storeNumber,this.url,function(d){if(d&&d.stores&&d.stores[0]){this.processResponseForAvailabilityInfo(d.stores[0].partsAvailability)}this.hideOverlay();if(this.equalizeSectionHeight){this.equalizeSectionHeight()}}.bind(this))}else{if(a.searchQuery&&a.viewAction===this.overlay.actionTypes.search){this.getAvailabilityForLocation(this.partNumber,a.searchQuery,function(d){this.setValueForKeyPath(d.stores,"stores");this.overlay.setValueForKeyPath(false,"searching")}.bind(this))}}}else{throw"No part number found"}}}else{if(coherent.Browser.IE&&b.srcElement&&b.srcElement.id==="retail-availability-placeholder-value"){this.overlay.focusLocationField()}}},triggerActionHandler:function(a,c){if(a.viewAction!=="click"){return}var b=a.partNumber;var d=a.productTitle;if(b){this.setValueForKeyPath(b,"partNumber");this.setValueForKeyPath(d,"productTitle");if(this.storeNumber&&!this.stores){this.overlay.setValueForKeyPath(true,"searching");this.getAvailabilityForStore(b,this.storeNumber,this.searchUrl,function(e){this.setValueForKeyPath(e.stores,"stores");this.overlay.setValueForKeyPath(false,"searching");this.overlay.setValueForKeyPath(e.zip,"searchQuery")}.bind(this),this.showOverlayError.bind(this))}this.showOverlay()}},saveStoreSelection:function(a){if(a){if(this.cookie){apple.cookie(this.cookie.name,a,{domain:this.cookie.domain,path:"/",expires:this.cookie.expiry>0?this.cookie.expiry:""})}this.setValueForKeyPath(a,"storeNumber")}},showOverlay:function(){this.__overlay&&this.__overlay.display({sourceId:this.overlay.id,classname:"retail-availability-search-overlay overlay"})},hideOverlay:function(){this.__overlay.hide()},observeProductChange:function(c){var b=c.newValue||{partNumber:null,productTitle:""};var a=c.oldValue;if(a&&a.partNumber===b.partNumber){return}this.__partNumbers[0]=b.partNumber;this.trigger.setValueForKeyPath(b.partNumber,"partNumber");this.trigger.setValueForKeyPath(b.productTitle,"productTitle");this.__triggerHash={};this.__triggerHash[b.partNumber]=this.trigger;if(this.storeNumber){this.getStoreAvailabilityInfo(b.partNumber)}else{this.checkEligibilty(b.partNumber)}},getStoreAvailabilityInfo:function(){if(this.storeNumber){var a=this.__partNumbers;if(a&&a[0]){this.getAvailabilityForStore(a,this.storeNumber,this.url,function(b){if(b&&b.stores&&b.stores[0]){this.processResponseForAvailabilityInfo(b.stores[0].partsAvailability)}}.bind(this))}}},checkEligibilty:function(){var a=this.__partNumbers;if(a&&a[0]){this.getEligibilityForPartNumbers(a,function(b){if(b&&b.pickupEligibility){this.processResponseForAvailabilityInfo(b.pickupEligibility)}}.bind(this))}},processResponseForAvailabilityInfo:function(c){for(var b in this.__triggerHash){var a=c[b];if(a&&(typeof a.eligible==="undefined"||a.eligible)){this.__triggerHash[b].setValueForKeyPath(a.pickupQuote,"availability");this.__triggerHash[b].setValueForKeyPath(a.storeSearchEnabled!==false,"showLink");this.__triggerHash[b].setValueForKeyPath(a.pickupDisplay!=="ineligible","showView")}else{this.__triggerHash[b].setValueForKeyPath(false,"showView")}}},getEligibilityForPartNumbers:function(a,b){this.performQuery({partNumber:a,url:this.eligibilityUrl,success:b,timeout:this.timeout})},getAvailabilityForStore:function(c,a,b,e,d){this.performQuery({partNumber:c,storeNumber:a,url:b,success:e,error:d,timeout:this.timeout})},getAvailabilityForLocation:function(b,a,c){this.performQuery({partNumber:b,location:a,url:this.searchUrl,success:c,error:this.showOverlayError.bind(this)})},typeOf:function(a){return Object.prototype.toString.call(a).match(/\[object ([a-zA-Z0-9]+)\]/)[1].toLowerCase()},showOverlayError:function(a){this.overlay.setValueForKeyPath(false,"searching");this.overlay.showErrorMessage(a.errorMessage)},addQueryParam:function(a,b){if(a.indexOf("?")>-1){!/&$/.test(a)&&(a=a+"&")}else{a=a+"?"}a=a+b;return a},performQuery:function(d){var f={};var c=d.url;if(d.partNumber){if(this.typeOf(d.partNumber)==="array"){var e=0;var a=d.partNumber.length;for(;e<a;e++){f["parts."+e]=d.partNumber[e]}}else{f["parts.0"]=d.partNumber}if(d.location){f.zip=d.location}else{if(d.storeNumber){f.store=d.storeNumber}}if(this.queryParams){c=this.addQueryParam(c,this.queryParams)}function h(i){if(i.success===false){d.error?d.error(i):b(i)}else{d.success(i)}}function b(i,j){console.log(i,j)}var g=JSONRPC.get(c,f,d.timeout?{timeout:d.timeout}:null);g.addCallback(h,b)}}});apple.RetailAvailabilitySearchViewController.create=function(a,b){var c=Element.query(a);if(c){new coherent.View(c);new apple.RetailAvailabilitySearchViewController(c,b)}};EqualizeControllerMixin.apply(apple.RetailAvailabilitySearchViewController);Package("apple");apple.SlidingView=Class.create(coherent.View,{init:function(){Element.addClassName(this.viewElement(),"js-enabled");this.slidingList=Element.query(this.viewElement(),"ul");this.leftArrow=document.createElement("a");Element.addClassName(this.leftArrow,"navbar-arrow left");this.rightArrow=document.createElement("a");Element.addClassName(this.rightArrow,"navbar-arrow right");var a=Element.query(this.viewElement(),".panel-body");a.appendChild(this.leftArrow);a.appendChild(this.rightArrow);Event.observe(this.leftArrow,"click",this.moveRight.bind(this));Event.observe(this.rightArrow,"click",this.moveLeft.bind(this));this.isiPad=navigator.userAgent.match(/iPad/i)!=null;this.originalCoord={x:0,y:0};this.finalCoord={x:0,y:0}},moveRight:function(){},moveLeft:function(){},ontouchstart:function(a){},ontouchmove:function(a){},ontouchend:function(a){}});Package("apple");apple.LateralNav=Class.create(coherent.View,{scrollContainer:null,lateralNavWidth:980,distanceBetweenLinks:73,buttonOffset:70,init:function(){if(!Element.hasClassName(Element.query("html"),"no-touch")){return}this.setupElementRefs();this.calculateTransitionPoints();this.checkButtons();this.setButtonsBackgroundColor();Event.observe(this.nextButton,"click",this.slideToNext.bindAsEventListener(this));Event.observe(this.prevButton,"click",this.slideToPrev.bindAsEventListener(this))},setupElementRefs:function(){this.scrollContainer=Element.query(this.viewElement(),".scroll-body");this.tiles=Element.queryAll(this.viewElement(),".scroll-body .tile");this.nextButton=Element.query(this.viewElement(),".button-right");this.prevButton=Element.query(this.viewElement(),".button-left")},calculateTransitionPoints:function(){var b=this,d=0,c=0,a=0;this.currentPoint=0;this.transitionPoints=[];b.transitionPoints.push(0);this.tiles.forEach(function(e){a=Element.offsetFromAncestor(e,this.scrollContainer).width;a+=b.distanceBetweenLinks;d+=a;c+=a;if(c-b.distanceBetweenLinks>=b.lateralNavWidth){b.transitionPoints.push(-1*(d-a)+b.buttonOffset);c=a+b.buttonOffset}})},slideToNext:function(){this.currentPoint++;this.slide(this.currentPoint);this.checkButtons();apple.metrics.fireMicroEvent({eVar:"eVar6",action:"right",feature:"Navigation-scroll"})},slideToPrev:function(){this.currentPoint--;this.slide(this.currentPoint);this.checkButtons();apple.metrics.fireMicroEvent({eVar:"eVar6",action:"left",feature:"Navigation-scroll"})},slide:function(a){var b=this.transitionPoints[a];if(coherent.Browser.Safari){Element.setStyle(this.scrollContainer,"-webkit-transform","translateX("+b+"px )")}else{if(coherent.Browser.IE===9){Element.setStyle(this.scrollContainer,"-ms-transform","translateX("+b+"px )")}else{if(coherent.Browser.IE===8){Element.setStyle(this.scrollContainer,"left",b+"px")}else{Element.setStyle(this.scrollContainer,"transform","translateX("+b+"px )")}}}},checkButtons:function(){if(this.transitionPoints.length<=1){this.hideButton(this.nextButton);this.hideButton(this.prevButton)}else{if(this.currentPoint===0&&this.transitionPoints.length>1){this.showButton(this.nextButton);this.hideButton(this.prevButton)}else{if(this.currentPoint===this.transitionPoints.length-1){this.hideButton(this.nextButton);this.showButton(this.prevButton)}else{this.showButton(this.nextButton);this.showButton(this.prevButton)}}}},showButton:function(a){Element.removeClassName(a,"hide");Element.removeClassName(a,"gone")},hideButton:function(a){Element.addClassName(a,"hide");Element.addClassName(a,"gone")},setButtonsBackgroundColor:function(){var a=this.viewElement(),b="transparent";while(a){b=Element.getStyle(a,"backgroundColor");if((b!=="rgba(0, 0, 0, 0)")&&(b!=="transparent")){break}a=a.parentNode}Element.setStyle(this.nextButton,"backgroundColor",b);Element.setStyle(this.prevButton,"backgroundColor",b)}});(function(){Event.onDomReady(function(){setTimeout(function(){var a=Element.queryAll(".lateral-navbar");a.forEach(function(b){new apple.LateralNav(b)})},1000)})})();Package("apple");apple.VisualLimitTextField=Class.create(coherent.TextField,{defaultOptions:{thermometerWidth:74,thermometerSpriteOffset:8,maxLength:500},init:function(){this.options=Object.applyDefaults(this.options,this.defaultOptions);this.getConfiguration();this.getThermometerElement();this.getMaxLengthAttribute();this.clearDefaultText();this.hideThermometerUntilThresholdIsReached();this.createThermometerMarkup();this.addObserverForKeyPath(this,this.observeErrorMessageChange,"errorMessage");this.setValueForKey(false,"blackWordError");this.displayServerMessages();this.updateThermometer();Event.observe(this.viewElement(),"paste",this.onpaste.bind(this))},getConfiguration:function(){this.config=window.visualLimitTextFieldConfig;this.textStrings=window.visualLimitTextFieldTextStrings},getThermometerElement:function(){var a=this.viewElement().id+"Thermometer";this.thermometer=document.getElementById(a)},getMaxLengthAttribute:function(){this.options.maxLength=this.viewElement().getAttribute("maxlength");this.viewElement().removeAttribute("maxlength")},clearDefaultText:function(){if(this.thermometer){while(this.thermometer.childNodes.length>=1){this.thermometer.removeChild(this.thermometer.firstChild)}}},hideThermometerUntilThresholdIsReached:function(){if(this.thermometer){this.thermometer.style.display="none"}},createThermometerMarkup:function(){if(this.thermometer){this.thermometer.background=document.createElement("div");this.thermometer.meter=document.createElement("div");this.thermometer.overlay=document.createElement("div");this.thermometer.background.className="textfieldThermometerBackground";this.thermometer.meter.className="textfieldThermometerMeter";this.thermometer.overlay.className="textfieldThermometerOverlay";this.thermometer.background.appendChild(this.thermometer.meter);this.thermometer.background.appendChild(this.thermometer.overlay);this.thermometer.appendChild(this.thermometer.background)}},onkeyup:function(a){this.validate();if(!this.continuallyUpdatesValue){return}if(this.updateTimer){window.clearTimeout(this.updateTimer)}this.updateTimer=this.valueChanged.bindAndDelay(this,this.keypressUpdateTimeout)},onpaste:function(a){this.validate();this.checkForBlackWords.bind(this).delay(10)},valueChanged:function(a){if(this.updateTimer){window.clearTimeout(this.updateTmer);this.updateTimer=null}if(this.markerValue){return}this.checkForBlackWords()},checkForBlackWords:function(){var a={t:this.viewElement().value};this.ajaxResponse=JSONRPC.post(this.config.messageValidatorUrl,a);this.ajaxResponse.addCallback(this.processAjaxResponse.bind(this))},processAjaxResponse:function(){if(this.ajaxResponse&&this.ajaxResponse._result&&this.ajaxResponse._result.status=="ERROR"){this.setValueForKey(this.ajaxResponse._result.error,"blackWordError")}else{this.setValueForKey(false,"blackWordError")}this.validate()},displayServerMessages:function(){var d=this.viewElement().id+"Error";var b=document.getElementById(d);if(b){var c=b.getElementsByTagName("li");var a=c[c.length-1].firstChild.nodeValue;this.setValueForKey(a,"errorMessage")}},validate:function(){var a;this.updateThermometer();this.updateValueBinding();if(this.valueIsOverMaxLength()){this.limitValueToMaxLength();this.setValueForKey(this.textStrings.maxLengthError,"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});return a}else{if(this.valueForKey("blackWordError")){this.setValueForKey(this.valueForKey("blackWordError"),"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});this.presentError(a);return a}else{if(this.valueIsAtMaxLength()){this.setValueForKey(this.textStrings.maxLengthError,"errorMessage");a=new coherent.Error({description:this.valueForKey("errorMessage")});this.presentError(a);return true}else{this.setValueForKey(null,"errorMessage");return true}}}},updateValueBinding:function(){if(this.bindings.value){this.bindings.value.setValue(this.viewElement().value)}},valueIsOverMaxLength:function(){if(this.viewElement().value.length>this.options.maxLength){return true}return false},valueIsAtMaxLength:function(){if(this.viewElement().value.length>=this.options.maxLength){return true}return false},limitValueToMaxLength:function(){var a=this.viewElement().value.substr(0,this.options.maxLength);this.viewElement().value=a},updateThermometer:function(){this.setMeasurements();this.updateMeterPosition();this.showThermometerWhenThresholdIsReached()},setMeasurements:function(){this.currentLength=this.viewElement().value.length;this.percentFull=parseInt(this.currentLength/this.options.maxLength*100,10);this.percentFull=(this.percentFull>100)?100:this.percentFull;this.meterWidth=parseInt(this.options.thermometerWidth*this.percentFull/100,10);this.meterSpriteOffset=this.options.thermometerWidth-this.meterWidth},updateMeterPosition:function(){if(this.thermometer){var a="-"+this.meterSpriteOffset+"px -"+this.options.thermometerSpriteOffset+"px";this.thermometer.meter.style.backgroundPosition=a}},showThermometerWhenThresholdIsReached:function(){if(this.thermometer){if(this.percentFull>=this.config.thermometerThreshold){this.thermometer.style.display="block"}}},hideThermometer:function(){if(this.thermometer){this.thermometer.style.display="none"}},observeErrorMessageChange:function(b){if(b.newValue!=b.oldValue){this.hideError()}if(!b.newValue){return}var a=new coherent.Error({description:b.newValue});this.presentError(a)},presentError:function(a){coherent.Bubble.display({classname:"bubble overlay-bubble",error:a,target:this.viewElement(),dimensions:{width:350,height:35}})},reset:function(){this.viewElement().value="";this.setValueForKey(null,"errorMessage");this.setValueForKey(false,"blackWordError");this.hideError();this.updateThermometer();this.hideThermometer()},hideError:function(){coherent.Bubble.hide({target:this.viewElement()})}});Package("apple");apple.FilterArticleSelect=Class.create(coherent.SelectField,{init:function(){Event.observe(this.viewElement(),"change",this.filter.bindAsEventListener(this))},filter:function(){window.location.href=this.viewElement().value}});Package("apple");apple.CommunityViewController=Class.create(coherent.ViewController,{addStructureProperty:function(b,a){if(a&&"function"==typeof(a)&&(a=a.valueOf()).__factoryFn__){return a.call(this,b,false)}return null},readMore:function(b){var c="description";var d=" expand";var a=b.viewElement().parentNode;while(a&&a!=document.body){if(a.className==c){a.className+=d;break}a=a.parentNode}if(a){a.setAttribute("tabindex","-1");a.focus()}this.forceIEtoRedraw()},forceIEtoRedraw:function(){if(coherent.Browser.IE===7){Array.forEach(Element.queryAll("div.bottom-corners, ul.pipe-list"),function(a){a.style.display="none";a.style.display="block"})}},showReportInappropriateOverlay:function(a){this.storeReportInappropriateOptions(a);if(this.dialog){window.reportInappropriateViewController.setOptions();this.displayDialog()}else{this.dialog=new apple.Dialog();if(!this.dialog||!window.reportInappropriateUrl){return}this.displayDialog()}},displayDialog:function(){this.dialog.overlay.display({url:window.reportInappropriateUrl,classname:"overlay modal-overlay community"})},storeReportInappropriateOptions:function(a){window.reportInappropriateOptions={url:a.viewElement?a.viewElement().href:a.target.href,contentType:a.contentType}}});Package("apple");apple.QuestionSearchForm=Class.create(coherent.Form,{searchField:coherent.TextField('input[type="text"]',{valueBinding:"searchValue",action:"searchQuestions",sendsActionOnEndEditing:false}),__structure__:{".search-reset":coherent.Anchor({visibleBinding:"showReset",action:"resetSearchField"}),'button[name="search"]':coherent.Button({action:"searchQuestions"}),'button[name="post"]':coherent.Button({action:"submitQuestion"})},init:function(){this.base();this.setupSearchField();this.setupMultipleFormActions();this.toggleResetButton();this.forceIEtoRedraw();this.fixCommunitySearchIE();Event.observe(this.searchField.viewElement(),"focus",this.focusInputWrapper.bindAsEventListener(this));Event.observe(this.searchField.viewElement(),"blur",this.focusInputWrapper.bindAsEventListener(this))},fixCommunitySearchIE:function(){if(coherent.Browser.IE===7&&Element.query(".community-search")){var c=Element.getStyles(Element.query(".community-search"),["width","paddingLeft","paddingRight","borderWidth"]);var b=Element.getStyles(Element.query(".community-search .button-wrapper"),["width"]);var a=Element.getStyles(Element.query(".community-search .input-wrapper .effects"),["paddingLeft","paddingRight","borderWidth"]);var d=apple.QuestionSearchForm.stripPx;Element.query(".community-search .input-wrapper").style.width=d(c.width)-d(c.paddingLeft)-d(c.paddingRight)*2-d(c.borderWidth)*2-d(b.width)-d(a.paddingLeft)-d(a.paddingRight)-d(a.borderWidth)*2}},forceIEtoRedraw:function(){if(coherent.Browser.IE===7){Array.forEach(Element.queryAll("div.bottom-corners"),function(a){a.style.display="none";a.style.display="block"})}},setupSearchField:function(){if(this.searchField){this.searchField.nullPlaceholder=this.searchField.viewElement().getAttribute("placeholder");this.searchField.viewElement().removeAttribute("placeholder");apple.behavior.TextFieldPlaceholder(this.searchField);this.addObserverForKeyPath(this,this.toggleResetButton,"searchValue")}},setupMultipleFormActions:function(){this.actions={searchQuestions:this.viewElement().action,submitQuestion:window.questionPostAction}},searchQuestions:function(){if(!this.searchFieldIsBlank()){this.viewElement().action=this.actions.searchQuestions;this.delayedFormSubmit.bindAndDelay(this,25)}},submitQuestion:function(){if(!this.searchFieldIsBlank()){this.viewElement().action=this.actions.submitQuestion;this.delayedFormSubmit.bindAndDelay(this,25)}},delayedFormSubmit:function(){this.action=null;this.viewElement().submit()},searchFieldIsBlank:function(){if(!this.valueForKey("searchValue")){this.setValueForKey("","searchValue")}if(this.valueForKey("searchValue").replace(/^\s+$/,"").length<1){return true}return false},toggleResetButton:function(){if(this.searchField.viewElement().value.length>0){this.setValueForKey(true,"showReset")}else{this.setValueForKey(false,"showReset")}},resetSearchField:function(){this.setValueForKey("","searchValue");this.toggleResetButton()},focusInputWrapper:function(){Element.toggleClassName(this.searchField.viewElement().parentNode.parentNode,"focus");this.parentForm=this.parentForm||Element.locateAncestor(this.searchField.viewElement(),function(a){return a.tagName.toLowerCase()=="form"});if(this.parentForm){Element.toggleClassName(this.parentForm,"focus")}}});apple.QuestionSearchForm.stripPx=function(a){return parseInt(a.slice(0,-2),10)};Package("apple");apple.QuestionAnswerViewController=Class.create(apple.CommunityViewController,{contributionForm:coherent.Form("form.contribution"),questionAsked:apple.VisualLimitTextField("textarea#question-asked"),questionDescription:apple.VisualLimitTextField("textarea#question-description"),answerText:apple.VisualLimitTextField("textarea#answer-text"),__structure__:{"form.question-search":apple.QuestionSearchForm(),"form.community-search":apple.QuestionSearchForm(),"select.filter-article":apple.FilterArticleSelect(),"#follow-overlay-trigger a":coherent.Anchor({action:"showFollowOverlay"}),".question a.report-inappropriate-link":coherent.Anchor({contentType:"question",action:"showReportInappropriateOverlay"}),".answer a.report-inappropriate-link":coherent.Anchor({contentType:"answer",action:"showReportInappropriateOverlay"}),".description span.more a":coherent.Anchor({action:"readMore"})},init:function(){this.focusTextFieldsOnPageLoad();this.setupContributionForm();if(window.questionUrl){this.questionUrl.bindAndDelay(this,1500)}if(Element.query(".filter-article")&&Element.query(".filter-article .selected")){Element.query(".filter-article").selectedIndex=Element.query(".filter-article .selected").index}},showFollowOverlay:function(){var a={classname:"bubble community follow-overlay",within:document.getElementById("page"),sourceId:Element.assignId(document.getElementById("question-subscribe")),target:document.getElementById("follow-overlay-trigger")};apple.FollowOverlay.display(a)},focusTextFieldsOnPageLoad:function(){if(this.questionAsked){this.questionAsked.focus()}if(this.answerText){this.answerText.focus()}},setupContributionForm:function(){if(this.contributionForm){Event.observe(this.contributionForm.viewElement(),"submit",this.validateContributionForm.bind(this))}},validateContributionForm:function(a){if(!(this.contributionForm.validateFields())){Event.stop(a)}},questionUrl:function(){this.questionUrlRequest=JSONRPC.get(window.questionUrl)}});apple.A11yAlert=function(){var a=$("aria-alert-wrapper");if(!a){var b=document.createElement("div");b.id="aria-alert-wrapper";return new apple.A11yAlertView(document.body.appendChild(b),{text:""},{textBinding:"*.text"})}else{return coherent.View.fromNode(a)}};apple.A11yAlertView=Class.create(coherent.View,{wrapper:Part(".aria-alert-text-wrapper"),innerHTML:'<div class="a11y aria-alert-container" role="alert"><p class="aria-alert-text-wrapper" aria-live="assertive" aria-relevant="additions"></p></div>',alertPersistence:1000,observeTextChange:function(b){var a=b.newValue;if(!(""+a).length){this.clear();return}if(this._activeTimeout){window.clearTimeout(this._activeTimeout);this.clear()}this.wrapper().appendChild(document.createTextNode(""+a));this._activeTimeout=window.setTimeout(this.say.bind(this,""),this.alertPersistence)},clear:function(){var a=this.wrapper();if(a){Element.setInnerHTML(a,"")}},say:function(a){this.__relativeSource.setValueForKeyPath(a,"text")}});Package("apple.transaction");apple.transaction.TextBox=Class.create(coherent.TextField,{init:function(){this.base();this.setAriaRequired();var a=this.viewElement();a.setAttribute("data-autom",a.id);if(a.hasAttribute("aria-describedby")){a.originalAriaDescribedby=a.getAttribute("aria-describedby")}},validate:function(){var g=this.viewElement();var i=g.value;var d;if(!g.disabled){if(this.formatter){var b=!!window.chrome;if(b&&"truncateExtraBytes" in this.formatter&&typeof(this.formatter.truncateExtraBytes)==="function"){var i=this.formatter.truncateExtraBytes(g)}var j=this.formatter.isStringValid(i);if(j!==true){d=j;this.presentError(d)}var c=i;i=this.formatter.valueForString(i);if(i!=g.value){g.value=i}}if(this.bindings.value){i=this.bindings.value.validateProposedValue(i);if(i instanceof coherent.Error){d=i;this.presentError(i)}if(i!=this.bindings.value.value()){this.bindings.value.setValue(i)}}this.clearErrorsIfNecessary(d)}var g=this.viewElement(),f=this.validationError,e=Element.assignId(g),a=e+"-error",h=Element.query("#"+a);if(f){if(!h){h=document.createElement("span");h.id=a;h.appendChild(document.createTextNode(this.validationError.description));h.className="field-error";g.parentNode.parentNode.insertBefore(h,g.parentNode)}else{if(h.innerHTML!==""&&h.innerHTML!==this.validationError.description){h.innerHTML=this.validationError.description}}g.setAttribute("aria-invalid","true");g.setAttribute("aria-describedby",a)}else{if(Element.hasClassName(g,"ineligiblePincode")){this.validationError=true;g.setAttribute("aria-invalid","true")}else{g.setAttribute("aria-invalid","false");if(g.originalAriaDescribedby){g.setAttribute("aria-describedby",g.originalAriaDescribedby)}else{g.removeAttribute("aria-describedby",a)}if(h){h.parentNode.removeChild(h)}}}return d||i},acceptsFirstResponder:function(){this.initialValue=this.viewElement().value;return this.base()},hasAttributeValue:function(c,a,b){return c.getAttribute(a)&&c.getAttribute(a).match(new RegExp("(\\s|^)"+b+"(\\s|$)"))},addAttributeValue:function(d,a,c){if(!this.hasAttributeValue(d,a,c)){var b=d.getAttribute(a);if(b&&b.length){c=b+" "+c}d.setAttribute(a,c)}},removeAttributeValue:function(d,a,c){var b=new RegExp("(\\s|^)"+c+"(\\s|$)");var e=d.getAttribute(a);if(e&&e.match(b)){d.setAttribute(a,e.replace(b," "));if(!d.getAttribute(a).length){d.removeAttribute(a)}}},observeValueChange:function(d,a,c){var b=this.hasFocus;this.initialValue=d.newValue;this.hasFocus=false;this.base(d,a,c);this.clearAllErrors();this.hasFocus=b},observeEnabledChange:function(d){if(this.resetOnDisable){var c=this.bindings.value;if(d.newValue){if(c&&this.lastEnteredValue){c.object.setValueForKeyPath(this.lastEnteredValue,c.keyPath)}}else{if(c){this.lastEnteredValue=c.value()}this.clearAllErrors();if(this.viewElement()){var b=this.viewElement(),a=Element.query($(b.parentNode),"label");b.value=null;Element.removeClassName(a,"hidden")}}}this.base(d)},resignFirstResponder:function(b){var a=this.viewElement();if(a&&a.nodeName!="INPUT"&&a.nodeName!="TEXTAREA"){return null}if(this.initialValue!=a.value){this.validate()}return this.base(b)},valueChanged:function(b){if(this.updateTimer){window.clearTimeout(this.updateTimer);this.updateTimer=null}if(this.markerValue){return}var a=this.viewElement();if(b&&b.type==="change"){if(a.value){a.value=a.value.replace(/^\s+|\s+$/g,"")}}this.validate()},willPresentError:function(b){var a=this.viewElement();if(Element.hasClassName(a,"error-below")){b.position="below"}},clearErrorsIfNecessary:function(b){if(b&&(b instanceof coherent.Error)){return}var a=this.bindings.errorMessage;if(a&&a.value()){this.bindings.errorMessage.setValue(null)}if(this.validationError){this.clearAllErrors()}},clearAllErrors:function(){var b=this.viewElement(),c=Element.assignId(b),a=c+"-error";this.base();b.setAttribute("aria-invalid","false");this.removeAttributeValue(b,"aria-describedby",a)},setAriaRequired:function(){var a=this.viewElement();if(this.formatter&&this.formatter.required!==null&&this.formatter.required===true){a.setAttribute("aria-required","true")}}});Package("apple.financeCalculator");apple.financeCalculator.LoanValueFormatter=Class.create(coherent.Formatter,{parser:null,field:null,isStringValid:function(f){var c,d,a,g=[],b=this.field&&this.field.viewElement(),e=b.getAttribute("data-separator")||null;d=(b&&parseFloat(b.getAttribute("min")))||0;a=(b&&parseFloat(b.getAttribute("max")))||null;c=(this.parser&&this.parser(f,e))||NaN;if(isNaN(c)){g.push("invalid-number")}else{if(d>c){g.push("below-min")}if(a!==null&&a<c){g.push("above-max")}}if(g.length>0){g.push("invalid");return new coherent.Error({description:g})}return true},isValidInputCharacter:function(a){return true},stringForValue:function(a){return(null===a||"undefined"===typeof(a))?"":String(a)},valueForString:function(a){return a}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorModel=Class.create({dom:{content:{query:"#finance-calculator"},errorOverlay:{query:"#finance-calculator-overlay-error",html:'<div role="dialog" id="finance-calculator-overlay-error" class="finance-calculator-overlay overlay"></div>'},overlay:{query:"#finance-calculator-overlay",html:'<div role="dialog" id="finance-calculator-overlay" class="finance-calculator-overlay overlay" aria-labelledby="finance-calculator-title"></div>'},wrapper:{html:'<div id="finance-calculator-wrapper"></div>',query:"#finance-calculator-wrapper"}},getInitialContent:function(a,b){this.requestContent(a||null,null,b)},getInstallmentsContent:function(a,b,c){this.requestContent(a,{amount:b},c)},getInterstitialContent:function(a,b){this.requestContent(a,null,b)},requestContent:function(a,c,f,e){var b={};c=c||{};b.responseContentType=e||"text/html";function d(g){if(f){f(g||false)}}XHR.get(a,c,b).addMethods(d,d)}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorView=Class.create(coherent.View,{__structure__:{".close-button":coherent.Button({action:"close"}),"#finance-calculator-form":coherent.Form({action:"submit"}),"#finance-calculator-loanvalue":apple.transaction.TextBox({valueBinding:"currentLoanValue",errorMessageBinding:"loanValueErrors",action:"submit",sendsActionOnEndEditing:false,editable:"isValueEditable"}),"#finance-calculator-error-bubble":coherent.View({visibleBinding:"loanValueErrors"}),".results":coherent.View({htmlBinding:"installmentResults"}),"button.calculate":coherent.Button({action:"submit"}),"button.apply-now":coherent.Button({action:"displayCheckoutFinancing"}),"button.apply-now-interstitial":coherent.Button({action:"displayInterstitialContent"})},applyNowButton:Part("button.apply-now"),applyNowInterstitialButton:Part("button.apply-now-interstitial"),calculateButton:Part("button.calculate"),closeButton:Part(".close-button"),errorBubble:Part("#finance-calculator-error-bubble"),errorsContainer:Part("#finance-calculator-errors"),footer:Part(".footer"),header:Part(".header"),installmentsUrlInput:Part("#finance-calculator-installments-url"),loanValueInput:Part("#finance-calculator-loanvalue"),resultsContainer:Part("#finance-calculator-results"),checkoutFinancingTabSelectors:[".checkout #payment-loan-content-tab",".checkout #payment-lease-content-tab",".checkout #payment-installments-content-tab"],defaultHeadingText:null,inputFormatter:new apple.financeCalculator.LoanValueFormatter(),spinnerContent:'<div class="overlay-waiting"></div>',spinnerTimeout:300,init:function(){this.inputFormatter.field=coherent.View.fromNode(this.loanValueInput());this.inputFormatter.parser=apple.financeCalculator.instance.parseLoanValue;this.enableIOSZoomFix()},addStructureProperty:function(b,a){if(a&&"function"==typeof(a)&&(a=a.valueOf()).__factoryFn__){return a.call(this,b,false)}return null},clearResults:function(){var a=this.resultsContainer();Element.setStyle(a,"minHeight",Element.getDimensions(a).height+"px");this.setValueForKey("","installmentResults")},close:function(a){this.disableIOSZoomFix();apple.financeCalculator.instance.close();if(a!==false&&apple.financeCalculator.instance.isCheckoutPage()===true){apple.financeCalculator.instance.trackAction("Close")}},displayCheckoutFinancing:function(){var a=this,b;b=this.checkoutFinancingTabSelectors.some(function(d){var c=Element.query(d);if(c){a.close(false);c.click();Element.scrollDocumentTopBy(Element.getRect(c).top);return true}});if(b){apple.financeCalculator.instance.trackAction("Apply Now")}},displayInterstitialContent:function(b){var c=b.viewElement(),a=(c&&c.getAttribute("data-url"))||null;if(a){apple.financeCalculator.instance.trackAction("Apply Now (Interstitial)");apple.financeCalculator.instance.showInterstitialContent(a)}},enableIOSZoomFix:function(){if(coherent.Browser.MobileSafari===true){var a=this.loanValueInput();this.disableIOSZoomFix();Event.observe(a,"touchend",function(){setTimeout(function(){apple.financeCalculator.instance.iosRenderFix();a.focus()},500)})}},disableIOSZoomFix:function(){if(coherent.Browser.MobileSafari===true){Event.stopObserving(this.loanValueInput(),"touchend")}},fetchInstallmentResults:function(f){var b=this,a=new Date().getTime(),d=apple.financeCalculator.instance.model,c=this.installmentsUrlInput().value||null,e=this.resultsContainer();this.setValueForKey(this.spinnerContent,"installmentResults");d.getInstallmentsContent(c,f,function(i){var g=new Date().getTime()-a,h=Math.max(0,b.spinnerTimeout-g);(function(){var j=apple.financeCalculator.instance.overlay,k={};this.updateHasResultsState();Element.setStyle(e,"opacity",0);b.setValueForKey(i,"installmentResults");coherent.Animator.setStyles(e,{opacity:1});this.addStructureProperty("button.apply-now",coherent.Button({action:"displayCheckoutFinancing"}));this.resize();e.firstChild.focus()}).bindAndDelay(b,h)})},getParsedLoanValue:function(){var b=this.valueForKey("currentLoanValue"),a=this.loanValueInput().getAttribute("data-separator")||null;return apple.financeCalculator.instance.parseLoanValue(b,a)},presentError:function(a){var b=this.loanValueInput();this.updateErrorMessages(a.description);this.setValueForKey(a.description,"loanValueErrors");b.setAttribute("aria-labelledby",this.errorBubble().id);b.removeAttribute("aria-describedby");b.focus()},reset:function(){var a=this.loanValueInput();a.removeAttribute("aria-labelledby");this.setValueForKey(true,"isValueEditable");this.updateHasResultsState();this.resize();if(apple.financeCalculator.instance.isCheckoutPage()===true){this.setValueForKey(false,"isValueEditable")}},resize:function(){apple.financeCalculator.instance.resizeOverlay()},setOptions:function(a){a=a||{};if("loanValue" in a){this.setValueForKey(a.loanValue,"currentLoanValue")}},submit:function(){if(this.valueForKey("isValueEditable")===false){return}this.clearResults();apple.financeCalculator.instance.trackAction("Calculate");if(this.validate()===true){this.fetchInstallmentResults(this.getParsedLoanValue())}return false},updateErrorMessages:function(e){var d,a,c=this.errorsContainer(),b=this.loanValueInput();b.removeAttribute("aria-labelledby");d=Element.queryAll(c,"li");d.forEach(function(f){Element.removeClassName(f,"active")});if(e.length>0){a="li."+e.join(", li.");d=Element.queryAll(c,a);d.forEach(function(f){Element.addClassName(f,"active")})}},validate:function(){var b,a=coherent.View.fromNode(this.loanValueInput());a.formatter=this.inputFormatter;b=!(a.validate() instanceof coherent.Error);a.formatter=null;return b},updateHasResultsState:function(){if(this.loanValueInput().value!==""){Element.addClassName(this.viewElement(),"with-results")}}});Package("apple.financeCalculator");apple.financeCalculator.FinanceCalculatorController=Class.create(coherent.Controller,{contentView:null,isLaunching:null,model:null,overlay:null,errorOverlay:null,opts:null,constructor:function(){this.model=new apple.financeCalculator.FinanceCalculatorModel();this.createDOMContainers()},createDOMContainers:function(){var a=this.model.dom;if(!Element.query(a.wrapper.query)){document.body.appendChild(this.createElementFromHtml(a.wrapper.html))}if(!this.overlay&&!Element.query(a.overlay.query)){document.body.appendChild(this.createElementFromHtml(a.overlay.html));this.overlay=new coherent.Overlay(Element.query(a.overlay.query))}},createElementFromHtml:function(a){var b=document.createElement("div");Element.setInnerHTML(b,a);return b.firstChild},createOverlay:function(a,b){this.model.getInitialContent(a,function(d){var c,e=this.model.dom;if(d===false){this.showErrorOverlay()}else{this.destroyContentView();c=Element.query(this.model.dom.wrapper.query);Element.setInnerHTML(c,d);this.contentView=new apple.financeCalculator.FinanceCalculatorView(Element.query(e.content.query));b()}}.bind(this))},destroyContentView:function(){var a=Element.query(this.model.dom.content.query);if(a){coherent.View.teardownViewsForNodeTree(a)}},getSelectedCheckoutFinancingTab:function(){var a;if(this.isCheckoutPage()){a=Element.queryAll("#payment-form-nav .current");if(a.length===1){return a[0].getAttribute("id")}}return false},iosRotationFix:function(){var b=Element.query("#finance-calculator-title"),a=b.innerHTML;b.innerHTML+="<span/>";b.innerHTML=a},isCheckoutPage:function(){return(Element.hasClassName(document.body,"checkout"))},launch:function(b){var a;this.opts=b;if(this.isLaunching===true){return}this.isLaunching=true;if(this.isCheckoutPage()){a=this.getSelectedCheckoutFinancingTab()}this.opts.trackingPart=a||((this.opts.loanValue!==null)?"above-threshold":"");this.createOverlay(b.contentUrl,function(){this.showOverlay(b);this.isLaunching=false;if(coherent.Browser.MobileSafari===true){Element.setStyles(this.overlay.contentScreen,{position:"fixed",height:"100%","-webkit-box-reflect":"below"})}}.bind(this))},parseLoanValue:function(b,c){var e,a,d=/^([\s,.]?\d)+?$/;if(!b||b.length===0||d.test(b)===false){return NaN}c=c||".";e=b.split("");a=[];e.forEach(function(g,f){if(/\d/.test(g)===true){a.push(g)}else{if(g===c){a.push(".")}}});return parseFloat(a.join(""))},resizeOverlay:function(i){var b=this.overlay,g=this.contentView.viewElement(),f=Element.getDimensions(g),d=f.height,a=f.width,c="px",e={width:a+c,height:d+c,marginLeft:(-a/2)+c,marginTop:(-d/2)+c};Element.setStyles(b.viewElement(),e)},showErrorOverlay:function(){var d,b,a=this,c=this.model.dom;if(!this.errorOverlay){b=this.createElementFromHtml(c.errorOverlay.html);d=Element.query(c.wrapper.query);d.appendChild(b);this.errorOverlay=new coherent.Overlay(b)}this.errorOverlay.display({html:a.errorOverlay.errorInnerHTML})},showOverlay:function(b){var a;if(!this.contentView){return}this.contentView.reset();this.contentView.setOptions(b);this.overlay.display({sourceId:this.contentView.viewElement().getAttribute("id")});a=this.overlay.viewElement();if(a){document.body.appendChild(a)}if(coherent.Browser.MobileSafari===true){Event.observe(window,"orientationchange",this.iosRotationFix.bind(this))}this.trackAction("Launch")},showInterstitialContent:function(a){this.model.getInterstitialContent(a,function(b){if(b===false){this.showErrorOverlay()}else{this.destroyContentView();this.overlay.display({html:b})}}.bind(this))},trackAction:function(d,a){var b=apple.metrics||null,c={eVar:"eVar21",slot:"",feature:"Finance Calculator",action:d||null};c.part=a||this.opts.trackingPart||"";if(!b||!c.action){return}b.fireMicroEvent(c)},close:function(){if(this.overlay){this.overlay.hide()}if(coherent.Browser.MobileSafari===true){Event.stopObserving(window,"orientationchange",this.iosRotationFix.bind(this))}}});Package("apple.financeCalculator");apple.financeCalculator.bootstrap=function(){var c="a.finance-calculator-link";function a(d){var e={};d=d||"";d.split("&").map(function(f){if(f.indexOf("=")<0){return}f=f.split("=").map(decodeURIComponent);e[f[0]]=f[1]});return e}function b(g,d){var h,e,f={};if(!g.nodeName||g.nodeName.toLowerCase()!=="a"){return}Event.stop(d);h=g.getAttribute("href");if(h){e=new coherent.URL(h);e.query=a(e.query);f={contentUrl:e.url,loanValue:e.query.amount.replace("+"," ")||null,page:e.query.page||null}}if(!apple.financeCalculator.instance){apple.financeCalculator.instance=new apple.financeCalculator.FinanceCalculatorController()}apple.financeCalculator.instance.launch(f)}Event.observe(document.body,"click",function(d){var e=d.target||d.srcElement;while(e!==document.body&&e.nodeName.toLowerCase()!=="a"&&e.parentNode){e=e.parentNode}if(Element.match(e,c)){b(e,d)}})};if(Event.onDomReady){Event.onDomReady(apple.financeCalculator.bootstrap)}else{Event.onLoad(apple.financeCalculator.bootstrap)}window.apple.mvt={};window.as=window.as||{};window.as.mvt=window.apple.mvt;apple.mvt.activate=function(){if(window.optimizely&&window.optimizely.push&&window.optimizely.activateSiteCatalyst){var b=apple.metrics.clone(),a;window.optimizely.push(["activate"]);apple.mvt.siteCatalystIntegrate();a=apple.metrics.getNewKeyObject(b);if(!window.optimizely.$.isEmptyObject(a)){a.linkTrackVars=window.optimizely.$.map(a,function(d,c){return c}).join(",");a.linkTrackEvents="None";apple.Tracking.track(null,"MVT Activation",a,null)}}};apple.mvt.siteCatalystIntegrate=function(){var c=window.optimizely.activeExperiments,d=c?c.length:0;for(var b=0;b<d;b++){var e=c[b],a=window.optimizely.allExperiments[e];if(a.site_catalyst_evar){s["eVar"+a.site_catalyst_evar]=a.name+":"+window.optimizely.variationNamesMap[e]}}};Package("apple.behavior");apple.behavior.Overlay=(function(){if(!(coherent&&coherent.Overlay)){return null}coherent.Overlay.prototype.requestCompleteCallback=function(){if(apple&&apple.mvt&&apple.mvt.activate){apple.mvt.activate()}}})();apple.retargeting={sourceSelector:"#retargeting-pixel",targetClass:"retargeting-pixel",activate:function(a){var c,d,b;b=Element.query(a||this.sourceSelector);if(b&&b.nodeName.toLowerCase()==="noscript"&&(c=b.textContent.trim())){d=document.createElement("div");d.className=this.targetClass;d.style.display="none";c=c.trim().replace("&lt;","<").replace("&gt;",">");Element.setInnerHTML(d,c);document.body.appendChild(d)}}};Event.observe(window,"load",function(){apple.retargeting.activate()});Package("apple");apple.PagelevelFeedbackViewController=Class.create(coherent.ViewController,{loadingClassName:"plf-loading",closingClassName:"plf-closing",showingMessageClassName:"plf-showing-message",showingDataClassName:"plf-showing-data",questionWidgets:[],isDataLoaded:false,AJAXResponse:"",isKeyboardUser:false,opinionOverlay:null,overlayClassName:"overlay feedback-overlay-liquid",overlayView:null,data:null,loadingMessage:"Loading",sourceID:null,displaySettings:null,init:function(){var a=this.viewElement(),b=Element.query(a,".plf-drawer");this.plfOpenBtn=Element.query(a,".plf-open-btn");Element.assignId(b);this.sourceID=Element.query(this.viewElement(),".plf-drawer").id;Event.observe(this.plfOpenBtn,"click",this.openButtonClickHandler.bindAsEventListener(this));Event.observe(window,"orientationchange",this.adjustOverlayPosition.bindAsEventListener(this))},openButtonClickHandler:function(a){Event.stop(a);this.fireMetricsEvent({action:"Open"});this.openOpinionOverlay()},adjustOverlayPosition:function(){if(this.opinionOverlay&&this.opinionOverlay.visible){this.opinionOverlay.__show(this.displaySettings)}},openOpinionOverlay:function(){var a=this;if(!this.opinionOverlay){var b=document.createElement("div");b.className=this.overlayClassName;document.body.appendChild(b);this.opinionOverlay=new coherent.Overlay(b)}this.opinionOverlay.beforeShow=function(e,c){if(!a.data){Element.addClassName(document.querySelectorAll(".overlayScreen")[0],"feedbackOverlayScreen");a.overlayView=document.querySelectorAll(".feedback-overlay-liquid")[0];a.plfMsg=Element.query(a.overlayView,".plf-msg");a.plfForm=Element.query(a.overlayView,".plf-form");a.plfIntro=Element.query(a.overlayView,".plf-intro");a.plfDrawer=Element.query(a.overlayView,".plf-drawer");a.plfCancelBtn=Element.query(a.overlayView,".button.cancel");a.plfSubmitBtn=Element.query(a.overlayView,".button[type=submit]");a.feedbackContentScreen=Element.query(document.body,".feedbackOverlayScreen");a.plfDrawer.setAttribute("tabindex",-1);Element.removeClassName(a.plfDrawer,a.showingMessageClassName);Element.removeClassName(a.plfDrawer,a.showingDataClassName);Element.addClassName(a.plfDrawer,a.loadingClassName);Event.observe(a.feedbackContentScreen,"click",a.closeOverlay.bindAsEventListener(a));Event.observe(document,"keydown",function(f){if((f.keyCode||f.which)===Event.KEY_ESC){a.closeOverlay();Event.stop(f)}});var d=JSONRPC.get(a.serviceURL);d.addMethods(a.receiveData.bind(a),a.showErrorMessage.bind(a))}a.opinionOverlay.setDisplayDimensions=function(g,f){f.dimensions=g;a.displaySettings=f}};if(!a.overlayView){a.displayOverlay()}else{a.displayOverlay();Element.removeClassName(a.plfDrawer,a.loadingClassName);Element.removeClassName(a.plfDrawer,a.showingMessageClassName);Element.addClassName(a.plfDrawer,a.showingDataClassName)}},displayOverlay:function(){this.opinionOverlay.display({displayCloseWidget:true,sourceId:this.sourceID,dialog:true,ariaDialog:true})},receiveData:function(b){var a=b&&b.feedback&&b.feedback.questions||[];this.data=b;if(a.length===0){this.showErrorMessage();return}this.createFeedbackQuestions(a)},showErrorMessage:function(){Element.setInnerHTML(this.plfMsg,this.errorMessage);Element.removeClassName(this.plfDrawer,this.loadingClassName);Element.addClassName(this.plfDrawer,this.showingMessageClassName)},createFeedbackQuestions:function(b){var b=b||[],a=Element.query(this.overlayView,".plf-rating-questions");plfFreetextQuestionsContainer=Element.query(this.overlayView,".plf-freetext-questions");plfFreetextQuestionsTemplate='                   <div class="plf-freetext-question" id="ftq-${0}">                       <label id="ftq-${0}-label" class="a11ylabel" for="ftq-${0}-textarea">${1}<span class="a11y">${2}</span></label>                       <textarea id="ftq-${0}-textarea" cols="30" rows="6" ></textarea>                       <span id="ftq-${0}-count" class="count"></span>                       <p id="ftq-${0}-count-msg" class="a11y"></p>                   </div>',plfRatingQuestionsTemplate='                   <fieldset class="plf-rating-question" id="rq-${0}">                       <legend class="question" id="rq-${0}-legend">${1}</legend>                       <span class="star-wrapper">                           <label id="rq-${0}-1-label" for="rq-${0}-1"><span class="a11y"><input id="rq-${0}-1" aria-labelledby="rq-${0}-legend" type="radio" value="1" name="rq-${0}-group">${2}</span></label>                           <label id="rq-${0}-2-label" for="rq-${0}-2"><span class="a11y"><input id="rq-${0}-2" aria-labelledby="rq-${0}-legend" type="radio" value="2" name="rq-${0}-group">${3}</span></label>                           <label id="rq-${0}-3-label" for="rq-${0}-3"><span class="a11y"><input id="rq-${0}-3" aria-labelledby="rq-${0}-legend" type="radio" value="3" name="rq-${0}-group">${4}</span></label>                           <label id="rq-${0}-4-label" for="rq-${0}-4"><span class="a11y"><input id="rq-${0}-4" aria-labelledby="rq-${0}-legend" type="radio" value="4" name="rq-${0}-group">${5}</span></label>                           <label id="rq-${0}-5-label" for="rq-${0}-5"><span class="a11y"><input id="rq-${0}-5" aria-labelledby="rq-${0}-legend" type="radio" value="5" name="rq-${0}-group">${6}</span></label>                       </span>                   </fieldset>';b.forEach(function(d){var c=d,e;if(c.type=="STAR_RATING"){e=new apple.RatingQuestionWidget("rq-"+c.id,c);a.innerHTML+=plfRatingQuestionsTemplate.expand({"0":c.id,"1":c.description,"2":this.ratingsLabelTemplate.replace("{0}",1).replace("{1}",5),"3":this.ratingsLabelTemplate.replace("{0}",2).replace("{1}",5),"4":this.ratingsLabelTemplate.replace("{0}",3).replace("{1}",5),"5":this.ratingsLabelTemplate.replace("{0}",4).replace("{1}",5),"6":this.ratingsLabelTemplate.replace("{0}",5).replace("{1}",5)},"")}else{if(c.type=="OPEN_ENDED"){c.lowCharsMessage=this.lowCharsMessage;c.noCharsMessage=this.noCharsMessage;e=new apple.FreeTextQuestionWidget("ftq-"+c.id,c);plfFreetextQuestionsContainer.innerHTML+=plfFreetextQuestionsTemplate.expand({"0":c.id,"1":c.description,"2":this.maxCharsAllyLabel.replace("{0}",c.maxCharLimit),"3":c.maxCharLimit},"")}}this.questionWidgets.push(e)}.bind(this));Element.removeClassName(this.plfDrawer,this.loadingClassName);Element.addClassName(this.plfDrawer,this.showingDataClassName);Event.observe(this.plfCancelBtn,"click",this.closeOverlay.bindAsEventListener(this));Event.observe(Element.query(this.overlayView,".close"),"click",this.closeOverlay.bindAsEventListener(this));Event.observe(this.plfSubmitBtn,"click",this.handleSubmit.bindAsEventListener(this));this.setTextAreaHeight(a,plfFreetextQuestionsContainer)},setTextAreaHeight:function(e,c){var a=e.offsetHeight,d=Element.query(c,"textarea"),b,f;if(coherent.Browser.IE===8){b=25}else{b=parseInt(window.getComputedStyle(d).getPropertyValue("padding-top"),10)}f=a-b-b-4;d.style.height=f+"px"},handleSubmit:function(c){Event.stop(c);this.fireMetricsEvent({action:"Submit"});var b={pageName:s.pageName,uniqueUserId:apple.cookie("s_vi"),answers:[]},a=this.data.feedback,e=a.params;for(var d in e){b[d]=e[d]}a.questions.forEach(function(f){if(f.value!=null){b.answers.push({id:f.id,type:f.type,value:f.value})}});if(b.answers.length>0){JSONRPC.post(a.serviceURL,"",{body:apple.data.json.stringify(b)})}Element.setInnerHTML(this.plfMsg,this.confirmationMessage);Element.removeClassName(this.plfDrawer,this.showingDataClassName);Element.addClassName(this.plfDrawer,this.showingMessageClassName)},closeOverlay:function(){this.fireMetricsEvent({action:"Cancel"});this.plfForm.reset();this.questionWidgets.forEach(function(a){a.reset()});this.opinionOverlay.hide(false)},fireMetricsEvent:function(a){var b=Object.applyDefaults(a,{eVar:"eVar6",slot:"",feature:"Feedback",part:(this.partNumber||""),action:"Selected"});apple.metrics.fireMicroEventNoDuplicates(b)}});apple.RatingQuestionWidget=Class.create(coherent.View,{__viewClassName__:"plf-rating-question",tempStarClassName:"tempStar",starClassName:"star",labelFocusClassName:"focused",labelIDSuffix:"-label",labels:PartList("label"),radioInputs:PartList("input"),__structure__:{"input[type=radio]":coherent.ToggleButton({selectionBinding:"*.value"})},init:function(){var a=Element.query(this.viewElement(),".star-wrapper");Event.observe(a,"mouseout",this.onmouseoutHandler.bindAsEventListener(this));this.labels().forEach(function(b){Event.observe(b,"mouseover",this.onmouseoverHandler.bindAsEventListener(this))}.bind(this));this.radioInputs().forEach(function(b){Event.observe(b,"focus",this.onfocusHandler.bindAsEventListener(this));Event.observe(b,"blur",this.onblurHandler.bindAsEventListener(this));Event.observe(b,"click",this.onclickHandler.bindAsEventListener(this))}.bind(this))},onfocusHandler:function(a){var b=a.target||a.srcElement;Element.addClassName($(b.id+this.labelIDSuffix),this.labelFocusClassName)},onblurHandler:function(a){var b=a.target||a.srcElement;Element.removeClassName($(b.id+this.labelIDSuffix),this.labelFocusClassName)},onclickHandler:function(a){var b=a.target||a.srcElement;this.clearStars(this.tempStarClassName);this.addClassNameToPreviousSiblings($(b.id+this.labelIDSuffix),this.starClassName)},onmouseoverHandler:function(a){var b=a.target||a.srcElement;this.addClassNameToPreviousSiblings(b,this.tempStarClassName)},onmouseoutHandler:function(a){this.clearStars(this.tempStarClassName)},addClassNameToPreviousSiblings:function(c,b){var d=this.labels();index=d.length,found=false;while(index--){var a=d[index];if(a.id===c.id){found=true}if(found){Element.addClassName(a,b)}else{Element.removeClassName(a,b)}}},clearStars:function(a){this.labels().forEach(function(b){Element.removeClassName(b,a)}.bind(this))},reset:function(){this.clearStars(this.starClassName);this.clearStars(this.tempStarClassName);this.__relativeSource.setValueForKey(null,"value")}});apple.FreeTextQuestionWidget=Class.create(coherent.View,{__viewClassName__:"plf-freetext-question",labelFocusClassName:"focus",labelHiddenClassName:"hidden",errorClassName:"err",__structure__:{textarea:coherent.TextField({valueBinding:"*.value"})},init:function(){var a=this.__relativeSource;this.maxCharLimit=a.maxCharLimit||2000;this.warnCharLimit=a.warnCharLimit||500;this.lowCharsWarnAt=a.warnThreshold||100;this.lowCharsMessage=a.lowCharsMessage;this.noCharsMessage=a.noCharsMessage;this.textarea=$(this.id+"-textarea");this.associatedLabel=$(this.id+"-label");this.plfCountTarget=$(this.id+"-count");this.plfCountMsgElement=$(this.id+"-count-msg");Event.observe(this.textarea,"focus",this.onfocusHandler.bindAsEventListener(this));Event.observe(this.textarea,"blur",this.onblurHandler.bindAsEventListener(this));Event.observe(this.textarea,"keyup",this.onkeyupHandler.bindAsEventListener(this));Event.observe(this.textarea,"keypress",this.onkeypressHandler.bindAsEventListener(this));Event.observe(this.textarea,"paste",this.onpasteHandler.bindAsEventListener(this))},onfocusHandler:function(a){var b=a.target||a.srcElement;Element.addClassName(this.associatedLabel,this.labelFocusClassName)},onblurHandler:function(a){var b=a.target||a.srcElement;if(b.value.length===0){Element.removeClassName(this.associatedLabel,this.labelFocusClassName);Element.removeClassName(this.associatedLabel,this.labelHiddenClassName)}},onpasteHandler:function(a){var c=a.target||a.srcElement,b="";Event.stop(a);if(a.clipboardData){b=a.clipboardData.getData("text/plain")}if(window.clipboardData){b=window.clipboardData.getData("Text")}c.value+=b.substring(0,this.maxCharLimit-c.value.length);return false},onkeypressHandler:function(a){var c=a.target||a.srcElement,b=c.value;if(b.length>=this.maxCharLimit){c.value=b.slice(0,this.maxCharLimit);Event.stop(a);return false}},onkeyupHandler:function(a){var c=a.target||a.srcElement,b=(this.maxCharLimit-c.value.length);if((c.value.length!=0)&&(!Element.hasClassName(this.associatedLabel,this.labelHiddenClassName))){Element.addClassName(this.associatedLabel,this.labelHiddenClassName)}if(b==this.warnCharLimit||b==this.lowCharsWarnAt||b==0){Element.setInnerHTML(this.plfCountMsgElement,this.lowCharsMessage.replace("{0}",b))}else{Element.setInnerHTML(this.plfCountMsgElement,"")}if(b<=this.warnCharLimit){Element.setInnerHTML(this.plfCountTarget,b);if(b<=this.lowCharsWarnAt){Element.addClassName(this.plfCountTarget,this.errorClassName)}else{Element.removeClassName(this.plfCountTarget,this.errorClassName)}}else{Element.removeClassName(this.plfCountTarget,this.errorClassName);Element.setInnerHTML(this.plfCountTarget,"")}},reset:function(){Element.removeClassName(this.associatedLabel,this.labelFocusClassName);Element.removeClassName(this.associatedLabel,this.labelHiddenClassName);Element.innerHTML(this.plfCountTarget,"");Element.innerHTML(this.plfCountMsgElement,"");this.__relativeSource.setValueForKey(null,"value")}});