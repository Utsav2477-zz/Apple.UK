!function(){function e(t,r,n){function i(s,a){if(!r[s]){if(!t[s]){var u="function"==typeof require&&require;if(!a&&u)return u(s,!0);if(o)return o(s,!0);var c=new Error("Cannot find module '"+s+"'");throw c.code="MODULE_NOT_FOUND",c}var l=r[s]={exports:{}};t[s][0].call(l.exports,function(e){var r=t[s][1][e];return i(r?r:e)},l,l.exports,e,t,r,n)}return r[s].exports}for(var o="function"==typeof require&&require,s=0;s<n.length;s++)i(n[s]);return i}return e}()({1:[function(e,t,r){"use strict";function n(){this._createElemnts(),this._bindEvents()}var i=n.prototype;i._bindEvents=function(){this._onResize=this._resize.bind(this)},i._createElemnts=function(){this.span=document.createElement("span");var e=this.span.style;e.visibility="hidden",e.position="absolute",e.top="0",e.bottom="0",e.zIndex="-1",this.span.innerHTML="&nbsp;",this.iframe=document.createElement("iframe");var t=this.iframe.style;t.position="absolute",t.top="0",t.left="0",t.width="100%",t.height="100%",this.span.appendChild(this.iframe),document.body.appendChild(this.span)},i.detect=function(e){this.originalSize=e||17,this.currentSize=parseFloat(window.getComputedStyle(this.span)["font-size"]),this.currentSize>this.originalSize&&this._onResize(),this.isDetecting||(this.iframe.contentWindow.addEventListener("resize",this._onResize),this.isDetecting=!0)},i._resize=function(e){this.currentSize=parseFloat(window.getComputedStyle(this.span)["font-size"]),this.originalSize<this.currentSize?document.documentElement.classList.add("text-zoom"):document.documentElement.classList.remove("text-zoom"),window.dispatchEvent(new Event("resize"))},i.remove=function(){this.isDetecting&&(this.iframe.contentWindow.removeEventListener("resize",this._onResize),this.isDetecting=!1)},i.destroy=function(){this.remove(),this.span&&this.span.parentElement&&this.span.parentElement.removeChild(this.span),this.span=null,this.iframe=null},t.exports=new n},{}],2:[function(e,t,r){"use strict";t.exports={assert:e("./assert"),count:e("./count"),countReset:e("./countReset"),dir:e("./dir"),dirxml:e("./dirxml"),enabled:e("./enabled"),error:e("./error"),group:e("./group"),groupCollapsed:e("./groupCollapsed"),groupEnd:e("./groupEnd"),info:e("./info"),log:e("./log"),profile:e("./profile"),profileEnd:e("./profileEnd"),table:e("./table"),time:e("./time"),timeEnd:e("./timeEnd"),trace:e("./trace"),warn:e("./warn")}},{"./assert":3,"./count":4,"./countReset":5,"./dir":6,"./dirxml":7,"./enabled":8,"./error":9,"./group":10,"./groupCollapsed":11,"./groupEnd":12,"./info":13,"./log":15,"./profile":16,"./profileEnd":17,"./table":18,"./time":19,"./timeEnd":20,"./trace":21,"./warn":22}],3:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("assert")},{"./internal/expose":14}],4:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("count")},{"./internal/expose":14}],5:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("countReset")},{"./internal/expose":14}],6:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("dir")},{"./internal/expose":14}],7:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("dirxml")},{"./internal/expose":14}],8:[function(e,t,r){"use strict";var n="f7c9180f-5c45-47b4-8de4-428015f096c0",i=!1,o=window||self;try{i=!!o.localStorage.getItem(n)}catch(s){}t.exports=i},{}],9:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("error")},{"./internal/expose":14}],10:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("group")},{"./internal/expose":14}],11:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("groupCollapsed")},{"./internal/expose":14}],12:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("groupEnd")},{"./internal/expose":14}],13:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("info")},{"./internal/expose":14}],14:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("../enabled");t.exports=function(e){return function(){if(i&&"object"===n(window.console)&&"function"==typeof console[e])return console[e].apply(console,Array.prototype.slice.call(arguments,0))}}},{"../enabled":8}],15:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("log")},{"./internal/expose":14}],16:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("profile")},{"./internal/expose":14}],17:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("profileEnd")},{"./internal/expose":14}],18:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("table")},{"./internal/expose":14}],19:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("time")},{"./internal/expose":14}],20:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("timeEnd")},{"./internal/expose":14}],21:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("trace")},{"./internal/expose":14}],22:[function(e,t,r){"use strict";t.exports=e("./internal/expose")("warn")},{"./internal/expose":14}],23:[function(e,t,r){"use strict";t.exports={EventEmitterMicro:e("./ac-event-emitter-micro/EventEmitterMicro")}},{"./ac-event-emitter-micro/EventEmitterMicro":24}],24:[function(e,t,r){"use strict";function n(){this._events={}}var i=n.prototype;i.on=function(e,t){this._events[e]=this._events[e]||[],this._events[e].unshift(t)},i.once=function(e,t){function r(i){n.off(e,r),void 0!==i?t(i):t()}var n=this;this.on(e,r)},i.off=function(e,t){if(this.has(e)){if(1===arguments.length)return this._events[e]=null,void delete this._events[e];var r=this._events[e].indexOf(t);r!==-1&&this._events[e].splice(r,1)}},i.trigger=function(e,t){if(this.has(e))for(var r=this._events[e].length-1;r>=0;r--)void 0!==t?this._events[e][r](t):this._events[e][r]()},i.has=function(e){return e in this._events!=!1&&0!==this._events[e].length},i.destroy=function(){for(var e in this._events)this._events[e]=null;this._events=null},t.exports=n},{}],25:[function(e,t,r){"use strict";var n={};t.exports=function(e,t,r){if(e=e.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),r||!n.hasOwnProperty(e)){var i=new RegExp("[\\?&]"+e+"=([^&#]*)"),o=i.exec(location.search),s=null===o?t:decodeURIComponent(o[1].replace(/\+/g," "));"true"!==s&&"false"!==s||(s="true"===s),isNaN(parseFloat(s))||(s=parseFloat(s)),n[e]=s}return n[e]}},{}],26:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("./extend");t.exports=function(e,t){if("object"!==("undefined"==typeof e?"undefined":n(e)))throw new TypeError("defaults: must provide a defaults object");if(t=t||{},"object"!==("undefined"==typeof t?"undefined":n(t)))throw new TypeError("defaults: options must be a typeof object");return i({},e,t)}},{"./extend":27}],27:[function(e,t,r){"use strict";e("@marcom/ac-polyfills/Array/prototype.forEach");var n=Object.prototype.hasOwnProperty;t.exports=function(){var e,t;return e=arguments.length<2?[{},arguments[0]]:[].slice.call(arguments),t=e.shift(),e.forEach(function(e){if(null!=e)for(var r in e)n.call(e,r)&&(t[r]=e[r])}),t}},{"@marcom/ac-polyfills/Array/prototype.forEach":void 0}],28:[function(e,t,r){"use strict";function n(e){e=e||{},o.call(this),this.id=a.getNewID(),this.executor=e.executor||s,this._reset(),this._willRun=!1,this._didDestroy=!1}var i,o=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,s=e("@marcom/ac-raf-executor/sharedRAFExecutorInstance"),a=e("@marcom/ac-raf-emitter-id-generator/sharedRAFEmitterIDGeneratorInstance");i=n.prototype=Object.create(o.prototype),i.run=function(){return this._willRun||(this._willRun=!0),this._subscribe()},i.cancel=function(){this._unsubscribe(),this._willRun&&(this._willRun=!1),this._reset()},i.destroy=function(){var e=this.willRun();return this.cancel(),this.executor=null,o.prototype.destroy.call(this),this._didDestroy=!0,e},i.willRun=function(){return this._willRun},i.isRunning=function(){return this._isRunning},i._subscribe=function(){return this.executor.subscribe(this)},i._unsubscribe=function(){return this.executor.unsubscribe(this)},i._onAnimationFrameStart=function(e){this._isRunning=!0,this._willRun=!1,this._didEmitFrameData||(this._didEmitFrameData=!0,this.trigger("start",e))},i._onAnimationFrameEnd=function(e){this._willRun||(this.trigger("stop",e),this._reset())},i._reset=function(){this._didEmitFrameData=!1,this._isRunning=!1},t.exports=n},{"@marcom/ac-event-emitter-micro":23,"@marcom/ac-raf-emitter-id-generator/sharedRAFEmitterIDGeneratorInstance":39,"@marcom/ac-raf-executor/sharedRAFExecutorInstance":53}],29:[function(e,t,r){"use strict";var n=e("./SingleCallRAFEmitter"),i=function(e){this.rafEmitter=new n,this.rafEmitter.on(e,this._onRAFExecuted.bind(this)),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.cancelAnimationFrame=this.cancelAnimationFrame.bind(this),this._frameCallbacks=[],this._nextFrameCallbacks=[],this._currentFrameID=-1,this._cancelFrameIdx=-1,this._frameCallbackLength=0,this._nextFrameCallbacksLength=0,this._frameCallbackIteration=0},o=i.prototype;o.requestAnimationFrame=function(e){return this._currentFrameID=this.rafEmitter.run(),this._nextFrameCallbacks.push(this._currentFrameID,e),this._nextFrameCallbacksLength+=2,this._currentFrameID},o.cancelAnimationFrame=function(e){this._cancelFrameIdx=this._nextFrameCallbacks.indexOf(e),this._cancelFrameIdx!==-1&&(this._nextFrameCallbacks.splice(this._cancelFrameIdx,2),this._nextFrameCallbacksLength-=2,0===this._nextFrameCallbacksLength&&this.rafEmitter.cancel())},o._onRAFExecuted=function(e){for(this._frameCallbacks=this._nextFrameCallbacks,this._frameCallbackLength=this._nextFrameCallbacksLength,this._nextFrameCallbacks=[],this._nextFrameCallbacksLength=0,this._frameCallbackIteration=0;this._frameCallbackIteration<this._frameCallbackLength;this._frameCallbackIteration+=2)this._frameCallbacks[this._frameCallbackIteration+1](e.time,e)},t.exports=i},{"./SingleCallRAFEmitter":31}],30:[function(e,t,r){"use strict";var n=e("./RAFInterface"),i=function(){this.events={}},o=i.prototype;o.requestAnimationFrame=function(e){return this.events[e]||(this.events[e]=new n(e)),this.events[e].requestAnimationFrame},o.cancelAnimationFrame=function(e){return this.events[e]||(this.events[e]=new n(e)),this.events[e].cancelAnimationFrame},t.exports=new i},{"./RAFInterface":29}],31:[function(e,t,r){"use strict";var n=e("./RAFEmitter"),i=function(e){n.call(this,e)},o=i.prototype=Object.create(n.prototype);o._subscribe=function(){return this.executor.subscribe(this,!0)},t.exports=i},{"./RAFEmitter":28}],32:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.requestAnimationFrame("draw")},{"./RAFInterfaceController":30}],33:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.requestAnimationFrame("update")},{"./RAFInterfaceController":30}],34:[function(e,t,r){"use strict";function n(e){s.call(this),this.options=i(c,e),this.loadingOptions=null,this.els=[],this.loadingQueue=null,this._queueItems=[],this._queueItemsObj={},this._loadOrder=[],this._timeout=null,this._didCallLoad=!1}var i=e("@marcom/ac-object/defaults"),o=e("@marcom/ac-queue").LiveQueue,s=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,a=e("@marcom/ac-raf-emitter/update"),u=e("@marcom/ac-raf-emitter/draw"),c={container:document.body,includeContainer:!1},l={loadingPoolSize:8,timeout:null,imageDataAttribute:"data-progressive-image",imageAnimate:!0,imageAnimateClass:"progressive-image-animated"};n.Events={ImageLoad:"image-load",Complete:"complete"};var h=n.prototype=Object.create(s.prototype);h.load=function(e){this._didCallLoad||(this._didCallLoad=!0,this.loadingOptions=i(l,e),this.loadingQueue=new o(this.loadingOptions.loadingPoolSize),this.els=Array.from(this._getProgressiveImageElements()),this.options.includeContainer&&this.options.container.hasAttribute(this._getProgressiveImageDataAttribute())&&this.els.unshift(this.options.container),u(function(){var e,t,r=this.els.length;for(e=0;e<r;e++)t={queueItem:this.loadingQueue.enqueue(this._loadNextItem.bind(this,e),e),el:this.els[e],id:e},this._queueItems.push(t),this._queueItemsObj[e]=t,this.loadingOptions.imageAnimate&&this.els[e].classList.add(this.loadingOptions.imageAnimateClass);a(function(){this.loadingQueue.start(),"number"==typeof this.loadingOptions.timeout&&(this._timeout=setTimeout(this.cancel.bind(this),this.loadingOptions.timeout))}.bind(this))}.bind(this)))},h.setVisible=function(e){return new Promise(function(t,r){u(function(){e.removeAttribute(this._getProgressiveImageDataAttribute()),t(),e=null}.bind(this))}.bind(this))},h.cancel=function(){if(this.els){var e,t=this.els.length;for(e=0;e<t;e++)this.setVisible(this.els[e]),this.loadingOptions.imageAnimate&&u(function(){this.els[e].setAttribute("data-progressive-image-loaded","")}.bind(this,e))}this._handleLoadingComplete()},h.destroy=function(){this.cancel(),this.off(),s.prototype.destroy.call(this)},h._loadNextItem=function(e){return new Promise(function(e,t,r){var n=this._queueItemsObj[e];this._loadAndSetVisible(n.el).then(function(){var e=this._queueItems.indexOf(n);this._queueItems.splice(e,1),this._queueItemsObj[n.id]=null,t(),this._handleImageLoad(n.el),n=t=null,1===this.loadingQueue.count()&&this._handleLoadingComplete()}.bind(this))}.bind(this,e))},h._loadAndSetVisible=function(e){return new Promise(function(t,r){this.setVisible(e).then(function(){this._getBackgroundImageSrc(e).then(function(r){this._loadImage(r).then(t),e=null}.bind(this))}.bind(this))}.bind(this))},h._getBackgroundImageSrc=function(e){return new Promise(function(t,r){a(function(){var r=e.currentStyle;return r||(r=window.getComputedStyle(e,!1)),e=null,0===r.backgroundImage.indexOf("url(")?void t(r.backgroundImage.slice(4,-1).replace(/"/g,"")):void t(null)}.bind(this))}.bind(this))},h._getProgressiveImageDataAttribute=function(){return this.loadingOptions.imageDataAttribute},h._getProgressiveImageCSSQuery=function(){return"["+this._getProgressiveImageDataAttribute()+"]"},h._getProgressiveImageElements=function(){return this.options.container.querySelectorAll(this._getProgressiveImageCSSQuery())||[]},h._loadImage=function(e){return new Promise(this._loadImagePromiseFunc.bind(this,e))},h._loadImagePromiseFunc=function(e,t,r){function n(){this.removeEventListener("load",n),t(this),t=null}if(!e)return void t(null);var i=new Image;i.addEventListener("load",n),i.src=e},h._clearTimeout=function(){this._timeout&&(window.clearTimeout(this._timeout),this._timeout=null)},h._handleImageLoad=function(e){u(function(){this.trigger(n.Events.ImageLoad,e),this.loadingOptions.imageAnimate&&e.setAttribute("data-progressive-image-loaded",""),e=null}.bind(this))},h._handleLoadingComplete=function(){this.loadingQueue.stop(),this._clearTimeout(),this.trigger(n.Events.Complete)},t.exports=n},{"@marcom/ac-event-emitter-micro":23,"@marcom/ac-object/defaults":26,"@marcom/ac-queue":35,"@marcom/ac-raf-emitter/draw":32,"@marcom/ac-raf-emitter/update":33}],35:[function(e,t,r){"use strict";t.exports={Queue:e("./ac-queue/Queue"),QueueItem:e("./ac-queue/QueueItem"),LiveQueue:e("./ac-queue/LiveQueue")}},{"./ac-queue/LiveQueue":36,"./ac-queue/Queue":37,"./ac-queue/QueueItem":38}],36:[function(e,t,r){"use strict";function n(e){this._queue=new i,this._maxProcesses=e||1,this._availableSlots=this._maxProcesses,this._rafId=0,this._isRunning=!1,this._boundFunctions={_run:this._run.bind(this),_releaseSlot:this._releaseSlot.bind(this)}}e("@marcom/ac-polyfills/Promise"),e("@marcom/ac-polyfills/requestAnimationFrame"),e("@marcom/ac-polyfills/Function/prototype.bind");var i=e("./Queue"),o=e("./QueueItem"),s=n.prototype;s.start=function(){this._isRunning&&cancelAnimationFrame(this._rafId),this._rafId=requestAnimationFrame(this._boundFunctions._run),this._isRunning=!0},s.pause=function(){this._isRunning&&(cancelAnimationFrame(this._rafId),this._rafId=0),this._isRunning=!1},s.stop=function(){this.pause(),this.clear()},s.enqueue=function(e,t){if("function"!=typeof e)throw new Error("LiveQueue can only enqueue functions");void 0===t&&(t=i.PRIORITY_DEFAULT);var r=new o(e,t);return this.enqueueQueueItem(r)},s.enqueueQueueItem=function(e){return this._queue.enqueueQueueItem(e),this._isRunning&&0===this._rafId&&this.start(),e},s.dequeueQueueItem=function(e){return this._queue.dequeueQueueItem(e)},s.clear=function(){this._queue=new i},s.destroy=function(){this.pause(),this._isRunning=!1,this._queue=null,this._boundFunctions=null},s.count=function(){return this._queue.count()+this.pending()},s.pending=function(){return this._maxProcesses-this._availableSlots},s.isEmpty=function(){return 0===this.count()},s._run=function(){if(this._isRunning&&(this._rafId=requestAnimationFrame(this._boundFunctions._run),!this._queue.isEmpty()&&0!==this._availableSlots)){var e=this._queue.dequeue(),t=e.data();this._isPromise(t)&&(this._retainSlot(),t.then(this._boundFunctions._releaseSlot,this._boundFunctions._releaseSlot)),this._stopRunningIfDone()}},s._retainSlot=function(){this._availableSlots--},s._releaseSlot=function(){this._availableSlots++,this._stopRunningIfDone()},s._stopRunningIfDone=function(){0!=this._rafId&&0===this._queue.count()&&this._availableSlots==this._maxProcesses&&(cancelAnimationFrame(this._rafId),this._rafId=0)},s._isPromise=function(e){return!(!e||"function"!=typeof e.then)},t.exports=n},{"./Queue":37,"./QueueItem":38,"@marcom/ac-polyfills/Function/prototype.bind":void 0,"@marcom/ac-polyfills/Promise":void 0,"@marcom/ac-polyfills/requestAnimationFrame":void 0}],37:[function(e,t,r){"use strict";function n(){this._items=[]}var i=e("./QueueItem"),o=n.prototype;o.enqueue=function(e,t){void 0===t&&(t=n.PRIORITY_DEFAULT);var r=new i(e,t);return this.enqueueQueueItem(r)},o.enqueueQueueItem=function(e){return this._items.indexOf(e)===-1&&this._items.push(e),e},o.dequeue=function(){this._heapSort();var e=this._items.length-1,t=this._items[0];return this._items[0]=this._items[e],this._items.pop(),t},o.dequeueQueueItem=function(e){var t=this._items.indexOf(e);return t>-1&&this._items.splice(t,1),e},o.peek=function(){return 0==this.count()?null:(this._heapSort(),this._items[0])},o.isEmpty=function(){return 0===this._items.length},o.count=function(){return this._items.length},o.toString=function(){for(var e=["Queue total items: "+this.count()+"\n"],t=0;t<this.count();++t)e.push(this._items[t].toString()+"\n");return e.join("")},o._heapSort=function(){for(var e=0,t=this._items.length-1;t>=0;t--)for(var r=t;r>0;){e++;var n=Math.floor((r-1)/2);if(this._items[r].compareTo(this._items[n])>=0)break;var i=this._items[r];this._items[r]=this._items[n],this._items[n]=i,r=n}},n.PRIORITY_LOW=10,n.PRIORITY_DEFAULT=5,n.PRIORITY_HIGH=1,t.exports=n},{"./QueueItem":38}],38:[function(e,t,r){"use strict";function n(e,t){this.priority=t,this.data=e,this.insertionOrder=i++}var i=0,o=n.prototype;o.compareTo=function(e){return this.priority<e.priority?-1:this.priority>e.priority?1:this.insertionOrder<e.insertionOrder?-1:1},o.toString=function(){return"QueueItem {priority:"+this.priority+",\tdata:"+this.data+"\tinsertionOrder:"+this.insertionOrder+"}"},t.exports=n},{}],39:[function(e,t,r){"use strict";var n=e("@marcom/ac-shared-instance").SharedInstance,i="ac-raf-emitter-id-generator:sharedRAFEmitterIDGeneratorInstance",o="1.0.3",s=function(){this._currentID=0};s.prototype.getNewID=function(){return this._currentID++,"raf:"+this._currentID},t.exports=n.share(i,o,s)},{"@marcom/ac-shared-instance":54}],40:[function(e,t,r){"use strict";t.exports={majorVersionNumber:"3.x"}},{}],41:[function(e,t,r){"use strict";function n(e){e=e||{},o.call(this),this.id=a.getNewID(),this.executor=e.executor||s,this._reset(),this._willRun=!1,this._didDestroy=!1}var i,o=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,s=e("./sharedRAFExecutorInstance"),a=e("./sharedRAFEmitterIDGeneratorInstance");i=n.prototype=Object.create(o.prototype),i.run=function(){return this._willRun||(this._willRun=!0),this._subscribe()},i.cancel=function(){this._unsubscribe(),this._willRun&&(this._willRun=!1),this._reset()},i.destroy=function(){var e=this.willRun();return this.cancel(),this.executor=null,o.prototype.destroy.call(this),this._didDestroy=!0,e},i.willRun=function(){return this._willRun},i.isRunning=function(){return this._isRunning},i._subscribe=function(){return this.executor.subscribe(this)},i._unsubscribe=function(){return this.executor.unsubscribe(this)},i._onAnimationFrameStart=function(e){this._isRunning=!0,this._willRun=!1,this._didEmitFrameData||(this._didEmitFrameData=!0,this.trigger("start",e))},i._onAnimationFrameEnd=function(e){this._willRun||(this.trigger("stop",e),this._reset())},i._reset=function(){this._didEmitFrameData=!1,this._isRunning=!1},t.exports=n},{"./sharedRAFEmitterIDGeneratorInstance":49,"./sharedRAFExecutorInstance":50,"@marcom/ac-event-emitter-micro":23}],42:[function(e,t,r){"use strict";function n(e){e=e||{},this._reset(),this.updatePhases(),this.eventEmitter=new o,this._willRun=!1,this._totalSubscribeCount=-1,this._requestAnimationFrame=window.requestAnimationFrame,this._cancelAnimationFrame=window.cancelAnimationFrame,this._boundOnAnimationFrame=this._onAnimationFrame.bind(this),this._boundOnExternalAnimationFrame=this._onExternalAnimationFrame.bind(this)}var i,o=e("@marcom/ac-event-emitter-micro/EventEmitterMicro");i=n.prototype,i.frameRequestedPhase="requested",i.startPhase="start",i.runPhases=["update","external","draw"],i.endPhase="end",i.disabledPhase="disabled",i.beforePhaseEventPrefix="before:",i.afterPhaseEventPrefix="after:",i.subscribe=function(e,t){return this._totalSubscribeCount++,this._nextFrameSubscribers[e.id]||(t?this._nextFrameSubscribersOrder.unshift(e.id):this._nextFrameSubscribersOrder.push(e.id),this._nextFrameSubscribers[e.id]=e,this._nextFrameSubscriberArrayLength++,this._nextFrameSubscriberCount++,this._run()),this._totalSubscribeCount},i.subscribeImmediate=function(e,t){return this._totalSubscribeCount++,this._subscribers[e.id]||(t?this._subscribersOrder.splice(this._currentSubscriberIndex+1,0,e.id):this._subscribersOrder.unshift(e.id),this._subscribers[e.id]=e,this._subscriberArrayLength++,this._subscriberCount++),this._totalSubscribeCount},i.unsubscribe=function(e){return!!this._nextFrameSubscribers[e.id]&&(this._nextFrameSubscribers[e.id]=null,this._nextFrameSubscriberCount--,0===this._nextFrameSubscriberCount&&this._cancel(),!0)},i.getSubscribeID=function(){return this._totalSubscribeCount+=1},i.destroy=function(){var e=this._cancel();return this.eventEmitter.destroy(),this.eventEmitter=null,this.phases=null,this._subscribers=null,this._subscribersOrder=null,this._nextFrameSubscribers=null,this._nextFrameSubscribersOrder=null,this._rafData=null,this._boundOnAnimationFrame=null,this._onExternalAnimationFrame=null,e},i.useExternalAnimationFrame=function(e){if("boolean"==typeof e){var t=this._isUsingExternalAnimationFrame;return e&&this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),!this._willRun||e||this._animationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),this._isUsingExternalAnimationFrame=e,e?this._boundOnExternalAnimationFrame:t||!1}},i.updatePhases=function(){this.phases||(this.phases=[]),this.phases.length=0,this.phases.push(this.frameRequestedPhase),this.phases.push(this.startPhase),Array.prototype.push.apply(this.phases,this.runPhases),this.phases.push(this.endPhase),this._runPhasesLength=this.runPhases.length,this._phasesLength=this.phases.length},i._run=function(){if(!this._willRun)return this._willRun=!0,0===this.lastFrameTime&&(this.lastFrameTime=performance.now()),this._animationFrameActive=!0,this._isUsingExternalAnimationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),this.phase===this.disabledPhase&&(this.phaseIndex=0,this.phase=this.phases[this.phaseIndex]),!0},i._cancel=function(){var e=!1;return this._animationFrameActive&&(this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),this._animationFrameActive=!1,this._willRun=!1,e=!0),this._isRunning||this._reset(),e},i._onAnimationFrame=function(e){for(this._subscribers=this._nextFrameSubscribers,this._subscribersOrder=this._nextFrameSubscribersOrder,this._subscriberArrayLength=this._nextFrameSubscriberArrayLength,this._subscriberCount=this._nextFrameSubscriberCount,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this.phaseIndex=0,this.phase=this.phases[this.phaseIndex],this._isRunning=!0,this._willRun=!1,this._didRequestNextRAF=!1,this._rafData.delta=e-this.lastFrameTime,this.lastFrameTime=e,this._rafData.fps=0,this._rafData.delta>=1e3&&(this._rafData.delta=0),0!==this._rafData.delta&&(this._rafData.fps=1e3/this._rafData.delta),this._rafData.time=e,this._rafData.naturalFps=this._rafData.fps,this._rafData.timeNow=Date.now(),this.phaseIndex++,this.phase=this.phases[this.phaseIndex],this.eventEmitter.trigger(this.beforePhaseEventPrefix+this.phase),this._currentSubscriberIndex=0;this._currentSubscriberIndex<this._subscriberArrayLength;this._currentSubscriberIndex++)null!==this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]._onAnimationFrameStart(this._rafData);for(this.eventEmitter.trigger(this.afterPhaseEventPrefix+this.phase),this._runPhaseIndex=0;this._runPhaseIndex<this._runPhasesLength;this._runPhaseIndex++){for(this.phaseIndex++,this.phase=this.phases[this.phaseIndex],this.eventEmitter.trigger(this.beforePhaseEventPrefix+this.phase),this._currentSubscriberIndex=0;this._currentSubscriberIndex<this._subscriberArrayLength;this._currentSubscriberIndex++)null!==this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]].trigger(this.phase,this._rafData);this.eventEmitter.trigger(this.afterPhaseEventPrefix+this.phase)}for(this.phaseIndex++,this.phase=this.phases[this.phaseIndex],this.eventEmitter.trigger(this.beforePhaseEventPrefix+this.phase),this._currentSubscriberIndex=0;this._currentSubscriberIndex<this._subscriberArrayLength;this._currentSubscriberIndex++)null!==this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[this._currentSubscriberIndex]]._onAnimationFrameEnd(this._rafData);this.eventEmitter.trigger(this.afterPhaseEventPrefix+this.phase),this._willRun?(this.phaseIndex=0,this.phaseIndex=this.phases[this.phaseIndex]):this._reset()},i._onExternalAnimationFrame=function(e){this._isUsingExternalAnimationFrame&&this._onAnimationFrame(e)},i._reset=function(){this._rafData||(this._rafData={}),this._rafData.time=0,this._rafData.delta=0,this._rafData.fps=0,this._rafData.naturalFps=0,this._rafData.timeNow=0,this._subscribers={},this._subscribersOrder=[],this._currentSubscriberIndex=-1,this._subscriberArrayLength=0,this._subscriberCount=0,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this._didEmitFrameData=!1,this._animationFrame=null,this._animationFrameActive=!1,this._isRunning=!1,this._shouldReset=!1,this.lastFrameTime=0,this._runPhaseIndex=-1,this.phaseIndex=-1,this.phase=this.disabledPhase},t.exports=n},{"@marcom/ac-event-emitter-micro/EventEmitterMicro":24}],43:[function(e,t,r){"use strict";var n=e("./SingleCallRAFEmitter"),i=function(e){this.phase=e,this.rafEmitter=new n,this._cachePhaseIndex(),this.requestAnimationFrame=this.requestAnimationFrame.bind(this),this.cancelAnimationFrame=this.cancelAnimationFrame.bind(this),this._onBeforeRAFExecutorStart=this._onBeforeRAFExecutorStart.bind(this),this._onBeforeRAFExecutorPhase=this._onBeforeRAFExecutorPhase.bind(this),this._onAfterRAFExecutorPhase=this._onAfterRAFExecutorPhase.bind(this),this.rafEmitter.on(this.phase,this._onRAFExecuted.bind(this)),this.rafEmitter.executor.eventEmitter.on("before:start",this._onBeforeRAFExecutorStart),this.rafEmitter.executor.eventEmitter.on("before:"+this.phase,this._onBeforeRAFExecutorPhase),this.rafEmitter.executor.eventEmitter.on("after:"+this.phase,this._onAfterRAFExecutorPhase),this._frameCallbacks=[],this._currentFrameCallbacks=[],this._nextFrameCallbacks=[],this._phaseActive=!1,this._currentFrameID=-1,this._cancelFrameIdx=-1,this._frameCallbackLength=0,this._currentFrameCallbacksLength=0,this._nextFrameCallbacksLength=0,this._frameCallbackIteration=0},o=i.prototype;o.requestAnimationFrame=function(e,t){return t===!0&&this.rafEmitter.executor.phaseIndex>0&&this.rafEmitter.executor.phaseIndex<=this.phaseIndex?this._phaseActive?(this._currentFrameID=this.rafEmitter.executor.subscribeImmediate(this.rafEmitter,!0),this._frameCallbacks.push(this._currentFrameID,e),this._frameCallbackLength+=2):(this._currentFrameID=this.rafEmitter.executor.subscribeImmediate(this.rafEmitter,!1),this._currentFrameCallbacks.push(this._currentFrameID,e),this._currentFrameCallbacksLength+=2):(this._currentFrameID=this.rafEmitter.run(),this._nextFrameCallbacks.push(this._currentFrameID,e),this._nextFrameCallbacksLength+=2),this._currentFrameID},o.cancelAnimationFrame=function(e){this._cancelFrameIdx=this._nextFrameCallbacks.indexOf(e),this._cancelFrameIdx>-1?this._cancelNextAnimationFrame():(this._cancelFrameIdx=this._currentFrameCallbacks.indexOf(e),this._cancelFrameIdx>-1?this._cancelCurrentAnimationFrame():(this._cancelFrameIdx=this._frameCallbacks.indexOf(e),this._cancelFrameIdx>-1&&this._cancelRunningAnimationFrame()))},o._onRAFExecuted=function(e){for(this._frameCallbackIteration=0;this._frameCallbackIteration<this._frameCallbackLength;this._frameCallbackIteration+=2)this._frameCallbacks[this._frameCallbackIteration+1](e.time,e);this._frameCallbacks.length=0,this._frameCallbackLength=0},o._onBeforeRAFExecutorStart=function(){Array.prototype.push.apply(this._currentFrameCallbacks,this._nextFrameCallbacks.splice(0,this._nextFrameCallbacksLength)),this._currentFrameCallbacksLength=this._nextFrameCallbacksLength,this._nextFrameCallbacks.length=0,this._nextFrameCallbacksLength=0},o._onBeforeRAFExecutorPhase=function(){this._phaseActive=!0,Array.prototype.push.apply(this._frameCallbacks,this._currentFrameCallbacks.splice(0,this._currentFrameCallbacksLength)),this._frameCallbackLength=this._currentFrameCallbacksLength,this._currentFrameCallbacks.length=0,this._currentFrameCallbacksLength=0},o._onAfterRAFExecutorPhase=function(){this._phaseActive=!1},o._cachePhaseIndex=function(){this.phaseIndex=this.rafEmitter.executor.phases.indexOf(this.phase)},o._cancelRunningAnimationFrame=function(){this._frameCallbacks.splice(this._cancelFrameIdx,2),this._frameCallbackLength-=2},o._cancelCurrentAnimationFrame=function(){this._currentFrameCallbacks.splice(this._cancelFrameIdx,2),this._currentFrameCallbacksLength-=2},o._cancelNextAnimationFrame=function(){this._nextFrameCallbacks.splice(this._cancelFrameIdx,2),this._nextFrameCallbacksLength-=2,0===this._nextFrameCallbacksLength&&this.rafEmitter.cancel()},t.exports=i},{"./SingleCallRAFEmitter":45}],44:[function(e,t,r){"use strict";var n=e("./RAFInterface"),i=function(){this.events={}},o=i.prototype;o.requestAnimationFrame=function(e){return this.events[e]||(this.events[e]=new n(e)),this.events[e].requestAnimationFrame},o.cancelAnimationFrame=function(e){return this.events[e]||(this.events[e]=new n(e)),this.events[e].cancelAnimationFrame},t.exports=new i;
},{"./RAFInterface":43}],45:[function(e,t,r){"use strict";var n=e("./RAFEmitter"),i=function(e){n.call(this,e)},o=i.prototype=Object.create(n.prototype);o._subscribe=function(){return this.executor.subscribe(this,!0)},t.exports=i},{"./RAFEmitter":41}],46:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.cancelAnimationFrame("update")},{"./RAFInterfaceController":44}],47:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.requestAnimationFrame("draw")},{"./RAFInterfaceController":44}],48:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.requestAnimationFrame("external")},{"./RAFInterfaceController":44}],49:[function(e,t,r){"use strict";var n=e("@marcom/ac-shared-instance").SharedInstance,i=e("https://www.apple.com/am/.release-info.js").majorVersionNumber,o=function(){this._currentID=0};o.prototype.getNewID=function(){return this._currentID++,"raf:"+this._currentID},t.exports=n.share("@marcom/ac-raf-emitter/sharedRAFEmitterIDGeneratorInstance",i,o)},{"../.release-info.js":40,"@marcom/ac-shared-instance":54}],50:[function(e,t,r){"use strict";var n=e("@marcom/ac-shared-instance").SharedInstance,i=e("https://www.apple.com/am/.release-info.js").majorVersionNumber,o=e("./RAFExecutor");t.exports=n.share("@marcom/ac-raf-emitter/sharedRAFExecutorInstance",i,o)},{"../.release-info.js":40,"./RAFExecutor":42,"@marcom/ac-shared-instance":54}],51:[function(e,t,r){"use strict";var n=e("./RAFInterfaceController");t.exports=n.requestAnimationFrame("update")},{"./RAFInterfaceController":44}],52:[function(e,t,r){"use strict";function n(e){e=e||{},this._reset(),this._willRun=!1,this._totalSubscribeCount=-1,this._requestAnimationFrame=window.requestAnimationFrame,this._cancelAnimationFrame=window.cancelAnimationFrame,this._boundOnAnimationFrame=this._onAnimationFrame.bind(this),this._boundOnExternalAnimationFrame=this._onExternalAnimationFrame.bind(this)}e("@marcom/ac-polyfills/performance/now");var i;i=n.prototype,i.subscribe=function(e,t){return this._totalSubscribeCount++,this._nextFrameSubscribers[e.id]||(t?this._nextFrameSubscribersOrder.unshift(e.id):this._nextFrameSubscribersOrder.push(e.id),this._nextFrameSubscribers[e.id]=e,this._nextFrameSubscriberArrayLength++,this._nextFrameSubscriberCount++,this._run()),this._totalSubscribeCount},i.unsubscribe=function(e){return!!this._nextFrameSubscribers[e.id]&&(this._nextFrameSubscribers[e.id]=null,this._nextFrameSubscriberCount--,0===this._nextFrameSubscriberCount&&this._cancel(),!0)},i.trigger=function(e,t){var r;for(r=0;r<this._subscriberArrayLength;r++)null!==this._subscribers[this._subscribersOrder[r]]&&this._subscribers[this._subscribersOrder[r]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[r]].trigger(e,t)},i.destroy=function(){var e=this._cancel();return this._subscribers=null,this._subscribersOrder=null,this._nextFrameSubscribers=null,this._nextFrameSubscribersOrder=null,this._rafData=null,this._boundOnAnimationFrame=null,this._onExternalAnimationFrame=null,e},i.useExternalAnimationFrame=function(e){if("boolean"==typeof e){var t=this._isUsingExternalAnimationFrame;return e&&this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),!this._willRun||e||this._animationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),this._isUsingExternalAnimationFrame=e,e?this._boundOnExternalAnimationFrame:t||!1}},i._run=function(){if(!this._willRun)return this._willRun=!0,0===this.lastFrameTime&&(this.lastFrameTime=performance.now()),this._animationFrameActive=!0,this._isUsingExternalAnimationFrame||(this._animationFrame=this._requestAnimationFrame.call(window,this._boundOnAnimationFrame)),!0},i._cancel=function(){var e=!1;return this._animationFrameActive&&(this._animationFrame&&(this._cancelAnimationFrame.call(window,this._animationFrame),this._animationFrame=null),this._animationFrameActive=!1,this._willRun=!1,e=!0),this._isRunning||this._reset(),e},i._onSubscribersAnimationFrameStart=function(e){var t;for(t=0;t<this._subscriberArrayLength;t++)null!==this._subscribers[this._subscribersOrder[t]]&&this._subscribers[this._subscribersOrder[t]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[t]]._onAnimationFrameStart(e)},i._onSubscribersAnimationFrameEnd=function(e){var t;for(t=0;t<this._subscriberArrayLength;t++)null!==this._subscribers[this._subscribersOrder[t]]&&this._subscribers[this._subscribersOrder[t]]._didDestroy===!1&&this._subscribers[this._subscribersOrder[t]]._onAnimationFrameEnd(e)},i._onAnimationFrame=function(e){this._subscribers=this._nextFrameSubscribers,this._subscribersOrder=this._nextFrameSubscribersOrder,this._subscriberArrayLength=this._nextFrameSubscriberArrayLength,this._subscriberCount=this._nextFrameSubscriberCount,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this._isRunning=!0,this._willRun=!1,this._didRequestNextRAF=!1,this._rafData.delta=e-this.lastFrameTime,this.lastFrameTime=e,this._rafData.fps=0,this._rafData.delta>=1e3&&(this._rafData.delta=0),0!==this._rafData.delta&&(this._rafData.fps=1e3/this._rafData.delta),this._rafData.time=e,this._rafData.naturalFps=this._rafData.fps,this._rafData.timeNow=Date.now(),this._onSubscribersAnimationFrameStart(this._rafData),this.trigger("update",this._rafData),this.trigger("external",this._rafData),this.trigger("draw",this._rafData),this._onSubscribersAnimationFrameEnd(this._rafData),this._willRun||this._reset()},i._onExternalAnimationFrame=function(e){this._isUsingExternalAnimationFrame&&this._onAnimationFrame(e)},i._reset=function(){this._rafData={time:0,delta:0,fps:0,naturalFps:0,timeNow:0},this._subscribers={},this._subscribersOrder=[],this._subscriberArrayLength=0,this._subscriberCount=0,this._nextFrameSubscribers={},this._nextFrameSubscribersOrder=[],this._nextFrameSubscriberArrayLength=0,this._nextFrameSubscriberCount=0,this._didEmitFrameData=!1,this._animationFrame=null,this._animationFrameActive=!1,this._isRunning=!1,this._shouldReset=!1,this.lastFrameTime=0},t.exports=n},{"@marcom/ac-polyfills/performance/now":void 0}],53:[function(e,t,r){"use strict";var n=e("@marcom/ac-shared-instance").SharedInstance,i="ac-raf-executor:sharedRAFExecutorInstance",o="2.0.1",s=e("./RAFExecutor");t.exports=n.share(i,o,s)},{"./RAFExecutor":52,"@marcom/ac-shared-instance":54}],54:[function(e,t,r){"use strict";t.exports={SharedInstance:e("./ac-shared-instance/SharedInstance")}},{"./ac-shared-instance/SharedInstance":55}],55:[function(e,t,r){"use strict";var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=window,o="AC",s="SharedInstance",a=i[o],u=function(){var e={};return{get:function(t,r){var n=null;return e[t]&&e[t][r]&&(n=e[t][r]),n},set:function(t,r,n){return e[t]||(e[t]={}),"function"==typeof n?e[t][r]=new n:e[t][r]=n,e[t][r]},share:function(e,t,r){var n=this.get(e,t);return n||(n=this.set(e,t,r)),n},remove:function(t,r){var i="undefined"==typeof r?"undefined":n(r);if("string"===i||"number"===i){if(!e[t]||!e[t][r])return;return void(e[t][r]=null)}e[t]&&(e[t]=null)}}}();a||(a=i[o]={}),a[s]||(a[s]=u),t.exports=a[s]},{}],56:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,u=e("./Model/AnimSystemModel"),c=e("./Keyframes/Keyframe"),l=e("./Keyframes/KeyframeCSSClass"),h=e("./Keyframes/KeyframeDiscreteEvent"),f=e("./ScrollGroup"),m=e("./TimeGroup"),p=(e("./utils/arrayToObject"),{update:e("@marcom/ac-raf-emitter/update"),cancelUpdate:e("@marcom/ac-raf-emitter/cancelUpdate"),external:e("@marcom/ac-raf-emitter/external"),draw:e("@marcom/ac-raf-emitter/draw")}),d=null,v=function(e){function t(){n(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));if(d)throw"You cannot create multiple AnimSystems. You probably want to create multiple groups instead. You can have unlimited groups on a page";return d=e,e.groups=[],e.scrollSystems=[],e.timeSystems=[],e._forceUpdateRAFId=-1,e.onScroll=e.onScroll.bind(e),e.onResizedDebounced=e.onResizedDebounced.bind(e),e.onResizeImmediate=e.onResizeImmediate.bind(e),e}return o(t,e),s(t,[{key:"initialize",value:function(){this.timeSystems=[],this.scrollSystems=[],this.groups=[],this.setupEvents(),this.initializeResizeFilter(),this.initializeModel(),this.createDOMGroups(),this.createDOMKeyframes()}},{key:"remove",value:function(){var e=this;return Promise.all(this.groups.map(function(e){return e.remove()})).then(function(){e.groups=null,e.scrollSystems=null,e.timeSystems=null,window.clearTimeout(u.RESIZE_TIMEOUT),window.removeEventListener("scroll",e.onScroll),window.removeEventListener("resize",e.onResizeImmediate),e._events={}})}},{key:"destroy",value:function(){this.remove()}},{key:"createTimeGroup",value:function(e){var t=new m(e,this);return this.groups.push(t),this.timeSystems.push(t),this.trigger(u.EVENTS.ON_GROUP_CREATED,t),t}},{key:"createScrollGroup",value:function(e){if(!e)throw"AnimSystem scroll based groups must supply an HTMLElement";var t=new f(e,this);return this.groups.push(t),this.scrollSystems.push(t),this.trigger(u.EVENTS.ON_GROUP_CREATED,t),t}},{key:"removeGroup",value:function(e){var t=this;return Promise.all(e.keyframeControllers.map(function(t){return e.removeKeyframeController(t)})).then(function(){return new Promise(function(r){var n=t.groups.indexOf(e);n!==-1&&t.groups.splice(n,1),n=t.scrollSystems.indexOf(e),n!==-1&&t.scrollSystems.splice(n,1),n=t.timeSystems.indexOf(e),n!==-1&&t.timeSystems.splice(n,1),e.destroy(),r()})})}},{key:"createDOMGroups",value:function(){var e=this;document.body.setAttribute("data-anim-scroll-group","body"),document.querySelectorAll("[data-anim-scroll-group]").forEach(function(t){return e.createScrollGroup(t)}),document.querySelectorAll("[data-anim-time-group]").forEach(function(t){return e.createTimeGroup(t)}),this.trigger(u.EVENTS.ON_DOM_GROUPS_CREATED,this.groups)}},{key:"createDOMKeyframes",value:function(){var e=this,t=[];[c.DATA_ATTRIBUTE,l.DATA_ATTRIBUTE,h.DATA_ATTRIBUTE].forEach(function(e){for(var r=0;r<12;r++)t.push(e+(0===r?"":"-"+(r-1)))});for(var r=0;r<t.length;r++)for(var n=t[r],i=document.querySelectorAll("["+n+"]"),o=0;o<i.length;o++){var s=i[o],a=JSON.parse(s.getAttribute(n));this.addKeyframe(s,a)}p.update(function(){e.groups.forEach(function(e){return e.onKeyframesDirty({silent:!0})}),e.groups.forEach(function(e){return e.trigger(u.EVENTS.ON_DOM_KEYFRAMES_CREATED,e)}),e.trigger(u.EVENTS.ON_DOM_KEYFRAMES_CREATED,e),e.groups.forEach(function(e){e.forceUpdate({waitForNextUpdate:!1,silent:!0}),e.reconcile()}),e.onScroll()},!0)}},{key:"initializeResizeFilter",value:function(){if(!u.cssDimensionsTracker){var e=document.createElement("div");e.setAttribute("cssDimensionsTracker","true"),e.style.position="fixed",e.style.top="0",e.style.width="100%",e.style.height="100vh",e.style.pointerEvents="none",e.style.visibility="hidden",e.style.zIndex="-1",document.documentElement.appendChild(e),u.cssDimensionsTracker=e}}},{key:"initializeModel",value:function(){u.pageMetrics.windowHeight=u.cssDimensionsTracker.clientHeight,u.pageMetrics.windowWidth=u.cssDimensionsTracker.clientWidth,u.pageMetrics.scrollY=window.scrollY||window.pageYOffset,u.pageMetrics.scrollX=window.scrollX||window.pageXOffset,u.pageMetrics.breakpoint=u.getBreakpoint();var e=document.documentElement.getBoundingClientRect();u.pageMetrics.documentOffsetX=e.left+u.pageMetrics.scrollX,u.pageMetrics.documentOffsetY=e.top+u.pageMetrics.scrollY}},{key:"setupEvents",value:function(){window.removeEventListener("scroll",this.onScroll),window.addEventListener("scroll",this.onScroll),window.removeEventListener("resize",this.onResizeImmediate),window.addEventListener("resize",this.onResizeImmediate)}},{key:"onScroll",value:function(){u.pageMetrics.scrollY=window.scrollY||window.pageYOffset,u.pageMetrics.scrollX=window.scrollX||window.pageXOffset;for(var e=0,t=this.scrollSystems.length;e<t;e++)this.scrollSystems[e]._onScroll();this.trigger(u.PageEvents.ON_SCROLL,u.pageMetrics)}},{key:"onResizeImmediate",value:function(){var e=u.cssDimensionsTracker.clientWidth,t=u.cssDimensionsTracker.clientHeight;if(e!==u.pageMetrics.windowWidth||t!==u.pageMetrics.windowHeight){u.pageMetrics.windowWidth=e,u.pageMetrics.windowHeight=t,u.pageMetrics.scrollY=window.scrollY||window.pageYOffset,u.pageMetrics.scrollX=window.scrollX||window.pageXOffset;var r=document.documentElement.getBoundingClientRect();u.pageMetrics.documentOffsetX=r.left+u.pageMetrics.scrollX,u.pageMetrics.documentOffsetY=r.top+u.pageMetrics.scrollY,window.clearTimeout(u.RESIZE_TIMEOUT),u.RESIZE_TIMEOUT=window.setTimeout(this.onResizedDebounced,250),this.trigger(u.PageEvents.ON_RESIZE_IMMEDIATE,u.pageMetrics)}}},{key:"onResizedDebounced",value:function(){var e=this;p.update(function(){var t=u.pageMetrics.breakpoint,r=u.getBreakpoint(),n=r!==t;if(n){u.pageMetrics.previousBreakpoint=t,u.pageMetrics.breakpoint=r;for(var i=0,o=e.groups.length;i<o;i++)e.groups[i]._onBreakpointChange();e.trigger(u.PageEvents.ON_BREAKPOINT_CHANGE,u.pageMetrics)}for(var s=0,a=e.groups.length;s<a;s++)e.groups[s].forceUpdate({waitForNextUpdate:!1});e.trigger(u.PageEvents.ON_RESIZE_DEBOUNCED,u.pageMetrics)},!0)}},{key:"forceUpdate",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.waitForNextUpdate,n=void 0===r||r,i=t.silent,o=void 0!==i&&i;this._forceUpdateRAFId!==-1&&p.cancelUpdate(this._forceUpdateRAFId);var s=function(){for(var t=0,r=e.groups.length;t<r;t++){var n=e.groups[t];n.forceUpdate({waitForNextUpdate:!1,silent:o})}return-1};this._forceUpdateRAFId=n?p.update(s,!0):s()}},{key:"addKeyframe",value:function(e,t){var r=this.getGroupForTarget(e);return r=r||this.getGroupForTarget(document.body),r.addKeyframe(e,t)}},{key:"getGroupForTarget",value:function(e){if(e._animInfo&&e._animInfo.group)return e._animInfo.group;for(var t=e;t;){if(t._animInfo&&t._animInfo.isGroup)return t._animInfo.group;t=t.parentElement}}},{key:"getControllerForTarget",value:function(e){return e._animInfo&&e._animInfo.controller?e._animInfo.controller:null}}]),t}(a);t.exports=new v},{"./Keyframes/Keyframe":57,"./Keyframes/KeyframeCSSClass":58,"./Keyframes/KeyframeDiscreteEvent":60,"./Model/AnimSystemModel":61,"./ScrollGroup":70,"./TimeGroup":71,"./utils/arrayToObject":72,"@marcom/ac-event-emitter-micro":23,"@marcom/ac-raf-emitter/cancelUpdate":46,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/external":48,"@marcom/ac-raf-emitter/update":51}],57:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("../Model/AnimSystemModel"),s=e("@marcom/sm-math-utils"),a=e("../Model/EasingFunctions"),u=e("../Model/UnitBezier"),c=e("../utils/arrayToObject"),l=function(){function e(t,r){n(this,e),this.controller=t,this.anchors=[],this.jsonProps=r,this.ease=t.group.defaultEase,this.easeFunctionString=o.KeyframeDefaults.easeFunctionString,this.easeFunction=a[this.easeFunctionString],this.start=0,this.end=0,this.localT=0,this.curvedT=0,this.id=0,this.event="",this.needsEventDispatch=!1,this.snapAtCreation=!1,this.isEnabled=!1,this.animValues={},this.breakpointMask="SMLX",this.disabledWhen=[],this.keyframeType=o.KeyframeTypes.Interpolation,this.hold=!1}return i(e,[{key:"destroy",value:function(){this.controller=null,this.anchors=null,this.jsonProps=null,this.easeFunction=null,this.animValues=null}},{key:"remove",value:function(){return this.controller.removeKeyframe(this)}},{key:"parseOptions",value:function(e){var t=this;if(this.jsonProps=e,e.relativeTo&&console.error("KeyframeError: relativeTo has been removed. Use 'anchors' property instead. Found 'relativeTo':\""+e.relativeTo+'"'),""!==e.anchors&&e.anchors){var r=Array.isArray(e.anchors)?e.anchors:[e.anchors];this.anchors=[],r.forEach(function(e){var r=e instanceof Element?e:t.controller.group.element.querySelector(e)||document.querySelector(e);return null===r?void console.warn("Keyframe for",t.controller.friendlyName," `anchor` failed to find '"+e+"' via querySelector in group.element or document"):(t.anchors.push(r),void t.controller.group.metrics.add(r))})}else this.anchors=[],e.anchors=[];if(e.ease?this.ease=parseFloat(e.ease):e.ease=this.ease,e.hasOwnProperty("snapAtCreation")?this.snapAtCreation=e.snapAtCreation:e.snapAtCreation=this.snapAtCreation,e.easeFunction?this.easeFunction=e.easeFunction:e.easeFunction=this.easeFunctionString,e.breakpointMask?this.breakpointMask=e.breakpointMask:e.breakpointMask=this.breakpointMask,e.disabledWhen?this.disabledWhen=Array.isArray(e.disabledWhen)?e.disabledWhen:[e.disabledWhen]:e.disabledWhen=this.disabledWhen,e.hasOwnProperty("hold")?this.hold=e.hold:e.hold=this.hold,this.easeFunction=a[e.easeFunction],!a.hasOwnProperty(e.easeFunction)){var n=u.fromCSSString(e.easeFunction);n?this.easeFunction=n:console.error("Keyframe parseOptions cannot find EasingFunction named '"+e.easingFunction+"'")}for(var i in e)if(o.KeyframeJSONReservedWords.indexOf(i)===-1){var s=e[i];if(Array.isArray(s)){if(this.animValues[i]=this.controller.group.expressionParser.parseArray(this,s),void 0===this.controller.tweenProps[i]||!this.controller._ownerIsElement){var c=0;this.controller._ownerIsElement||(c=this.controller.element[i]);var l=new o.TargetValue(c,o.KeyframeDefaults.epsilon,this.snapAtCreation);this.controller.tweenProps[i]=l}var h=this.controller.tweenProps[i];if(e.epsilon)h.epsilon=e.epsilon;else{var f=Math.abs(this.animValues[i][0]-this.animValues[i][1]),m=Math.min(.001*f,h.epsilon,o.KeyframeDefaults.epsilon);h.epsilon=Math.max(m,1e-4)}}}this.keyframeType=this.hold?o.KeyframeTypes.InterpolationForward:o.KeyframeTypes.Interpolation,e.event&&(this.event=e.event)}},{key:"overwriteProps",value:function(e){this.animValues={};var t=Object.assign({},this.jsonProps,e);this.controller.updateKeyframe(this,t)}},{key:"updateLocalProgress",value:function(e){if(this.start===this.end||e>this.end)return this.localT=1,void(this.curvedT=this.easeFunction(this.localT));var t=(e-this.start)/(this.end-this.start),r=this.hold?this.localT:0;this.localT=s.clamp(t,r,1),this.curvedT=this.easeFunction(this.localT)}},{key:"reconcile",value:function(e){var t=this.animValues[e],r=this.controller.tweenProps[e];r.initialValue=t[0],r.target=t[0]+this.curvedT*(t[1]-t[0]),r.current!==r.target&&(r.current=r.target,this.needsEventDispatch||(this.needsEventDispatch=!0,this.controller.keyframesRequiringDispatch.push(this)))}},{key:"reset",value:function(e){this.localT=e||0;var t=this.ease;this.ease=1;for(var r in this.animValues)this.reconcile(r);this.ease=t}},{key:"onDOMRead",value:function(e){var t=this.animValues[e],r=this.controller.tweenProps[e];r.target=t[0]+this.curvedT*(t[1]-t[0]);var n=r.current;r.current+=(r.target-r.current)*this.ease;var i=r.current-r.target;i<r.epsilon&&i>-r.epsilon&&(r.current=r.target,i=0),""===this.event||this.needsEventDispatch||(i>r.epsilon||i<-r.epsilon||0===i&&n!==r.current)&&(this.needsEventDispatch=!0,this.controller.keyframesRequiringDispatch.push(this))}},{key:"isInRange",value:function(e){return e>=this.start&&e<=this.end}},{key:"setEnabled",value:function(e){e=e||c(Array.from(document.documentElement.classList));var t=this.breakpointMask.indexOf(o.pageMetrics.breakpoint)!==-1,r=!1;return this.disabledWhen.length>0&&(r=this.disabledWhen.some(function(t){return"undefined"!=typeof e[t]})),this.isEnabled=t&&!r,this.isEnabled}},{key:"updateAnimationConstraints",value:function(){this.start=this.controller.group.timeParser.parse(this,this.jsonProps.start),this.end=this.controller.group.timeParser.parse(this,this.jsonProps.end),this.updateAnimatedValueConstraints()}},{key:"updateAnimatedValueConstraints",value:function(){for(var e in this.animValues){var t=this.jsonProps[e];this.animValues[e]=this.controller.group.expressionParser.parseArray(this,t)}}}]),e}();l.DATA_ATTRIBUTE="data-anim-tween",t.exports=l},{"../Model/AnimSystemModel":61,"../Model/EasingFunctions":62,"../Model/UnitBezier":66,"../utils/arrayToObject":72,"@marcom/sm-math-utils":94}],58:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=e("./Keyframe"),c=e("https://www.apple.com/am/Model/AnimSystemModel.js"),l=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return o.keyframeType=c.KeyframeTypes.CSSClass,o._triggerType=t.TRIGGER_TYPE_CSS_CLASS,o.cssClass="",o.friendlyName="",o.style={on:null,off:null},o.toggle=!1,o.isApplied=!1,o}return o(t,e),a(t,[{key:"parseOptions",value:function(e){if(!this.controller._ownerIsElement)throw new TypeError("CSS Keyframes cannot be applied to JS Objects");if(e.x=void 0,e.y=void 0,e.scale=void 0,e.scaleX=void 0,e.scaleY=void 0,e.rotation=void 0,e.opacity=void 0,e.hold=void 0,void 0!==e.toggle&&(this.toggle=e.toggle),void 0!==e.cssClass)this._triggerType=t.TRIGGER_TYPE_CSS_CLASS,this.cssClass=e.cssClass,this.friendlyName="."+this.cssClass,void 0===this.controller.tweenProps.targetClasses&&(this.controller.tweenProps.targetClasses={add:[],remove:[]});else{if(void 0===e.style||!this.isValidStyleProperty(e.style))throw new TypeError("KeyframeCSSClass no 'cssClass` property found. If using `style` property its also missing or invalid");if(this._triggerType=t.TRIGGER_TYPE_STYLE_PROPERTY,this.style=e.style,this.friendlyName="style",this.toggle=void 0!==this.style.off||this.toggle,this.toggle&&void 0===this.style.off){this.style.off={};for(var r in this.style.on)this.style.off[r]=""}void 0===this.controller.tweenProps.targetStyles&&(this.controller.tweenProps.targetStyles={})}if(void 0===e.end&&(e.end=e.start),e.toggle=this.toggle,this._triggerType===t.TRIGGER_TYPE_CSS_CLASS)this.isApplied=this.controller.element.classList.contains(this.cssClass);else{var n=getComputedStyle(this.controller.element);this.isApplied=!0;for(var i in this.style.on)if(n[i]!==this.style.on[i]){this.isApplied=!1;break}}u.prototype.parseOptions.call(this,e),this.animValues[this.friendlyName]=[0,0],void 0===this.controller.tweenProps[this.friendlyName]&&(this.controller.tweenProps[this.friendlyName]=new c.TargetValue(0,1,(!1))),this.keyframeType=c.KeyframeTypes.CSSClass}},{key:"updateLocalProgress",value:function(e){this.isApplied&&!this.toggle||(this.start!==this.end?!this.isApplied&&e>=this.start&&e<=this.end?this._apply():this.isApplied&&this.toggle&&(e<this.start||e>this.end)&&this._unapply():!this.isApplied&&e>=this.start?this._apply():this.isApplied&&this.toggle&&e<this.start&&this._unapply())}},{key:"_apply",value:function(){if(this._triggerType===t.TRIGGER_TYPE_CSS_CLASS)this.controller.tweenProps.targetClasses.add.push(this.cssClass),this.controller.needsClassUpdate=!0;else{for(var e in this.style.on)this.controller.tweenProps.targetStyles[e]=this.style.on[e];this.controller.needsStyleUpdate=!0}this.isApplied=!0}},{key:"_unapply",value:function(){if(this._triggerType===t.TRIGGER_TYPE_CSS_CLASS)this.controller.tweenProps.targetClasses.remove.push(this.cssClass),this.controller.needsClassUpdate=!0;else{for(var e in this.style.off)this.controller.tweenProps.targetStyles[e]=this.style.off[e];this.controller.needsStyleUpdate=!0}this.isApplied=!1}},{key:"isValidStyleProperty",value:function(e){if(!e.hasOwnProperty("on"))return!1;if("object"!==s(e.on))throw new TypeError("KeyframeCSSClass `style` property should be in the form of: {on:{visibility:hidden, otherProperty: value}}");if(this.toggle&&e.hasOwnProperty("off")&&"object"!==s(e.off))throw new TypeError("KeyframeCSSClass `style` property should be in the form of: {on:{visibility:hidden, otherProperty: value}}");return!0}},{key:"reconcile",value:function(e,t){}},{key:"onDOMRead",value:function(e,t){}},{key:"updateAnimatedValueConstraints",value:function(){}}]),t}(u);l.TRIGGER_TYPE_CSS_CLASS=0,l.TRIGGER_TYPE_STYLE_PROPERTY=1,l.DATA_ATTRIBUTE="data-anim-classname",t.exports=l},{"../Model/AnimSystemModel.js":61,"./Keyframe":57}],59:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function g(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:g(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=e("../Model/AnimSystemModel"),c=(e("./Keyframe"),e("./KeyframeCSSClass")),l=e("../Model/InferKeyframeFromProps"),h=e("../utils/arrayToObject"),f=e("../Model/UUID"),m=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,p=e("@marcom/decompose-css-transform"),d={update:e("@marcom/ac-raf-emitter/update"),external:e("@marcom/ac-raf-emitter/external"),draw:e("@marcom/ac-raf-emitter/draw")},v=Math.PI/180,y={create:e("gl-mat4/create"),rotateX:e("gl-mat4/rotateX"),rotateY:e("gl-mat4/rotateY"),rotateZ:e("gl-mat4/rotateZ"),scale:e("gl-mat4/scale")},b=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.uuid=f(),o.group=e,o.element=r,o._ownerIsElement=o.element instanceof Element,o._ownerIsElement?o.friendlyName=o.element.tagName+"."+Array.from(o.element.classList).join("."):o.friendlyName=o.element.friendlyName||o.uuid,o.element._animInfo=o.element._animInfo||new u.AnimInfo(e,o),o.element._animInfo.controller=o,o.element._animInfo.group=o.group,o.element._animInfo.controllers.push(o),o.tweenProps=new u.TweenProps,o.eventObject=new u.EventObject(o),o.needsStyleUpdate=!1,o.needsClassUpdate=!1,o.elementMetrics=o.group.metrics.add(o.element),o.attributes=[],o.keyframes={},o._allKeyframes=[],o._activeKeyframes=[],o.keyframesRequiringDispatch=[],o.updateCachedValuesFromElement(),o.boundsMin=0,o.boundsMax=0,o.mat2d=new Float32Array(6),o.mat4=y.create(),o.needsWrite=!0,o.onDOMWriteImp=o._ownerIsElement?o.onDOMWriteForElement:o.onDOMWriteForObject,o}return o(t,e),s(t,[{key:"destroy",value:function(){if(this.element._animInfo){this.element._animInfo.controller===this&&(this.element._animInfo.controller=null);var e=this.element._animInfo.controllers.indexOf(this);e!==-1&&this.element._animInfo.controllers.splice(e,1),0===this.element._animInfo.controllers.length?this.element._animInfo=null:(this.element._animInfo.controller=this.element._animInfo.controllers[this.element._animInfo.controllers.length-1],this.element._animInfo.group=this.element._animInfo.controller.group)}this.eventObject.controller=null,this.eventObject.element=null,this.eventObject.keyframe=null,this.eventObject.tweenProps=null,this.eventObject=null,this.elementMetrics=null,this.group=null,this.keyframesRequiringDispatch=null;for(var r=0;r<this._allKeyframes.length;r++)this._allKeyframes[r].destroy();this._allKeyframes=null,this._activeKeyframes=null,this.attributes=null,this.keyframes=null,this.element=null,this.tweenProps=null,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"remove",value:function(){return this.group.removeKeyframeController(this)}},{key:"updateCachedValuesFromElement",value:function(){if(this._ownerIsElement){var e=getComputedStyle(this.element),t=p(this.element,!0),r=u.KeyframeDefaults.epsilon,n=!1;this.tweenProps.x=new u.TargetValue(t.translation[0],r,n),this.tweenProps.y=new u.TargetValue(t.translation[1],r,n),this.tweenProps.z=new u.TargetValue(t.translation[2],r,n),this.tweenProps.rotation=new u.TargetValue(t.eulerRotation[2],r,n),this.tweenProps.rotationX=new u.TargetValue(t.eulerRotation[0],r,n),this.tweenProps.rotationY=new u.TargetValue(t.eulerRotation[1],r,n),this.tweenProps.rotationZ=new u.TargetValue(t.eulerRotation[2],r,n),this.tweenProps.scale=new u.TargetValue(t.scale[0],r,n),this.tweenProps.scaleX=new u.TargetValue(t.scale[0],r,n),this.tweenProps.scaleY=new u.TargetValue(t.scale[1],r,n),this.tweenProps.opacity=new u.TargetValue(parseFloat(e.opacity),r,n)}}},{key:"addKeyframe",value:function(e){var t=l(e);if(!t)throw new Error("AnimSystem Cannot create keyframe for from options `"+e+"`");var r=new t(this,e);return r.parseOptions(e),r.id=this._allKeyframes.length,this._allKeyframes.push(r),r}},{key:"needsUpdate",value:function(){for(var e=0,t=this.attributes.length;e<t;e++){var r=this.attributes[e],n=this.tweenProps[r],i=Math.abs(n.current-n.target);if(i>n.epsilon)return!0}return!1}},{key:"updateLocalProgress",value:function(e){for(var t=0,r=this.attributes.length;t<r;t++){var n=this.attributes[t],i=this.keyframes[this.attributes[t]];if(1!==i.length){var o=this.getNearestKeyframeForAttribute(n,e);o&&o.updateLocalProgress(e)}else i[0].updateLocalProgress(e)}}},{key:"reconcile",value:function(){for(var e=0,t=this.attributes.length;e<t;e++){var r=this.attributes[e],n=this.getNearestKeyframeForAttribute(r,this.group.position.local);n.updateLocalProgress(this.group.position.local),n.snapAtCreation&&n.reconcile(r)}}},{key:"determineActiveKeyframes",value:function(e){var t=this;e=e||h(Array.from(document.documentElement.classList));var r=this._activeKeyframes,n=this.attributes;this._activeKeyframes=[],this.attributes=[],this.keyframes={};for(var i=0;i<this._allKeyframes.length;i++){var o=this._allKeyframes[i];if(o.setEnabled(e)){this._activeKeyframes.push(o);for(var s in o.animValues)this.keyframes[s]=this.keyframes[s]||[],
this.keyframes[s].push(o),this.attributes.indexOf(s)===-1&&(this.attributes.push(s),this.tweenProps[s].isActive=!0)}}var a=r.filter(function(e){return t._activeKeyframes.indexOf(e)===-1});if(0!==a.length){var u=n.filter(function(e){return t.attributes.indexOf(e)===-1});if(0!==u.length)if(this.needsWrite=!0,this._ownerIsElement)d.external(function(){var e=["x","y","z","scale","scaleX","scaleY","rotation","rotationX","rotationY","rotationZ"],r=u.filter(function(t){return e.indexOf(t)!==-1});r.length>0&&t.element.style.removeProperty("transform");for(var n=0,i=u.length;n<i;++n){var o=u[n],s=t.tweenProps[o];s.current=s.target=s.initialValue,s.isActive=!1,"opacity"===o&&t.element.style.removeProperty("opacity")}for(var l=0,h=a.length;l<h;++l){var f=a[l];f instanceof c&&f._unapply()}},!0);else for(var l=0,f=u.length;l<f;++l){var m=this.tweenProps[u[l]];m.current=m.target=m.initialValue,m.isActive=!1}}}},{key:"onDOMRead",value:function(e){for(var t=0,r=this.attributes.length;t<r;t++){var n=this.attributes[t];this.tweenProps[n].previousValue=this.tweenProps[n].current;var i=this.getNearestKeyframeForAttribute(n,e.local);i&&i.onDOMRead(n),this.tweenProps[n].previousValue!==this.tweenProps[n].current&&(this.needsWrite=!0)}}},{key:"onDOMWrite",value:function(){(this.needsWrite||this.needsClassUpdate||this.needsStyleUpdate)&&(this.needsWrite=!1,this.onDOMWriteImp(),this.handleEventDispatch())}},{key:"onDOMWriteForObject",value:function(){for(var e=0,t=this.attributes.length;e<t;e++){var r=this.attributes[e];this.element[r]=this.tweenProps[r].current}}},{key:"onDOMWriteForElement",value:function(){var e=this.tweenProps;if(e.z.isActive||e.rotationX.isActive||e.rotationY.isActive){var t=this.mat4;if(t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,e.x.isActive||e.y.isActive||e.z.isActive){var r=e.x.current,n=e.y.current,i=e.z.current;t[12]=t[0]*r+t[4]*n+t[8]*i+t[12],t[13]=t[1]*r+t[5]*n+t[9]*i+t[13],t[14]=t[2]*r+t[6]*n+t[10]*i+t[14],t[15]=t[3]*r+t[7]*n+t[11]*i+t[15]}if(e.rotation.isActive||e.rotationZ.isActive){var o=(e.rotation.current||e.rotationZ.current)*v;y.rotateZ(t,t,o)}if(e.rotationX.isActive){var s=e.rotationX.current*v;y.rotateX(t,t,s)}if(e.rotationY.isActive){var a=e.rotationY.current*v;y.rotateY(t,t,a)}(e.scale.isActive||e.scaleX.isActive||e.scaleY.isActive)&&y.scale(t,t,[e.scale.current,e.scale.current,1]),this.element.style.transform="matrix3d("+t[0]+","+t[1]+","+t[2]+","+t[3]+","+t[4]+","+t[5]+","+t[6]+","+t[7]+","+t[8]+","+t[9]+","+t[10]+","+t[11]+","+t[12]+","+t[13]+","+t[14]+","+t[15]+")"}else if(e.x.isActive||e.y.isActive||e.rotation.isActive||e.rotationZ.isActive||e.scale.isActive||e.scaleX.isActive||e.scaleY.isActive){var u=this.mat2d;if(u[0]=1,u[1]=0,u[2]=0,u[3]=1,u[4]=0,u[5]=0,e.x.isActive||e.y.isActive){var c=e.x.current,l=e.y.current,h=u[0],f=u[1],m=u[2],p=u[3],d=u[4],b=u[5];u[0]=h,u[1]=f,u[2]=m,u[3]=p,u[4]=h*c+m*l+d,u[5]=f*c+p*l+b}if(e.rotation.isActive||e.rotationZ.isActive){var g=(e.rotation.current||e.rotationZ.current)*v,_=u[0],E=u[1],w=u[2],O=u[3],x=u[4],k=u[5],A=Math.sin(g),S=Math.cos(g);u[0]=_*S+w*A,u[1]=E*S+O*A,u[2]=_*-A+w*S,u[3]=E*-A+O*S,u[4]=x,u[5]=k}e.scale.isActive?(u[0]=u[0]*e.scale.current,u[1]=u[1]*e.scale.current,u[2]=u[2]*e.scale.current,u[3]=u[3]*e.scale.current,u[4]=u[4],u[5]=u[5]):(e.scaleX.isActive||e.scaleY.isActive)&&(u[0]=u[0]*e.scaleX.current,u[1]=u[1]*e.scaleX.current,u[2]=u[2]*e.scaleY.current,u[3]=u[3]*e.scaleY.current,u[4]=u[4],u[5]=u[5]),this.element.style.transform="matrix("+u[0]+", "+u[1]+", "+u[2]+", "+u[3]+", "+u[4]+", "+u[5]+")"}if(e.opacity.isActive&&(this.element.style.opacity=e.opacity.current),this.needsStyleUpdate){for(var P in this.tweenProps.targetStyles)null!==this.tweenProps.targetStyles[P]&&(this.element.style[P]=this.tweenProps.targetStyles[P]),this.tweenProps.targetStyles[P]=null;this.needsStyleUpdate=!1}this.needsClassUpdate&&(this.tweenProps.targetClasses.add.length>0&&this.element.classList.add.apply(this.element.classList,this.tweenProps.targetClasses.add),this.tweenProps.targetClasses.remove.length>0&&this.element.classList.remove.apply(this.element.classList,this.tweenProps.targetClasses.remove),this.tweenProps.targetClasses.add.length=0,this.tweenProps.targetClasses.remove.length=0,this.needsClassUpdate=!1)}},{key:"handleEventDispatch",value:function(){if(0!==this.keyframesRequiringDispatch.length){for(var e=0,t=this.keyframesRequiringDispatch.length;e<t;e++){var r=this.keyframesRequiringDispatch[e];r.needsEventDispatch=!1,this.eventObject.keyframe=r,this.eventObject.pageMetrics=u.pageMetrics,this.eventObject.event=r.event,this.trigger(r.event,this.eventObject)}this.keyframesRequiringDispatch.length=0}this.eventObject.keyframe=null,this.eventObject.event="draw",this.trigger("draw",this.eventObject)}},{key:"updateAnimationConstraints",value:function(){for(var e=this,t=0,r=this._activeKeyframes.length;t<r;t++)this._activeKeyframes[t].updateAnimationConstraints();this.attributes.forEach(function(t){1!==e.keyframes[t].length&&e.keyframes[t].sort(u.KeyframeComparison)}),this.updateDeferredPropertyValues()}},{key:"refreshMetrics",value:function(){var e=new Set([this.element]);this._allKeyframes.forEach(function(t){return t.anchors.forEach(function(t){return e.add(t)})}),this.group.metrics.refreshCollection(e),this.group.keyframesDirty=!0}},{key:"updateDeferredPropertyValues",value:function(){for(var e=0,t=this.attributes.length;e<t;e++){var r=this.attributes[e],n=this.keyframes[r],i=n[0];if(!(i.keyframeType>u.KeyframeTypes.InterpolationForward))for(var o=0,s=n.length;o<s;o++){var a=n[o];if(null===a.jsonProps[r][0]){if(0===o){a.animValues[r][0]=this.tweenProps[r].initialValue;continue}a.animValues[r][0]=n[o-1].animValues[r][1]}if(null===a.jsonProps[r][1]){if(o===s-1)throw new RangeError("AnimSystem - last keyframe cannot defer it's end value! "+r+":["+a.jsonProps[r][0]+",null]");a.animValues[r][1]=n[o+1].animValues[r][0]}}}}},{key:"getBounds",value:function(e){this.boundsMin=Number.MAX_VALUE,this.boundsMax=-Number.MAX_VALUE;for(var t=0,r=this.attributes.length;t<r;t++)for(var n=this.keyframes[this.attributes[t]],i=0;i<n.length;i++){var o=n[i];this.boundsMin=Math.min(o.start,this.boundsMin),this.boundsMax=Math.max(o.end,this.boundsMax),e.min=Math.min(o.start,e.min),e.max=Math.max(o.end,e.max)}}},{key:"getNearestKeyframeForAttribute",value:function(e,t){t=void 0!==t?t:this.group.lastPosition;var r=null,n=Number.POSITIVE_INFINITY,i=this.keyframes[e];if(void 0===i)return null;var o=i.length;if(0===o)return null;if(1===o)return i[0];for(var s=0;s<o;s++){var a=i[s];if(a.isInRange(t)){r=a;break}var u=Math.min(Math.abs(t-a.start),Math.abs(t-a.end));u<n&&(n=u,r=a)}return r}},{key:"getAllKeyframesForAttribute",value:function(e){return this.keyframes[e]}},{key:"updateKeyframe",value:function(e,t){var r=this;e.parseOptions(t),e.updateAnimationConstraints(),this.group.keyframesDirty=!0,d.update(function(){r.trigger(u.EVENTS.ON_KEYFRAME_UPDATED,e),r.group.trigger(u.EVENTS.ON_KEYFRAME_UPDATED,e)},!0)}},{key:"removeKeyframe",value:function(e){var t=this,r=this._allKeyframes.indexOf(e);return r===-1?Promise.resolve(null):(this._allKeyframes.splice(r,1),this.group.keyframesDirty=!0,new Promise(function(r){t.group.rafEmitter.executor.eventEmitter.once("before:draw",function(){return r(e)})}))}},{key:"updateAnimation",value:function(e,t){return this.group.gui&&console.warn("KeyframeController.updateAnimation(keyframe,props) has been deprecated. Please use updateKeyframe(keyframe,props)"),this.updateKeyframe(e,t)}}]),t}(m);t.exports=b},{"../Model/AnimSystemModel":61,"../Model/InferKeyframeFromProps":64,"../Model/UUID":65,"../utils/arrayToObject":72,"./Keyframe":57,"./KeyframeCSSClass":58,"@marcom/ac-event-emitter-micro":23,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/external":48,"@marcom/ac-raf-emitter/update":51,"@marcom/decompose-css-transform":76,"gl-mat4/create":96,"gl-mat4/rotateX":98,"gl-mat4/rotateY":99,"gl-mat4/rotateZ":100,"gl-mat4/scale":101}],60:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function h(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:h(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=e("./Keyframe"),c=e("https://www.apple.com/am/Model/AnimSystemModel.js"),l=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return o.keyframeType=c.KeyframeTypes.Event,o.isApplied=!1,o.hasDuration=!1,o.isCurrentlyInRange=!1,o}return o(t,e),s(t,[{key:"parseOptions",value:function(e){e.x=void 0,e.y=void 0,e.scale=void 0,e.scaleX=void 0,e.scaleY=void 0,e.rotation=void 0,e.style=void 0,e.cssClass=void 0,e.rotation=void 0,e.opacity=void 0,e.hold=void 0,void 0===e.end&&(e.end=e.start),this.event=e.event,this.animValues[this.event]=[0,0],"undefined"==typeof this.controller.tweenProps[this.event]&&(this.controller.tweenProps[this.event]=new c.TargetValue(0,1,(!1))),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"parseOptions",this).call(this,e),this.keyframeType=c.KeyframeTypes.Event}},{key:"updateLocalProgress",value:function(e){if(this.hasDuration){var t=this.isCurrentlyInRange,r=e>=this.start&&e<=this.end;if(t===r)return;return this.isCurrentlyInRange=r,void(r&&!t?this._trigger(this.event+":enter"):t&&!r&&this._trigger(this.event+":exit"))}!this.isApplied&&e>=this.start?(this.isApplied=!0,this._trigger(this.event)):this.isApplied&&e<this.start&&(this.isApplied=!1,this._trigger(this.event+":reverse"))}},{key:"_trigger",value:function(e){this.controller.eventObject.event=e,this.controller.eventObject.keyframe=this,this.controller.trigger(e,this.controller.eventObject)}},{key:"updateAnimationConstraints",value:function(){a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"updateAnimationConstraints",this).call(this),this.hasDuration=this.start!==this.end}},{key:"reset",value:function(e){this.isApplied=!1,this.isCurrentlyInRange=!1,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"reset",this).call(this,e)}},{key:"onDOMRead",value:function(e,t){}},{key:"reconcile",value:function(e,t){}},{key:"updateAnimatedValueConstraints",value:function(){}}]),t}(u);l.DATA_ATTRIBUTE="data-anim-event",t.exports=l},{"../Model/AnimSystemModel.js":61,"./Keyframe":57}],61:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i={GUI_INSTANCE:null,ANIM_INSTANCE:null,VIEWPORT_EMITTER_ELEMENT:void 0,LOCAL_STORAGE_KEYS:{GuiPosition:"GuiPosition-0",scrollY:"scrollY",path:"path"},RESIZE_TIMEOUT:-1,BREAKPOINTS:[{name:"S",mediaQuery:"only screen and (max-width: 735px)"},{name:"M",mediaQuery:"only screen and (max-width: 1068px)"},{name:"L",mediaQuery:"only screen and (min-width: 1442px)"},{name:"L",mediaQuery:"only screen and (min-width: 1069px)"}],getBreakpoint:function(){for(var e=0;e<i.BREAKPOINTS.length;e++){var t=i.BREAKPOINTS[e],r=window.matchMedia(t.mediaQuery);if(r.matches)return t.name}},KeyframeDefaults:{ease:1,epsilon:.05,easeFunctionString:"linear",easeFunction:"linear",hold:!1,snapAtCreation:!1,toggle:!1,breakpointMask:"SMLX",event:"",disabledWhen:[],cssClass:""},KeyframeTypes:{Interpolation:0,InterpolationForward:1,CSSClass:2,Event:3},EVENTS:{ON_DOM_KEYFRAMES_CREATED:"ON_DOM_KEYFRAMES_CREATED",ON_DOM_GROUPS_CREATED:"ON_DOM_GROUPS_CREATED",ON_GROUP_CREATED:"ON_GROUP_CREATED",ON_KEYFRAME_UPDATED:"ON_KEYFRAME_UPDATED",ON_TIMELINE_START:"ON_TIMELINE_START",ON_TIMELINE_UPDATE:"ON_TIMELINE_UPDATE",ON_TIMELINE_COMPLETE:"ON_TIMELINE_COMPLETE"},PageEvents:{ON_SCROLL:"ON_SCROLL",ON_RESIZE_IMMEDIATE:"ON_RESIZE_IMMEDIATE",ON_RESIZE_DEBOUNCED:"ON_RESIZE_DEBOUNCED",ON_BREAKPOINT_CHANGE:"ON_BREAKPOINT_CHANGE"},KeyframeJSONReservedWords:["event","cssClass","style","anchors","start","end","epsilon","easeFunction","ease","breakpointMask","disabledWhen"],TweenProps:function o(){n(this,o)},TargetValue:function s(e,t,r){n(this,s),this.epsilon=parseFloat(t),this.snapAtCreation=r,this.initialValue=e,this.target=e,this.current=e,this.previousValue=e,this.isActive=!1},AnimInfo:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.isGroup=r,this.group=e,this.controller=t,this.controllers=[]},Progress:function(){this.local=0,this.localUnclamped=0,this.lastPosition=0},ViewableRange:function(e,t){this.a=e.top-t,this.a<0&&(this.a=e.top),this.b=e.top,this.d=e.bottom,this.c=Math.max(this.d-t,this.b)},pageMetrics:new function(){this.scrollX=0,this.scrollY=0,this.windowWidth=0,this.windowHeight=0,this.documentOffsetX=0,this.documentOffsetY=0,this.previousBreakpoint="",this.breakpoint=""},EventObject:function(e){this.controller=e,this.element=this.controller.element,this.keyframe=null,this.event="",this.tweenProps=this.controller.tweenProps},KeyframeComparison:function(e,t){return e.start<t.start?-1:e.start>t.start?1:0}};t.exports=i},{}],62:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function o(){n(this,o),this.linear=function(e){return e},this.easeInQuad=function(e){return e*e},this.easeOutQuad=function(e){return e*(2-e)},this.easeInOutQuad=function(e){return e<.5?2*e*e:-1+(4-2*e)*e},this.easeInSin=function(e){return 1+Math.sin(Math.PI/2*e-Math.PI/2)},this.easeOutSin=function(e){return Math.sin(Math.PI/2*e)},this.easeInOutSin=function(e){return(1+Math.sin(Math.PI*e-Math.PI/2))/2},this.easeInElastic=function(e){return 0===e?e:(.04-.04/e)*Math.sin(25*e)+1},this.easeOutElastic=function(e){return.04*e/--e*Math.sin(25*e)},this.easeInOutElastic=function(e){return(e-=.5)<0?(.02+.01/e)*Math.sin(50*e):(.02-.01/e)*Math.sin(50*e)+1},this.easeOutBack=function(e){return e-=1,e*e*(2.70158*e+1.70158)+1},this.easeInCubic=function(e){return e*e*e},this.easeOutCubic=function(e){return--e*e*e+1},this.easeInOutCubic=function(e){return e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1},this.easeInQuart=function(e){return e*e*e*e},this.easeOutQuart=function(e){return 1- --e*e*e*e},this.easeInOutQuart=function(e){return e<.5?8*e*e*e*e:1-8*--e*e*e*e},this.easeInQuint=function(e){return e*e*e*e*e},this.easeOutQuint=function(e){return 1+--e*e*e*e*e},this.easeInOutQuint=function(e){return e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e}};t.exports=new i},{}],63:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./AnimSystemModel"),s=function(e,t){return void 0===e||null===e?t:e},a=function(){function e(){n(this,e),this._metrics=new WeakMap}return i(e,[{key:"destroy",value:function(){this._metrics=null}},{key:"add",value:function(e){var t=this._metrics.get(e);if(t)return t;var r=new u(e);return this._metrics.set(e,r),this._refreshMetrics(e,r)}},{key:"get",value:function(e){return this._metrics.get(e)}},{key:"refreshCollection",value:function(e){var t=this;e.forEach(function(e){return t._refreshMetrics(e,null)})}},{key:"refreshMetrics",value:function(e){return this._refreshMetrics(e)}},{key:"_refreshMetrics",value:function(e,t){if(t=t||this._metrics.get(e),!(e instanceof Element))return t.width=s(e.width,0),t.height=s(e.height,0),t.top=s(e.top,0),t.left=s(e.left,0),t.right=t.left+t.width,t.bottom=t.top+t.height,t;if(void 0===e.offsetWidth){var r=e.getBoundingClientRect();return t.width=r.width,t.height=r.height,t.top=o.pageMetrics.scrollY+r.top,t.left=o.pageMetrics.scrollX+r.left,t.right=t.left+t.width,t.bottom=t.top+t.height,t}t.width=e.offsetWidth,t.height=e.offsetHeight,t.top=o.pageMetrics.documentOffsetY,t.left=o.pageMetrics.documentOffsetX;for(var n=e;n;)t.top+=n.offsetTop,t.left+=n.offsetLeft,n=n.offsetParent;return t.right=t.left+t.width,t.bottom=t.top+t.height,t}}]),e}(),u=function(){function e(t){n(this,e),this.top=0,this.bottom=0,this.left=0,this.right=0,this.height=0,this.width=0}return i(e,[{key:"toString",value:function(){return"top:"+this.top+", bottom:"+this.bottom+", left:"+this.left+", right:"+this.right+", height:"+this.height+", width:"+this.width}},{key:"toObject",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right,height:this.height,width:this.width}}}]),e}();t.exports=a},{"./AnimSystemModel":61}],64:[function(e,t,r){"use strict";var n=e("./AnimSystemModel"),i=e("../Keyframes/Keyframe"),o=e("../Keyframes/KeyframeDiscreteEvent"),s=e("../Keyframes/KeyframeCSSClass"),a=function(e){for(var t in e){var r=e[t];if(n.KeyframeJSONReservedWords.indexOf(t)===-1&&Array.isArray(r))return!0}return!1};t.exports=function(e){if(void 0!==e.cssClass||void 0!==e.style){if(a(e))throw"CSS Keyframes cannot tween values, please use multiple keyframes instead";return s}if(a(e))return i;if(e.event)return o;throw delete e.anchors,"Could not determine tween type based on "+JSON.stringify(e)}},{"../Keyframes/Keyframe":57,"../Keyframes/KeyframeCSSClass":58,"../Keyframes/KeyframeDiscreteEvent":60,"./AnimSystemModel":61}],65:[function(e,t,r){"use strict";t.exports=function(){for(var e="",t=0;t<8;t++){var r=16*Math.random()|0;8!==t&&12!==t&&16!==t&&20!==t||(e+="-"),e+=(12===t?4:16===t?3&r|8:r).toString(16)}return e}},{}],66:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=1e-5,s=Math.abs,a=5,u=function(){function e(t,r,i,o){n(this,e),this.cp=new Float32Array(6),this.cp[0]=3*t,this.cp[1]=3*(i-t)-this.cp[0],this.cp[2]=1-this.cp[0]-this.cp[1],this.cp[3]=3*r,this.cp[4]=3*(o-r)-this.cp[3],this.cp[5]=1-this.cp[3]-this.cp[4]}return i(e,[{key:"sampleCurveX",value:function(e){return((this.cp[2]*e+this.cp[1])*e+this.cp[0])*e}},{key:"sampleCurveY",value:function(e){return((this.cp[5]*e+this.cp[4])*e+this.cp[3])*e}},{key:"sampleCurveDerivativeX",value:function(e){return(3*this.cp[2]*e+2*this.cp[1])*e+this.cp[0]}},{key:"solveCurveX",value:function(e){var t,r,n,i,u,c;for(n=e,c=0;c<a;c++){if(i=this.sampleCurveX(n)-e,s(i)<o)return n;if(u=this.sampleCurveDerivativeX(n),s(u)<o)break;n-=i/u}if(t=0,r=1,n=e,n<t)return t;if(n>r)return r;for(;t<r;){if(i=this.sampleCurveX(n),s(i-e)<o)return n;e>i?t=n:r=n,n=.5*(r-t)+t}return n}},{key:"solve",value:function(e){return this.sampleCurveY(this.solveCurveX(e))}}]),e}(),c=/\d*\.?\d+/g;u.fromCSSString=function(e){var t=e.match(c);if(4!==t.length)throw"UnitBezier could not convert "+e+" to cubic-bezier";var r=t.map(Number),n=new u(r[0],r[1],r[2],r[3]);return n.solve.bind(n)},t.exports=u},{}],67:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=e("./Interpreter"),s=new(e("../Model/ElementMetricsLookup")),a={},u=function(){function e(t){n(this,e),this.group=t,this.data={target:null,anchors:null,metrics:this.group.metrics}}return i(e,[{key:"parseArray",value:function(e,t){return[this.parseExpression(e,t[0]),this.parseExpression(e,t[1])]}},{key:"parseExpression",value:function(t,r){return r?"number"==typeof r?r:(this.data.target=t.controller.element,this.data.anchors=t.anchors,this.data.keyframe=t.keyframe,e._parse(r,this.data)):null}},{key:"destroy",value:function(){this.group=null}}],[{key:"_parse",value:function(e,t){var r=a[e]||(a[e]=o.Parse(e,t));return r.execute(t)}},{key:"parse",value:function(t,r){return r=r||{},r&&(r.target&&s.add(r.target),r.anchors&&r.anchors.forEach(function(e){return s.add(e)})),r.metrics=s,e._parse(t,r)}}]),e}();window.ExpressionParser=u,u.programs=a,t.exports=u},{"../Model/ElementMetricsLookup":63,"./Interpreter":68}],68:[function(e,t,r){"use strict";function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("../Model/AnimSystemModel"),u=e("@marcom/sm-math-utils"),c={smoothstep:function(e,t,r){return r=c.clamp((r-e)/(t-e),0,1),r*r*(3-2*r)},deg:function(e){return 180*e/Math.PI},rad:function(e){return e*Math.PI/180},random:function(e,t){return Math.random()*(t-e)+e},atan:Math.atan2};Object.getOwnPropertyNames(Math).forEach(function(e){return c[e]?null:c[e.toLowerCase()]=Math[e]}),Object.getOwnPropertyNames(u).forEach(function(e){return c[e]?null:c[e.toLowerCase()]=u[e]});var l=null,h={ANCHOR_CONST:"a",ALPHA:"ALPHA",LPAREN:"(",RPAREN:")",PLUS:"PLUS",MINUS:"MINUS",MUL:"MUL",DIV:"DIV",INTEGER_CONST:"INTEGER_CONST",FLOAT_CONST:"FLOAT_CONST",COMMA:",",EOF:"EOF"},f={NUMBERS:/\d|\d\.\d/,DIGIT:/\d/,OPERATOR:/[-+*\/]/,PAREN:/[()]/,WHITE_SPACE:/\s/,ALPHA:/[a-zA-Z]|%/,ALPHANUMERIC:/[a-zA-Z0-9]/,OBJECT_UNIT:/^(t|l|b|r|%w|%h|%|h|w)$/,GLOBAL_METRICS_UNIT:/^(px|vh|vw)$/,ANY_UNIT:/^(t|l|b|r|%w|%h|%|h|w|px|vh|vw)$/,MATH_FUNCTION:new RegExp("\\b("+Object.keys(c).join("|")+")\\b","i")},m={round:1,clamp:3,lerp:3,random:2,atan:2,floor:1,ceil:1,abs:1,cos:1,sin:1,smoothstep:3,rad:1,deg:1,pow:2},p=function A(e,t){o(this,A),this.type=e,this.value=t};p.ONE=new p("100",100),p.EOF=new p(h.EOF,null);var d=function S(e){o(this,S),this.type=e},v=function(e){function t(e,r){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"UnaryOp"));return i.token=i.op=e,i.expr=r,i}return i(t,e),t}(d),y=function(e){function t(e,r,i){o(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"BinOp"));return s.left=e,s.op=r,s.right=i,s}return i(t,e),t}(d),b=function(e){function t(e,r){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"MathOp"));if(i.op=e,i.list=r,m[e.value]&&r.length!==m[e.value])throw new Error("Incorrect number of arguments for '"+e.value+"'. Received "+r.length+", expected "+m[e.value]);return i}return i(t,e),t}(d),g=function(e){function t(e){o(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Num"));return r.token=e,r.value=e.value,r}return i(t,e),t}(d),_=(function(e){function t(e){o(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Unit"));return r.token=e,r.value=e.value,r}return i(t,e),t}(d),function(e){function t(e,r,i){o(this,t);var s=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"RefValue"));return s.num=e,s.ref=r,s.unit=i,s}return i(t,e),t}(d)),E=function(e){function t(e,r){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"CSSValue"));return i.ref=e,i.propertyName=r,i}return i(t,e),t}(d),w=function(e){function t(e,r){o(this,t);var i=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"PropValue"));return i.ref=e,i.propertyName=r,i}return i(t,e),t}(d),O=function(){function e(t){o(this,e),this.text=t,this.pos=0,this["char"]=this.text[this.pos],this.tokens=[];for(var r=void 0;(r=this.getNextToken())&&r!==p.EOF;)this.tokens.push(r);this.tokens.push(r)}return s(e,[{key:"advance",value:function(){this["char"]=this.text[++this.pos]}},{key:"skipWhiteSpace",value:function(){for(;null!=this["char"]&&f.WHITE_SPACE.test(this["char"]);)this.advance()}},{key:"name",value:function(){for(var e="";null!=this["char"]&&f.ALPHA.test(this["char"]);)e+=this["char"],this.advance();return new p(h.ALPHA,e)}},{key:"number",value:function(){for(var e="";null!=this["char"]&&f.DIGIT.test(this["char"]);)e+=this["char"],this.advance();if(null!=this["char"]&&"."===this["char"]){for(e+=this["char"],this.advance();null!=this["char"]&&f.DIGIT.test(this["char"]);)e+=this["char"],this.advance();return new p(h.FLOAT_CONST,parseFloat(e))}return new p(h.INTEGER_CONST,parseInt(e))}},{key:"getNextToken",value:function(){for(;null!=this["char"];)if(f.WHITE_SPACE.test(this["char"]))this.skipWhiteSpace();else{if(f.DIGIT.test(this["char"]))return this.number();if(","===this["char"])return this.advance(),new p(h.COMMA,",");if(f.OPERATOR.test(this["char"])){var e="",t=this["char"];switch(t){case"+":e=h.PLUS;break;case"-":e=h.MINUS;break;case"*":e=h.MUL;break;case"/":e=h.DIV}return this.advance(),new p(e,t)}if(f.PAREN.test(this["char"])){var r="",n=this["char"];switch(n){case"(":r=h.LPAREN;break;case")":r=h.RPAREN}return this.advance(),new p(r,n)}if(f.ALPHA.test(this["char"]))return this.name();this.error("Unexpected character "+this["char"])}return p.EOF}}]),e}(),x=function(){function e(t){o(this,e),this.lexer=t,this.pos=0}return s(e,[{key:"error",value:function t(e){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=this.lexer.text.slice(this.pos-3,this.pos+3),t=new Error(e+' in "'+this.lexer.text+'" near "'+n+'". '+r+" ");throw console.error(t.message,l.keyframe||l.target),t}},{key:"consume",value:function(e){var t=this.currentToken;return t.type===e?this.pos+=1:this.error("Invalid token "+this.currentToken.value+", expected "+e),t}},{key:"consumeList",value:function(e){e.includes(this.currentToken)?this.pos+=1:this.error("Invalid token "+this.currentToken.value+", expected "+tokenType)}},{key:"expr",value:function(){for(var e=this.term();this.currentToken.type===h.PLUS||this.currentToken.type===h.MINUS;){var t=this.currentToken;switch(t.value){case"+":this.consume(h.PLUS);break;case"-":this.consume(h.MINUS)}e=new y(e,t,this.term())}return e}},{key:"term",value:function(){for(var e=this.factor();this.currentToken.type===h.MUL||this.currentToken.type===h.DIV;){var t=this.currentToken;switch(t.value){case"*":this.consume(h.MUL);break;case"/":this.consume(h.DIV)}e=new y(e,t,this.factor())}return e}},{key:"factor",value:function(){if(this.currentToken.type===h.PLUS)return new v(this.consume(h.PLUS),this.factor());if(this.currentToken.type===h.MINUS)return new v(this.consume(h.MINUS),this.factor());if(this.currentToken.type===h.INTEGER_CONST||this.currentToken.type===h.FLOAT_CONST){var e=new g(this.currentToken);if(this.pos+=1,f.OPERATOR.test(this.currentToken.value)||this.currentToken.type===h.RPAREN||this.currentToken.type===h.COMMA||this.currentToken.type===h.EOF)return e;if(this.currentToken.type===h.ALPHA&&this.currentToken.value===h.ANCHOR_CONST)return this.consume(h.ALPHA),new _(e,this.anchorIndex(),this.unit(f.ANY_UNIT));if(this.currentToken.type===h.ALPHA)return"%a"===this.currentToken.value&&this.error("%a is invalid, try removing the %"),new _(e,null,this.unit());this.error("Expected a scaling unit type","Such as 'h' / 'w'")}else{if(f.OBJECT_UNIT.test(this.currentToken.value))return new _(new g(p.ONE),null,this.unit());if(this.currentToken.value===h.ANCHOR_CONST){this.consume(h.ALPHA);var t=this.anchorIndex();if(f.OBJECT_UNIT.test(this.currentToken.value))return new _(new g(p.ONE),t,this.unit())}else if(this.currentToken.type===h.ALPHA){if("css"===this.currentToken.value||"prop"===this.currentToken.value){var r="css"===this.currentToken.value?E:w;this.consume(h.ALPHA),this.consume(h.LPAREN);var n=this.propertyName(),i=null;return this.currentToken.type===h.COMMA&&(this.consume(h.COMMA),this.consume(h.ALPHA),i=this.anchorIndex()),this.consume(h.RPAREN),new r(i,n)}if(f.MATH_FUNCTION.test(this.currentToken.value)){var o=this.currentToken.value.toLowerCase();if("number"==typeof c[o])return this.consume(h.ALPHA),new g(new p(h.ALPHA,c[o]));var s=p[o]||new p(o,o),a=[];this.consume(h.ALPHA),this.consume(h.LPAREN);var u=null;do this.currentToken.value===h.COMMA&&this.consume(h.COMMA),u=this.expr(),a.push(u);while(this.currentToken.value===h.COMMA);return this.consume(h.RPAREN),new b(s,a)}}else if(this.currentToken.type===h.LPAREN){this.consume(h.LPAREN);var l=this.expr();return this.consume(h.RPAREN),l}}this.error("Unexpected token "+this.currentToken.value)}},{key:"propertyName",value:function(){for(var e="";this.currentToken.type===h.ALPHA||this.currentToken.type===h.MINUS;)e+=this.currentToken.value,this.pos+=1;return e}},{key:"unit",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f.ANY_UNIT,t=this.currentToken;return t.type===h.ALPHA&&e.test(t.value)?(this.consume(h.ALPHA),new p(h.ALPHA,t.value=t.value.replace(/%(h|w)/,"$1").replace("%","h"))):void this.error("Expected unit type")}},{key:"anchorIndex",value:function(){var e=this.currentToken;return e.type===h.INTEGER_CONST?(this.consume(h.INTEGER_CONST),new g(e)):void this.error("Invalid anchor reference",". Should be something like a0, a1, a2")}},{key:"parse",value:function(){var e=this.expr();return this.currentToken!==p.EOF&&this.error("Unexpected token "+this.currentToken.value),e}},{key:"currentToken",get:function(){return this.lexer.tokens[this.pos]}}]),e}(),k=function(){function e(t){o(this,e),this.parser=t,this.root=t.parse()}return s(e,[{key:"visit",value:function(e){var t=this[e.type];if(!t)throw new Error("No visit method named, "+t);var r=t.call(this,e);return r}},{key:"BinOp",value:function(e){switch(e.op.type){case h.PLUS:return this.visit(e.left)+this.visit(e.right);case h.MINUS:return this.visit(e.left)-this.visit(e.right);case h.MUL:return this.visit(e.left)*this.visit(e.right);case h.DIV:return this.visit(e.left)/this.visit(e.right)}}},{key:"RefValue",value:function(e){var t=this.unwrapReference(e),r=e.unit.value,n=e.num.value,i=l.metrics.get(t);switch(r){case"h":return.01*n*i.height;case"t":return.01*n*i.top;case"vh":return.01*n*a.pageMetrics.windowHeight;case"vw":return.01*n*a.pageMetrics.windowWidth;case"px":return n;case"w":return.01*n*i.width;case"b":return.01*n*i.bottom;case"l":return.01*n*i.left;case"r":return.01*n*i.right}}},{key:"PropValue",value:function(e){var t=null===e.ref?l.target:l.anchors[e.ref.value];return t[e.propertyName]}},{key:"CSSValue",value:function(e){var t=this.unwrapReference(e);return parseFloat(getComputedStyle(t).getPropertyValue(e.propertyName))}},{key:"Num",value:function(e){return e.value}},{key:"UnaryOp",value:function(e){return e.op.type===h.PLUS?+this.visit(e.expr):e.op.type===h.MINUS?-this.visit(e.expr):void 0}},{key:"MathOp",value:function(e){var t=this,r=e.list.map(function(e){return t.visit(e)});return c[e.op.value].apply(null,r)}},{key:"unwrapReference",value:function(e){return null===e.ref?l.target:(e.ref.value>=l.anchors.length&&console.error("Not enough anchors supplied for expression "+this.parser.lexer.text,l.target),
l.anchors[e.ref.value])}},{key:"execute",value:function(e){return l=e,this.visit(this.root)}}],[{key:"Parse",value:function(t){return new e(new x(new O(t)))}}]),e}();t.exports=k},{"../Model/AnimSystemModel":61,"@marcom/sm-math-utils":94}],69:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),o=function(){function e(t){n(this,e),this.group=t}return i(e,[{key:"parse",value:function(e,t){if("number"==typeof t)return t;var r=this.group.expressionParser.parseExpression(e,t);return this.group.convertScrollPositionToTValue(r)}},{key:"destroy",value:function(){this.group=null}}]),e}();t.exports=o},{}],70:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function b(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:b(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,c=e("@marcom/sm-math-utils"),l=e("./utils/arrayToObject"),h=e("./Model/AnimSystemModel"),f=e("./Model/ElementMetricsLookup"),m=e("./Parsing/ExpressionParser"),p=e("./Parsing/TimeParser"),d=e("./Keyframes/KeyframeController"),v={create:e("@marcom/ac-raf-emitter/RAFEmitter"),update:e("@marcom/ac-raf-emitter/update"),draw:e("@marcom/ac-raf-emitter/draw")},y=function(e){function t(e,r){n(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return o.anim=r,o.element=e,o.name=o.name||e.getAttribute("data-anim-scroll-group"),o.isEnabled=!0,o.position=new h.Progress,o.metrics=new f,o.metrics.add(o.element),o.expressionParser=new m(o),o.timeParser=new p(o),o.boundsMin=0,o.boundsMax=0,o.timelineUpdateRequired=!1,o._keyframesDirty=!1,o.viewableRange=o.createViewableRange(),o.defaultEase=h.KeyframeDefaults.ease,o.keyframeControllers=[],o.updateProgress(o.getPosition()),o.onDOMRead=o.onDOMRead.bind(o),o.onDOMWrite=o.onDOMWrite.bind(o),o.gui=null,o.finalizeInit(),o}return o(t,e),s(t,[{key:"finalizeInit",value:function(){this.element._animInfo=new h.AnimInfo(this,null,(!0)),this.setupRAFEmitter()}},{key:"destroy",value:function(){this.expressionParser.destroy(),this.expressionParser=null,this.timeParser.destroy(),this.timeParser=null;for(var e=0,r=this.keyframeControllers.length;e<r;e++)this.keyframeControllers[e].destroy();this.keyframeControllers=null,this.position=null,this.viewableRange=null,this.gui&&(this.gui.destroy(),this.gui=null),this.metrics.destroy(),this.metrics=null,this.rafEmitter.destroy(),this.rafEmitter=null,this.anim=null,this.element._animInfo&&this.element._animInfo.group===this&&(this.element._animInfo.group=null,this.element._animInfo=null),this.element=null,this.isEnabled=!1,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"removeKeyframeController",value:function(e){var t=this;if(!this.keyframeControllers.includes(e))return Promise.resolve();var r=e._allKeyframes;return e._allKeyframes=[],this.keyframesDirty=!0,new Promise(function(n){v.draw(function(){var i=t.keyframeControllers.indexOf(e);return i===-1?void n():(t.keyframeControllers.splice(i,1),e.onDOMWrite(),r.forEach(function(e){return e.destroy()}),e.destroy(),t.gui&&t.gui.create(),void n())},!0)})}},{key:"remove",value:function(){return this.anim.removeGroup(this)}},{key:"setupRAFEmitter",value:function(e){var t=this;this.rafEmitter&&this.rafEmitter.destroy(),this.rafEmitter=e||new v.create,this.rafEmitter.on("update",this.onDOMRead),this.rafEmitter.on("draw",this.onDOMWrite),this.rafEmitter.once("external",function(){return t.reconcile()})}},{key:"requestDOMChange",value:function(){return!!this.isEnabled&&this.rafEmitter.run()}},{key:"onDOMRead",value:function(){this.keyframesDirty&&this.onKeyframesDirty();for(var e=0,t=this.keyframeControllers.length;e<t;e++)this.keyframeControllers[e].onDOMRead(this.position)}},{key:"onDOMWrite",value:function(){for(var e=0,t=this.keyframeControllers.length;e<t;e++)this.keyframeControllers[e].onDOMWrite(this.position);this.needsUpdate()&&this.requestDOMChange()}},{key:"needsUpdate",value:function(){if(this._keyframesDirty)return!0;for(var e=0,t=this.keyframeControllers.length;e<t;e++)if(this.keyframeControllers[e].needsUpdate())return!0;return!1}},{key:"addKeyframe",value:function(e,t){var r=this.getControllerForTarget(e);return null===r&&(r=new d(this,e),this.keyframeControllers.push(r)),this.keyframesDirty=!0,r.addKeyframe(t)}},{key:"forceUpdate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.waitForNextUpdate,r=void 0===t||t,n=e.silent,i=void 0!==n&&n;this.isEnabled&&(this.refreshMetrics(),this.timelineUpdateRequired=!0,r?this.keyframesDirty=!0:this.onKeyframesDirty({silent:i}))}},{key:"onKeyframesDirty",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.silent,r=void 0!==t&&t;this.determineActiveKeyframes(),this.keyframesDirty=!1;for(var n=0,i=this.keyframeControllers.length;n<i;n++)this.keyframeControllers[n].updateAnimationConstraints();this.updateProgress(this.getPosition()),this.updateBounds(),r||this._onScroll(),this.gui&&this.gui.create()}},{key:"refreshMetrics",value:function(){var e=new Set([this.element]);this.keyframeControllers.forEach(function(t){e.add(t.element),t._allKeyframes.forEach(function(t){return t.anchors.forEach(function(t){return e.add(t)})})}),this.metrics.refreshCollection(e),this.viewableRange=this.createViewableRange()}},{key:"reconcile",value:function(){for(var e=0,t=this.keyframeControllers.length;e<t;e++)this.keyframeControllers[e].reconcile()}},{key:"determineActiveKeyframes",value:function(e){e=e||l(Array.from(document.documentElement.classList));for(var t=0,r=this.keyframeControllers.length;t<r;t++)this.keyframeControllers[t].determineActiveKeyframes(e)}},{key:"updateBounds",value:function(){if(0===this.keyframeControllers.length)return this.boundsMin=0,void(this.boundsMax=0);for(var e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},t=0,r=this.keyframeControllers.length;t<r;t++)this.keyframeControllers[t].getBounds(e);var n=this.convertTValueToScrollPosition(e.min),i=this.convertTValueToScrollPosition(e.max);i-n<h.pageMetrics.windowHeight?(e.min=this.convertScrollPositionToTValue(n-.5*h.pageMetrics.windowHeight),e.max=this.convertScrollPositionToTValue(i+.5*h.pageMetrics.windowHeight)):(e.min-=.001,e.max+=.001),this.boundsMin=e.min,this.boundsMax=e.max,this.timelineUpdateRequired=!0}},{key:"createViewableRange",value:function(){return new h.ViewableRange(this.metrics.get(this.element),h.pageMetrics.windowHeight)}},{key:"_onBreakpointChange",value:function(e,t){this.keyframesDirty=!0,this.determineActiveKeyframes()}},{key:"updateProgress",value:function(e){return this.hasDuration()?(this.position.localUnclamped=(e-this.viewableRange.a)/(this.viewableRange.d-this.viewableRange.a),void(this.position.local=c.clamp(this.position.localUnclamped,this.boundsMin,this.boundsMax))):void(this.position.local=this.position.localUnclamped=0)}},{key:"performTimelineDispatch",value:function(){for(var e=0,t=this.keyframeControllers.length;e<t;e++)this.keyframeControllers[e].updateLocalProgress(this.position.local);this.trigger(h.EVENTS.ON_TIMELINE_UPDATE,this.position.local),this.timelineUpdateRequired=!1,this.position.lastPosition!==this.position.local&&(this.position.lastPosition<=this.boundsMin&&this.position.localUnclamped>this.boundsMin?this.trigger(h.EVENTS.ON_TIMELINE_START,this):this.position.lastPosition>=this.boundsMin&&this.position.localUnclamped<this.boundsMin?this.trigger(h.EVENTS.ON_TIMELINE_START+":reverse",this):this.position.lastPosition<=this.boundsMax&&this.position.localUnclamped>=this.boundsMax?this.trigger(h.EVENTS.ON_TIMELINE_COMPLETE,this):this.position.lastPosition>=this.boundsMax&&this.position.localUnclamped<this.boundsMax&&this.trigger(h.EVENTS.ON_TIMELINE_COMPLETE+":reverse",this)),null!==this.gui&&this.gui.onScrollUpdate(this.position)}},{key:"_onScroll",value:function(e){if(!this.isEnabled)return!1;void 0===e&&(e=this.getPosition()),this.updateProgress(e);var t=this.position.lastPosition===this.boundsMin||this.position.lastPosition===this.boundsMax,r=this.position.localUnclamped===this.boundsMin||this.position.localUnclamped===this.boundsMax;if(!this.timelineUpdateRequired&&t&&r&&this.position.lastPosition===e)return void(this.position.local=this.position.localUnclamped);if(this.timelineUpdateRequired||this.position.localUnclamped>this.boundsMin&&this.position.localUnclamped<this.boundsMax)return this.performTimelineDispatch(),this.requestDOMChange(),void(this.position.lastPosition=this.position.localUnclamped);var n=this.position.lastPosition>this.boundsMin&&this.position.lastPosition<this.boundsMax,i=this.position.localUnclamped<=this.boundsMin||this.position.localUnclamped>=this.boundsMax;if(n&&i)return this.performTimelineDispatch(),this.requestDOMChange(),void(this.position.lastPosition=this.position.localUnclamped);var o=this.position.lastPosition<this.boundsMin&&this.position.localUnclamped>this.boundsMax,s=this.position.lastPosition>this.boundsMax&&this.position.localUnclamped<this.boundsMax;(o||s)&&(this.performTimelineDispatch(),this.requestDOMChange(),this.position.lastPosition=this.position.localUnclamped),null!==this.gui&&this.gui.onScrollUpdate(this.position)}},{key:"convertScrollPositionToTValue",value:function(e){return this.hasDuration()?c.map(e,this.viewableRange.a,this.viewableRange.d,0,1):0}},{key:"convertTValueToScrollPosition",value:function(e){return this.hasDuration()?c.map(e,0,1,this.viewableRange.a,this.viewableRange.d):0}},{key:"hasDuration",value:function(){return this.viewableRange.a!==this.viewableRange.d}},{key:"getPosition",value:function(){return h.pageMetrics.scrollY}},{key:"getControllerForTarget",value:function(e){if(!e._animInfo||!e._animInfo.controllers)return null;if(e._animInfo.controller&&e._animInfo.controller.group===this)return e._animInfo.controller;for(var t=e._animInfo.controllers,r=0,n=t.length;r<n;r++)if(t[r].group===this)return t[r];return null}},{key:"trigger",value:function(e,t){if("undefined"!=typeof this._events[e])for(var r=this._events[e].length-1;r>=0;r--)void 0!==t?this._events[e][r](t):this._events[e][r]()}},{key:"keyframesDirty",set:function(e){this._keyframesDirty=e,this._keyframesDirty&&this.requestDOMChange()},get:function(){return this._keyframesDirty}},{key:"keyFrames",get:function(){return this.viewableRange}}]),t}(u);t.exports=y},{"./Keyframes/KeyframeController":59,"./Model/AnimSystemModel":61,"./Model/ElementMetricsLookup":63,"./Parsing/ExpressionParser":67,"./Parsing/TimeParser":69,"./utils/arrayToObject":72,"@marcom/ac-event-emitter-micro":23,"@marcom/ac-raf-emitter/RAFEmitter":41,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/update":51,"@marcom/sm-math-utils":94}],71:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function m(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:m(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=e("./ScrollGroup"),c=e("@marcom/sm-math-utils"),l=0,h={create:e("@marcom/ac-raf-emitter/RAFEmitter")},f=function(e){function t(e,r){n(this,t),e||(e=document.createElement("div"),e.className="TimeGroup-"+l++);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,r));return o.name=o.name||e.getAttribute("data-anim-time-group"),o._isPaused=!0,o._repeats=0,o._isReversed=!1,o._timeScale=1,o}return o(t,e),s(t,[{key:"finalizeInit",value:function(){if(!this.anim)throw"TimeGroup not instantiated correctly. Please use `AnimSystem.createTimeGroup(el)`";this.defaultEase=1,this.onPlayTimeUpdate=this.onPlayTimeUpdate.bind(this),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"finalizeInit",this).call(this)}},{key:"progress",value:function(e){if(void 0===e)return 0===this.boundsMax?0:this.position.local/this.boundsMax;var t=e*this.boundsMax;this.timelineUpdateRequired=!0,this._onScroll(t)}},{key:"time",value:function(e){return void 0===e?this.position.local:(e=c.clamp(e,this.boundsMin,this.boundsMax),this.timelineUpdateRequired=!0,void this._onScroll(e))}},{key:"play",value:function(e){this.reversed(!1),this.isEnabled=!0,this._isPaused=!1,this.time(e),this._playheadEmitter.run()}},{key:"reverse",value:function(e){this.reversed(!0),this.isEnabled=!0,this._isPaused=!1,this.time(e),this._playheadEmitter.run()}},{key:"reversed",value:function(e){return void 0===e?this._isReversed:void(this._isReversed=e)}},{key:"restart",value:function(){this._isReversed?(this.progress(1),this.reverse(this.time())):(this.progress(0),this.play(this.time()))}},{key:"pause",value:function(e){this.time(e),this._isPaused=!0}},{key:"paused",value:function(e){return void 0===e?this._isPaused:(this._isPaused=e,this._isPaused||this.play(),this)}},{key:"onPlayTimeUpdate",value:function(e){if(!this._isPaused){var r=c.clamp(e.delta/1e3,0,.5);this._isReversed&&(r=-r);var n=this.time(),i=n+r*this._timeScale;if(this._repeats===t.REPEAT_FOREVER||this._repeats>0){var o=!1;!this._isReversed&&i>this.boundsMax?(i-=this.boundsMax,o=!0):this._isReversed&&i<0&&(i=this.boundsMax+i,o=!0),o&&(this._repeats=this._repeats===t.REPEAT_FOREVER?t.REPEAT_FOREVER:this._repeats-1)}this.time(i);var s=!this._isReversed&&this.position.local!==this.duration,a=this._isReversed&&0!==this.position.local;s||a?this._playheadEmitter.run():this.paused(!0)}}},{key:"updateProgress",value:function(e){return this.hasDuration()?(this.position.localUnclamped=e,void(this.position.local=c.clamp(this.position.localUnclamped,this.boundsMin,this.boundsMax))):void(this.position.local=this.position.localUnclamped=0)}},{key:"updateBounds",value:function(){if(0===this.keyframeControllers.length)return this.boundsMin=0,void(this.boundsMax=0);for(var e={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY},t=0,r=this.keyframeControllers.length;t<r;t++)this.keyframeControllers[t].getBounds(e);this.boundsMin=0,this.boundsMax=e.max,this.viewableRange.a=this.viewableRange.b=0,this.viewableRange.c=this.viewableRange.d=this.boundsMax,this.timelineUpdateRequired=!0}},{key:"setupRAFEmitter",value:function(e){this._playheadEmitter=new h.create,this._playheadEmitter.on("update",this.onPlayTimeUpdate),a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"setupRAFEmitter",this).call(this,e)}},{key:"needsUpdate",value:function(){return!0}},{key:"timeScale",value:function(e){return void 0===e?this._timeScale:(this._timeScale=e,this)}},{key:"repeats",value:function(e){return void 0===e?this._repeats:void(this._repeats=e)}},{key:"getPosition",value:function(){return this.position.local}},{key:"convertScrollPositionToTValue",value:function(e){return e}},{key:"convertTValueToScrollPosition",value:function(e){return e}},{key:"hasDuration",value:function(){return this.duration>0}},{key:"destroy",value:function(){this._playheadEmitter.destroy(),this._playheadEmitter=null,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"duration",get:function(){return this.keyframesDirty&&this.onKeyframesDirty({silent:!0}),this.boundsMax}}]),t}(u);f.REPEAT_FOREVER=-1,t.exports=f},{"./ScrollGroup":70,"@marcom/ac-raf-emitter/RAFEmitter":41,"@marcom/sm-math-utils":94}],72:[function(e,t,r){"use strict";var n=function(e){return e.reduce(function(e,t){return e[t]=t,e},{})};t.exports=n},{}],73:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function p(e,t,r){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);if(void 0===n){var i=Object.getPrototypeOf(e);return null===i?void 0:p(i,t,r)}if("value"in n)return n.value;var o=n.get;if(void 0!==o)return o.call(r)},u=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,c=e("@marcom/anim-system/Model/AnimSystemModel"),l={create:e("@marcom/ac-raf-emitter/RAFEmitter"),update:e("@marcom/ac-raf-emitter/update"),draw:e("@marcom/ac-raf-emitter/draw")},h=function(){},f=0,m=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.el=e.el,r.gum=e.gum,r.componentName=e.componentName,r._keyframeController=null,r}return o(t,e),s(t,[{key:"destroy",value:function(){this.el=null,this.gum=null,this._keyframeController=null,a(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"destroy",this).call(this)}},{key:"addKeyframe",value:function(e){var t=e.el||this.el;return(e.group||this.anim).addKeyframe(t,e)}},{key:"addDiscreteEvent",value:function(e){e.event=e.event||"Generic-Event-Name-"+f++;var t=void 0!==e.end&&e.end!==e.start,r=this.addKeyframe(e);return t?(e.onEnterOnce&&r.controller.once(e.event+":enter",e.onEnterOnce),e.onExitOnce&&r.controller.once(e.event+":exit",e.onExitOnce),e.onEnter&&r.controller.on(e.event+":enter",e.onEnter),e.onExit&&r.controller.on(e.event+":exit",e.onExit)):(e.onEventOnce&&r.controller.once(e.event,e.onEventOnce),e.onEventReverseOnce&&r.controller.once(e.event+":reverse",e.onEventReverseOnce),e.onEvent&&r.controller.on(e.event,e.onEvent),e.onEventReverse&&r.controller.on(e.event+":reverse",e.onEventReverse)),r}},{key:"addRAFLoop",value:function(e){var t=["start","end"];if(!t.every(function(t){return e.hasOwnProperty(t)}))return void console.log("BubbleGum.BaseComponent::addRAFLoop required options are missing: "+t.join(" "));var r=new l.create;r.on("update",e.onUpdate||h),r.on("draw",e.onDraw||h),r.on("draw",function(){return r.run()});var n=e.onEnter,i=e.onExit;return e.onEnter=function(){r.run(),n?n():0},e.onExit=function(){r.cancel(),i?i():0},this.addDiscreteEvent(e)}},{key:"addContinuousEvent",value:function(e){e.onDraw||console.log("BubbleGum.BaseComponent::addContinuousEvent required option `onDraw` is missing. Consider using a regular keyframe if you do not need a callback"),e.event=e.event||"Generic-Event-Name-"+f++;var t=this.addKeyframe(e);return t.controller.on(e.event,e.onDraw),t}},{key:"mounted",value:function(){}},{key:"onResizeImmediate",value:function(e){}},{key:"onResizeDebounced",value:function(e){}},{key:"onBreakpointChange",value:function(e){}},{key:"anim",get:function(){return this.gum.anim}},{key:"keyframeController",get:function(){return this._keyframeController||(this._keyframeController=this.anim.getControllerForTarget(this.el))}},{key:"pageMetrics",get:function(){return c.pageMetrics}}]),t}(u);t.exports=m},{"@marcom/ac-event-emitter-micro":23,"@marcom/ac-raf-emitter/RAFEmitter":41,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/update":51,"@marcom/anim-system/Model/AnimSystemModel":61}],74:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/ac-event-emitter-micro").EventEmitterMicro,u=e("@marcom/delayed-initializer"),c=e("@marcom/anim-system"),l=e("@marcom/anim-system/Model/AnimSystemModel"),h=e("./ComponentMap"),f={},m=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.el=e,r.anim=c,r.components=[],r.el.getAttribute("data-anim-scroll-group")||r.el.setAttribute("data-anim-scroll-group","bubble-gum-group"),c.on(l.EVENTS.ON_DOM_GROUPS_CREATED,function(e){r.componentsInitialized=!1,r.initComponents(),r.setupEvents()}),c.on(l.EVENTS.ON_DOM_KEYFRAMES_CREATED,function(){r.components.forEach(function(e){return e.mounted()}),r.trigger(t.EVENTS.DOM_COMPONENTS_MOUNTED)}),u.add(function(){return c.initialize()}),r}return o(t,e),s(t,[{key:"initComponents",value:function(){var e=Array.prototype.slice.call(this.el.querySelectorAll("[data-component-list]"));this.el.hasAttribute("data-component-list")&&e.push(this.el);for(var t=0;t<e.length;t++)for(var r=e[t],n=r.getAttribute("data-component-list"),i=n.split(" "),o=0,s=i.length;o<s;o++){var a=i[o];""!==a&&" "!==a&&this.addComponent({el:r,componentName:a})}this.componentsInitialized=!0}},{key:"setupEvents",value:function(){this.onResizeDebounced=this.onResizeDebounced.bind(this),this.onResizeImmediate=this.onResizeImmediate.bind(this),this.onBreakpointChange=this.onBreakpointChange.bind(this),c.on(l.PageEvents.ON_RESIZE_IMMEDIATE,this.onResizeImmediate),c.on(l.PageEvents.ON_RESIZE_DEBOUNCED,this.onResizeDebounced),c.on(l.PageEvents.ON_BREAKPOINT_CHANGE,this.onBreakpointChange)}},{key:"addComponent",value:function(e){var r=e.el,n=e.componentName,i=e.data;if(!h.hasOwnProperty(n))throw"BubbleGum::addComponent could not add component to '"+r.className+"'. No component type '"+n+"' found!";var o=h[n];if(!t.componentIsSupported(o,n))return void 0===f[n]&&(console.log("BubbleGum::addComponent unsupported component '"+n+"'. Reason: '"+n+".IS_SUPPORTED' returned false"),f[n]=!0),null;var s=r.dataset.componentList||"";s.includes(n)||(r.dataset.componentList=s.split(" ").concat(n).join(" "));var a=new o({el:r,data:i,componentName:e.componentName,gum:this,pageMetrics:l.pageMetrics});return this.components.push(a),this.componentsInitialized&&a.mounted(),a}},{key:"removeComponent",value:function(e){var t=this.components.indexOf(e);t!==-1&&(this.components.splice(t,1),e.el.dataset.componentList=e.el.dataset.componentList.split(" ").filter(function(t){return t!==e.componentName}).join(" "),e.destroy())}},{key:"getComponentOfType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement,r="[data-component-list*="+e+"]",n=t.matches(r)?t:t.querySelector(r);return n?this.components.find(function(t){return t instanceof h[e]&&t.el===n}):null}},{key:"getComponentsOfType",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:document.documentElement,r="[data-component-list*="+e+"]",n=t.matches(r)?[t]:Array.from(t.querySelectorAll(r));return this.components.filter(function(t){return t instanceof h[e]&&n.includes(t.el)})}},{key:"getComponentsForElement",value:function(e){return this.components.filter(function(t){return t.el===e})}},{key:"onResizeImmediate",value:function(){this.components.forEach(function(e){return e.onResizeImmediate(l.pageMetrics)})}},{key:"onResizeDebounced",value:function(){this.components.forEach(function(e){return e.onResizeDebounced(l.pageMetrics)})}},{key:"onBreakpointChange",value:function(){this.components.forEach(function(e){return e.onBreakpointChange(l.pageMetrics)})}}],[{key:"componentIsSupported",value:function(e,t){var r=e.IS_SUPPORTED;if(void 0===r)return!0;if("function"!=typeof r)return console.error('BubbleGum::addComponent error in "'+t+'".IS_SUPPORTED - it should be a function which returns true/false'),!0;var n=e.IS_SUPPORTED();return void 0===n?(console.error('BubbleGum::addComponent error in "'+t+'".IS_SUPPORTED - it should be a function which returns true/false'),!0):n}}]),t}(a);m.EVENTS={DOM_COMPONENTS_MOUNTED:"DOM_COMPONENTS_MOUNTED"},t.exports=m},{"./ComponentMap":75,"@marcom/ac-event-emitter-micro":23,"@marcom/anim-system":56,"@marcom/anim-system/Model/AnimSystemModel":61,"@marcom/delayed-initializer":77}],75:[function(e,t,r){"use strict";t.exports={BaseComponent:e("./BaseComponent")}},{"./BaseComponent":73}],76:[function(e,t,r){"use strict";var n={create:e("gl-mat4/create"),invert:e("gl-mat4/invert"),clone:e("gl-mat4/clone"),transpose:e("gl-mat4/transpose")},i={create:e("gl-vec3/create"),dot:e("gl-vec3/dot"),normalize:e("gl-vec3/normalize"),length:e("gl-vec3/length"),cross:e("gl-vec3/cross"),fromValues:e("gl-vec3/fromValues")},o={create:e("gl-vec4/create"),transformMat4:e("gl-vec4/transformMat4"),fromValues:e("gl-vec4/fromValues")},s=(Math.PI/180,180/Math.PI),a=0,u=1,c=3,l=4,h=5,f=7,m=11,p=12,d=13,v=15,y=function(e,t){t=t||!1;for(var r=n.clone(e),a=i.create(),u=i.create(),l=i.create(),h=o.create(),p=o.create(),d=(i.create(),0);d<16;d++)r[d]/=r[v];var y=n.clone(r);y[c]=0,y[f]=0,y[m]=0,y[v]=1;var E=(r[3],r[7],r[11],r[12]),w=r[13],O=r[14],x=(r[15],o.create());if(_(r[c])&&_(r[f])&&_(r[m]))h=o.fromValues(0,0,0,1);else{x[0]=r[c],x[1]=r[f],x[2]=r[m],x[3]=r[v];var k=n.invert(n.create(),y),A=n.transpose(n.create(),k);h=o.transformMat4(h,x,A)}a[0]=E,a[1]=w,a[2]=O;var S=[i.create(),i.create(),i.create()];S[0][0]=r[0],S[0][1]=r[1],S[0][2]=r[2],S[1][0]=r[4],S[1][1]=r[5],S[1][2]=r[6],S[2][0]=r[8],S[2][1]=r[9],S[2][2]=r[10],u[0]=i.length(S[0]),i.normalize(S[0],S[0]),l[0]=i.dot(S[0],S[1]),S[1]=b(S[1],S[0],1,-l[0]),u[1]=i.length(S[1]),i.normalize(S[1],S[1]),l[0]/=u[1],l[1]=i.dot(S[0],S[2]),S[2]=b(S[2],S[0],1,-l[1]),l[2]=i.dot(S[1],S[2]),S[2]=b(S[2],S[1],1,-l[2]),u[2]=i.length(S[2]),i.normalize(S[2],S[2]),l[1]/=u[2],l[2]/=u[2];var P=i.cross(i.create(),S[1],S[2]);if(i.dot(S[0],P)<0)for(d=0;d<3;d++)u[d]*=-1,S[d][0]*=-1,S[d][1]*=-1,S[d][2]*=-1;p[0]=.5*Math.sqrt(Math.max(1+S[0][0]-S[1][1]-S[2][2],0)),p[1]=.5*Math.sqrt(Math.max(1-S[0][0]+S[1][1]-S[2][2],0)),p[2]=.5*Math.sqrt(Math.max(1-S[0][0]-S[1][1]+S[2][2],0)),p[3]=.5*Math.sqrt(Math.max(1+S[0][0]+S[1][1]+S[2][2],0)),S[2][1]>S[1][2]&&(p[0]=-p[0]),S[0][2]>S[2][0]&&(p[1]=-p[1]),S[1][0]>S[0][1]&&(p[2]=-p[2]);var T=o.fromValues(p[0],p[1],p[2],2*Math.acos(p[3])),I=g(p);return t&&(l[0]=Math.round(l[0]*s*100)/100,l[1]=Math.round(l[1]*s*100)/100,l[2]=Math.round(l[2]*s*100)/100,I[0]=Math.round(I[0]*s*100)/100,I[1]=Math.round(I[1]*s*100)/100,I[2]=Math.round(I[2]*s*100)/100,T[3]=Math.round(T[3]*s*100)/100),{translation:a,scale:u,skew:l,perspective:h,quaternion:p,eulerRotation:I,axisAngle:T}},b=function(e,t,r,n){var o=i.create();return o[0]=r*e[0]+n*t[0],o[1]=r*e[1]+n*t[1],o[2]=r*e[2]+n*t[2],o},g=function(e){var t,r,n,o=e[3]*e[3],s=e[0]*e[0],a=e[1]*e[1],u=e[2]*e[2],c=s+a+u+o,l=e[0]*e[1]+e[2]*e[3];return l>.499*c?(r=2*Math.atan2(e[0],e[3]),n=Math.PI/2,t=0,i.fromValues(t,r,n)):l<-.499*c?(r=-2*Math.atan2(e[0],e[3]),n=-Math.PI/2,t=0,i.fromValues(t,r,n)):(r=Math.atan2(2*e[1]*e[3]-2*e[0]*e[2],s-a-u+o),n=Math.asin(2*l/c),t=Math.atan2(2*e[0]*e[3]-2*e[1]*e[2],-s+a-u+o),i.fromValues(t,r,n))},_=function(e){return Math.abs(e)<1e-4},E=function(e){var t=String(getComputedStyle(e).transform).trim(),r=n.create();if("none"===t||""===t)return r;var i,o,s=t.slice(0,t.indexOf("("));if("matrix3d"===s)for(i=t.slice(9,-1).split(","),o=0;o<i.length;o++)r[o]=parseFloat(i[o]);else{if("matrix"!==s)throw new TypeError("Invalid Matrix Value");for(i=t.slice(7,-1).split(","),o=i.length;o--;)i[o]=parseFloat(i[o]);r[a]=i[0],r[u]=i[1],r[p]=i[4],r[l]=i[2],r[h]=i[3],r[d]=i[5]}return r};t.exports=function(e,t){var r=E(e);return y(r,t)}},{"gl-mat4/clone":95,"gl-mat4/create":96,"gl-mat4/invert":97,"gl-mat4/transpose":102,"gl-vec3/create":103,"gl-vec3/cross":104,"gl-vec3/dot":105,"gl-vec3/fromValues":106,"gl-vec3/length":107,"gl-vec3/normalize":108,"gl-vec4/create":109,"gl-vec4/fromValues":110,"gl-vec4/transformMat4":111}],77:[function(e,t,r){"use strict";var n=!1,i=!1,o=[];t.exports={NUMBER_OF_FRAMES_TO_WAIT:30,add:function(e){var t=this;if(i&&e(),o.push(e),!n){n=!0;var r=document.documentElement.scrollHeight,s=0,a=function u(){var e=document.documentElement.scrollHeight;if(r!==e)s=0;else if(s++,s>=t.NUMBER_OF_FRAMES_TO_WAIT)return void o.forEach(function(e){return e()});r=e,requestAnimationFrame(u)};requestAnimationFrame(a)}}}},{}],78:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};n(this,t);var r=void 0;"endpoint"===e.type&&(r="Failed to fetch product prices: The API service endpoint was not specified.");var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,r));return o.name="ConfigurationError",o.type=e.type,o}return o(t,e),s(t,[{key:"showHint",value:function(){"endpoint"===this.type&&(a.warn(this.message+" This may be expected if this page's locale doesn't have an Apple Online Store."),a.info('If prices are expected for this locale, check that the API service endpoint is specified in HTML with %c<link rel="ac:pricing-endpoint" href="/path/to/endpoint">%c or the "fetchProducts" function\'s "endpoint" option.',"font-family:monospace",""));
}}]),t}(Error)},{"./private/logger":90}],79:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}t.exports=function i(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};n(this,i),this.error=e,this.products=t}},{}],80:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e||"Failed to fetch product price: The API service responded with an unexpected data format."));return r.name="InvalidDataError",r}return o(t,e),s(t,[{key:"showHint",value:function(){a.warn(this.message)}}]),t}(Error)},{"./private/logger":90}],81:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/validateObject"),u=e("./InvalidDataError"),c=function(e){return{id:e.isString,name:e.isString,type:function(e){return["WUIP","PART"].includes(e)},price:e.isObject,"price.value":e.isNumber,"price.display":e.isObject,"price.display.disclaimer":e.isOptionalString,"price.display.legal":e.isOptionalString,"price.display.actual":e.isString,"price.display.smart":e.isString,"price.display.from":function(e,t){return"WUIP"===t.type?"string"==typeof e:"undefined"==typeof e}}},l=function(){function e(t){var r=this;if(n(this,e),!e.validate(t))throw new u("Could not create Product, because the given JSON contains invalid data.");Object.entries(t).forEach(function(e){var t=o(e,2),n=t[0],s=t[1];r[n]||Object.defineProperty(r,n,{enumerable:!0,value:"object"===("undefined"==typeof s?"undefined":i(s))?Object.freeze(JSON.parse(JSON.stringify(s))):s})})}return s(e,[{key:"isWUIP",get:function(){return"WUIP"===this.type}},{key:"isPart",get:function(){return"PART"===this.type}}],[{key:"validate",value:function(e){return a(e,c)}}]),e}();t.exports=l},{"./InvalidDataError":80,"./private/validateObject":93}],82:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(){n(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Failed to fetch product prices: The API service responded with a status of 404 (Not Found)."));return e.name="ServiceNotFoundError",e}return o(t,e),s(t,[{key:"showHint",value:function(){a.warn(this.message),a.info('Check the "href" value of the %c<link rel="ac:pricing-endpoint">%c tag or the "fetchProducts" function\'s "endpoint" option, if specified.',"font-family:monospace","")}}]),t}(Error)},{"./private/logger":90}],83:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(){n(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Failed to fetch product prices: The Apple Online Store is temporarily unavailable."));return e.name="ServiceUnavailableError",e}return o(t,e),s(t,[{key:"showHint",value:function(){a.warn(this.message)}}]),t}(Error)},{"./private/logger":90}],84:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Failed to fetch product prices: The API service did not respond within "+e+" seconds, so the request was aborted."));return r.name="TimeoutError",r.timeoutValue=e,r}return o(t,e),s(t,[{key:"showHint",value:function(){a.warn(this.message)}}]),t}(Error)},{"./private/logger":90}],85:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("./private/logger");t.exports=function(e){function t(){n(this,t);var e=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"Failed to fetch prices: An unexpected error occured."));return e.name="UnexpectedError",e}return o(t,e),s(t,[{key:"showHint",value:function(){a.warn(this.message),a.info("The API service endpoint may require authentication and/or authorization.")}}]),t}(Error)},{"./private/logger":90}],86:[function(e,t,r){"use strict";function n(){function e(){return new Promise(function(e,t){var r=_.dummyPrices&&"undefined"!=typeof window&&window.location.search.indexOf(v)>-1;if(r){var n=s(v,null);t(n&&f[n]&&new f[n])}e()})}function t(e){if(_=Object.assign({},d,e,_),!_.endpoint)throw new f.ConfigurationError({type:"endpoint"});var t=_.aliases?Object.entries(_.aliases):[];t.length&&(O=t.reduce(function(e,t){var r=o(t,2),n=r[0],i=r[1];return e[i]=e[i]||[],e[i].push(n),e},{}),g=g.map(function(e){return _.aliases[e]||e}))}function r(){return new Promise(function(e,t){var r=new XMLHttpRequest;r.withCredentials=!0,r.onloadend=e.bind(this,r),r.ontimeout=t.bind(this,new f.TimeoutError(_.timeout)),r.onerror=t.bind(this,new f.UnexpectedError),r.open("https://www.apple.com/am/ipad-10.2/GET",u(_.endpoint,g),!0),r.timeout=1e3*(_.timeout||0),r.send()})}function n(e){var t=parseInt(e.getResponseHeader("x-rewrite-status"),10),r=t||e.status;if(404===r)throw new f.ServiceNotFoundError;if(503===r)throw new f.ServiceUnavailableError;if(r>=400)throw new f.UnexpectedError;if(200===r){var n=c(e.responseText);if(n&&"object"===i(n.items))return n.items}throw new f.InvalidDataError}function y(e){var t={};return Object.entries(e).forEach(function(e){var r=o(e,2),n=r[0],i=r[1],s=null,a=O[n]||[n];try{_.dummyPrices&&"UNKNOWN"===i.type&&(i=l(n,"unknown"),x.push(n)),s=new m(i),999999===s.price.value&&x.push(n)}catch(u){if("InvalidDataError"!==u.name)throw u}a.forEach(function(e){t[e]=s})}),Object.defineProperty(t,"aliases",{value:_.aliases}),h.group("%cResults from Apple Online Store","background-color:#27a33f;color:white;padding:2px 5px"),h.log(t),h.groupEnd(),h.enabled&&x.length&&(h.group("Dummy Prices"),h.warn("Using dummy prices for the following product identifiers: "+x.join(", ")),h.info("$777,777 — The API service may require authentication and/or authorization. \n$888,888 — The product identifer is currently unknown to the API service. \n$999,999 — The product identifier is known to the API service, but the price has yet to be set. \n"),h.groupEnd()),new p(null,t)}function b(e){var t={};g.forEach(function(e){return t[e]=null});var r=new p(e,t);if(!e)return r;var n=!Object.keys(f).some(function(t){return e.name===t});if(n)throw e;if("UnexpectedError"===e.name&&_.dummyPrices){var i={};w.forEach(function(e){i[e]=l(e,"unauthorized"),x.push(e)}),r=new p(e,i)}return e&&"function"==typeof e.showHint&&e.showHint(r.products),r}var g=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],_=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!g.length){var E=new p;return Promise.resolve(E)}Array.isArray(g)||(g=[g]);var w=g,O={},x=[];return a().then(t).then(e).then(r).then(n).then(y)["catch"](b)}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),s=e("@marcom/ac-get-param"),a=e("./private/getOptionsFromHTMLDocument"),u=e("./private/createRequestURL"),c=e("./private/parseJSON"),l=e("./private/mockProductJSON"),h=e("./private/logger"),f={ConfigurationError:e("./ConfigurationError"),ServiceNotFoundError:e("./ServiceNotFoundError"),ServiceUnavailableError:e("./ServiceUnavailableError"),TimeoutError:e("./TimeoutError"),InvalidDataError:e("./InvalidDataError"),UnexpectedError:e("./UnexpectedError")},m=e("./Product"),p=e("./FetchProductsResult"),d={endpoint:null,aliases:null,timeout:5,dummyPrices:!1},v="39f4f1f5-c4a1-4a7c-ab30-085335a11146";t.exports.fetchProducts=n,t.exports.Product=m,Object.entries(f).forEach(function(e){var r=o(e,2),n=r[0],i=r[1];return t.exports[n]=i})},{"./ConfigurationError":78,"./FetchProductsResult":79,"./InvalidDataError":80,"./Product":81,"./ServiceNotFoundError":82,"./ServiceUnavailableError":83,"./TimeoutError":84,"./UnexpectedError":85,"./private/createRequestURL":88,"./private/getOptionsFromHTMLDocument":89,"./private/logger":90,"./private/mockProductJSON":91,"./private/parseJSON":92,"@marcom/ac-get-param":25}],87:[function(e,t,r){"use strict";t.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];return Array.isArray(e)||(e=[e]),e.filter(function(e){return"string"==typeof e}).map(function(e){return encodeURIComponent(String(e).trim())}).join(",")}},{}],88:[function(e,t,r){"use strict";var n=e("./createPartsQueryValue"),i=/\?(.+)/,o=/(#.*)/;t.exports=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e=e.replace(o,"");var r=(e.match(i)||[])[1],s=e;return t.length&&(s+=r?"&":"?",s+="parts="+n(t)),s}},{"./createPartsQueryValue":87}],89:[function(e,t,r){"use strict";var n=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),i=e("@marcom/ac-raf-emitter/update");t.exports=function(){return new Promise(function(e){return"undefined"!=typeof window&&window.document?void i(function(){var t={},r=document.querySelector('link[rel="ac:pricing-endpoint"]');r&&(t.endpoint=(r.getAttribute("href")||"").trim());var i=document.querySelectorAll('meta[name="ac:pricing-alias"]');i.forEach(function(e){var r=(e.getAttribute("content")||"").split("="),i=n(r,2),o=i[0],s=i[1];o&&s&&(t.aliases=t.aliases||{},t.aliases[o]=s)});var o=document.querySelector('meta[name="ac:pricing-dummy"]');o&&(t.dummyPrices="true"===(o.getAttribute("content")||"").trim()),e(t)}):void e({})})}},{"@marcom/ac-raf-emitter/update":51}],90:[function(e,t,r){"use strict";for(var n=e("@marcom/ac-console"),i="[ @marcom/pricing ]",o=Object.keys(n),s=!1,a=function(){var e=o[u],r="function"==typeof n[e]?n[e]:null;r&&(t.exports[e]=function(){var t=Array.prototype.slice.call(arguments);s||"string"!=typeof t[0]||(t[0]=i+" "+t[0]),"group"!==e&&"groupCollapsed"!==e||(s=!0),"groupEnd"===e&&(s=!1),r.apply(n,t)})},u=0,c=o.length;u<c;u++)a();t.exports.enabled=n.enabled},{"@marcom/ac-console":2}],91:[function(e,t,r){"use strict";function n(e,t){var r=e%1===0?0:2;return e>9999?e.toLocaleString(t,{minimumFractionDigits:r,maximumFractionDigits:r}):e.toFixed(r)}var i={unauthorized:777777,unknown:888888};t.exports=function(e,t){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"en",o=parseFloat(i[t]||t||0),s=n(o,r);return{id:e,name:"",type:"WUIP",price:{value:o,display:{actual:"$"+Number(o).toLocaleString(r,{minimumFractionDigits:2}),smart:"$"+s,from:"From $"+s}}}}},{}],92:[function(e,t,r){"use strict";t.exports=function(e){try{return JSON.parse(e)}catch(t){return null}}},{}],93:[function(e,t,r){"use strict";function n(e,t){return t.split(".").reduce(function(e,t){return e&&e[t]},e)}var i=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),o={isString:function(e){return"string"==typeof e},isOptionalString:function(e){return!e||"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:function(e){return"[object Object]"===Object.prototype.toString.call(e)}};t.exports=function(e,t){"function"==typeof t&&(t=t(o));for(var r=Object.entries(t),s=0,a=r.length;s<a;s++){var u=i(r[s],2),c=u[0],l=u[1],h=c.indexOf(".")>-1?n(e,c):e[c];if(l.call(e,h,e)!==!0)return!1}return!0}},{}],94:[function(e,t,r){"use strict";t.exports={lerp:function(e,t,r){return t+(r-t)*e},map:function(e,t,r,n,i){return n+(i-n)*(e-t)/(r-t)},mapClamp:function(e,t,r,n,i){var o=n+(i-n)*(e-t)/(r-t);return Math.max(n,Math.min(i,o))},norm:function(e,t,r){return(e-t)/(r-t)},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},randFloat:function(e,t){return Math.random()*(t-e)+e},randInt:function(e,t){return Math.floor(Math.random()*(t-e)+e)}}},{}],95:[function(e,t,r){function n(e){var t=new Float32Array(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}t.exports=n},{}],96:[function(e,t,r){function n(){var e=new Float32Array(16);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}t.exports=n},{}],97:[function(e,t,r){function n(e,t){var r=t[0],n=t[1],i=t[2],o=t[3],s=t[4],a=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],m=t[11],p=t[12],d=t[13],v=t[14],y=t[15],b=r*a-n*s,g=r*u-i*s,_=r*c-o*s,E=n*u-i*a,w=n*c-o*a,O=i*c-o*u,x=l*d-h*p,k=l*v-f*p,A=l*y-m*p,S=h*v-f*d,P=h*y-m*d,T=f*y-m*v,I=b*T-g*P+_*S+E*A-w*k+O*x;return I?(I=1/I,e[0]=(a*T-u*P+c*S)*I,e[1]=(i*P-n*T-o*S)*I,e[2]=(d*O-v*w+y*E)*I,e[3]=(f*w-h*O-m*E)*I,e[4]=(u*A-s*T-c*k)*I,e[5]=(r*T-i*A+o*k)*I,e[6]=(v*_-p*O-y*g)*I,e[7]=(l*O-f*_+m*g)*I,e[8]=(s*P-a*A+c*x)*I,e[9]=(n*A-r*P-o*x)*I,e[10]=(p*w-d*_+y*b)*I,e[11]=(h*_-l*w-m*b)*I,e[12]=(a*k-s*S-u*x)*I,e[13]=(r*S-n*k+i*x)*I,e[14]=(d*g-p*E-v*b)*I,e[15]=(l*E-h*g+f*b)*I,e):null}t.exports=n},{}],98:[function(e,t,r){function n(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[4],s=t[5],a=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=o*i+c*n,e[5]=s*i+l*n,e[6]=a*i+h*n,e[7]=u*i+f*n,e[8]=c*i-o*n,e[9]=l*i-s*n,e[10]=h*i-a*n,e[11]=f*i-u*n,e}t.exports=n},{}],99:[function(e,t,r){function n(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],u=t[3],c=t[8],l=t[9],h=t[10],f=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i-c*n,e[1]=s*i-l*n,e[2]=a*i-h*n,e[3]=u*i-f*n,e[8]=o*n+c*i,e[9]=s*n+l*i,e[10]=a*n+h*i,e[11]=u*n+f*i,e}t.exports=n},{}],100:[function(e,t,r){function n(e,t,r){var n=Math.sin(r),i=Math.cos(r),o=t[0],s=t[1],a=t[2],u=t[3],c=t[4],l=t[5],h=t[6],f=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=o*i+c*n,e[1]=s*i+l*n,e[2]=a*i+h*n,e[3]=u*i+f*n,e[4]=c*i-o*n,e[5]=l*i-s*n,e[6]=h*i-a*n,e[7]=f*i-u*n,e}t.exports=n},{}],101:[function(e,t,r){function n(e,t,r){var n=r[0],i=r[1],o=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*o,e[9]=t[9]*o,e[10]=t[10]*o,e[11]=t[11]*o,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}t.exports=n},{}],102:[function(e,t,r){function n(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],o=t[6],s=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=o,e[11]=t[14],e[12]=i,e[13]=s,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e}t.exports=n},{}],103:[function(e,t,r){function n(){var e=new Float32Array(3);return e[0]=0,e[1]=0,e[2]=0,e}t.exports=n},{}],104:[function(e,t,r){function n(e,t,r){var n=t[0],i=t[1],o=t[2],s=r[0],a=r[1],u=r[2];return e[0]=i*u-o*a,e[1]=o*s-n*u,e[2]=n*a-i*s,e}t.exports=n},{}],105:[function(e,t,r){function n(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}t.exports=n},{}],106:[function(e,t,r){function n(e,t,r){var n=new Float32Array(3);return n[0]=e,n[1]=t,n[2]=r,n}t.exports=n},{}],107:[function(e,t,r){function n(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}t.exports=n},{}],108:[function(e,t,r){function n(e,t){var r=t[0],n=t[1],i=t[2],o=r*r+n*n+i*i;return o>0&&(o=1/Math.sqrt(o),e[0]=t[0]*o,e[1]=t[1]*o,e[2]=t[2]*o),e}t.exports=n},{}],109:[function(e,t,r){function n(){var e=new Float32Array(4);return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}t.exports=n},{}],110:[function(e,t,r){function n(e,t,r,n){var i=new Float32Array(4);return i[0]=e,i[1]=t,i[2]=r,i[3]=n,i}t.exports=n},{}],111:[function(e,t,r){function n(e,t,r){var n=t[0],i=t[1],o=t[2],s=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*o+r[12]*s,e[1]=r[1]*n+r[5]*i+r[9]*o+r[13]*s,e[2]=r[2]*n+r[6]*i+r[10]*o+r[14]*s,e[3]=r[3]*n+r[7]*i+r[11]*o+r[15]*s,e}t.exports=n},{}],112:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/bubble-gum/BaseComponent"),u=(e("@marcom/anim-system"),function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.body=document.querySelector("body"),r}return o(t,e),s(t,[{key:"mounted",value:function(){this.localNavBackground=document.querySelector("#ac-localnav.ac-localnav-scrim .ac-ln-background"),this.localnavDarkthemeTransition=Boolean(this.el.dataset.localnavDarkthemeTransition)||!1,this.localnavDarkthemeTransition===!1&&this.initialize()}},{key:"initialize",value:function(){var e=this;this.addDiscreteEvent({start:"t",end:"b",event:"change-localnav-color",onEnter:function(){return e.updateLocalNavColor()}})}},{key:"updateLocalNavColor",value:function(){this.localNavBackground.style.transitionDuration="0.2s",this.localNavBackground.style.transitionTimingFunction="cubic-bezier(0.28, 0.11, 0.32, 1)",this.localNavBackground.style.transitionDelay="0s",this.localNavBackground.style.backgroundColor=this._setLightNavColor()}},{key:"addLocalNavDarkTheme",value:function(){this.localNavBackground.style.backgroundColor=this._setDarkNavColor(),this.localNavBackground.style.transitionDuration="1s",this.localNavBackground.style.transitionDelay="0s",this.localNavBackground.style.transitionTimingFunction="cubic-bezier(0.25, 0.46, 0.45, 0.94)",this.body.classList.add("ac-theme-dark")}},{key:"removeLocalNavDarkTheme",value:function(){this.localNavBackground.style.backgroundColor=this._setLightNavColor(),this.localNavBackground.style.transitionDuration="1s",this.localNavBackground.style.transitionDelay="0.15s",this.localNavBackground.style.transitionTimingFunction="cubic-bezier(0.55, 0.085, 0.68, 0.53)",this.body.classList.remove("ac-theme-dark")}},{key:"_setLightNavColor",value:function(){return this.el.dataset.localnavColor||"rgba(255, 255, 255, 0.9)"}},{key:"_setDarkNavColor",value:function(){return"rgba(17, 17, 17, 0.7)"}}]),t}(a));t.exports=u},{"@marcom/anim-system":56,"@marcom/bubble-gum/BaseComponent":73}],113:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/bubble-gum/BaseComponent"),u=e("@marcom/ac-progressive-image-loader/ProgressiveImageLoader"),c={update:e("@marcom/ac-raf-emitter/update"),draw:e("@marcom/ac-raf-emitter/draw")},l=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));try{r._loadOptions=JSON.parse(r.el.getAttribute("data-progressive-image-options"))}catch(o){r._loadOptions=null}return r.imageLoader=new u({container:r.el,includeContainer:!0}),r}return o(t,e),s(t,[{key:"mounted",value:function(){var e=this,t=this.el.querySelectorAll("[data-progressive-image]").length,r=this.el.querySelectorAll("figure").length;return 0===t&&r>0?void console.log("Warning: Attempting to progressively load images on a container without any progressive-images",this.el):void c.update(function(){e.addDiscreteEvent({start:"t - 200vh",end:"b + 100vh",event:"ProgressiveImageLoad",allowRTL:!0,onEnter:function(){return e.imageLoader.load(e._loadOptions)}})})}},{key:"destroy",value:function(){this.imageLoader.destroy(),this.imageLoader=null}}],[{key:"IS_SUPPORTED",value:function(){return document.documentElement.classList.contains("progressive-image")}}]),t}(a);t.exports=l},{"@marcom/ac-progressive-image-loader/ProgressiveImageLoader":34,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/update":51,"@marcom/bubble-gum/BaseComponent":73}],114:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e){return{X:"xlarge",L:"large",M:"medium",S:"small"}[e]}var a=function(){function e(e,t){var r=[],n=!0,i=!1,o=void 0;try{for(var s,a=e[Symbol.iterator]();!(n=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);n=!0);}catch(u){i=!0,o=u}finally{try{!n&&a["return"]&&a["return"]()}finally{if(i)throw o}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),u=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=e("@marcom/bubble-gum/BaseComponent"),l=3,h=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));r.video=r.el.querySelector("video")||r.el,r.options=e.data||{},r.pauseRelativeTo=r.options.pauseRelativeTo||r.el.getAttribute("data-pause-relative-to"),r.isFirefox=document.documentElement.classList.contains("firefox"),r.inView=!1,r.sources={},Object.entries(r.video.dataset).filter(function(e){var t=a(e,1),r=t[0];return 0===r.indexOf("src")}).forEach(function(e){var t=a(e,2),n=t[0],i=t[1],o=n.replace(/^src/,"").toLowerCase();r.sources[o]=i});var o=void 0;return Object.defineProperty(r,"currentViewport",{set:function(e){o=s(e),r.load(o)},get:function(){return o}}),r.currentViewport=e.pageMetrics.breakpoint,r.previousSource=null,r.inLoadArea=!1,r.addDiscreteEvent({event:"Video: Load",start:r.options.loadAreaStart||"t - 200vh",end:r.options.loadAreaEnd||"b + 100vh",onEnter:function(){r.inLoadArea=!0,r.load()},onExit:function(){r.inLoadArea=!1}}),r.autoplayKeyframe=r.addDiscreteEvent({event:"Video: Pause Offscreen",start:"t - 50vh",end:"b + 50vh",onEnter:function(){return r.queueVideoPlayback()},onExit:function(){return r.pauseVideoPlayback()}}),r.video.addEventListener("playing",function(){r.el.classList.remove("waiting-to-start"),r.el.classList.remove("ended")}),r.video.addEventListener("ended",function(){r.el.classList.remove("waiting-to-start"),r.el.classList.add("ended")}),r}return o(t,e),u(t,[{key:"onBreakpointChange",value:function(e){this.currentViewport=e.breakpoint,this.inView&&this.video.play()}},{key:"load",value:function(e){if(this.inLoadArea){e=e||this.currentViewport;var t=this.sources[e],r=window.devicePixelRatio>=2?"_2x":"",n=t.split(".mp4")[0],i="mp4";t=""+n+r+"."+i,t&&t!==this.previousSource&&(this.video.autoplay=this.video.readyState>=l&&!this.video.paused,this.video.src=this.previousSource=t,this.video.load())}}},{key:"showStartFrame",value:function(){this.video.currentTime=0,this.el.classList.add("waiting-to-start"),this.el.classList.remove("ended"),this.pauseVideoPlayback()}},{key:"queueVideoPlayback",value:function(){var e=this;this.inView=!0,"function"==typeof this._onCanPlay&&this.video.removeEventListener("canplay",this._onCanPlay),this.video.readyState<l?(this._onCanPlay=function(){e.video.play(),e.video.removeEventListener("canplay",e._onCanPlay)},this.video.addEventListener("canplay",this._onCanPlay),this.isFirefox&&this.video.play()):this.video.play()}},{key:"pauseVideoPlayback",value:function(){this.inView=!1,this.video.paused||this.video.pause()}}],[{key:"IS_SUPPORTED",value:function(){return document.documentElement.classList.contains("screen-animations-supported")}}]),t}(c);t.exports=h},{"@marcom/bubble-gum/BaseComponent":73}],115:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/bubble-gum/BaseComponent"),u=e("@marcom/anim-system"),c=e("@marcom/ac-accessibility/TextZoom"),l={update:e("@marcom/ac-raf-emitter/update"),draw:e("@marcom/ac-raf-emitter/draw")},h=function(e){function t(e){return n(this,t),i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));
}return o(t,e),s(t,[{key:"mounted",value:function(){this.body=document.querySelector("body"),this.main=document.querySelector(".main"),this.transitionLayer=this.createTransitionLayer(this.main),this.headlineLight=this.el.querySelector(".image-overview-hometheater-headline-light"),this.headlineDark=this.el.querySelector(".image-overview-hometheater-headline-dark"),this.ipadLight=this.el.querySelector(".image-overview-hometheater-hero-light"),this.ipadDark=this.el.querySelector(".image-overview-hometheater-hero-dark"),this.paragraphLight=this.el.querySelector(".hometheater-paragraph-container .section-copy-block"),this.paragraphDark=this.cloneElement(this.paragraphLight),this.animatingElements=[this.transitionLayer,this.headlineLight,this.headlineDark,this.ipadLight,this.ipadDark,this.paragraphLight,this.paragraphDark],this.bodyBgColor="#FFF",this.sectionBgColor="#F2F2F2",this.transitionState="out",this.localNavColorChanger=this.gum.getComponentOfType("LocalNavColorChanger",this.el),this.initialize()}},{key:"initialize",value:function(){this.createTransitionTimeGroup(),this.createKeyframeController(),this.setInitialProps(),this.checkForTextZoomChange()}},{key:"createKeyframeController",value:function(){var e=this;this.addDiscreteEvent({start:"a0t - 100vh",onEvent:function(){return e.transitionIn()},onEventReverse:function(){return e.transitionOut()},anchors:[".section-hometheater .hometheater-hero-dark"]}),this.addDiscreteEvent({start:"a0t - 100vh",onEvent:function(){return e.transitionOut()},onEventReverse:function(){return e.transitionIn()},breakpointMask:"LMX",anchors:[".section-portable .section-headline"]}),this.addDiscreteEvent({start:"a0t - 95vh",onEvent:function(){return e.transitionOut()},onEventReverse:function(){return e.transitionIn()},breakpointMask:"S",anchors:[".section-portable .section-headline"]}),this.addDiscreteEvent({start:"a0b",onEvent:function(){return e.transitionIn()},onEventReverse:function(){return e.transitionOut()},breakpointMask:"LX",anchors:[".section-photos .section-paragraph"]}),this.addDiscreteEvent({start:"a0t",onEvent:function(){return e.transitionIn()},onEventReverse:function(){return e.transitionOut()},breakpointMask:"MS",anchors:[".section-photos .section-paragraph"]}),this.addDiscreteEvent({start:"a0t - 100vh + 5px",onEvent:function(){return e.resetTransition()},anchors:[".section-portable .section-headline"]}),this.addDiscreteEvent({start:"a0b - 5px",onEventReverse:function(){return e.resetTransition()},breakpointMask:"LX",anchors:[".section-photos .section-paragraph"]}),this.addDiscreteEvent({start:"a0t - 5px",onEventReverse:function(){return e.resetTransition()},breakpointMask:"MS",anchors:[".section-photos .section-paragraph"]}),this.transitionLayerController=u.getControllerForTarget(this.transitionLayer),this.transitionLayerController.on("update-props",function(t){var r=t.tweenProps.opacity.current;0===r&&e.setTransitionOutProps(),0!==r&&1!==r||e.setWillChange(!1)})}},{key:"createTransitionTimeGroup",value:function(){this.transitionTimeGroup=u.createTimeGroup(),this.transitionTimeGroup.addKeyframe(this.transitionLayer,{snapAtCreation:!0,start:0,end:.75,ease:.1,opacity:[0,1],easeFunction:"easeOutQuad",event:"update-props"}),this.transitionTimeGroup.addKeyframe(this.headlineLight,{start:.25,end:1,ease:.1,opacity:[1,0],easeFunction:"easeOutQuad"}),this.transitionTimeGroup.addKeyframe(this.headlineDark,{start:.25,end:1,ease:.1,opacity:[0,1],easeFunction:"easeOutQuad"}),this.transitionTimeGroup.addKeyframe(this.ipadLight,{start:.25,end:1,ease:.1,opacity:[1,0],easeFunction:"easeOutQuad"}),this.transitionTimeGroup.addKeyframe(this.ipadDark,{start:.25,end:1,ease:.1,opacity:[0,1],easeFunction:"easeOutQuad"}),this.transitionTimeGroup.addKeyframe(this.paragraphLight,{start:.25,end:1,ease:.1,opacity:[1,0],easeFunction:"easeOutQuad"}),this.transitionTimeGroup.addKeyframe(this.paragraphDark,{start:.25,end:1,ease:.1,opacity:[0,1],easeFunction:"easeOutQuad"}),this.transitionDuration=1e3*this.transitionTimeGroup.duration}},{key:"createTransitionLayer",value:function(e){var t=document.createElement("div");return t.setAttribute("class","transition-layer"),t.style.display="block",t.style.position="fixed",t.style.zIndex="-1",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100vh",t.style.opacity="0",t.style.backgroundColor="#111",e.prepend(t),e.querySelector(".transition-layer")}},{key:"cloneElement",value:function(e){var t=e.cloneNode(!0);return t.setAttribute("role","presentation"),t.setAttribute("tabIndex","-1"),t.setAttribute("aria-hidden","true"),t.classList.add("theme-dark"),t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.right="0",e.parentNode.insertBefore(t,e.nextSibling)}},{key:"transitionIn",value:function(){"out"===this.transitionState&&(this.transitionState="in",this.setTransitionInProps(),this.setWillChange(!0),this.transitionTimeGroup.play(),this.localNavColorChanger.addLocalNavDarkTheme())}},{key:"transitionOut",value:function(){"in"===this.transitionState&&(this.transitionState="out",this.setWillChange(!0),this.transitionTimeGroup.reverse(),this.localNavColorChanger.removeLocalNavDarkTheme())}},{key:"setTransitionOutProps",value:function(){this.el.style.zIndex="auto",this.transitionLayer.style.zIndex=-1,this.el.style.backgroundColor=this.sectionBgColor,this.body.style.backgroundColor=this.bodyBgColor}},{key:"setTransitionInProps",value:function(){this.el.style.zIndex=10,this.transitionLayer.style.zIndex=5,this.el.style.backgroundColor="initial",this.body.style.backgroundColor=this.sectionBgColor}},{key:"setInitialProps",value:function(){var e=this;l.update(function(){"out"===e.transitionState&&e.setTransitionOutProps()})}},{key:"resetTransition",value:function(){var e=this;this.transitionOut(),this.timer&&clearTimeout(this.timer),this.timer=setTimeout(function(){e.setInitialProps()},this.transitionDuration+500)}},{key:"setWillChange",value:function(e){this.animatingElements.forEach(function(t){t.style.willChange=e?"opacity":"initial"})}},{key:"onResizeDebounced",value:function(){this.resetTransition()}},{key:"checkForTextZoomChange",value:function(){this.isSafari=document.documentElement.classList.contains("safari"),this.currentFontSize=c.currentSize,this.isSafari&&window.addEventListener("resize",this.onTextZoomResize.bind(this),!1)}},{key:"onTextZoomResize",value:function(){c.remove(),c.detect();var e=document.documentElement.classList.contains("text-zoom"),t=c.currentSize;this.isTextZoomed===e&&this.currentFontSize===t||(this.isTextZoomed=e,this.currentFontSize=c.currentSize,u.forceUpdate({silent:!1,waitForNextUpdate:!0}))}}],[{key:"IS_SUPPORTED",value:function(){return document.documentElement.classList.contains("hometheater-transition-supported")}}]),t}(a);t.exports=h},{"@marcom/ac-accessibility/TextZoom":1,"@marcom/ac-raf-emitter/draw":47,"@marcom/ac-raf-emitter/update":51,"@marcom/anim-system":56,"@marcom/bubble-gum/BaseComponent":73}],116:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=e("@marcom/bubble-gum/BaseComponent"),u=e("@marcom/anim-system"),c=e("@marcom/anim-system/Model/AnimSystemModel"),l=function(e){function t(e){n(this,t);var r=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.snipes=r.el.querySelectorAll(".snipe-anim-sprite"),r.animationInit=!1,r.animationEnded=!1,r.inView=!1,r.scrollMetrics=0,r.scrollOffset=0,r.setEndOfAnimation=r.setEndOfAnimation.bind(r),r.snipeEnter=r.snipeEnter.bind(r),r.snipeExit=r.snipeExit.bind(r),r}return o(t,e),s(t,[{key:"mounted",value:function(){var e=this;this.snipes.forEach(function(e){e.style.animation="none"}),this.addDiscreteEvent({start:"t - 100vh + h",end:"b",event:"snipe-animation",onEnter:this.snipeEnter,onExit:this.snipeExit}),u.on(c.PageEvents.ON_SCROLL,function(t){e.scrollMetrics=t.scrollY,e.animationEnded&&!e.inView&&e._resetSnipeAnimation()})}},{key:"_resetSnipeAnimation",value:function(){var e=this,t=Math.abs(this.scrollOffset-this.scrollMetrics);t>this.el.offsetHeight&&(this.animationInit=!1,this.animationEnded=!1,this.snipes.forEach(function(t){t.style.animation="none",t.removeEventListener("animationend",e.setEndOfAnimation)}))}},{key:"_setAnimPlayState",value:function(e){this.snipes.forEach(function(t){t.style.animationPlayState=e})}},{key:"setEndOfAnimation",value:function(){this.animationEnded=!0}},{key:"snipeEnter",value:function(){var e=this;this.inView=!0,this.animationInit||(this.snipes.forEach(function(t){t.removeAttribute("style"),t.addEventListener("animationend",e.setEndOfAnimation)}),this.animationInit=!0),this._setAnimPlayState("running")}},{key:"snipeExit",value:function(){this.inView=!1,this._setAnimPlayState("paused"),this.animationEnded&&(this.scrollOffset=this.scrollMetrics)}}],[{key:"IS_SUPPORTED",value:function(){return document.documentElement.classList.contains("snipe-animations-supported")}}]),t}(a);t.exports=l},{"@marcom/anim-system":56,"@marcom/anim-system/Model/AnimSystemModel":61,"@marcom/bubble-gum/BaseComponent":73}],117:[function(e,t,r){"use strict";var n=e("@marcom/bubble-gum/BubbleGum"),i=e("@marcom/bubble-gum/ComponentMap"),o=e("./model/ComponentMap"),s=e("@marcom/ac-accessibility/TextZoom"),a=e("@marcom/pricing"),u=a.fetchProducts,c={initialize:function(){Object.assign(i,o);var e=document.querySelector("body");new n(e);s.detect(),this.displayPrices()},displayPrices:function(){var e=this,t=document.querySelector(".hero-dynamic-price");t&&u(["ipad-10.2"]).then(function(r){var n=r.error,i=r.products;e.trackDynamicPricingState(n);var o=i["ipad-10.2"];if(o){var s=t.getAttribute("data-pricing-template");t.textContent=s?s.replace("{price}",o.price.display.smart):o.price.display.from}})},trackDynamicPricingState:function(t){try{var r=e("@marcom/ac-analytics"),n={Success:"DP-S0",ConfigurationError:"DP-E1",ServiceNotFoundError:"DP-E2",ServiceUnavailableError:"DP-E3",TimeoutError:"DP-E4",InvalidDataError:"DP-E5",UnexpectedError:"DP-E6"}[t&&t.name||"Success"];r.passiveTracker({eVar100:n})}catch(i){}}};c.initialize()},{"./model/ComponentMap":118,"@marcom/ac-accessibility/TextZoom":1,"@marcom/ac-analytics":void 0,"@marcom/bubble-gum/BubbleGum":74,"@marcom/bubble-gum/ComponentMap":75,"@marcom/pricing":86}],118:[function(e,t,r){"use strict";t.exports={ProgressiveImage:e("../components/ProgressiveImageComponent"),VideoViewportSource:e("../components/VideoViewportSource"),LocalNavColorChanger:e("../components/LocalNavColorChanger"),HomeTheaterTransition:e("../components/overview/HomeTheaterTransition"),SnipeAnimation:e("../components/overview/SnipeAnimation")}},{"../components/LocalNavColorChanger":112,"../components/ProgressiveImageComponent":113,"../components/VideoViewportSource":114,"../components/overview/HomeTheaterTransition":115,"../components/overview/SnipeAnimation":116}]},{},[117]);